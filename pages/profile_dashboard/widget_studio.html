<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Widget Studio - Inque</title>
    <link rel="stylesheet" href="/core/styles/index.css" />
    <link
      rel="stylesheet"
      href="/pages/page_modals/modal_styles/profile_banner.css"
    />
    <link rel="stylesheet" href="pd_styles/widget_studio.css" />
    <script src="https://www.google.com/recaptcha/enterprise.js?render=6Ldt0YYrAAAAAKyNgAPO8Te96_m5innDHsSkppQc"></script>
    <div id="profileHubContainer"></div>
  </head>
  <body>
    <!-- Navigation Header -->
    <header class="widget-studio-header">
      <div class="header-content">
        <div class="header-left">
          <a href="/pages/profile_dashboard/my-projects.html" class="back-btn">
            <span class="btn-icon">‚Üê</span>
            Yor Profile
          </a>
          <h1 class="page-title">üé® Widget Studio</h1>
        </div>
        <div class="header-right">
          <div class="user-info" id="userInfo">
            <div class="user-avatar" id="userAvatar">
              <span class="avatar-placeholder">üë§</span>
            </div>
            <span class="user-name" id="userName">Loading...</span>
          </div>
        </div>
      </div>
    </header>

    <!-- Main Content -->
    <main class="widget-studio-main">
      <div class="studio-container">
        <!-- Studio Welcome Section -->
        <div class="studio-welcome">
          <div class="welcome-content">
            <h2>Welcome to Your Widget Studio</h2>
            <p>
              Create, preview, and manage your interactive widgets. Each slot
              can hold a complete project with multiple files.
            </p>
            <button
              class="onboarding-trigger-btn"
              id="showZipUploadOnboardingBtn"
            >
              <span class="btn-icon">üì¶</span>
              Zip Upload Guide
            </button>
            <div class="studio-stats">
              <div class="stat-item">
                <span class="stat-number" id="totalWidgets">0</span>
                <span class="stat-label">Total Widgets</span>
              </div>
              <div class="stat-item">
                <span class="stat-number" id="activeSlots">0</span>
                <span class="stat-label">Active Slots</span>
              </div>
              <div class="stat-item">
                <span class="stat-number" id="totalFiles">0</span>
                <span class="stat-label">Total Files</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Widget Slots Grid -->
        <div class="widget-slots-grid">
          <!-- Slot 1 -->
          <div class="widget-slot" data-slot="1">
            <div class="slot-header">
              <h3>Slot 1</h3>
              <span class="slot-status" id="slot1Status">Available</span>
            </div>

            <div class="slot-content">
              <!-- File Upload Area -->
              <div class="file-upload-area" id="uploadArea1">
                <input
                  type="file"
                  class="file-input"
                  data-slot="1"
                  accept=".zip,application/zip"
                  id="fileInput1"
                />
                <div class="upload-placeholder" id="placeholder1">
                  <span class="upload-icon">üì¶</span>
                  <p>Drop your project ZIP file here or click to upload</p>
                  <span class="upload-hint"
                    >Upload a complete project as a ZIP file for the best
                    experience</span
                  >
                </div>
              </div>

              <!-- Selected Files Display -->
              <div
                class="selected-files"
                id="selectedFiles1"
                style="display: none"
              >
                <h4>Selected Files</h4>
                <div class="files-list" id="filesList1"></div>
                <button class="clear-files-btn" data-slot="1">
                  Clear All Files
                </button>
              </div>

              <!-- Widget Information -->
              <div class="widget-info">
                <div class="info-group">
                  <label for="title1">Widget Title</label>
                  <input
                    type="text"
                    class="widget-title"
                    data-slot="1"
                    id="title1"
                    placeholder="Enter widget title"
                  />
                </div>
                <div class="info-group">
                  <label for="description1">Description</label>
                  <textarea
                    class="widget-description"
                    data-slot="1"
                    id="description1"
                    placeholder="Describe your widget"
                    rows="3"
                  ></textarea>
                </div>
                <div class="info-group">
                  <label for="tags1">Tags (optional)</label>
                  <input
                    type="text"
                    class="widget-tags"
                    data-slot="1"
                    id="tags1"
                    placeholder="e.g., game, utility, showcase"
                  />
                </div>
              </div>

              <!-- Slot Actions -->
              <div class="slot-actions">
                <button class="preview-btn" data-slot="1" id="previewBtn1">
                  <span class="btn-icon">üëÅÔ∏è</span>
                  Preview
                </button>
                <button class="upload-btn" data-slot="1" id="uploadBtn1">
                  <span class="btn-icon">üöÄ</span>
                  Upload to Slot 1
                </button>
              </div>

              <!-- Upload Progress -->
              <div class="upload-progress" id="progress1" style="display: none">
                <div class="progress-bar">
                  <div class="progress-fill" id="progressFill1"></div>
                </div>
                <span class="progress-text" id="progressText1">0%</span>
              </div>
            </div>
          </div>

          <!-- Slot 2 -->
          <div class="widget-slot" data-slot="2">
            <div class="slot-header">
              <h3>Slot 2</h3>
              <span class="slot-status" id="slot2Status">Available</span>
            </div>

            <div class="slot-content">
              <!-- File Upload Area -->
              <div class="file-upload-area" id="uploadArea2">
                <input
                  type="file"
                  class="file-input"
                  data-slot="2"
                  accept=".zip,application/zip"
                  id="fileInput2"
                />
                <div class="upload-placeholder" id="placeholder2">
                  <span class="upload-icon">üì¶</span>
                  <p>Drop your project ZIP file here or click to upload</p>
                  <span class="upload-hint"
                    >Upload a complete project as a ZIP file for the best
                    experience</span
                  >
                </div>
              </div>

              <!-- Selected Files Display -->
              <div
                class="selected-files"
                id="selectedFiles2"
                style="display: none"
              >
                <h4>Selected Files</h4>
                <div class="files-list" id="filesList2"></div>
                <button class="clear-files-btn" data-slot="2">
                  Clear All Files
                </button>
              </div>

              <!-- Widget Information -->
              <div class="widget-info">
                <div class="info-group">
                  <label for="title2">Widget Title</label>
                  <input
                    type="text"
                    class="widget-title"
                    data-slot="2"
                    id="title2"
                    placeholder="Enter widget title"
                  />
                </div>
                <div class="info-group">
                  <label for="description2">Description</label>
                  <textarea
                    class="widget-description"
                    data-slot="2"
                    id="description2"
                    placeholder="Describe your widget"
                    rows="3"
                  ></textarea>
                </div>
                <div class="info-group">
                  <label for="tags2">Tags (optional)</label>
                  <input
                    type="text"
                    class="widget-tags"
                    data-slot="2"
                    id="tags2"
                    placeholder="e.g., game, utility, showcase"
                  />
                </div>
              </div>

              <!-- Slot Actions -->
              <div class="slot-actions">
                <button class="preview-btn" data-slot="2" id="previewBtn2">
                  <span class="btn-icon">üëÅÔ∏è</span>
                  Preview
                </button>
                <button class="upload-btn" data-slot="2" id="uploadBtn2">
                  <span class="btn-icon">üöÄ</span>
                  Upload to Slot 2
                </button>
              </div>

              <!-- Upload Progress -->
              <div class="upload-progress" id="progress2" style="display: none">
                <div class="progress-bar">
                  <div class="progress-fill" id="progressFill2"></div>
                </div>
                <span class="progress-text" id="progressText2">0%</span>
              </div>
            </div>
          </div>

          <!-- Slot 3 -->
          <div class="widget-slot" data-slot="3">
            <div class="slot-header">
              <h3>Slot 3</h3>
              <span class="slot-status" id="slot3Status">Available</span>
            </div>

            <div class="slot-content">
              <!-- File Upload Area -->
              <div class="file-upload-area" id="uploadArea3">
                <input
                  type="file"
                  class="file-input"
                  data-slot="3"
                  accept=".zip,application/zip"
                  id="fileInput3"
                />
                <div class="upload-placeholder" id="placeholder3">
                  <span class="upload-icon">üì¶</span>
                  <p>Drop your project ZIP file here or click to upload</p>
                  <span class="upload-hint"
                    >Upload a complete project as a ZIP file for the best
                    experience</span
                  >
                </div>
              </div>

              <!-- Selected Files Display -->
              <div
                class="selected-files"
                id="selectedFiles3"
                style="display: none"
              >
                <h4>Selected Files</h4>
                <div class="files-list" id="filesList3"></div>
                <button class="clear-files-btn" data-slot="3">
                  Clear All Files
                </button>
              </div>

              <!-- Widget Information -->
              <div class="widget-info">
                <div class="info-group">
                  <label for="title2">Widget Title</label>
                  <input
                    type="text"
                    class="widget-title"
                    data-slot="3"
                    id="title3"
                    placeholder="Enter widget title"
                  />
                </div>
                <div class="info-group">
                  <label for="description3">Description</label>
                  <textarea
                    class="widget-description"
                    data-slot="3"
                    id="description3"
                    placeholder="Describe your widget"
                    rows="3"
                  ></textarea>
                </div>
                <div class="info-group">
                  <label for="tags3">Tags (optional)</label>
                  <input
                    type="text"
                    class="widget-tags"
                    data-slot="3"
                    id="tags3"
                    placeholder="e.g., game, utility, showcase"
                  />
                </div>
              </div>

              <!-- Slot Actions -->
              <div class="slot-actions">
                <button class="preview-btn" data-slot="3" id="previewBtn3">
                  <span class="btn-icon">üëÅÔ∏è</span>
                  Preview
                </button>
                <button class="upload-btn" data-slot="3" id="uploadBtn3">
                  <span class="btn-icon">üöÄ</span>
                  Upload to Slot 3
                </button>
              </div>

              <!-- Upload Progress -->
              <div class="upload-progress" id="progress3" style="display: none">
                <div class="progress-bar">
                  <div class="progress-fill" id="progressFill3"></div>
                </div>
                <span class="progress-text" id="progressText3">0%</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Studio Actions -->
        <div class="studio-actions">
          <button class="save-all-btn" id="saveAllBtn">
            <span class="btn-icon">üíæ</span>
            Save All Changes
          </button>
          <button class="refresh-btn" id="refreshBtn">
            <span class="btn-icon">üîÑ</span>
            Refresh Studio
          </button>
        </div>
      </div>
    </main>

    <!-- Preview Modal -->
    <div class="preview-modal" id="previewModal">
      <div class="preview-modal-content">
        <div class="preview-modal-header">
          <h3>Widget Preview</h3>
          <button class="preview-modal-close" id="previewModalClose">
            &times;
          </button>
        </div>
        <div class="preview-modal-body" id="previewModalBody">
          <!-- Preview content will be inserted here -->
        </div>
      </div>
    </div>

    <!-- Zip Upload Onboarding Modal -->
    <div
      class="onboarding-modal"
      id="zipUploadOnboardingModal"
      style="display: none"
    >
      <div class="onboarding-modal-content">
        <div class="onboarding-modal-header">
          <h3>üì¶ Zip Upload Guide - Widget Studio</h3>
          <button
            class="onboarding-modal-close"
            id="zipUploadOnboardingModalClose"
          >
            &times;
          </button>
        </div>
        <div class="onboarding-modal-body">
          <div class="onboarding-step active" data-step="1">
            <h4>üì¶ Step 1: Create Your Project Zip</h4>
            <p>Package your entire widget project into a single ZIP file:</p>
            <div class="zip-instructions">
              <div class="instruction-item">
                <span class="step-number">1</span>
                <div class="step-content">
                  <strong>Create a folder</strong> for your project (e.g.,
                  "my-widget/")
                </div>
              </div>
              <div class="instruction-item">
                <span class="step-number">2</span>
                <div class="step-content">
                  <strong>Add your files:</strong>
                  <ul>
                    <li>index.html (main entry point)</li>
                    <li>styles.css, app.css, etc.</li>
                    <li>script.js, app.js, etc.</li>
                    <li>assets/ folder with images, fonts</li>
                    <li>manifest.json (optional but recommended)</li>
                  </ul>
                </div>
              </div>
              <div class="instruction-item">
                <span class="step-number">3</span>
                <div class="step-content">
                  <strong>Compress to ZIP:</strong> Right-click folder ‚Üí "Send
                  to" ‚Üí "Compressed (zipped) folder"
                </div>
              </div>
            </div>
          </div>

          <div class="onboarding-step" data-step="2">
            <h4>üìÑ Step 2: Add manifest.json (Recommended)</h4>
            <p>Include a manifest.json file in your zip for better results:</p>
            <div class="manifest-example">
              <pre><code>{
  "name": "My Awesome Widget",
  "version": "1.0.0",
  "entry": "index.html",
  "description": "A cool interactive widget",
  "preview": {
    "width": 600,
    "height": 400
  },
  "files": [
    "index.html",
    "styles.css",
    "script.js",
    "assets/logo.png"
  ],
  "permissions": {
    "externalFetch": false
  }
}</code></pre>
            </div>
            <div class="manifest-benefits">
              <h5>‚ú® Benefits of manifest.json:</h5>
              <ul>
                <li>üìã Automatic file validation</li>
                <li>üéØ Better preview generation</li>
                <li>üîç Enhanced CSS analysis</li>
                <li>‚ö° Optimized processing</li>
              </ul>
            </div>
          </div>

          <div class="onboarding-step" data-step="3">
            <h4>üîç Step 3: Upload & Processing</h4>
            <p>Our system will automatically process your zip:</p>
            <div class="processing-steps">
              <div class="process-item">
                <div class="process-icon">üì¶</div>
                <div class="process-content">
                  <strong>Extract & Validate</strong>
                  <p>Zip is extracted and files are validated for security</p>
                </div>
              </div>
              <div class="process-item">
                <div class="process-icon">üîç</div>
                <div class="process-content">
                  <strong>Analyze Structure</strong>
                  <p>HTML entry point detected, CSS dependencies mapped</p>
                </div>
              </div>
              <div class="process-item">
                <div class="process-icon">üé®</div>
                <div class="process-content">
                  <strong>Optimize Assets</strong>
                  <p>Images optimized, CSS processed for better performance</p>
                </div>
              </div>
              <div class="process-item">
                <div class="process-icon">üöÄ</div>
                <div class="process-content">
                  <strong>Generate Previews</strong>
                  <p>Preview and full-view entry points created</p>
                </div>
              </div>
            </div>
          </div>

          <div class="onboarding-step" data-step="4">
            <h4>‚úÖ Step 4: Preview & Publish</h4>
            <p>Your widget is ready for the world:</p>
            <div class="final-benefits">
              <div class="benefit-grid">
                <div class="benefit-item">
                  <span class="benefit-icon">üëÅÔ∏è</span>
                  <div class="benefit-content">
                    <strong>Live Preview</strong>
                    <p>Test your widget before publishing</p>
                  </div>
                </div>
                <div class="benefit-item">
                  <span class="benefit-icon">üöÄ</span>
                  <div class="benefit-content">
                    <strong>One-Click Deploy</strong>
                    <p>Published to explore page automatically</p>
                  </div>
                </div>
                <div class="benefit-item">
                  <span class="benefit-icon">üìä</span>
                  <div class="benefit-content">
                    <strong>Analytics & Stats</strong>
                    <p>Track views, interactions, and engagement</p>
                  </div>
                </div>
                <div class="benefit-item">
                  <span class="benefit-icon">üîÑ</span>
                  <div class="benefit-content">
                    <strong>Easy Updates</strong>
                    <p>Upload new versions anytime</p>
                  </div>
                </div>
              </div>
            </div>
            <div class="getting-started">
              <h5>üéØ Ready to get started?</h5>
              <p>Upload your first zip file to see your widget come to life!</p>
            </div>
          </div>
        </div>
        <div class="onboarding-modal-footer">
          <div class="onboarding-progress">
            <span class="progress-dot active" data-step="1"></span>
            <span class="progress-dot" data-step="2"></span>
            <span class="progress-dot" data-step="3"></span>
            <span class="progress-dot" data-step="4"></span>
          </div>
          <div class="onboarding-controls">
            <button
              class="onboarding-btn secondary"
              id="zipUploadOnboardingPrev"
              style="display: none"
            >
              Previous
            </button>
            <button class="onboarding-btn primary" id="zipUploadOnboardingNext">
              Next
            </button>
            <button class="onboarding-btn success" id="zipUploadOnboardingSkip">
              Skip Guide
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Toast Notifications -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- Scripts -->
    <script type="module" src="../../core/firebase-core.js"></script>
    <script type="module" src="../../scripts/upload/cloud-upload.js"></script>
    <script
      type="module"
      src="../../scripts/ai-agents/css-analyzer.js"
    ></script>
    <script type="module" src="../page_scripts/widget_studio.js"></script>
    <script>
      // Zip Upload Onboarding Modal Functionality
      class ZipUploadOnboardingManager {
        constructor() {
          this.currentStep = 1;
          this.totalSteps = 4;
          this.onboardingCompleted =
            localStorage.getItem("zipUploadOnboarding") === "completed";

          this.init();
        }

        init() {
          if (!this.onboardingCompleted) {
            // Show onboarding after a short delay
            setTimeout(() => {
              this.showOnboarding();
            }, 1500);
          }

          this.setupEventListeners();
        }

        setupEventListeners() {
          // Trigger button
          const showBtn = document.getElementById("showZipUploadOnboardingBtn");
          if (showBtn) {
            showBtn.addEventListener("click", () => this.showOnboarding());
          }

          // Modal close button
          const closeBtn = document.getElementById(
            "zipUploadOnboardingModalClose"
          );
          if (closeBtn) {
            closeBtn.addEventListener("click", () => this.hideOnboarding());
          }

          // Skip button
          const skipBtn = document.getElementById("zipUploadOnboardingSkip");
          if (skipBtn) {
            skipBtn.addEventListener("click", () => this.completeOnboarding());
          }

          // Next/Previous buttons
          const nextBtn = document.getElementById("zipUploadOnboardingNext");
          const prevBtn = document.getElementById("zipUploadOnboardingPrev");

          if (nextBtn) {
            nextBtn.addEventListener("click", () => this.nextStep());
          }

          if (prevBtn) {
            prevBtn.addEventListener("click", () => this.previousStep());
          }

          // Click outside modal to close
          const modal = document.getElementById("zipUploadOnboardingModal");
          if (modal) {
            modal.addEventListener("click", (e) => {
              if (e.target === modal) {
                this.hideOnboarding();
              }
            });
          }

          // Keyboard navigation
          document.addEventListener("keydown", (e) => {
            if (e.key === "Escape" && modal && modal.style.display !== "none") {
              this.hideOnboarding();
            }
          });
        }

        showOnboarding() {
          const modal = document.getElementById("zipUploadOnboardingModal");
          if (modal) {
            modal.style.display = "flex";
            document.body.style.overflow = "hidden";
            this.currentStep = 1;
            this.updateOnboardingDisplay();
          }
        }

        hideOnboarding() {
          const modal = document.getElementById("zipUploadOnboardingModal");
          if (modal) {
            modal.style.display = "none";
            document.body.style.overflow = "";
          }
        }

        completeOnboarding() {
          localStorage.setItem("zipUploadOnboarding", "completed");
          this.hideOnboarding();

          // Show welcome message
          const toast = document.createElement("div");
          toast.className = "toast success";
          toast.innerHTML = `
            <span class="toast-message">Welcome to Zip Upload! üì¶ Upload your project as a zip file for the best experience.</span>
            <button class="toast-close">&times;</button>
          `;
          document.getElementById("toastContainer").appendChild(toast);

          setTimeout(() => toast.remove(), 5000);
        }

        nextStep() {
          if (this.currentStep < this.totalSteps) {
            this.currentStep++;
            this.updateOnboardingDisplay();

            // Complete onboarding on last step
            if (this.currentStep === this.totalSteps) {
              setTimeout(() => this.completeOnboarding(), 500);
            }
          }
        }

        previousStep() {
          if (this.currentStep > 1) {
            this.currentStep--;
            this.updateOnboardingDisplay();
          }
        }

        updateOnboardingDisplay() {
          // Update steps
          const steps = document.querySelectorAll(".onboarding-step");
          steps.forEach((step) => step.classList.remove("active"));
          const currentStepEl = document.querySelector(
            `[data-step="${this.currentStep}"]`
          );
          if (currentStepEl) {
            currentStepEl.classList.add("active");
          }

          // Update progress dots
          const dots = document.querySelectorAll(".progress-dot");
          dots.forEach((dot) => dot.classList.remove("active"));
          const currentDot = document.querySelector(
            `.progress-dot[data-step="${this.currentStep}"]`
          );
          if (currentDot) {
            currentDot.classList.add("active");
          }

          // Update buttons
          const prevBtn = document.getElementById("zipUploadOnboardingPrev");
          const nextBtn = document.getElementById("zipUploadOnboardingNext");
          const skipBtn = document.getElementById("zipUploadOnboardingSkip");

          if (prevBtn) {
            prevBtn.style.display = this.currentStep > 1 ? "block" : "none";
          }

          if (nextBtn) {
            nextBtn.textContent =
              this.currentStep === this.totalSteps ? "Get Started!" : "Next";
          }

          if (skipBtn) {
            skipBtn.style.display =
              this.currentStep === this.totalSteps ? "none" : "block";
          }
        }
      }

      // Initialize onboarding when DOM is ready
      document.addEventListener("DOMContentLoaded", () => {
        new ZipUploadOnboardingManager();
      });
    </script>
    <script type="module" src="../../scripts/auth/auth.js"></script>
    <script
      type="module"
      src="../page_modals/modal_scripts/profile_banner.js"
    ></script>
  </body>
</html>
