console.log("[PROFILE HUB] Initializing modular ProfileHub system...");class c{constructor(){console.log("[PROFILE HUB] Creating ProfileHubManager..."),this.state={user:{isAuthenticated:!1,profile:null,preferences:this.getDefaultPreferences()},ui:{hubState:"minimized",chatbotState:"closed",customizationState:"closed",position:"top-right",theme:"neo-brutalist",scale:1},navigation:{currentPage:this.getCurrentPage(),history:[],bookmarks:[]},chatbot:{messages:[],isTyping:!1,commands:this.getQuickCommands()},notifications:{unreadCount:0,items:[]}},this.listeners=new Map,this.dom={},this.modules={auth:null,chatbot:null,customization:null,navigation:null},this.init()}async init(){console.log("[PROFILE HUB] Initializing ProfileHub system...");try{document.readyState==="loading"&&await new Promise(t=>{document.addEventListener("DOMContentLoaded",t)}),this.initializeDOMReferences(),await this.initializeModules(),this.setupEventListeners(),this.applySavedPreferences(),this.updateUI(),this.setupAuthListener(),console.log("[PROFILE HUB] ProfileHub initialization complete")}catch(t){console.error("[PROFILE HUB] Initialization failed:",t)}}initializeDOMReferences(){console.log("[PROFILE HUB] Initializing DOM references..."),this.dom={hub:document.getElementById("profileHub"),hubCore:document.querySelector(".hub-core"),expandedContent:document.getElementById("hubExpandedContent"),overlay:document.getElementById("profileHubOverlay"),userAvatar:document.getElementById("hubUserAvatar"),userName:document.getElementById("hubUserName"),userStatus:document.getElementById("hubUserStatus"),userLevel:document.getElementById("hubUserLevel"),statusIndicator:document.getElementById("hubStatusIndicator"),chatbotToggle:document.getElementById("hubChatbotToggle"),customizeToggle:document.getElementById("hubCustomizeToggle"),authToggle:document.getElementById("hubAuthToggle"),hubToggle:document.getElementById("hubToggleBtn"),drawerToggle:document.getElementById("profileHubDrawerToggle"),chatbotContainer:document.getElementById("hubChatbotContainer"),chatbotSlider:document.getElementById("chatbotSlider"),chatMessages:document.getElementById("hubChatMessages"),chatInput:document.getElementById("hubChatInput"),sendChatBtn:document.getElementById("hubSendChatBtn"),chatCommands:document.getElementById("hubChatCommands"),customizationPanel:document.getElementById("hubCustomizationPanel"),userStats:document.getElementById("hubUserStats"),notificationBadge:document.getElementById("hubNotificationBadge")};const e=["hub","hubCore","expandedContent"].filter(i=>!this.dom[i]);e.length>0&&console.error(`[PROFILE HUB] Missing required DOM elements: ${e.join(", ")}`),console.log("[PROFILE HUB] DOM elements found:"),Object.keys(this.dom).forEach(i=>{this.dom[i]?console.log(`  ✅ ${i}: Found`):console.log(`  ❌ ${i}: Missing`)});try{this.dom.hub&&(this.dom.hub.setAttribute("role","dialog"),this.dom.hub.setAttribute("aria-live","polite"),this.dom.hub.setAttribute("aria-label","Profile hub")),this.dom.hubToggle&&(this.dom.hubToggle.setAttribute("aria-controls","hubExpandedContent"),this.dom.hubToggle.setAttribute("aria-expanded","false"),this.dom.hubToggle.setAttribute("aria-label","Toggle profile hub")),this.dom.expandedContent&&(this.dom.expandedContent.setAttribute("role","region"),this.dom.expandedContent.setAttribute("aria-label","Profile hub menu"),this.dom.expandedContent.setAttribute("aria-hidden","true"))}catch(i){console.warn("[PROFILE HUB] Failed to set ARIA attributes",i)}console.log("[PROFILE HUB] DOM references initialized successfully - Enhanced sliding modal system ready")}async initializeModules(){console.log("[PROFILE HUB] Initializing modules..."),this.modules.auth=new v(this),this.modules.chatbot=new w(this),this.modules.customization=new H(this),this.modules.navigation=new B(this),console.log("[PROFILE HUB] All modules initialized")}setupEventListeners(){console.log("[PROFILE HUB] Setting up event listeners..."),this.dom.hubToggle?this.addEventListener(this.dom.hubToggle,"click",()=>{console.log("[PROFILE HUB] Hub toggle button clicked"),this.safeToggleHub()}):console.warn("[PROFILE HUB] Hub toggle button not found!"),this.dom.chatbotToggle?this.addEventListener(this.dom.chatbotToggle,"click",()=>{console.log("[PROFILE HUB] Chatbot toggle button clicked"),this.toggleChatbot()}):console.warn("[PROFILE HUB] Chatbot toggle button not found!"),this.dom.customizeToggle?this.addEventListener(this.dom.customizeToggle,"click",()=>{console.log("[PROFILE HUB] Customize toggle button clicked → navigating to Explore"),this.navigateTo("pages/explore.html")}):console.warn("[PROFILE HUB] Customize toggle button not found!"),this.dom.authToggle?this.addEventListener(this.dom.authToggle,"click",()=>{console.log("[PROFILE HUB] Auth toggle button clicked"),this.modules.auth.handleAuthToggle()}):console.warn("[PROFILE HUB] Auth toggle button not found!"),this.addEventListener(this.dom.userAvatar,"click",()=>{this.handleUserAvatarClick()}),this.addEventListener(this.dom.overlay,"click",()=>{this.closeAllPanels()}),this.dom.drawerToggle&&this.addEventListener(this.dom.drawerToggle,"click",()=>{console.log("[PROFILE HUB] Drawer toggle button clicked"),this.safeToggleDrawer()}),this.addEventListener(document,"keydown",i=>{this.handleKeyboardShortcuts(i)}),this.setupNavigationListeners(),this.setupQuickActionListeners(),this.addEventListener(window,"resize",()=>{this.handleResize()}),this.addEventListener(window,"orientationchange",()=>{setTimeout(()=>{this.handleResize(),(this.state.ui.hubState!=="minimized"||this.state.ui.customizationState==="open")&&this.updateModalPositions(this.state.ui.position)},100)});const t=document.getElementById("adminOpenUsers"),e=document.getElementById("adminOpenRules");t&&this.addEventListener(t,"click",()=>{console.log("[PROFILE HUB][ADMIN] Opening Users page"),this.navigateTo("pages/users.html")}),e&&this.addEventListener(e,"click",()=>{console.log("[PROFILE HUB][ADMIN] Attempting to open Firestore rules");try{window.open("/firestore.rules","_blank")}catch(i){console.warn("[PROFILE HUB][ADMIN] Could not open rules in new tab",i)}}),console.log("[PROFILE HUB] Event listeners set up successfully")}setupNavigationListeners(){const t=this.dom.expandedContent?.querySelectorAll(".nav-link");t?(console.log(`[PROFILE HUB] Setting up ${t.length} navigation links`),t.forEach((e,i)=>{const s=e.getAttribute("href");console.log(`[PROFILE HUB] Link ${i+1}: ${s}`),this.addEventListener(e,"click",n=>{this.handleNavigation(n,e)})})):console.warn("[PROFILE HUB] No navigation links found in expanded content")}setupQuickActionListeners(){const t=this.dom.expandedContent?.querySelectorAll(".quick-action-btn");t&&t.forEach(e=>{this.addEventListener(e,"click",()=>{const i=e.dataset.action;this.handleQuickAction(i)})})}handleNavigation(t,e){const i=e.getAttribute("href"),s=i.startsWith("http");console.log(`[PROFILE HUB] Navigation requested: ${i}`),s||(t.preventDefault(),this.state.navigation.history.push({url:i,timestamp:Date.now(),title:e.textContent.trim()}),e.style.transform="scale(0.95)",setTimeout(()=>{e.style.transform=""},150),setTimeout(()=>{const n=this.resolveAppPath(i);console.log(`[PROFILE HUB] Navigating to: ${n}`),this.navigateTo(n)},200)),setTimeout(()=>{this.setState({ui:{hubState:"minimized"}})},100)}handleQuickAction(t){switch(console.log(`[PROFILE HUB] Quick action: ${t}`),t){case"newWidget":this.modules.navigation.openWidgetStudio();break;case"shareProfile":this.modules.navigation.shareProfile();break;case"notifications":this.modules.navigation.openNotifications();break;case"settings":this.toggleCustomization();break;default:console.warn(`[PROFILE HUB] Unknown action: ${t}`)}}handleKeyboardShortcuts(t){(t.ctrlKey||t.metaKey)&&t.shiftKey&&t.key==="H"&&(t.preventDefault(),this.toggleHub()),(t.ctrlKey||t.metaKey)&&t.shiftKey&&t.key==="C"&&(t.preventDefault(),this.toggleChatbot()),t.key==="Escape"&&this.closeAllPanels(),(t.ctrlKey||t.metaKey)&&t.shiftKey&&t.key==="D"&&(t.preventDefault(),this.toggleDrawer())}handleResize(){this.adjustHubPosition()}handleUserAvatarClick(){this.state.user.isAuthenticated?this.toggleHub():this.modules.auth.openAuthModal()}toggleHub(){const e=this.state.ui.hubState==="expanded"?"minimized":"expanded";console.log(`[PROFILE HUB] Toggling hub: ${this.state.ui.hubState} -> ${e}`),this.dom.expandedContent?(console.log("[PROFILE HUB] Expanded content element found:",this.dom.expandedContent),console.log("[PROFILE HUB] Current expanded content display:",window.getComputedStyle(this.dom.expandedContent).display)):console.warn("[PROFILE HUB] Expanded content element NOT found!"),this.setState({ui:{hubState:e,customizationState:"closed"}}),setTimeout(()=>{console.log("[PROFILE HUB] State after toggle:",this.state.ui.hubState),this.dom.hub&&console.log("[PROFILE HUB] Hub data-state attribute:",this.dom.hub.getAttribute("data-state")),this.dom.expandedContent&&console.log("[PROFILE HUB] Expanded content display after toggle:",window.getComputedStyle(this.dom.expandedContent).display)},100)}safeToggleHub(){this._hubToggleBusy||(this._hubToggleBusy=!0,this.toggleHub(),setTimeout(()=>this._hubToggleBusy=!1,250))}toggleDrawer(){const t=this.dom.hub.classList.contains("drawer-hidden");console.log(`[PROFILE HUB] Toggling drawer: ${t?"showing":"hiding"}`),t?(this.dom.hub.classList.remove("drawer-hidden"),this.dom.drawerToggle&&(this.dom.drawerToggle.style.display="none"),console.log("[PROFILE HUB] ProfileHub drawer shown")):(this.dom.hub.classList.add("drawer-hidden"),this.dom.drawerToggle&&(this.dom.drawerToggle.style.display="flex"),console.log("[PROFILE HUB] ProfileHub drawer hidden"))}safeToggleDrawer(){this._drawerToggleBusy||(this._drawerToggleBusy=!0,this.toggleDrawer(),setTimeout(()=>this._drawerToggleBusy=!1,250))}toggleChatbot(){const t=this.state.ui.hubState==="chatbot-active",e=t?"minimized":"chatbot-active";console.log(`[PROFILE HUB] Toggling chatbot: ${this.state.ui.hubState} -> ${e}`),console.log("[PROFILE HUB] Enhanced chatbot sliding animation triggered - smooth slide from right"),this.setState({ui:{hubState:e,customizationState:"closed"}}),t||this.modules.chatbot.initialize()}toggleCustomization(){const t=this.state.ui.customizationState==="open",e=t?"closed":"open";console.log(`[PROFILE HUB] Toggling customization: ${this.state.ui.customizationState} -> ${e}`),console.log("[PROFILE HUB] Enhanced sliding modal animation triggered - smooth slide from right"),console.log("[PROFILE HUB] Orb remains visible and accessible in top-left corner"),this.setState({ui:{customizationState:e,hubState:t?"minimized":"expanded"}}),this.toggleCustomizationBackdrop(e==="open"),console.log("[PROFILE HUB] Customization panel state updated successfully")}toggleCustomizationBackdrop(t){let e=document.getElementById("hub-customization-panel-backdrop");e||(e=document.createElement("div"),e.id="hub-customization-panel-backdrop",e.className="hub-customization-panel-backdrop",e.addEventListener("click",()=>{this.toggleCustomization()}),document.body.appendChild(e),console.log("[PROFILE HUB] Created customization panel backdrop")),t?(e.classList.add("active"),console.log("[PROFILE HUB] Enhanced backdrop overlay activated with sliding animation")):(e.classList.remove("active"),console.log("[PROFILE HUB] Enhanced backdrop overlay deactivated"))}closeAllPanels(){console.log("[PROFILE HUB] Closing all panels"),this.setState({ui:{hubState:"minimized",customizationState:"closed"}})}updateUI(){if(!this.dom.hub)return;const{ui:t,user:e,notifications:i}=this.state;if(this.dom.hub.setAttribute("data-state",t.hubState),this.dom.hub.setAttribute("data-theme",t.theme),this.dom.hub.setAttribute("data-position",t.position),this.dom.hub.setAttribute("aria-expanded",t.hubState!=="minimized"?"true":"false"),this.dom.hub.style.setProperty("--hub-scale",t.scale),this.dom.expandedContent&&(t.hubState==="expanded"?(this.dom.expandedContent.classList.add("show"),this.dom.expandedContent.style.display="block",this.dom.expandedContent.style.opacity="1",this.dom.expandedContent.style.visibility="visible",this.dom.expandedContent.setAttribute("aria-hidden","false"),console.log("[PROFILE HUB] Expanded content forced to show")):(this.dom.expandedContent.classList.remove("show"),this.dom.expandedContent.style.display="none",this.dom.expandedContent.style.opacity="0",this.dom.expandedContent.style.visibility="hidden",this.dom.expandedContent.setAttribute("aria-hidden","true"),console.log("[PROFILE HUB] Expanded content forced to hide"))),this.dom.overlay){this.dom.overlay.classList.toggle("active",t.hubState==="expanded"||t.hubState==="chatbot-active"||t.customizationState==="open");const s=t.hubState==="expanded"||t.hubState==="chatbot-active"||t.customizationState==="open";document.body.style.overflow=s?"hidden":""}if(this.updateUserInfo(),this.updateNotificationBadge(),this.dom.customizationPanel){const s=t.customizationState==="open",n=this.dom.customizationPanel.classList.contains("active");this.dom.customizationPanel.classList.remove("slide-in","slide-out"),s&&!n?(this.dom.customizationPanel.classList.add("active","slide-in"),console.log("[PROFILE HUB] Customization panel sliding in with enhanced animation")):!s&&n?(this.dom.customizationPanel.classList.add("slide-out"),setTimeout(()=>{this.dom.customizationPanel.classList.remove("active","slide-out")},400),console.log("[PROFILE HUB] Customization panel sliding out with enhanced animation")):s&&this.dom.customizationPanel.classList.add("active")}if(this.dom.chatbotContainer){const s=t.hubState==="chatbot-active",n=this.dom.chatbotContainer.classList.contains("active");this.dom.chatbotContainer.classList.remove("slide-in","slide-out"),s&&!n?(this.dom.chatbotContainer.classList.add("active","slide-in"),console.log("[PROFILE HUB] Chatbot container sliding in with enhanced animation")):!s&&n?(this.dom.chatbotContainer.classList.add("slide-out"),setTimeout(()=>{this.dom.chatbotContainer.classList.remove("active","slide-out")},400),console.log("[PROFILE HUB] Chatbot container sliding out with enhanced animation")):s&&this.dom.chatbotContainer.classList.add("active")}console.log("[PROFILE HUB] UI updated with enhanced sliding modal animations")}updateUserInfo(){const{user:t}=this.state;this.dom.userName&&(this.dom.userName.textContent=t.isAuthenticated?t.profile?.displayName||t.profile?.name||"User":"Guest"),this.dom.userStatus&&(this.dom.userStatus.textContent=t.isAuthenticated?"Online • Authenticated":"Click to customize"),this.dom.userLevel&&(this.dom.userLevel.textContent=t.isAuthenticated?`LVL • ${t.profile?.level||1}`:"LVL • ?"),this.dom.statusIndicator&&(this.dom.statusIndicator.className=`avatar-status-indicator ${t.isAuthenticated?"online":"offline"}`),this.dom.authToggle&&(this.dom.authToggle.classList.toggle("logged-in",t.isAuthenticated),this.dom.authToggle.querySelector(".btn-icon").textContent=t.isAuthenticated?"👤":"🔐"),this.dom.userStats&&(this.dom.userStats.style.display=t.isAuthenticated?"block":"none");const e=document.getElementById("hubAdminSettings");if(e){const i=(t.profile?.role||"").toString().toUpperCase();e.style.display=t.isAuthenticated&&(i==="ADMIN"||i==="SUPERADMIN")?"block":"none";const s=document.getElementById("adminRoleLabel");s&&i&&(s.textContent=i)}if(this.dom.adminSection){const i=(t.profile?.role||"").toString().toUpperCase();this.dom.adminSection.style.display=t.isAuthenticated&&(i==="ADMIN"||i==="SUPERADMIN")?"block":"none";const s=document.getElementById("adminRoleLabel");s&&i&&(s.textContent=i)}console.log("[PROFILE HUB] User info updated")}updateNotificationBadge(){const{notifications:t}=this.state;this.dom.notificationBadge&&(this.dom.notificationBadge.textContent=t.unreadCount,this.dom.notificationBadge.style.display=t.unreadCount>0?"flex":"none")}updateUserStats(t){console.log("[PROFILE HUB] Updating user stats",t);const e=document.getElementById("hubWidgetCount"),i=document.getElementById("hubFollowerCount"),s=document.getElementById("hubViewCount");e&&(e.textContent=t.widgetsCreated||0),i&&(i.textContent=t.followersCount||0),s&&(s.textContent=t.totalViews||0),console.log("[PROFILE HUB] User stats updated successfully")}setupAuthListener(){window.addEventListener("auth-state-changed",t=>{const{user:e,profile:i}=t.detail;this.handleAuthStateChange(e,i)})}handleAuthStateChange(t,e=null){console.log("[PROFILE HUB] Auth state changed:",t?"logged in":"logged out",e?"with profile data":"without profile data"),this.setState({user:{isAuthenticated:!!t,profile:e||(t?this.extractUserProfile(t):null)}}),e&&e.stats&&this.updateUserStats(e.stats)}extractUserProfile(t){return{uid:t.uid,email:t.email,displayName:t.displayName,photoURL:t.photoURL,name:t.displayName||t.email?.split("@")[0],level:1}}setState(t,e=!0){this.state=this.deepMerge(this.state,t),this.updateUI(),t.ui?.position&&this.handlePositionChange(t.ui.position),e&&t.user?.preferences&&this.savePreferences(),this.emit("state-changed",{state:this.state,changes:t}),console.log("[PROFILE HUB] State updated:",t)}deepMerge(t,e){const i={...t};for(const s in e)e[s]&&typeof e[s]=="object"&&!Array.isArray(e[s])?i[s]=this.deepMerge(i[s]||{},e[s]):i[s]=e[s];return i}addEventListener(t,e,i){if(!t)return;t.addEventListener(e,i);const s=`${e}-${Date.now()}-${Math.random()}`;return this.listeners.set(s,{element:t,event:e,handler:i}),s}removeEventListener(t){const e=this.listeners.get(t);e&&(e.element.removeEventListener(e.event,e.handler),this.listeners.delete(t))}emit(t,e){const i=new CustomEvent(`profilehub-${t}`,{detail:e});window.dispatchEvent(i)}getCurrentPage(){return window.location.pathname.split("/").pop()||"index.html"}getDefaultPreferences(){return{theme:"neo-brutalist",position:"top-right",scale:1,autoMinimize:!0,chatbotEnabled:!0,keyboardShortcuts:!0,animations:!0}}getQuickCommands(){return[{command:"/navigate projects",label:"🔗 Projects",action:"navigate",target:"pages/my-projects.html"},{command:"/help customize",label:"⚙️ Customize",action:"customize",target:null},{command:"/stats",label:"📊 Stats",action:"stats",target:null},{command:"/help",label:"❓ Help",action:"help",target:null}]}resolveAppPath(t){return t?t.startsWith("http")?t:`/${t.replace(/^\.\//,"").replace(/^\/+/,"")}`:"/"}navigateTo(t){const e=this.resolveAppPath(t);console.log(`[PROFILE HUB] Navigating to: ${e}`),window.location.assign(e)}savePreferences(){try{localStorage.setItem("profilehub-preferences",JSON.stringify(this.state.user.preferences)),console.log("[PROFILE HUB] Preferences saved")}catch(t){console.warn("[PROFILE HUB] Failed to save preferences:",t)}}applySavedPreferences(){try{const t=localStorage.getItem("profilehub-preferences");if(t){const e=JSON.parse(t);typeof this.updateModalPositions=="function"?this.setState({user:{preferences:e},ui:{theme:e.theme||"neo-brutalist",position:e.position||"top-right",scale:e.scale||1}},!1):this.setState({user:{preferences:e},ui:{theme:e.theme||"neo-brutalist",position:e.position||"top-right",scale:e.scale||1}},!1),console.log("[PROFILE HUB] Preferences applied")}}catch(t){console.warn("[PROFILE HUB] Failed to load preferences:",t)}}adjustHubPosition(){const t=this.dom.hub.getBoundingClientRect();(t.right>window.innerWidth||t.bottom>window.innerHeight)&&console.log("[PROFILE HUB] Adjusting position for viewport")}handlePositionChange(t){console.log("[PROFILE HUB] Handling position change to:",t),this.updateModalPositions(t),this.emit("position-changed",{position:t,previousPosition:this.state.ui.position}),this.repositionOpenModals(t)}updateModalPositions(t){console.log("[PROFILE HUB] Updating modal positions for:",t);const{ui:e}=this.state;if(this.dom.expandedContent){const i=this.getPositionStyles(t),s=this.preventOverflow(this.dom.expandedContent,i,t);this.updateModalPosition(this.dom.expandedContent,s)}if(this.dom.chatbotContainer){const i=this.getPositionStyles(t),s=this.preventOverflow(this.dom.chatbotContainer,i,t);this.updateModalPosition(this.dom.chatbotContainer,s)}if(this.dom.customizationPanel){const i=this.getPositionStyles(t),s=this.preventOverflow(this.dom.customizationPanel,i,t);this.updateModalPosition(this.dom.customizationPanel,s)}}preventOverflow(t,e,i){if(!t)return e;const s=document.createElement("div");Object.assign(s.style,e),s.style.visibility="hidden",s.style.position="fixed",document.body.appendChild(s);const n=s.getBoundingClientRect();document.body.removeChild(s);const r=window.innerWidth,d=window.innerHeight;let l={...e};return n.right>r&&i.includes("right")&&(l.left="10px",l.right="auto",l.transformOrigin="top left"),n.bottom>d&&i.includes("top")&&(l.top="auto",l.bottom="10px",l.transformOrigin=i.includes("right")?"bottom right":"bottom left"),r<=768&&(l.maxWidth="95vw",l.maxHeight="85vh",i.includes("top")&&(l.top="auto",l.bottom="10px",l.transformOrigin=i.includes("right")?"bottom right":"bottom left")),console.log("[PROFILE HUB] Adjusted modal position to prevent overflow:",{original:i,adjusted:l,modalSize:{width:n.width,height:n.height},viewport:{width:r,height:d}}),l}getPositionStyles(t){const e={position:"absolute",zIndex:"100081",maxWidth:"90vw",maxHeight:"80vh"},i=window.innerHeight,s=this.dom.hub?.getBoundingClientRect()||{};switch(t){case"top-left":return{...e,top:`${s.bottom+10}px`,left:"10px",right:"auto",bottom:"auto",transformOrigin:"top left"};case"top-right":return{...e,top:`${s.bottom+10}px`,right:"10px",left:"auto",bottom:"auto",transformOrigin:"top right"};case"bottom-left":return{...e,bottom:`${i-s.top+10}px`,left:"10px",top:"auto",right:"auto",transformOrigin:"bottom left"};case"bottom-right":return{...e,bottom:`${i-s.top+10}px`,right:"10px",top:"auto",left:"auto",transformOrigin:"bottom right"};default:return{...e,top:`${s.bottom+10}px`,right:"10px",left:"auto",bottom:"auto",transformOrigin:"top right"}}}updateModalPosition(t,e){t&&(t.classList.add("hub-modal-adjusted"),Object.keys(e).forEach(i=>{t.style[i]=e[i]}),t.className=t.className.replace(/position-\w+/g,""),t.classList.add(`position-${this.state.ui.position}`),console.log("[PROFILE HUB] Modal position updated:",{element:t.id||t.className,position:this.state.ui.position,styles:e}))}repositionOpenModals(t){const{ui:e}=this.state;if(e.hubState==="expanded"&&this.dom.expandedContent){const i=this.getPositionStyles(t),s=this.preventOverflow(this.dom.expandedContent,i,t);this.updateModalPosition(this.dom.expandedContent,s)}if(e.hubState==="chatbot-active"&&this.dom.chatbotContainer){const i=this.getPositionStyles(t),s=this.preventOverflow(this.dom.chatbotContainer,i,t);this.updateModalPosition(this.dom.chatbotContainer,s)}if(e.customizationState==="open"&&this.dom.customizationPanel){const i=this.getPositionStyles(t),s=this.preventOverflow(this.dom.customizationPanel,i,t);this.updateModalPosition(this.dom.customizationPanel,s)}}destroy(){console.log("[PROFILE HUB] Destroying ProfileHub..."),this.listeners.forEach((t,e)=>{this.removeEventListener(e)}),Object.values(this.modules).forEach(t=>{t&&typeof t.destroy=="function"&&t.destroy()}),console.log("[PROFILE HUB] ProfileHub destroyed")}}class v{constructor(t){this.hub=t,console.log("[AUTH MODULE] Initialized")}handleAuthToggle(){this.hub.state.user.isAuthenticated?this.openProfileMenu():this.openAuthModal()}openAuthModal(){if(console.log("[AUTH MODULE] Opening auth modal..."),window.openAuthModal)window.openAuthModal("login");else{const t=document.getElementById("authModal");t&&(t.style.display="block",document.body.style.overflow="hidden")}this.hub.setState({ui:{hubState:"minimized"}})}openProfileMenu(){console.log("[AUTH MODULE] Opening profile menu..."),this.hub.toggleHub()}}class w{constructor(t){this.hub=t,this.initialized=!1,console.log("[CHATBOT MODULE] Initialized")}initialize(){this.initialized||(console.log("[CHATBOT MODULE] Setting up chatbot integration..."),this.setupChatbotListeners(),this.loadChatHistory(),this.setupQuickCommands(),this.initialized=!0,console.log("[CHATBOT MODULE] Chatbot integration ready"))}setupChatbotListeners(){const{dom:t}=this.hub;this.hub.addEventListener(t.sendChatBtn,"click",()=>{this.sendMessage()}),this.hub.addEventListener(t.chatInput,"keypress",n=>{n.key==="Enter"&&!n.shiftKey&&(n.preventDefault(),this.sendMessage())});const e=t.chatCommands?.querySelectorAll(".command-chip");e&&e.forEach(n=>{this.hub.addEventListener(n,"click",()=>{const r=n.dataset.command;this.executeCommand(r)})});const i=t.chatbotSlider?.querySelector("#chatbotClose"),s=t.chatbotSlider?.querySelector("#chatbotMinimize");i&&this.hub.addEventListener(i,"click",()=>{this.hub.setState({ui:{hubState:"minimized"}})}),s&&this.hub.addEventListener(s,"click",()=>{this.hub.setState({ui:{hubState:"expanded"}})})}async sendMessage(){const{dom:t}=this.hub,e=t.chatInput?.value.trim();if(e){if(console.log("[CHATBOT MODULE] Sending message:",e),t.chatInput.value="",this.addMessage(e,"user"),e.startsWith("/")){this.executeCommand(e);return}this.showTypingIndicator();try{const i=await this.getAIResponse(e);this.hideTypingIndicator(),this.addMessage(i,"ai")}catch(i){console.error("[CHATBOT MODULE] Error getting AI response:",i),this.hideTypingIndicator(),this.addMessage("Sorry, I encountered an error. Please try again.","ai")}}}addMessage(t,e){const{dom:i}=this.hub;if(!i.chatMessages)return;const s=document.createElement("div");s.className=`message ${e}-message`,s.innerHTML=`
      <div class="message-avatar">${e==="user"?"👤":"🤖"}</div>
      <div class="message-content">
        <p>${t}</p>
      </div>
    `,i.chatMessages.appendChild(s),i.chatMessages.scrollTop=i.chatMessages.scrollHeight,this.hub.setState({chatbot:{messages:[...this.hub.state.chatbot.messages,{content:t,sender:e,timestamp:Date.now()}]}}),console.log(`[CHATBOT MODULE] Added ${e} message`)}showTypingIndicator(){const{dom:t}=this.hub;if(!t.chatMessages)return;const e=document.createElement("div");e.className="message ai-message typing",e.id="hubTypingIndicator",e.innerHTML=`
      <div class="message-avatar">🤖</div>
      <div class="message-content">
        <p>Thinking...</p>
      </div>
    `,t.chatMessages.appendChild(e),t.chatMessages.scrollTop=t.chatMessages.scrollHeight,this.hub.setState({chatbot:{isTyping:!0}})}hideTypingIndicator(){const t=document.getElementById("hubTypingIndicator");t&&t.remove(),this.hub.setState({chatbot:{isTyping:!1}})}async getAIResponse(t){try{const e=this.getContextualResponse(t);return e||(window.getAIResponse?await window.getAIResponse(t):this.getFallbackResponse(t))}catch(e){return console.error("[CHATBOT MODULE] AI response error:",e),"I'm here to help you navigate and customize your ProfileHub experience. What would you like to know?"}}getContextualResponse(t){const e=t.toLowerCase();return e.includes("navigate")||e.includes("go to")?"I can help you navigate! Use commands like '/navigate projects' to go to your projects, or click the navigation links in your expanded hub.":e.includes("customize")||e.includes("theme")?"To customize your ProfileHub, click the gear icon or use '/help customize'. You can change themes, colors, position, and more!":e.includes("stats")||e.includes("profile")?"Your profile stats show your widgets, followers, and views. Use '/stats' to see detailed information about your account.":null}getFallbackResponse(t){const e=["I'm your integrated AI assistant! I can help you navigate, customize your hub, and answer questions about the platform.","Try using commands like '/navigate projects' or '/help customize' for quick actions!","I can help you understand ProfileHub features. What would you like to explore?","Your ProfileHub is fully customizable! Ask me about themes, positioning, or navigation."];return e[Math.floor(Math.random()*e.length)]}executeCommand(t){console.log("[CHATBOT MODULE] Executing command:",t);const e=t.split(" "),i=e[0].substring(1),s=e.slice(1).join(" ");switch(i){case"navigate":this.executeNavigateCommand(s);break;case"help":this.executeHelpCommand(s);break;case"stats":this.executeStatsCommand();break;case"customize":this.executeCustomizeCommand();break;default:this.addMessage(`Unknown command: ${t}. Try '/help' for available commands.`,"ai")}}executeNavigateCommand(t){const e={projects:"/pages/profile_dashboard/my-projects.html",studio:"/pages/profile_dashboard/widget_studio.html",explore:"/pages/explore.html",community:"/pages/users.html"};e[t]?(this.addMessage(`Navigating to ${t}...`,"ai"),setTimeout(()=>{this.hub.navigateTo(e[t])},1e3)):this.addMessage(`Available navigation targets: ${Object.keys(e).join(", ")}`,"ai")}executeHelpCommand(t){t==="customize"?(this.addMessage("To customize your ProfileHub: Click the gear icon, choose themes, adjust colors and position. Your changes are saved automatically!","ai"),this.hub.toggleCustomization()):this.addMessage(`Available commands:
      • /navigate [projects|studio|explore|community]
      • /help [customize]
      • /stats
      • /customize`,"ai")}executeStatsCommand(){const{user:t}=this.hub.state;t.isAuthenticated?this.addMessage(`Your Stats:
      • Level: ${t.profile?.level||1}
      • Widgets: ${t.profile?.stats?.widgetsCreated||0}
      • Followers: ${t.profile?.stats?.followersCount||0}
      • Views: ${t.profile?.stats?.totalViews||0}`,"ai"):this.addMessage("Please log in to view your stats!","ai")}executeCustomizeCommand(){this.addMessage("Opening customization panel...","ai"),this.hub.toggleCustomization()}setupQuickCommands(){}loadChatHistory(){try{const t=localStorage.getItem("profilehub-chat-history");if(t){const e=JSON.parse(t);this.hub.setState({chatbot:{messages:e}},!1),e.forEach(i=>{this.addMessage(i.content,i.sender)})}}catch(t){console.warn("[CHATBOT MODULE] Failed to load chat history:",t)}}}class H{constructor(t){this.hub=t,this.setupCustomizationControls(),console.log("[CUSTOMIZATION MODULE] Initialized")}setupCustomizationControls(){const t=document.getElementById("hubCustomizationPanel");if(!t)return;t.querySelectorAll(".theme-option").forEach(d=>{this.hub.addEventListener(d,"click",()=>{this.setTheme(d.dataset.theme)})});const i=t.querySelector("#hubPrimaryColor");i&&this.hub.addEventListener(i,"change",d=>{this.setPrimaryColor(d.target.value)});const s=t.querySelector("#hubSize");s&&this.hub.addEventListener(s,"input",d=>{this.setSize(parseFloat(d.target.value))});const n=t.querySelector("#saveCustomization"),r=t.querySelector("#resetCustomization");n&&this.hub.addEventListener(n,"click",()=>{this.saveCustomization()}),r&&this.hub.addEventListener(r,"click",()=>{this.resetCustomization()})}setTheme(t){console.log("[CUSTOMIZATION MODULE] Setting theme:",t),this.hub.setState({ui:{theme:t},user:{preferences:{theme:t}}}),document.querySelectorAll(".theme-option").forEach(e=>{e.classList.toggle("active",e.dataset.theme===t)})}setPrimaryColor(t){console.log("[CUSTOMIZATION MODULE] Setting primary color:",t),this.hub.dom.hub.style.setProperty("--hub-primary",t),this.hub.setState({user:{preferences:{primaryColor:t}}})}setSize(t){console.log("[CUSTOMIZATION MODULE] Setting size:",t),this.hub.setState({ui:{scale:t},user:{preferences:{scale:t}}})}saveCustomization(){this.hub.savePreferences(),this.showCustomizationToast("Customization saved!","success")}resetCustomization(){const t=this.hub.getDefaultPreferences();this.hub.setState({ui:{theme:t.theme,position:t.position,scale:t.scale},user:{preferences:t}}),this.updateCustomizationUI(),this.showCustomizationToast("Customization reset to defaults","info")}updateCustomizationUI(){const{ui:t}=this.hub.state;document.querySelectorAll(".theme-option").forEach(i=>{i.classList.toggle("active",i.dataset.theme===t.theme)}),document.getElementById("hubPrimaryColor");const e=document.getElementById("hubSize");e&&(e.value=t.scale)}showCustomizationToast(t,e){window.socialAuth&&window.socialAuth.showToast?window.socialAuth.showToast(t,e):console.log(`[CUSTOMIZATION MODULE] ${t}`)}}class B{constructor(t){this.hub=t,console.log("[NAVIGATION MODULE] Initialized")}openWidgetStudio(){console.log("[NAVIGATION MODULE] Opening Widget Studio..."),window.openWidgetStudio?window.openWidgetStudio():this.hub.navigateTo("pages/profile_dashboard/widget_studio.html"),this.hub.setState({ui:{hubState:"minimized"}})}shareProfile(){console.log("[NAVIGATION MODULE] Sharing profile...");const t=window.location.href;navigator.share?navigator.share({title:"Check out my profile!",url:t}):navigator.clipboard&&(navigator.clipboard.writeText(t),this.showNavigationToast("Profile URL copied to clipboard!","success"))}openNotifications(){console.log("[NAVIGATION MODULE] Opening notifications..."),window.openNotificationsPanel?window.openNotificationsPanel():this.showNavigationToast("Notifications panel coming soon!","info")}showNavigationToast(t,e){window.socialAuth&&window.socialAuth.showToast&&window.socialAuth.showToast(t,e)}}function P(){try{const o=document.getElementById("profileHubContainer");if(!o)return;const t=()=>{const e=window.innerWidth,i=window.innerHeight;if(e<=768){const s=document.getElementById("title-container"),n=document.getElementById("orb-container");if(s){const r=s.getBoundingClientRect();if(e<=480)o.style.top="auto",o.style.bottom="10px",o.style.right="10px",o.style.left="auto",console.log("[PROFILE HUB] Very small mobile: Bottom positioning");else{const d=r.bottom;i-d-20>200?(o.style.top=`${d+10}px`,o.style.bottom="auto",o.style.right="10px",o.style.left="auto",console.log("[PROFILE HUB] Tablet: Above title positioning")):(o.style.top="auto",o.style.bottom="10px",o.style.right="10px",o.style.left="auto",console.log("[PROFILE HUB] Tablet: Bottom positioning (limited space)"))}}else o.style.top="10px",o.style.right="10px",o.style.left="auto",o.style.bottom="auto";o.style.position="fixed"}else o.style.top="20px",o.style.right="20px",o.style.left="auto",o.style.bottom="auto",o.style.position="fixed",console.log("[PROFILE HUB] Desktop positioning")};t(),window.addEventListener("resize",t,{passive:!0})}catch(o){console.warn("[PROFILE HUB] Mobile positioning setup failed",o)}}function I(){try{const o=document.getElementById("profileHub"),t=document.getElementById("profileHubDrawerToggle");if(!o)return;let e=0,i=0,s=!1;const n=l=>{if(window.innerWidth>1024)return;const h=l.touches?l.touches[0]:l;e=h.clientX,i=h.clientY,s=!0},r=l=>{if(!s)return;const h=l.touches?l.touches[0]:l,g=h.clientX-e,y=h.clientY-i,m=Math.abs(g),E=Math.abs(y);if(m>60&&m>E&&(s=!1,g>0)){const p=document.getElementById("profileHub");p&&p.classList.add("drawer-hidden"),t&&(t.style.display="flex")}},d=()=>{s=!1};o.addEventListener("touchstart",n,{passive:!0}),o.addEventListener("touchmove",r,{passive:!0}),o.addEventListener("touchend",d,{passive:!0}),t&&t.addEventListener("touchstart",()=>{window.toggleProfileHubDrawer&&window.toggleProfileHubDrawer()},{passive:!0})}catch(o){console.warn("[PROFILE HUB] Mobile gesture setup failed",o)}}async function L(){try{if(console.log("[PROFILE HUB] Loading ProfileHub HTML content..."),await new Promise(n=>setTimeout(n,100)),document.getElementById("profileHub")){console.log("[PROFILE HUB] ProfileHub already exists in DOM, skipping fetch");return}if(window.location.pathname==="/"||window.location.pathname.endsWith("index.html")){console.log("[PROFILE HUB] On home page, ProfileHub should be included directly");return}const t=["pages/page_modals/profile_banner.html","./pages/page_modals/profile_banner.html","../page_modals/profile_banner.html","/pages/page_modals/profile_banner.html"];let e=null,i=null;for(const n of t)try{console.log(`[PROFILE HUB] Trying to load from: ${n}`);const r=await fetch(n);if(r.ok){e=await r.text(),console.log(`[PROFILE HUB] Successfully loaded HTML from: ${n}`);break}else console.warn(`[PROFILE HUB] Failed to load from ${n}: ${r.status} ${r.statusText}`),i=new Error(`Failed to load ProfileHub HTML from ${n}: ${r.status}`)}catch(r){i=r,console.warn(`[PROFILE HUB] Failed to load from ${n}:`,r.message)}if(!e)throw i||new Error("Failed to load ProfileHub HTML from any path");const s=document.getElementById("profileHubContainer");s?(s.innerHTML=e,console.log("[PROFILE HUB] ProfileHub HTML content loaded successfully"),console.log("[PROFILE HUB] HTML loaded, ready for manager initialization")):(console.warn("[PROFILE HUB] ProfileHub container not found"),b())}catch(o){console.error("[PROFILE HUB] Error loading ProfileHub HTML:",o),u()}}async function U(){try{if(document.getElementById("authModal"))return;const o=["pages/page_modals/user_auth.html","./pages/page_modals/user_auth.html","../page_modals/user_auth.html","/pages/page_modals/user_auth.html"];let t=null,e=null;for(const s of o)try{const n=await fetch(s);if(n.ok){t=await n.text();break}else e=new Error(`Failed to load Auth Modal HTML from ${s}: ${n.status}`)}catch(n){e=n}if(!t)throw e||new Error("Auth Modal HTML load failed");const i=document.createElement("div");i.innerHTML=t,document.body.appendChild(i),console.log("[PROFILE HUB] Auth modal HTML injected")}catch(o){console.warn("[PROFILE HUB] Could not inject Auth modal:",o)}}function b(){if(document.getElementById("profileHubContainer")){console.log("[PROFILE HUB] Container already exists");return}const o=document.createElement("div");return o.id="profileHubContainer",o.style.position="fixed",o.style.top="20px",o.style.right="20px",o.style.zIndex="100080",o.style.pointerEvents="auto",o.style.transition="all 0.3s ease",document.body.appendChild(o),console.log("[PROFILE HUB] Created ProfileHub container"),o}function u(){console.log("[PROFILE HUB] Creating fallback ProfileHub structure...");const o=document.getElementById("profileHubContainer");o&&(o.innerHTML=`
    <button id="profileHubDrawerToggle" class="profile-hub-drawer-toggle" style="display: none;" title="Show Profile Hub">
      👤
    </button>
    <div id="profileHub" class="profile-hub" data-state="minimized">
      <div class="hub-core">
        <div class="hub-user-section">
          <div class="user-avatar-container">
            <div id="hubUserAvatar" class="hub-user-avatar">
              <span class="avatar-emoji">👤</span>
              <div class="avatar-status-indicator" id="hubStatusIndicator"></div>
            </div>
          </div>
          <div class="hub-user-info">
            <div id="hubUserName" class="hub-user-name">Guest</div>
            <div id="hubUserStatus" class="hub-user-status">Click to customize</div>
            <div id="hubUserLevel" class="hub-user-level">LVL • ?</div>
          </div>
        </div>
        <div class="hub-controls">
          <button id="hubChatbotToggle" class="hub-control-btn" title="AI Assistant">
            <span class="btn-icon">🤖</span>
            <span class="btn-pulse" id="chatbotPulse"></span>
          </button>
          <button id="hubCustomizeToggle" class="hub-control-btn" title="Explore">
            <span class="btn-icon">🔍</span>
          </button>
          <button id="hubAuthToggle" class="hub-control-btn hub-auth-btn" title="Login / Profile">
            <span class="btn-icon">🔐</span>
          </button>
        </div>
        <button id="hubToggleBtn" class="hub-toggle-btn" title="Expand Hub">
          <span class="toggle-icon">⫷</span>
        </button>
      </div>
      <div class="hub-expanded-content" id="hubExpandedContent">
        <div class="hub-navigation">
          <h3 class="nav-section-title">Navigate</h3>
          <div class="nav-links-grid">
            <a href="/pages/profile_dashboard/my-projects.html" class="nav-link" data-color="primary">
              <span class="nav-icon">📊</span>
              <span class="nav-label">Projects</span>
            </a>
            <a href="/pages/profile_dashboard/widget_studio.html" class="nav-link" data-color="secondary">
              <span class="nav-icon">🎨</span>
              <span class="nav-label">Studio</span>
            </a>
            <a href="/pages/explore.html" class="nav-link" data-color="accent">
              <span class="nav-icon">🔍</span>
              <span class="nav-label">Explore</span>
            </a>
            <a href="/pages/users.html" class="nav-link" data-color="success">
              <span class="nav-icon">👥</span>
              <span class="nav-label">Community</span>
            </a>
          </div>
        </div>
        <div class="hub-quick-actions">
          <h3 class="nav-section-title">Quick Actions</h3>
          <div class="quick-actions-grid">
            <button class="quick-action-btn" data-action="newWidget">
              <span class="action-icon">➕</span>
              <span class="action-label">New Widget</span>
            </button>
            <button class="quick-action-btn" data-action="shareProfile">
              <span class="action-icon">🔗</span>
              <span class="action-label">Share</span>
            </button>
            <button class="quick-action-btn" data-action="notifications">
              <span class="action-icon">🔔</span>
              <span class="action-label">Notifications</span>
              <span class="notification-badge" id="hubNotificationBadge">0</span>
            </button>
            <button class="quick-action-btn" data-action="settings">
              <span class="action-icon">⚙️</span>
              <span class="action-label">Settings</span>
            </button>
          </div>
        </div>
        <div class="hub-user-stats" id="hubUserStats" style="display: none;">
          <h3 class="nav-section-title">Stats</h3>
          <div class="stats-grid">
            <div class="stat-item">
              <span class="stat-value" id="hubWidgetCount">0</span>
              <span class="stat-label">Widgets</span>
            </div>
            <div class="stat-item">
              <span class="stat-value" id="hubFollowerCount">0</span>
              <span class="stat-label">Followers</span>
            </div>
            <div class="stat-item">
              <span class="stat-value" id="hubViewCount">0</span>
              <span class="stat-label">Views</span>
            </div>
          </div>
        </div>
      </div>
      <div class="hub-chatbot-container" id="hubChatbotContainer">
        <div class="chatbot-slider" id="chatbotSlider">
          <div class="chatbot-header">
            <div class="chatbot-title">
              <span class="chatbot-icon">🤖</span>
              <span>AI Assistant</span>
            </div>
            <div class="chatbot-controls">
              <button id="chatbotMinimize" class="chatbot-control-btn" title="Minimize">−</button>
              <button id="chatbotClose" class="chatbot-control-btn" title="Close">×</button>
            </div>
          </div>
          <div class="chatbot-content">
            <div class="chat-messages" id="hubChatMessages">
              <div class="message ai-message">
                <div class="message-avatar">🤖</div>
                <div class="message-content">
                  <p>Hi! I'm your AI assistant integrated into your ProfileHub. How can I help you navigate or customize your experience?</p>
                </div>
              </div>
            </div>
            <div class="chat-input-container">
              <input type="text" id="hubChatInput" class="chat-input" placeholder="Ask me anything..." maxlength="500">
              <button id="hubSendChatBtn" class="send-chat-btn">
                <span class="btn-icon">📤</span>
              </button>
            </div>
            <div class="chat-quick-commands" id="hubChatCommands">
              <button class="command-chip" data-command="/navigate projects">🔗 Projects</button>
              <button class="command-chip" data-command="/help customize">⚙️ Customize</button>
              <button class="command-chip" data-command="/stats">📊 Stats</button>
              <button class="command-chip" data-command="/help">❓ Help</button>
            </div>
          </div>
        </div>
      </div>
      <div class="hub-customization-panel" id="hubCustomizationPanel">
        <div class="customization-content">
          <h3>Customize Your Hub</h3>
          <div class="customization-section">
            <label class="section-label">Theme</label>
            <div class="theme-selector">
              <button class="theme-option active" data-theme="neo-brutalist">Neo</button>
              <button class="theme-option" data-theme="minimal">Minimal</button>
              <button class="theme-option" data-theme="cyberpunk">Cyber</button>
              <button class="theme-option" data-theme="custom">Custom</button>
            </div>
          </div>
          <div class="customization-section">
            <label class="section-label">Primary Color</label>
            <input type="color" id="hubPrimaryColor" class="color-picker" value="#00f0ff">
          </div>
          <div class="customization-section">
            <label class="section-label">Hub Size</label>
            <input type="range" id="hubSize" class="size-slider" min="0.8" max="1.5" step="0.1" value="1">
          </div>
          <div class="customization-actions">
            <button id="saveCustomization" class="save-btn">Save Changes</button>
            <button id="resetCustomization" class="reset-btn">Reset</button>
          </div>
        </div>
      </div>
    </div>
    <div id="profileHubOverlay" class="profile-hub-overlay"></div>
  `,console.log("[PROFILE HUB] Fallback ProfileHub structure created"))}let a=null;async function f(){console.log("[PROFILE HUB] Starting ProfileHub system initialization..."),console.log("[PROFILE HUB] Current URL:",window.location.href),console.log("[PROFILE HUB] Current pathname:",window.location.pathname);try{let o=document.getElementById("profileHubContainer");if(!o&&(console.log("[PROFILE HUB] Creating ProfileHub container..."),b(),await new Promise(e=>setTimeout(e,100)),o=document.getElementById("profileHubContainer"),!o))throw new Error("Failed to create ProfileHub container");return P(),await L(),await U(),await new Promise(e=>setTimeout(e,200)),document.getElementById("profileHub")?(a=new c,await a.init(),window.profileHubManager=a,I(),console.log("[PROFILE HUB] ProfileHub system ready!"),!0):(console.warn("[PROFILE HUB] ProfileHub element not found, skipping manager initialization"),!1)}catch(o){console.error("[PROFILE HUB] Failed to initialize ProfileHub:",o),console.log("[PROFILE HUB] Attempting fallback initialization...");try{return u(),await new Promise(t=>setTimeout(t,100)),a=new c,window.profileHubManager=a,console.log("[PROFILE HUB] Fallback initialization successful!"),!0}catch(t){return console.error("[PROFILE HUB] Fallback initialization also failed:",t),!1}}}document.addEventListener("DOMContentLoaded",async()=>{console.log("[PROFILE HUB] DOM ready, initializing ProfileHub..."),await f()});window.toggleProfileHub=()=>a?.toggleHub();window.toggleProfileChatbot=()=>a?.toggleChatbot();window.openProfileCustomization=()=>a?.toggleCustomization();window.toggleProfileHubDrawer=()=>a?.toggleDrawer();window.resetProfileBannerPosition=(o="top-right")=>{console.log("[PROFILE HUB DEBUG] Resetting position to:",o),a?(a.setState({ui:{position:o},user:{preferences:{position:o}}}),a.updateUI(),console.log("[PROFILE HUB DEBUG] Position reset complete")):console.warn("[PROFILE HUB DEBUG] ProfileHub manager not available")};window.forceShowProfileHub=()=>{if(console.log("[PROFILE HUB DEBUG] Forcing ProfileHub to show"),!document.getElementById("profileHubContainer")){console.error("[PROFILE HUB DEBUG] ProfileHub container not found!");return}const t=document.getElementById("profileHub");if(!t){console.error("[PROFILE HUB DEBUG] ProfileHub element not found! Creating fallback..."),u(),a||(console.log("[PROFILE HUB DEBUG] Creating ProfileHub manager..."),a=new c,window.profileHubManager=a);return}if(t.style.display="block",t.style.opacity="1",t.style.visibility="visible",t.style.zIndex="1000",t.style.position="fixed",t.style.top="20px",t.style.right="20px",console.log("[PROFILE HUB DEBUG] ProfileHub forced to show"),!a){console.log("[PROFILE HUB DEBUG] Initializing ProfileHub manager...");try{a=new c,window.profileHubManager=a,console.log("[PROFILE HUB DEBUG] ProfileHub manager initialized")}catch(e){console.error("[PROFILE HUB DEBUG] Failed to initialize ProfileHub manager:",e)}}};window.checkProfileHubStatus=()=>{console.log("[PROFILE HUB DEBUG] Checking ProfileHub status...");const o={container:!!document.getElementById("profileHubContainer"),profileHub:!!document.getElementById("profileHub"),manager:!!a,managerState:a?.state||null,cssLoaded:!!document.querySelector('link[href*="profile_banner.css"]'),scriptLoaded:!!window.ProfileHubEvents};return console.log("[PROFILE HUB DEBUG] Status:",o),o};window.ProfileHubEvents={onPositionChange:o=>{const t=e=>{o(e.detail)};return window.addEventListener("profilehub-position-changed",t),()=>{window.removeEventListener("profilehub-position-changed",t)}},onStateChange:o=>{const t=e=>{o(e.detail)};return window.addEventListener("profilehub-state-changed",t),()=>{window.removeEventListener("profilehub-state-changed",t)}},getCurrentPosition:()=>a?.state?.ui?.position||"top-right",getCurrentState:()=>a?.state?.ui?.hubState||"minimized",isModalOpen:o=>{if(!a)return!1;const{ui:t}=a.state;switch(o){case"expanded":return t.hubState==="expanded";case"chatbot":return t.hubState==="chatbot-active";case"customization":return t.customizationState==="open";default:return!1}}};window.openChatbot=()=>a?.toggleChatbot();window.openWorkflowManager=()=>{const o=document.getElementById("workflowManagerModal");o&&(o.style.display="block",document.body.style.overflow="hidden")};window.initProfileHub=()=>{console.log("[PROFILE HUB] Manual initialization triggered");try{a?console.log("[PROFILE HUB] ProfileHub already initialized"):(u(),a=new c,window.profileHubManager=a,console.log("[PROFILE HUB] Manual initialization successful"))}catch(o){console.error("[PROFILE HUB] Manual initialization failed:",o)}};window.openAuthModal=(o="login")=>{const t=document.getElementById("authModal");if(t){t.style.display="block",document.body.style.overflow="hidden";const e=document.getElementById("loginForm"),i=document.getElementById("signUpForm"),s=document.getElementById("forgotPasswordForm"),n=document.getElementById("authModalTitle");o==="signup"?(e.style.display="none",i.style.display="block",s.style.display="none",n.textContent="Sign Up"):o==="forgot"?(e.style.display="none",i.style.display="none",s.style.display="block",n.textContent="Reset Password"):(e.style.display="block",i.style.display="none",s.style.display="none",n.textContent="Login")}};console.log("[PROFILE HUB] ProfileHub module loaded successfully");setTimeout(()=>{if(!a){console.log("[PROFILE HUB] Timeout-based initialization triggered");try{const o=document.getElementById("profileHubContainer");o&&!o.querySelector("#profileHub")&&(console.log("[PROFILE HUB] Creating ProfileHub via timeout fallback"),u(),a=new c,window.profileHubManager=a,console.log("[PROFILE HUB] Timeout-based initialization successful"))}catch(o){console.error("[PROFILE HUB] Timeout-based initialization failed:",o)}}},2e3);window.repositionOrbToTopLeft=()=>{console.log("[PROFILE HUB DEBUG] Repositioning orb to top-left"),document.querySelector(".floating-orb-container")?(document.documentElement.style.setProperty("--orb-left","20px"),document.documentElement.style.setProperty("--orb-top","20px"),window.innerWidth<=768&&(document.documentElement.style.setProperty("--orb-left","15px"),document.documentElement.style.setProperty("--orb-top","15px")),console.log("[PROFILE HUB DEBUG] Orb repositioned to top-left successfully")):console.warn("[PROFILE HUB DEBUG] Orb container not found")};window.restoreProfileHub=()=>{console.log("[PROFILE HUB EMERGENCY] Restoring ProfileHub..."),u(),a||(a=new c,window.profileHubManager=a,console.log("[PROFILE HUB EMERGENCY] Manager created"));const o=document.getElementById("profileHub");o?(o.style.display="block",o.style.opacity="1",o.style.visibility="visible",o.style.position="fixed",o.style.top="20px",o.style.right="20px",o.style.zIndex="1000",console.log("[PROFILE HUB EMERGENCY] ProfileHub restored and visible!")):console.error("[PROFILE HUB EMERGENCY] Failed to restore ProfileHub")};window.testSlidingModal=()=>{console.log("[PROFILE HUB DEBUG] Testing sliding modal animation");const o=document.getElementById("hubCustomizationPanel");o?(o.classList.toggle("active"),console.log("[PROFILE HUB DEBUG] Sliding modal animation toggled")):console.warn("[PROFILE HUB DEBUG] Customization panel not found")};window.testProfileHubButtons=()=>{console.log("[PROFILE HUB DEBUG] Testing button functionality manually");const o={hubToggle:document.getElementById("hubToggleBtn"),chatbotToggle:document.getElementById("hubChatbotToggle"),customizeToggle:document.getElementById("hubCustomizeToggle"),authToggle:document.getElementById("hubAuthToggle")};Object.entries(o).forEach(([t,e])=>{if(e){console.log(`[PROFILE HUB DEBUG] Testing ${t} button...`);try{const i=new MouseEvent("click",{bubbles:!0,cancelable:!0,view:window});e.dispatchEvent(i),console.log(`[PROFILE HUB DEBUG] ${t} button click simulated successfully`)}catch(i){console.error(`[PROFILE HUB DEBUG] Error testing ${t} button:`,i)}}else console.warn(`[PROFILE HUB DEBUG] ${t} button not found`)})};window.testMobileLayout=()=>{console.log("[PROFILE HUB DEBUG] Testing mobile layout positioning...");const o=window.innerWidth<=768,t=window.innerWidth<=480;console.log(`[PROFILE HUB DEBUG] Screen width: ${window.innerWidth}px`),console.log(`[PROFILE HUB DEBUG] Is mobile: ${o}`),console.log(`[PROFILE HUB DEBUG] Is small mobile: ${t}`);const e=document.getElementById("profileHub"),i=document.getElementById("profileHubDrawerToggle"),s=document.getElementById("title-container");if(e){const n=e.getBoundingClientRect();console.log("[PROFILE HUB DEBUG] ProfileHub position:",{top:n.top,right:window.innerWidth-n.right,left:n.left,bottom:window.innerHeight-n.bottom,width:n.width,height:n.height})}if(i){const n=i.getBoundingClientRect();console.log("[PROFILE HUB DEBUG] Drawer toggle position:",{top:n.top,right:window.innerWidth-n.right,left:n.left,bottom:window.innerHeight-n.bottom,visible:window.getComputedStyle(i).display!=="none"})}if(s){const n=s.getBoundingClientRect();console.log("[PROFILE HUB DEBUG] Title container position:",{top:n.top,marginTop:window.getComputedStyle(s).marginTop})}if(e&&i){console.log("[PROFILE HUB DEBUG] Testing drawer functionality...");const n=e.classList.contains("drawer-hidden");console.log(`[PROFILE HUB DEBUG] ProfileHub is hidden: ${n}`),console.log(`[PROFILE HUB DEBUG] Drawer toggle is visible: ${window.getComputedStyle(i).display!=="none"}`)}return{isMobile:o,isSmallMobile:t,profileHub:!!e,drawerToggle:!!i,titleContainer:!!s}};window.testProfileHubDropdown=()=>{console.log("[PROFILE HUB DEBUG] Testing dropdown functionality...");const o=document.getElementById("profileHub"),t=document.getElementById("hubExpandedContent"),e=document.getElementById("hubToggleBtn");if(console.log("Elements found:"),console.log(`  ProfileHub: ${!!o}`),console.log(`  Expanded Content: ${!!t}`),console.log(`  Toggle Button: ${!!e}`),o&&console.log(`  Current data-state: ${o.getAttribute("data-state")}`),t){const i=window.getComputedStyle(t);console.log(`  Expanded content display: ${i.display}`),console.log(`  Expanded content visibility: ${i.visibility}`),console.log(`  Expanded content opacity: ${i.opacity}`)}return window.profileHubManager?(console.log("[PROFILE HUB DEBUG] Testing manual toggle..."),window.profileHubManager.toggleHub()):console.warn("[PROFILE HUB DEBUG] ProfileHub manager not available"),t&&console.log("Expanded content classes:",t.className),{profileHub:!!o,expandedContent:!!t,toggleBtn:!!e,manager:!!window.profileHubManager}};window.diagnoseProfileIssues=()=>{console.log("[PROFILE HUB DEBUG] Diagnosing profile connection issues...");const o={timestamp:new Date().toISOString(),profileHubContainer:!!document.getElementById("profileHubContainer"),profileHub:!!document.getElementById("profileHub"),profileHubManager:!!window.profileHubManager,authUser:!!window.socialAuth?.currentUser,firebaseAuth:!!window.auth?.currentUser,widgetDisplay:!!window.widgetDisplay,firestoreRules:"Check Firebase Console for updated rules",networkStatus:navigator.onLine?"online":"offline"};return console.log("[PROFILE HUB DEBUG] Diagnosis results:",o),o.profileHubContainer||console.error("[PROFILE HUB DEBUG] Missing profileHubContainer - this is critical!"),o.profileHub||console.error("[PROFILE HUB DEBUG] Missing profileHub element - HTML may not have loaded"),o.profileHubManager||console.error("[PROFILE HUB DEBUG] ProfileHub manager not initialized"),!o.authUser&&!o.firebaseAuth&&console.warn("[PROFILE HUB DEBUG] No authenticated user found"),o};window.reinitializeProfileHub=async()=>{if(console.log("[PROFILE HUB DEBUG] Force reinitializing ProfileHub..."),window.profileHubManager)try{window.profileHubManager.destroy()}catch(t){console.warn("[PROFILE HUB DEBUG] Error destroying existing manager:",t)}const o=document.getElementById("profileHubContainer");o&&(o.innerHTML=""),await f(),console.log("[PROFILE HUB DEBUG] Reinitialization complete")};window.showProfileHub=()=>{const o=document.getElementById("profileHub"),t=document.getElementById("profileHubContainer");o?(o.classList.remove("drawer-hidden"),o.style.display="block !important",o.style.opacity="1",o.style.transform="translateX(0)",o.style.pointerEvents="auto",o.setAttribute("data-state","visible"),console.log("[PROFILE HUB DEBUG] ProfileHub forced to show"),console.log(`[PROFILE HUB DEBUG] Screen width: ${window.innerWidth}px`),console.log(`[PROFILE HUB DEBUG] ProfileHub display: ${window.getComputedStyle(o).display}`)):console.log("[PROFILE HUB DEBUG] ProfileHub element not found"),t&&(t.style.pointerEvents="auto",console.log("[PROFILE HUB DEBUG] Container pointer events enabled"))};
