import"./modulepreload-polyfill-B5Qt9EMX.js";/* empty css               *//* empty css              *//* empty css                      */import{auth as a,db as l}from"./firebase-core-BO8UvLyb.js";import{getDoc as f,doc as w,query as d,collection as m,where as u,orderBy as h,limit as c,getDocs as g,onSnapshot as E}from"https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js";import{onAuthStateChanged as y,signInWithEmailAndPassword as v,createUserWithEmailAndPassword as B,updateProfile as L}from"https://www.gstatic.com/firebasejs/11.10.0/firebase-auth.js";import"./auth-COKA9b7m.js";import"./timeline-manager-B2jLQ0HO.js";import"./profile_banner-Eu8vPd6E.js";import"https://www.gstatic.com/firebasejs/11.10.0/firebase-app.js";import"https://www.gstatic.com/firebasejs/11.10.0/firebase-analytics.js";import"https://www.gstatic.com/firebasejs/11.10.0/firebase-storage.js";import"./profile-dashboard-manager-DumQz_VG.js";const i={log:(o,e=null)=>{console.log(`[MY PROJECTS] ${o}`,e||"")},error:(o,e=null)=>{console.error(`[MY PROJECTS ERROR] ${o}`,e||"")},warn:(o,e=null)=>{console.warn(`[MY PROJECTS WARN] ${o}`,e||"")}};class b{constructor(){this.currentUser=null,this.userProfile=null,this.timelineUnsubscribe=null,this.widgets=[],this.domElements={},this.initializeDOMElements(),this.setupEventListeners(),this.init()}initializeDOMElements(){this.domElements={userAvatar:document.getElementById("userAvatar"),userName:document.getElementById("userName"),profileAvatar:document.getElementById("profileAvatar"),profileName:document.getElementById("profileName"),profileBio:document.getElementById("profileBio"),widgetsCount:document.getElementById("widgetsCount"),followersCount:document.getElementById("followersCount"),viewsCount:document.getElementById("viewsCount"),profileSection:document.getElementById("profileSection"),authSection:document.getElementById("authSection"),loginForm:document.getElementById("loginForm"),loginEmail:document.getElementById("loginEmail"),loginPassword:document.getElementById("loginPassword"),loginBtn:document.getElementById("loginBtn"),signupForm:document.getElementById("signupForm"),signupEmail:document.getElementById("signupEmail"),signupPassword:document.getElementById("signupPassword"),signupDisplayName:document.getElementById("signupDisplayName"),signupBtn:document.getElementById("signupBtn"),showSignupBtn:document.getElementById("showSignupBtn"),showLoginBtn:document.getElementById("showLoginBtn"),loginFormContainer:document.getElementById("loginFormContainer"),signupFormContainer:document.getElementById("signupFormContainer"),timelineSection:document.getElementById("timelineSection"),refreshTimelineBtn:document.getElementById("refreshTimelineBtn"),widgetsGrid:document.getElementById("widgetsGrid"),toastContainer:document.getElementById("toastContainer")},i.log("DOM elements initialized",Object.keys(this.domElements))}setupEventListeners(){this.domElements.loginForm&&this.domElements.loginForm.addEventListener("submit",n=>{n.preventDefault(),this.handleLogin()}),this.domElements.signupForm&&this.domElements.signupForm.addEventListener("submit",n=>{n.preventDefault(),this.handleSignup()}),this.domElements.showSignupBtn&&this.domElements.showSignupBtn.addEventListener("click",()=>{this.showSignupForm()}),this.domElements.showLoginBtn&&this.domElements.showLoginBtn.addEventListener("click",()=>{this.showLoginForm()}),this.domElements.refreshTimelineBtn&&this.domElements.refreshTimelineBtn.addEventListener("click",()=>{this.refreshTimeline()});const e=document.getElementById("aiAssistantBtn");e&&e.addEventListener("click",()=>{this.openChatbot()});const t=document.getElementById("profileLoginBtn");t&&t.addEventListener("click",()=>{this.handleProfileLogin()}),i.log("Event listeners setup complete")}async init(){i.log("Initializing My Projects Manager"),y(a,async e=>{this.currentUser=e,i.log("Auth state changed",{userId:e?.uid}),e?await this.handleUserLogin(e):await this.handleUserLogout()}),i.log("My Projects Manager initialized - Features ready to initialize")}async handleUserLogin(e){i.log("Handling user login",{uid:e.uid});try{await this.loadUserProfile(e.uid),this.updateUIForLoggedInUser(),i.log("Initializing widget loading feature"),await this.loadUserWidgets(),i.log("Initializing timeline listener feature"),this.setupTimelineListener(),i.log("Initializing profile stats feature"),this.updateProfileStats()}catch(t){i.error("Error handling user login",t),this.showToast("Error loading profile","error")}}async handleUserLogout(){i.log("Handling user logout"),this.userProfile=null,this.widgets=[],this.updateUIForLoggedOutUser(),this.timelineUnsubscribe&&(this.timelineUnsubscribe(),this.timelineUnsubscribe=null)}async loadUserProfile(e){try{i.log("Loading user profile",{userId:e});const t=await f(w(l,"users",e));if(t.exists())this.userProfile=t.data(),i.log("User profile loaded",this.userProfile);else throw new Error("User profile not found")}catch(t){throw i.error("Failed to load user profile",t),t}}updateUIForLoggedInUser(){if(!this.userProfile)return;i.log("Updating UI for logged-in user");const{userAvatar:e,userName:t,profileAvatar:n,profileName:s,profileBio:r}=this.domElements;e&&(e.style.backgroundImage=this.userProfile.photoURL?`url(${this.userProfile.photoURL})`:"",e.innerHTML=this.userProfile.photoURL?"":"👤"),t&&(t.textContent=this.userProfile.displayName||this.userProfile.email?.split("@")[0]||"User"),n&&(n.style.backgroundImage=this.userProfile.photoURL?`url(${this.userProfile.photoURL})`:"",n.innerHTML=this.userProfile.photoURL?"":"👤"),s&&(s.textContent=this.userProfile.displayName||this.userProfile.email?.split("@")[0]||"User"),r&&(r.textContent=this.userProfile.bio||"Welcome to your creative dashboard!"),this.domElements.profileSection&&(this.domElements.profileSection.style.display="block"),this.domElements.authSection&&(this.domElements.authSection.style.display="none")}updateUIForLoggedOutUser(){i.log("Updating UI for logged-out user");const{userAvatar:e,userName:t,profileName:n,profileBio:s}=this.domElements;e&&(e.style.backgroundImage="",e.innerHTML="👤"),t&&(t.textContent="Guest"),n&&(n.textContent="Welcome Guest"),s&&(s.textContent="Sign in to access your projects and connect with the community."),this.domElements.profileSection&&(this.domElements.profileSection.style.display="none"),this.domElements.authSection&&(this.domElements.authSection.style.display="block")}async loadUserWidgets(){try{if(!this.currentUser)return;i.log("Loading user widgets",{userId:this.currentUser.uid});let e;try{e=d(m(l,"widgets"),u("userId","==",this.currentUser.uid),h("createdAt","desc"),c(20));const t=await g(e);this.widgets=[],t.forEach(n=>{const s={id:n.id,...n.data()};this.widgets.push(s)})}catch(t){i.warn("Index not available, using fallback query",t),e=d(m(l,"widgets"),u("userId","==",this.currentUser.uid),c(20));const n=await g(e);this.widgets=[],n.forEach(s=>{const r={id:s.id,...s.data()};this.widgets.push(r)}),this.widgets.sort((s,r)=>{const p=s.createdAt?.toDate?.()||new Date(0);return(r.createdAt?.toDate?.()||new Date(0))-p})}i.log("User widgets loaded",{count:this.widgets.length}),this.renderWidgets()}catch(e){i.error("Failed to load user widgets",e),e.code==="failed-precondition"?this.showToast("Database index is being created. Please refresh in a moment.","warning"):this.showToast("Failed to load widgets. Please check your connection.","error")}}renderWidgets(){const{widgetsGrid:e}=this.domElements;if(e){if(this.widgets.length===0){e.innerHTML=`
        <div class="neo-card" style="text-align: center; color: #a0a0a0;">
          <div style="font-size: 3rem; margin-bottom: 1rem;">🎨</div>
          <h3>No widgets yet</h3>
          <p>Create your first widget in the Widget Studio</p>
          <a href="widget_studio.html" class="quick-action-btn" style="margin-top: 1rem; display: inline-block;">Get Started</a>
        </div>
      `;return}e.innerHTML="",this.widgets.forEach(t=>{const n=this.createWidgetCard(t);e.appendChild(n)})}}createWidgetCard(e){const t=document.createElement("div");return t.className="neo-card",t.innerHTML=`
      <h3>${e.title||"Untitled Widget"}</h3>
      <p>${e.description||"No description"}</p>
      <div style="margin-top: auto; display: flex; gap: 0.5rem;">
        <button class="quick-action-btn" onclick="window.open('${e.files?.[0]?.downloadURL||"#"}', '_blank')">
          👁️ Preview
        </button>
        <button class="quick-action-btn" onclick="navigator.share({ title: '${e.title}', url: '${e.files?.[0]?.downloadURL||""}' })">
          📤 Share
        </button>
      </div>
    `,t}setupTimelineListener(){if(this.currentUser){i.log("Setting up timeline listener",{userId:this.currentUser.uid}),this.timelineUnsubscribe&&this.timelineUnsubscribe();try{const e=d(m(l,"notifications"),u("userId","==",this.currentUser.uid),h("timestamp","desc"),c(10));this.timelineUnsubscribe=E(e,t=>{this.renderTimeline(t.docs.map(n=>({id:n.id,...n.data()})))},t=>{i.error("Timeline listener error",t),this.renderTimeline([])})}catch(e){i.error("Failed to setup timeline listener",e),this.renderTimeline([])}}}renderTimeline(e){const{timelineSection:t}=this.domElements;if(t){if(e.length===0){t.innerHTML=`
        <div class="timeline-event">
          <div class="timeline-event-title">No recent activity</div>
          <div class="timeline-event-content">
            Your activity timeline will appear here as you create widgets and interact with the community.
          </div>
        </div>
      `;return}t.innerHTML="",e.forEach(n=>{const s=this.createTimelineEvent(n);t.appendChild(s)})}}createTimelineEvent(e){const t=document.createElement("div");t.className="timeline-event";const n=e.timestamp?.toDate?new Date(e.timestamp.toDate()).toLocaleString():"Just now";return t.innerHTML=`
      <div class="timeline-event-title">${e.title||"Activity"}</div>
      <div class="timeline-event-content">
        ${e.message||""}
        <div style="font-size: 0.8rem; color: #666; margin-top: 0.5rem;">${n}</div>
      </div>
    `,t}updateProfileStats(){if(!this.userProfile)return;const{widgetsCount:e,followersCount:t,viewsCount:n}=this.domElements;e&&(e.textContent=this.widgets.length||0),t&&(t.textContent=this.userProfile.followers?.length||0),n&&(n.textContent=this.userProfile.stats?.totalViews||0)}async handleLogin(){try{const e=this.domElements.loginEmail.value,t=this.domElements.loginPassword.value;if(!e||!t){this.showToast("Please fill in all fields","warning");return}i.log("Attempting login",{email:e}),this.setLoginButtonLoading(!0),await v(a,e,t),this.showToast("Login successful!","success"),this.clearLoginForm()}catch(e){i.error("Login failed",e),this.showToast(this.getAuthErrorMessage(e),"error")}finally{this.setLoginButtonLoading(!1)}}async handleSignup(){try{const e=this.domElements.signupEmail.value,t=this.domElements.signupPassword.value,n=this.domElements.signupDisplayName.value;if(!e||!t){this.showToast("Please fill in email and password","warning");return}if(t.length<6){this.showToast("Password must be at least 6 characters","warning");return}i.log("Attempting signup",{email:e}),this.setSignupButtonLoading(!0);const r=(await B(a,e,t)).user;i.log("User created successfully",{uid:r.uid}),n&&(await L(r,{displayName:n}),i.log("Display name updated",{displayName:n})),this.showToast("Account created successfully! Welcome to inQ!","success"),this.clearSignupForm(),setTimeout(()=>{this.showLoginForm()},2e3)}catch(e){i.error("Signup failed",e),this.showToast(this.getSignupErrorMessage(e),"error")}finally{this.setSignupButtonLoading(!1)}}showSignupForm(){i.log("Showing signup form"),this.domElements.loginFormContainer&&(this.domElements.loginFormContainer.style.display="none"),this.domElements.signupFormContainer&&(this.domElements.signupFormContainer.style.display="block"),this.domElements.showSignupBtn&&this.domElements.showSignupBtn.parentElement&&(this.domElements.showSignupBtn.parentElement.style.display="none"),this.domElements.showLoginBtn&&this.domElements.showLoginBtn.parentElement&&(this.domElements.showLoginBtn.parentElement.style.display="block")}showLoginForm(){i.log("Showing login form"),this.domElements.signupFormContainer&&(this.domElements.signupFormContainer.style.display="none"),this.domElements.loginFormContainer&&(this.domElements.loginFormContainer.style.display="block"),this.domElements.showLoginBtn&&this.domElements.showLoginBtn.parentElement&&(this.domElements.showLoginBtn.parentElement.style.display="none"),this.domElements.showSignupBtn&&this.domElements.showSignupBtn.parentElement&&(this.domElements.showSignupBtn.parentElement.style.display="block")}setLoginButtonLoading(e){const{loginBtn:t}=this.domElements;t&&(t.disabled=e,t.textContent=e?"Signing In...":"Sign In")}clearLoginForm(){this.domElements.loginEmail&&(this.domElements.loginEmail.value=""),this.domElements.loginPassword&&(this.domElements.loginPassword.value="")}setSignupButtonLoading(e){const{signupBtn:t}=this.domElements;t&&(t.disabled=e,t.textContent=e?"Creating Account...":"Create Account")}clearSignupForm(){this.domElements.signupEmail&&(this.domElements.signupEmail.value=""),this.domElements.signupPassword&&(this.domElements.signupPassword.value=""),this.domElements.signupDisplayName&&(this.domElements.signupDisplayName.value="")}getSignupErrorMessage(e){return{"auth/email-already-in-use":"An account with this email already exists.","auth/invalid-email":"Please enter a valid email address.","auth/weak-password":"Password is too weak. Please choose a stronger password.","auth/network-request-failed":"Network error. Please check your connection.","auth/too-many-requests":"Too many requests. Please try again later."}[e.code]||"Account creation failed. Please try again."}getAuthErrorMessage(e){return{"auth/user-not-found":"No account found with this email.","auth/wrong-password":"Incorrect password.","auth/invalid-email":"Invalid email address.","auth/user-disabled":"This account has been disabled.","auth/too-many-requests":"Too many failed attempts. Try again later."}[e.code]||"Login failed. Please try again."}refreshTimeline(){i.log("Refreshing timeline"),this.timelineUnsubscribe&&this.timelineUnsubscribe(),this.setupTimelineListener(),this.showToast("Timeline refreshed!","success")}openChatbot(){i.log("Opening chatbot modal");const e=document.getElementById("chatbotModal");e?(e.style.display="flex",this.showToast("AI Assistant opened!","info"),setTimeout(()=>{const t=document.getElementById("chatInput");t&&t.focus()},100)):(i.error("Chatbot modal not found"),this.showToast("AI Assistant not available","error"))}handleProfileLogin(){i.log("Handling profile login button click");const e=document.getElementById("authModal");e?(e.style.display="block",document.body.style.overflow="hidden"):this.showToast("Login system initializing...","info")}showToast(e,t="info"){const{toastContainer:n}=this.domElements;if(!n)return;const s=document.createElement("div");s.className=`toast ${t}`,s.innerHTML=`
      <div class="toast-icon">${this.getToastIcon(t)}</div>
      <div class="toast-content">
        <div class="toast-message">${e}</div>
      </div>
      <button class="toast-close">&times;</button>
    `,n.appendChild(s),setTimeout(()=>{s.parentNode&&s.parentNode.removeChild(s)},5e3),s.querySelector(".toast-close").addEventListener("click",()=>{s.parentNode&&s.parentNode.removeChild(s)})}getToastIcon(e){const t={success:"✅",error:"❌",warning:"⚠️",info:"ℹ️"};return t[e]||t.info}}document.addEventListener("DOMContentLoaded",()=>{i.log("DOM Content Loaded - Starting My Projects initialization");try{const o=new b;window.myProjectsManager=o,i.log("My Projects page ready")}catch(o){i.error("Failed to initialize My Projects",o)}});window.openChatbot=function(){window.myProjectsManager?window.myProjectsManager.openChatbot():console.warn("[MY PROJECTS] MyProjectsManager not found")};console.log("[CHATBOT] Chatbot module loaded");window.initializeChatbot=function(){console.log("[CHATBOT] initializeChatbot called")};
