console.log("[PROFILE HUB] Initializing modular ProfileHub system...");class l{constructor(){console.log("[PROFILE HUB] Creating ProfileHubManager..."),this.state={user:{isAuthenticated:!1,profile:null,preferences:this.getDefaultPreferences()},ui:{hubState:"minimized",chatbotState:"closed",customizationState:"closed",position:"top-right",theme:"neo-brutalist",scale:1},navigation:{currentPage:this.getCurrentPage(),history:[],bookmarks:[]},chatbot:{messages:[],isTyping:!1,commands:this.getQuickCommands()},notifications:{unreadCount:0,items:[]}},this.listeners=new Map,this.dom={},this.modules={auth:null,chatbot:null,customization:null,navigation:null},this.init()}async init(){console.log("[PROFILE HUB] Initializing ProfileHub system...");try{document.readyState==="loading"&&await new Promise(e=>{document.addEventListener("DOMContentLoaded",e)}),this.initializeDOMReferences(),await this.initializeModules(),this.setupEventListeners(),this.applySavedPreferences(),this.updateUI(),this.setupAuthListener(),console.log("[PROFILE HUB] ProfileHub initialization complete")}catch(e){console.error("[PROFILE HUB] Initialization failed:",e)}}initializeDOMReferences(){console.log("[PROFILE HUB] Initializing DOM references..."),this.dom={hub:document.getElementById("profileHub"),hubCore:document.querySelector(".hub-core"),expandedContent:document.getElementById("hubExpandedContent"),overlay:document.getElementById("profileHubOverlay"),userAvatar:document.getElementById("hubUserAvatar"),userName:document.getElementById("hubUserName"),userStatus:document.getElementById("hubUserStatus"),userLevel:document.getElementById("hubUserLevel"),statusIndicator:document.getElementById("hubStatusIndicator"),chatbotToggle:document.getElementById("hubChatbotToggle"),customizeToggle:document.getElementById("hubCustomizeToggle"),authToggle:document.getElementById("hubAuthToggle"),hubToggle:document.getElementById("hubToggleBtn"),drawerToggle:document.getElementById("profileHubDrawerToggle"),chatbotContainer:document.getElementById("hubChatbotContainer"),chatbotSlider:document.getElementById("chatbotSlider"),chatMessages:document.getElementById("hubChatMessages"),chatInput:document.getElementById("hubChatInput"),sendChatBtn:document.getElementById("hubSendChatBtn"),chatCommands:document.getElementById("hubChatCommands"),customizationPanel:document.getElementById("hubCustomizationPanel"),userStats:document.getElementById("hubUserStats"),notificationBadge:document.getElementById("hubNotificationBadge")};const t=["hub","hubCore","expandedContent"].filter(i=>!this.dom[i]);if(t.length>0)throw new Error(`Missing required DOM elements: ${t.join(", ")}`);console.log("[PROFILE HUB] DOM references initialized successfully - Enhanced sliding modal system ready")}async initializeModules(){console.log("[PROFILE HUB] Initializing modules..."),this.modules.auth=new g(this),this.modules.chatbot=new m(this),this.modules.customization=new p(this),this.modules.navigation=new b(this),console.log("[PROFILE HUB] All modules initialized")}setupEventListeners(){console.log("[PROFILE HUB] Setting up event listeners..."),this.addEventListener(this.dom.hubToggle,"click",()=>{this.toggleHub()}),this.addEventListener(this.dom.drawerToggle,"click",()=>{this.toggleDrawer()}),this.addEventListener(this.dom.chatbotToggle,"click",()=>{this.toggleChatbot()}),this.addEventListener(this.dom.customizeToggle,"click",()=>{console.log("[PROFILE HUB] Gear quicklink clicked → navigating to Explore"),console.log("[PROFILE HUB] Navigating to: pages/explore.html"),window.location.href="pages/explore.html"}),this.addEventListener(this.dom.authToggle,"click",()=>{this.modules.auth.handleAuthToggle()}),this.addEventListener(this.dom.userAvatar,"click",()=>{this.handleUserAvatarClick()}),this.addEventListener(this.dom.overlay,"click",()=>{this.closeAllPanels()}),this.addEventListener(document,"keydown",e=>{this.handleKeyboardShortcuts(e)}),this.setupNavigationListeners(),this.setupQuickActionListeners(),this.addEventListener(window,"resize",()=>{this.handleResize()}),console.log("[PROFILE HUB] Event listeners set up successfully")}setupNavigationListeners(){const e=this.dom.expandedContent?.querySelectorAll(".nav-link");e?(console.log(`[PROFILE HUB] Setting up ${e.length} navigation links`),e.forEach((t,i)=>{const s=t.getAttribute("href");console.log(`[PROFILE HUB] Link ${i+1}: ${s}`),this.addEventListener(t,"click",a=>{this.handleNavigation(a,t)})})):console.warn("[PROFILE HUB] No navigation links found in expanded content")}setupQuickActionListeners(){const e=this.dom.expandedContent?.querySelectorAll(".quick-action-btn");e&&e.forEach(t=>{this.addEventListener(t,"click",()=>{const i=t.dataset.action;this.handleQuickAction(i)})})}handleNavigation(e,t){const i=t.getAttribute("href"),s=i.startsWith("http");console.log(`[PROFILE HUB] Navigation requested: ${i}`),s||(e.preventDefault(),this.state.navigation.history.push({url:i,timestamp:Date.now(),title:t.textContent.trim()}),t.style.transform="scale(0.95)",setTimeout(()=>{t.style.transform=""},150),setTimeout(()=>{console.log(`[PROFILE HUB] Navigating to: ${i}`),window.location.href=i},200)),setTimeout(()=>{this.setState({ui:{hubState:"minimized"}})},100)}handleQuickAction(e){switch(console.log(`[PROFILE HUB] Quick action: ${e}`),e){case"newWidget":this.modules.navigation.openWidgetStudio();break;case"shareProfile":this.modules.navigation.shareProfile();break;case"notifications":this.modules.navigation.openNotifications();break;case"settings":this.toggleCustomization();break;default:console.warn(`[PROFILE HUB] Unknown action: ${e}`)}}handleKeyboardShortcuts(e){(e.ctrlKey||e.metaKey)&&e.shiftKey&&e.key==="H"&&(e.preventDefault(),this.toggleHub()),(e.ctrlKey||e.metaKey)&&e.shiftKey&&e.key==="C"&&(e.preventDefault(),this.toggleChatbot()),e.key==="Escape"&&this.closeAllPanels(),(e.ctrlKey||e.metaKey)&&e.shiftKey&&e.key==="D"&&(e.preventDefault(),this.toggleDrawer())}handleResize(){this.adjustHubPosition()}handleUserAvatarClick(){this.state.user.isAuthenticated?this.toggleHub():this.modules.auth.openAuthModal()}toggleHub(){const t=this.state.ui.hubState==="expanded"?"minimized":"expanded";console.log(`[PROFILE HUB] Toggling hub: ${this.state.ui.hubState} -> ${t}`),this.setState({ui:{hubState:t,customizationState:"closed"}})}toggleDrawer(){const e=this.dom.hub.classList.contains("drawer-hidden");console.log(`[PROFILE HUB] Toggling drawer: ${e?"showing":"hiding"}`),e?(this.dom.hub.classList.remove("drawer-hidden"),this.dom.drawerToggle.style.display="none",console.log("[PROFILE HUB] ProfileHub drawer shown")):(this.dom.hub.classList.add("drawer-hidden"),this.dom.drawerToggle.style.display="flex",console.log("[PROFILE HUB] ProfileHub drawer hidden"))}toggleChatbot(){const e=this.state.ui.hubState==="chatbot-active",t=e?"minimized":"chatbot-active";console.log(`[PROFILE HUB] Toggling chatbot: ${this.state.ui.hubState} -> ${t}`),console.log("[PROFILE HUB] Enhanced chatbot sliding animation triggered - smooth slide from right"),this.setState({ui:{hubState:t,customizationState:"closed"}}),e||this.modules.chatbot.initialize()}toggleCustomization(){const e=this.state.ui.customizationState==="open",t=e?"closed":"open";console.log(`[PROFILE HUB] Toggling customization: ${this.state.ui.customizationState} -> ${t}`),console.log("[PROFILE HUB] Enhanced sliding modal animation triggered - smooth slide from right"),console.log("[PROFILE HUB] Orb remains visible and accessible in top-left corner"),this.setState({ui:{customizationState:t,hubState:e?"minimized":"expanded"}}),this.toggleCustomizationBackdrop(t==="open"),console.log("[PROFILE HUB] Customization panel state updated successfully")}toggleCustomizationBackdrop(e){let t=document.getElementById("hub-customization-panel-backdrop");t||(t=document.createElement("div"),t.id="hub-customization-panel-backdrop",t.className="hub-customization-panel-backdrop",t.addEventListener("click",()=>{this.toggleCustomization()}),document.body.appendChild(t),console.log("[PROFILE HUB] Created customization panel backdrop")),e?(t.classList.add("active"),console.log("[PROFILE HUB] Enhanced backdrop overlay activated with sliding animation")):(t.classList.remove("active"),console.log("[PROFILE HUB] Enhanced backdrop overlay deactivated"))}closeAllPanels(){console.log("[PROFILE HUB] Closing all panels"),this.setState({ui:{hubState:"minimized",customizationState:"closed"}})}updateUI(){if(!this.dom.hub)return;const{ui:e,user:t,notifications:i}=this.state;if(this.dom.hub.setAttribute("data-state",e.hubState),this.dom.hub.setAttribute("data-theme",e.theme),this.dom.hub.setAttribute("data-position",e.position),this.dom.hub.style.setProperty("--hub-scale",e.scale),this.dom.overlay&&this.dom.overlay.classList.toggle("active",e.hubState==="expanded"||e.hubState==="chatbot-active"||e.customizationState==="open"),this.updateUserInfo(),this.updateNotificationBadge(),this.dom.customizationPanel){const s=e.customizationState==="open",a=this.dom.customizationPanel.classList.contains("active");this.dom.customizationPanel.classList.remove("slide-in","slide-out"),s&&!a?(this.dom.customizationPanel.classList.add("active","slide-in"),console.log("[PROFILE HUB] Customization panel sliding in with enhanced animation")):!s&&a?(this.dom.customizationPanel.classList.add("slide-out"),setTimeout(()=>{this.dom.customizationPanel.classList.remove("active","slide-out")},400),console.log("[PROFILE HUB] Customization panel sliding out with enhanced animation")):s&&this.dom.customizationPanel.classList.add("active")}if(this.dom.chatbotContainer){const s=e.hubState==="chatbot-active",a=this.dom.chatbotContainer.classList.contains("active");this.dom.chatbotContainer.classList.remove("slide-in","slide-out"),s&&!a?(this.dom.chatbotContainer.classList.add("active","slide-in"),console.log("[PROFILE HUB] Chatbot container sliding in with enhanced animation")):!s&&a?(this.dom.chatbotContainer.classList.add("slide-out"),setTimeout(()=>{this.dom.chatbotContainer.classList.remove("active","slide-out")},400),console.log("[PROFILE HUB] Chatbot container sliding out with enhanced animation")):s&&this.dom.chatbotContainer.classList.add("active")}console.log("[PROFILE HUB] UI updated with enhanced sliding modal animations")}updateUserInfo(){const{user:e}=this.state;this.dom.userName&&(this.dom.userName.textContent=e.isAuthenticated?e.profile?.displayName||e.profile?.name||"User":"Guest"),this.dom.userStatus&&(this.dom.userStatus.textContent=e.isAuthenticated?"Online • Authenticated":"Click to customize"),this.dom.userLevel&&(this.dom.userLevel.textContent=e.isAuthenticated?`LVL • ${e.profile?.level||1}`:"LVL • ?"),this.dom.statusIndicator&&(this.dom.statusIndicator.className=`avatar-status-indicator ${e.isAuthenticated?"online":"offline"}`),this.dom.authToggle&&(this.dom.authToggle.classList.toggle("logged-in",e.isAuthenticated),this.dom.authToggle.querySelector(".btn-icon").textContent=e.isAuthenticated?"👤":"🔐"),this.dom.userStats&&(this.dom.userStats.style.display=e.isAuthenticated?"block":"none"),console.log("[PROFILE HUB] User info updated")}updateNotificationBadge(){const{notifications:e}=this.state;this.dom.notificationBadge&&(this.dom.notificationBadge.textContent=e.unreadCount,this.dom.notificationBadge.style.display=e.unreadCount>0?"flex":"none")}updateUserStats(e){console.log("[PROFILE HUB] Updating user stats",e);const t=document.getElementById("hubWidgetCount"),i=document.getElementById("hubFollowerCount"),s=document.getElementById("hubViewCount");t&&(t.textContent=e.widgetsCreated||0),i&&(i.textContent=e.followersCount||0),s&&(s.textContent=e.totalViews||0),console.log("[PROFILE HUB] User stats updated successfully")}setupAuthListener(){window.addEventListener("auth-state-changed",e=>{const{user:t,profile:i}=e.detail;this.handleAuthStateChange(t,i)})}handleAuthStateChange(e,t=null){console.log("[PROFILE HUB] Auth state changed:",e?"logged in":"logged out",t?"with profile data":"without profile data"),this.setState({user:{isAuthenticated:!!e,profile:t||(e?this.extractUserProfile(e):null)}}),t&&t.stats&&this.updateUserStats(t.stats)}extractUserProfile(e){return{uid:e.uid,email:e.email,displayName:e.displayName,photoURL:e.photoURL,name:e.displayName||e.email?.split("@")[0],level:1}}setState(e,t=!0){this.state=this.deepMerge(this.state,e),this.updateUI(),e.ui?.position&&this.handlePositionChange(e.ui.position),t&&e.user?.preferences&&this.savePreferences(),this.emit("state-changed",{state:this.state,changes:e}),console.log("[PROFILE HUB] State updated:",e)}deepMerge(e,t){const i={...e};for(const s in t)t[s]&&typeof t[s]=="object"&&!Array.isArray(t[s])?i[s]=this.deepMerge(i[s]||{},t[s]):i[s]=t[s];return i}addEventListener(e,t,i){if(!e)return;e.addEventListener(t,i);const s=`${t}-${Date.now()}-${Math.random()}`;return this.listeners.set(s,{element:e,event:t,handler:i}),s}removeEventListener(e){const t=this.listeners.get(e);t&&(t.element.removeEventListener(t.event,t.handler),this.listeners.delete(e))}emit(e,t){const i=new CustomEvent(`profilehub-${e}`,{detail:t});window.dispatchEvent(i)}getCurrentPage(){return window.location.pathname.split("/").pop()||"index.html"}getDefaultPreferences(){return{theme:"neo-brutalist",position:"top-right",scale:1,autoMinimize:!0,chatbotEnabled:!0,keyboardShortcuts:!0,animations:!0}}getQuickCommands(){return[{command:"/navigate projects",label:"🔗 Projects",action:"navigate",target:"pages/my-projects.html"},{command:"/help customize",label:"⚙️ Customize",action:"customize",target:null},{command:"/stats",label:"📊 Stats",action:"stats",target:null},{command:"/help",label:"❓ Help",action:"help",target:null}]}savePreferences(){try{localStorage.setItem("profilehub-preferences",JSON.stringify(this.state.user.preferences)),console.log("[PROFILE HUB] Preferences saved")}catch(e){console.warn("[PROFILE HUB] Failed to save preferences:",e)}}applySavedPreferences(){try{const e=localStorage.getItem("profilehub-preferences");if(e){const t=JSON.parse(e);this.setState({user:{preferences:t},ui:{theme:t.theme||"neo-brutalist",position:t.position||"top-right",scale:t.scale||1}},!1),console.log("[PROFILE HUB] Preferences applied")}}catch(e){console.warn("[PROFILE HUB] Failed to load preferences:",e)}}adjustHubPosition(){const e=this.dom.hub.getBoundingClientRect();(e.right>window.innerWidth||e.bottom>window.innerHeight)&&console.log("[PROFILE HUB] Adjusting position for viewport")}handlePositionChange(e){console.log("[PROFILE HUB] Handling position change to:",e),this.updateModalPositions(e),this.emit("position-changed",{position:e,previousPosition:this.state.ui.position}),this.repositionOpenModals(e)}updateModalPosition(e,t){e&&(Object.keys(t).forEach(i=>{e.style[i]=t[i]}),e.className=e.className.replace(/position-\w+/g,""),e.classList.add(`position-${this.state.ui.position}`))}repositionOpenModals(e){const{ui:t}=this.state;t.hubState==="expanded"&&this.dom.expandedContent&&this.updateModalPositions(e),t.hubState==="chatbot-active"&&this.dom.chatbotContainer&&this.updateModalPositions(e),t.customizationState==="open"&&this.dom.customizationPanel&&this.updateModalPositions(e)}destroy(){console.log("[PROFILE HUB] Destroying ProfileHub..."),this.listeners.forEach((e,t)=>{this.removeEventListener(t)}),Object.values(this.modules).forEach(e=>{e&&typeof e.destroy=="function"&&e.destroy()}),console.log("[PROFILE HUB] ProfileHub destroyed")}}class g{constructor(e){this.hub=e,console.log("[AUTH MODULE] Initialized")}handleAuthToggle(){this.hub.state.user.isAuthenticated?this.openProfileMenu():this.openAuthModal()}openAuthModal(){if(console.log("[AUTH MODULE] Opening auth modal..."),window.openAuthModal)window.openAuthModal("login");else{const e=document.getElementById("authModal");e&&(e.style.display="block",document.body.style.overflow="hidden")}this.hub.setState({ui:{hubState:"minimized"}})}openProfileMenu(){console.log("[AUTH MODULE] Opening profile menu..."),this.hub.toggleHub()}}class m{constructor(e){this.hub=e,this.initialized=!1,console.log("[CHATBOT MODULE] Initialized")}initialize(){this.initialized||(console.log("[CHATBOT MODULE] Setting up chatbot integration..."),this.setupChatbotListeners(),this.loadChatHistory(),this.setupQuickCommands(),this.initialized=!0,console.log("[CHATBOT MODULE] Chatbot integration ready"))}setupChatbotListeners(){const{dom:e}=this.hub;this.hub.addEventListener(e.sendChatBtn,"click",()=>{this.sendMessage()}),this.hub.addEventListener(e.chatInput,"keypress",a=>{a.key==="Enter"&&!a.shiftKey&&(a.preventDefault(),this.sendMessage())});const t=e.chatCommands?.querySelectorAll(".command-chip");t&&t.forEach(a=>{this.hub.addEventListener(a,"click",()=>{const d=a.dataset.command;this.executeCommand(d)})});const i=e.chatbotSlider?.querySelector("#chatbotClose"),s=e.chatbotSlider?.querySelector("#chatbotMinimize");i&&this.hub.addEventListener(i,"click",()=>{this.hub.setState({ui:{hubState:"minimized"}})}),s&&this.hub.addEventListener(s,"click",()=>{this.hub.setState({ui:{hubState:"expanded"}})})}async sendMessage(){const{dom:e}=this.hub,t=e.chatInput?.value.trim();if(t){if(console.log("[CHATBOT MODULE] Sending message:",t),e.chatInput.value="",this.addMessage(t,"user"),t.startsWith("/")){this.executeCommand(t);return}this.showTypingIndicator();try{const i=await this.getAIResponse(t);this.hideTypingIndicator(),this.addMessage(i,"ai")}catch(i){console.error("[CHATBOT MODULE] Error getting AI response:",i),this.hideTypingIndicator(),this.addMessage("Sorry, I encountered an error. Please try again.","ai")}}}addMessage(e,t){const{dom:i}=this.hub;if(!i.chatMessages)return;const s=document.createElement("div");s.className=`message ${t}-message`,s.innerHTML=`
      <div class="message-avatar">${t==="user"?"👤":"🤖"}</div>
      <div class="message-content">
        <p>${e}</p>
      </div>
    `,i.chatMessages.appendChild(s),i.chatMessages.scrollTop=i.chatMessages.scrollHeight,this.hub.setState({chatbot:{messages:[...this.hub.state.chatbot.messages,{content:e,sender:t,timestamp:Date.now()}]}}),console.log(`[CHATBOT MODULE] Added ${t} message`)}showTypingIndicator(){const{dom:e}=this.hub;if(!e.chatMessages)return;const t=document.createElement("div");t.className="message ai-message typing",t.id="hubTypingIndicator",t.innerHTML=`
      <div class="message-avatar">🤖</div>
      <div class="message-content">
        <p>Thinking...</p>
      </div>
    `,e.chatMessages.appendChild(t),e.chatMessages.scrollTop=e.chatMessages.scrollHeight,this.hub.setState({chatbot:{isTyping:!0}})}hideTypingIndicator(){const e=document.getElementById("hubTypingIndicator");e&&e.remove(),this.hub.setState({chatbot:{isTyping:!1}})}async getAIResponse(e){try{const t=this.getContextualResponse(e);return t||(window.getAIResponse?await window.getAIResponse(e):this.getFallbackResponse(e))}catch(t){return console.error("[CHATBOT MODULE] AI response error:",t),"I'm here to help you navigate and customize your ProfileHub experience. What would you like to know?"}}getContextualResponse(e){const t=e.toLowerCase();return t.includes("navigate")||t.includes("go to")?"I can help you navigate! Use commands like '/navigate projects' to go to your projects, or click the navigation links in your expanded hub.":t.includes("customize")||t.includes("theme")?"To customize your ProfileHub, click the gear icon or use '/help customize'. You can change themes, colors, position, and more!":t.includes("stats")||t.includes("profile")?"Your profile stats show your widgets, followers, and views. Use '/stats' to see detailed information about your account.":null}getFallbackResponse(e){const t=["I'm your integrated AI assistant! I can help you navigate, customize your hub, and answer questions about the platform.","Try using commands like '/navigate projects' or '/help customize' for quick actions!","I can help you understand ProfileHub features. What would you like to explore?","Your ProfileHub is fully customizable! Ask me about themes, positioning, or navigation."];return t[Math.floor(Math.random()*t.length)]}executeCommand(e){console.log("[CHATBOT MODULE] Executing command:",e);const t=e.split(" "),i=t[0].substring(1),s=t.slice(1).join(" ");switch(i){case"navigate":this.executeNavigateCommand(s);break;case"help":this.executeHelpCommand(s);break;case"stats":this.executeStatsCommand();break;case"customize":this.executeCustomizeCommand();break;default:this.addMessage(`Unknown command: ${e}. Try '/help' for available commands.`,"ai")}}executeNavigateCommand(e){const t={projects:"pages/profile_dashboard/my-projects.html",studio:"pages/profile_dashboard/widget_studio.html",explore:"pages/explore.html",community:"pages/users.html"};t[e]?(this.addMessage(`Navigating to ${e}...`,"ai"),setTimeout(()=>{window.location.href=t[e]},1e3)):this.addMessage(`Available navigation targets: ${Object.keys(t).join(", ")}`,"ai")}executeHelpCommand(e){e==="customize"?(this.addMessage("To customize your ProfileHub: Click the gear icon, choose themes, adjust colors and position. Your changes are saved automatically!","ai"),this.hub.toggleCustomization()):this.addMessage(`Available commands:
      • /navigate [projects|studio|explore|community]
      • /help [customize]
      • /stats
      • /customize`,"ai")}executeStatsCommand(){const{user:e}=this.hub.state;e.isAuthenticated?this.addMessage(`Your Stats:
      • Level: ${e.profile?.level||1}
      • Widgets: ${e.profile?.stats?.widgetsCreated||0}
      • Followers: ${e.profile?.stats?.followersCount||0}
      • Views: ${e.profile?.stats?.totalViews||0}`,"ai"):this.addMessage("Please log in to view your stats!","ai")}executeCustomizeCommand(){this.addMessage("Opening customization panel...","ai"),this.hub.toggleCustomization()}setupQuickCommands(){}loadChatHistory(){try{const e=localStorage.getItem("profilehub-chat-history");if(e){const t=JSON.parse(e);this.hub.setState({chatbot:{messages:t}},!1),t.forEach(i=>{this.addMessage(i.content,i.sender)})}}catch(e){console.warn("[CHATBOT MODULE] Failed to load chat history:",e)}}}class p{constructor(e){this.hub=e,this.setupCustomizationControls(),console.log("[CUSTOMIZATION MODULE] Initialized")}setupCustomizationControls(){const e=document.getElementById("hubCustomizationPanel");if(!e)return;e.querySelectorAll(".theme-option").forEach(r=>{this.hub.addEventListener(r,"click",()=>{this.setTheme(r.dataset.theme)})});const i=e.querySelector("#hubPrimaryColor");i&&this.hub.addEventListener(i,"change",r=>{this.setPrimaryColor(r.target.value)});const s=e.querySelector("#hubSize");s&&this.hub.addEventListener(s,"input",r=>{this.setSize(parseFloat(r.target.value))});const a=e.querySelector("#saveCustomization"),d=e.querySelector("#resetCustomization");a&&this.hub.addEventListener(a,"click",()=>{this.saveCustomization()}),d&&this.hub.addEventListener(d,"click",()=>{this.resetCustomization()})}setTheme(e){console.log("[CUSTOMIZATION MODULE] Setting theme:",e),this.hub.setState({ui:{theme:e},user:{preferences:{theme:e}}}),document.querySelectorAll(".theme-option").forEach(t=>{t.classList.toggle("active",t.dataset.theme===e)})}setPrimaryColor(e){console.log("[CUSTOMIZATION MODULE] Setting primary color:",e),this.hub.dom.hub.style.setProperty("--hub-primary",e),this.hub.setState({user:{preferences:{primaryColor:e}}})}setSize(e){console.log("[CUSTOMIZATION MODULE] Setting size:",e),this.hub.setState({ui:{scale:e},user:{preferences:{scale:e}}})}saveCustomization(){this.hub.savePreferences(),this.showCustomizationToast("Customization saved!","success")}resetCustomization(){const e=this.hub.getDefaultPreferences();this.hub.setState({ui:{theme:e.theme,position:e.position,scale:e.scale},user:{preferences:e}}),this.updateCustomizationUI(),this.showCustomizationToast("Customization reset to defaults","info")}updateCustomizationUI(){const{ui:e}=this.hub.state;document.querySelectorAll(".theme-option").forEach(i=>{i.classList.toggle("active",i.dataset.theme===e.theme)}),document.getElementById("hubPrimaryColor");const t=document.getElementById("hubSize");t&&(t.value=e.scale)}showCustomizationToast(e,t){window.socialAuth&&window.socialAuth.showToast?window.socialAuth.showToast(e,t):console.log(`[CUSTOMIZATION MODULE] ${e}`)}}class b{constructor(e){this.hub=e,console.log("[NAVIGATION MODULE] Initialized")}openWidgetStudio(){console.log("[NAVIGATION MODULE] Opening Widget Studio..."),window.openWidgetStudio?window.openWidgetStudio():window.location.href="pages/profile_dashboard/widget_studio.html",this.hub.setState({ui:{hubState:"minimized"}})}shareProfile(){console.log("[NAVIGATION MODULE] Sharing profile...");const e=window.location.href;navigator.share?navigator.share({title:"Check out my profile!",url:e}):navigator.clipboard&&(navigator.clipboard.writeText(e),this.showNavigationToast("Profile URL copied to clipboard!","success"))}openNotifications(){console.log("[NAVIGATION MODULE] Opening notifications..."),window.openNotificationsPanel?window.openNotificationsPanel():this.showNavigationToast("Notifications panel coming soon!","info")}showNavigationToast(e,t){window.socialAuth&&window.socialAuth.showToast&&window.socialAuth.showToast(e,t)}}async function f(){try{console.log("[PROFILE HUB] Loading ProfileHub HTML content..."),await new Promise(s=>setTimeout(s,100));const o=["pages/page_modals/profile_banner.html","./pages/page_modals/profile_banner.html","/pages/page_modals/profile_banner.html"];let e=null,t=null;for(const s of o)try{console.log(`[PROFILE HUB] Trying to load from: ${s}`);const a=await fetch(s);if(a.ok){e=await a.text(),console.log(`[PROFILE HUB] Successfully loaded HTML from: ${s}`);break}else t=new Error(`Failed to load ProfileHub HTML from ${s}: ${a.status}`)}catch(a){t=a,console.warn(`[PROFILE HUB] Failed to load from ${s}:`,a.message)}if(!e)throw t||new Error("Failed to load ProfileHub HTML from any path");const i=document.getElementById("profileHubContainer");i?(i.innerHTML=e,console.log("[PROFILE HUB] ProfileHub HTML content loaded successfully"),initializeProfileHub()):(console.warn("[PROFILE HUB] ProfileHub container not found"),u())}catch(o){console.error("[PROFILE HUB] Error loading ProfileHub HTML:",o),c()}}function u(){const o=document.createElement("div");o.id="profileHubContainer",o.style.position="fixed",o.style.top="20px",o.style.right="20px",o.style.zIndex="1000",document.body.appendChild(o),console.log("[PROFILE HUB] Created ProfileHub container")}function c(){console.log("[PROFILE HUB] Creating fallback ProfileHub structure...");const o=document.getElementById("profileHubContainer");o&&(o.innerHTML=`
    <button id="profileHubDrawerToggle" class="profile-hub-drawer-toggle" style="display: none;" title="Show Profile Hub">
      👤
    </button>
    <div id="profileHub" class="profile-hub" data-state="minimized">
      <div class="hub-core">
        <div class="hub-user-section">
          <div class="user-avatar-container">
            <div id="hubUserAvatar" class="hub-user-avatar">
              <span class="avatar-emoji">👤</span>
              <div class="avatar-status-indicator" id="hubStatusIndicator"></div>
            </div>
          </div>
          <div class="hub-user-info">
            <div id="hubUserName" class="hub-user-name">Guest</div>
            <div id="hubUserStatus" class="hub-user-status">Click to customize</div>
            <div id="hubUserLevel" class="hub-user-level">LVL • ?</div>
          </div>
        </div>
        <div class="hub-controls">
          <button id="hubChatbotToggle" class="hub-control-btn" title="AI Assistant">
            <span class="btn-icon">🤖</span>
            <span class="btn-pulse" id="chatbotPulse"></span>
          </button>
          <button id="hubCustomizeToggle" class="hub-control-btn" title="Explore">
            <span class="btn-icon">⚙️</span>
          </button>
          <button id="hubAuthToggle" class="hub-control-btn hub-auth-btn" title="Login / Profile">
            <span class="btn-icon">🔐</span>
          </button>
        </div>
        <button id="hubToggleBtn" class="hub-toggle-btn" title="Expand Hub">
          <span class="toggle-icon">⫷</span>
        </button>
      </div>
      <div class="hub-expanded-content" id="hubExpandedContent">
        <div class="hub-navigation">
          <h3 class="nav-section-title">Navigate</h3>
          <div class="nav-links-grid">
            <a href="pages/profile_dashboard/my-projects.html" class="nav-link" data-color="primary">
              <span class="nav-icon">📊</span>
              <span class="nav-label">Projects</span>
            </a>
            <a href="pages/profile_dashboard/widget_studio.html" class="nav-link" data-color="secondary">
              <span class="nav-icon">🎨</span>
              <span class="nav-label">Studio</span>
            </a>
            <a href="pages/explore.html" class="nav-link" data-color="accent">
              <span class="nav-icon">🔍</span>
              <span class="nav-label">Explore</span>
            </a>
            <a href="pages/users.html" class="nav-link" data-color="success">
              <span class="nav-icon">👥</span>
              <span class="nav-label">Community</span>
            </a>
          </div>
        </div>
        <div class="hub-quick-actions">
          <h3 class="nav-section-title">Quick Actions</h3>
          <div class="quick-actions-grid">
            <button class="quick-action-btn" data-action="newWidget">
              <span class="action-icon">➕</span>
              <span class="action-label">New Widget</span>
            </button>
            <button class="quick-action-btn" data-action="shareProfile">
              <span class="action-icon">🔗</span>
              <span class="action-label">Share</span>
            </button>
            <button class="quick-action-btn" data-action="notifications">
              <span class="action-icon">🔔</span>
              <span class="action-label">Notifications</span>
              <span class="notification-badge" id="hubNotificationBadge">0</span>
            </button>
            <button class="quick-action-btn" data-action="settings">
              <span class="action-icon">⚙️</span>
              <span class="action-label">Settings</span>
            </button>
          </div>
        </div>
        <div class="hub-user-stats" id="hubUserStats" style="display: none;">
          <h3 class="nav-section-title">Stats</h3>
          <div class="stats-grid">
            <div class="stat-item">
              <span class="stat-value" id="hubWidgetCount">0</span>
              <span class="stat-label">Widgets</span>
            </div>
            <div class="stat-item">
              <span class="stat-value" id="hubFollowerCount">0</span>
              <span class="stat-label">Followers</span>
            </div>
            <div class="stat-item">
              <span class="stat-value" id="hubViewCount">0</span>
              <span class="stat-label">Views</span>
            </div>
          </div>
        </div>
      </div>
      <div class="hub-chatbot-container" id="hubChatbotContainer">
        <div class="chatbot-slider" id="chatbotSlider">
          <div class="chatbot-header">
            <div class="chatbot-title">
              <span class="chatbot-icon">🤖</span>
              <span>AI Assistant</span>
            </div>
            <div class="chatbot-controls">
              <button id="chatbotMinimize" class="chatbot-control-btn" title="Minimize">−</button>
              <button id="chatbotClose" class="chatbot-control-btn" title="Close">×</button>
            </div>
          </div>
          <div class="chatbot-content">
            <div class="chat-messages" id="hubChatMessages">
              <div class="message ai-message">
                <div class="message-avatar">🤖</div>
                <div class="message-content">
                  <p>Hi! I'm your AI assistant integrated into your ProfileHub. How can I help you navigate or customize your experience?</p>
                </div>
              </div>
            </div>
            <div class="chat-input-container">
              <input type="text" id="hubChatInput" class="chat-input" placeholder="Ask me anything..." maxlength="500">
              <button id="hubSendChatBtn" class="send-chat-btn">
                <span class="btn-icon">📤</span>
              </button>
            </div>
            <div class="chat-quick-commands" id="hubChatCommands">
              <button class="command-chip" data-command="/navigate projects">🔗 Projects</button>
              <button class="command-chip" data-command="/help customize">⚙️ Customize</button>
              <button class="command-chip" data-command="/stats">📊 Stats</button>
              <button class="command-chip" data-command="/help">❓ Help</button>
            </div>
          </div>
        </div>
      </div>
      <div class="hub-customization-panel" id="hubCustomizationPanel">
        <div class="customization-content">
          <h3>Customize Your Hub</h3>
          <div class="customization-section">
            <label class="section-label">Theme</label>
            <div class="theme-selector">
              <button class="theme-option active" data-theme="neo-brutalist">Neo</button>
              <button class="theme-option" data-theme="minimal">Minimal</button>
              <button class="theme-option" data-theme="cyberpunk">Cyber</button>
              <button class="theme-option" data-theme="custom">Custom</button>
            </div>
          </div>
          <div class="customization-section">
            <label class="section-label">Primary Color</label>
            <input type="color" id="hubPrimaryColor" class="color-picker" value="#00f0ff">
          </div>
          <div class="customization-section">
            <label class="section-label">Hub Size</label>
            <input type="range" id="hubSize" class="size-slider" min="0.8" max="1.5" step="0.1" value="1">
          </div>
          <div class="customization-actions">
            <button id="saveCustomization" class="save-btn">Save Changes</button>
            <button id="resetCustomization" class="reset-btn">Reset</button>
          </div>
        </div>
      </div>
    </div>
    <div id="profileHubOverlay" class="profile-hub-overlay"></div>
  `,console.log("[PROFILE HUB] Fallback ProfileHub structure created"))}let n=null;async function h(){console.log("[PROFILE HUB] Starting ProfileHub system initialization...");try{let o=document.getElementById("profileHubContainer");return o||(console.log("[PROFILE HUB] Creating ProfileHub container..."),u(),o=document.getElementById("profileHubContainer")),await f(),await new Promise(e=>setTimeout(e,200)),n=new l,window.profileHubManager=n,console.log("[PROFILE HUB] ProfileHub system ready!"),!0}catch(o){console.error("[PROFILE HUB] Failed to initialize ProfileHub:",o),console.log("[PROFILE HUB] Attempting fallback initialization...");try{return c(),await new Promise(e=>setTimeout(e,100)),n=new l,window.profileHubManager=n,console.log("[PROFILE HUB] Fallback initialization successful!"),!0}catch(e){return console.error("[PROFILE HUB] Fallback initialization also failed:",e),!1}}}document.addEventListener("DOMContentLoaded",async()=>{console.log("[PROFILE HUB] DOM ready, initializing ProfileHub..."),await h()});window.toggleProfileHub=()=>n?.toggleHub();window.toggleProfileChatbot=()=>n?.toggleChatbot();window.openProfileCustomization=()=>n?.toggleCustomization();window.toggleProfileHubDrawer=()=>n?.toggleDrawer();window.resetProfileBannerPosition=(o="top-right")=>{console.log("[PROFILE HUB DEBUG] Resetting position to:",o),n?(n.setState({ui:{position:o},user:{preferences:{position:o}}}),n.updateUI(),console.log("[PROFILE HUB DEBUG] Position reset complete")):console.warn("[PROFILE HUB DEBUG] ProfileHub manager not available")};window.forceShowProfileHub=()=>{if(console.log("[PROFILE HUB DEBUG] Forcing ProfileHub to show"),!document.getElementById("profileHubContainer")){console.error("[PROFILE HUB DEBUG] ProfileHub container not found!");return}const e=document.getElementById("profileHub");if(!e){console.error("[PROFILE HUB DEBUG] ProfileHub element not found! Creating fallback..."),c(),n||(console.log("[PROFILE HUB DEBUG] Creating ProfileHub manager..."),n=new l,window.profileHubManager=n);return}if(e.style.display="block",e.style.opacity="1",e.style.visibility="visible",e.style.zIndex="1000",e.style.position="fixed",e.style.top="20px",e.style.right="20px",console.log("[PROFILE HUB DEBUG] ProfileHub forced to show"),!n){console.log("[PROFILE HUB DEBUG] Initializing ProfileHub manager...");try{n=new l,window.profileHubManager=n,console.log("[PROFILE HUB DEBUG] ProfileHub manager initialized")}catch(t){console.error("[PROFILE HUB DEBUG] Failed to initialize ProfileHub manager:",t)}}};window.checkProfileHubStatus=()=>{console.log("[PROFILE HUB DEBUG] Checking ProfileHub status...");const o={container:!!document.getElementById("profileHubContainer"),profileHub:!!document.getElementById("profileHub"),manager:!!n,managerState:n?.state||null,cssLoaded:!!document.querySelector('link[href*="profile_banner.css"]'),scriptLoaded:!!window.ProfileHubEvents};return console.log("[PROFILE HUB DEBUG] Status:",o),o};window.ProfileHubEvents={onPositionChange:o=>{const e=t=>{o(t.detail)};return window.addEventListener("profilehub-position-changed",e),()=>{window.removeEventListener("profilehub-position-changed",e)}},onStateChange:o=>{const e=t=>{o(t.detail)};return window.addEventListener("profilehub-state-changed",e),()=>{window.removeEventListener("profilehub-state-changed",e)}},getCurrentPosition:()=>n?.state?.ui?.position||"top-right",getCurrentState:()=>n?.state?.ui?.hubState||"minimized",isModalOpen:o=>{if(!n)return!1;const{ui:e}=n.state;switch(o){case"expanded":return e.hubState==="expanded";case"chatbot":return e.hubState==="chatbot-active";case"customization":return e.customizationState==="open";default:return!1}}};window.openChatbot=()=>n?.toggleChatbot();window.openWorkflowManager=()=>{const o=document.getElementById("workflowManagerModal");o&&(o.style.display="block",document.body.style.overflow="hidden")};window.initProfileHub=()=>{console.log("[PROFILE HUB] Manual initialization triggered");try{n?console.log("[PROFILE HUB] ProfileHub already initialized"):(c(),n=new l,window.profileHubManager=n,console.log("[PROFILE HUB] Manual initialization successful"))}catch(o){console.error("[PROFILE HUB] Manual initialization failed:",o)}};window.openAuthModal=(o="login")=>{const e=document.getElementById("authModal");if(e){e.style.display="block",document.body.style.overflow="hidden";const t=document.getElementById("loginForm"),i=document.getElementById("signUpForm"),s=document.getElementById("forgotPasswordForm"),a=document.getElementById("authModalTitle");o==="signup"?(t.style.display="none",i.style.display="block",s.style.display="none",a.textContent="Sign Up"):o==="forgot"?(t.style.display="none",i.style.display="none",s.style.display="block",a.textContent="Reset Password"):(t.style.display="block",i.style.display="none",s.style.display="none",a.textContent="Login")}};console.log("[PROFILE HUB] ProfileHub module loaded successfully");setTimeout(()=>{if(!n){console.log("[PROFILE HUB] Timeout-based initialization triggered");try{const o=document.getElementById("profileHubContainer");o&&!o.querySelector("#profileHub")&&(console.log("[PROFILE HUB] Creating ProfileHub via timeout fallback"),c(),n=new l,window.profileHubManager=n,console.log("[PROFILE HUB] Timeout-based initialization successful"))}catch(o){console.error("[PROFILE HUB] Timeout-based initialization failed:",o)}}},2e3);window.repositionOrbToTopLeft=()=>{console.log("[PROFILE HUB DEBUG] Repositioning orb to top-left"),document.querySelector(".floating-orb-container")?(document.documentElement.style.setProperty("--orb-left","20px"),document.documentElement.style.setProperty("--orb-top","20px"),window.innerWidth<=768&&(document.documentElement.style.setProperty("--orb-left","15px"),document.documentElement.style.setProperty("--orb-top","15px")),console.log("[PROFILE HUB DEBUG] Orb repositioned to top-left successfully")):console.warn("[PROFILE HUB DEBUG] Orb container not found")};window.restoreProfileHub=()=>{console.log("[PROFILE HUB EMERGENCY] Restoring ProfileHub..."),c(),n||(n=new l,window.profileHubManager=n,console.log("[PROFILE HUB EMERGENCY] Manager created"));const o=document.getElementById("profileHub");o?(o.style.display="block",o.style.opacity="1",o.style.visibility="visible",o.style.position="fixed",o.style.top="20px",o.style.right="20px",o.style.zIndex="1000",console.log("[PROFILE HUB EMERGENCY] ProfileHub restored and visible!")):console.error("[PROFILE HUB EMERGENCY] Failed to restore ProfileHub")};window.testSlidingModal=()=>{console.log("[PROFILE HUB DEBUG] Testing sliding modal animation");const o=document.getElementById("hubCustomizationPanel");o?(o.classList.toggle("active"),console.log("[PROFILE HUB DEBUG] Sliding modal animation toggled")):console.warn("[PROFILE HUB DEBUG] Customization panel not found")};window.diagnoseProfileIssues=()=>{console.log("[PROFILE HUB DEBUG] Diagnosing profile connection issues...");const o={timestamp:new Date().toISOString(),profileHubContainer:!!document.getElementById("profileHubContainer"),profileHub:!!document.getElementById("profileHub"),profileHubManager:!!window.profileHubManager,authUser:!!window.socialAuth?.currentUser,firebaseAuth:!!window.auth?.currentUser,widgetDisplay:!!window.widgetDisplay,firestoreRules:"Check Firebase Console for updated rules",networkStatus:navigator.onLine?"online":"offline"};return console.log("[PROFILE HUB DEBUG] Diagnosis results:",o),o.profileHubContainer||console.error("[PROFILE HUB DEBUG] Missing profileHubContainer - this is critical!"),o.profileHub||console.error("[PROFILE HUB DEBUG] Missing profileHub element - HTML may not have loaded"),o.profileHubManager||console.error("[PROFILE HUB DEBUG] ProfileHub manager not initialized"),!o.authUser&&!o.firebaseAuth&&console.warn("[PROFILE HUB DEBUG] No authenticated user found"),o};window.reinitializeProfileHub=async()=>{if(console.log("[PROFILE HUB DEBUG] Force reinitializing ProfileHub..."),window.profileHubManager)try{window.profileHubManager.destroy()}catch(e){console.warn("[PROFILE HUB DEBUG] Error destroying existing manager:",e)}const o=document.getElementById("profileHubContainer");o&&(o.innerHTML=""),await h(),console.log("[PROFILE HUB DEBUG] Reinitialization complete")};
