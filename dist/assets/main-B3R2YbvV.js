const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./auth-COKA9b7m.js","./timeline-manager-B2jLQ0HO.js","./firebase-core-BO8UvLyb.js","./profile-dashboard-manager-DumQz_VG.js","./widget-upload-EdH-RL5r.js","./cloud-upload-DzQTDkpW.js","./navigation-CiQvIeE9.js"])))=>i.map(i=>d[i]);
import"./modulepreload-polyfill-B5Qt9EMX.js";/* empty css               */import{_ as h}from"./timeline-manager-B2jLQ0HO.js";import{auth as Z,db as k}from"./firebase-core-BO8UvLyb.js";import{getDoc as U,doc as T,collection as H,query as Q,where as j,getDocs as V,deleteDoc as G,updateDoc as Y,arrayRemove as ae,serverTimestamp as re}from"https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js";import"https://www.gstatic.com/firebasejs/11.10.0/firebase-storage.js";import{p as N}from"./profile-dashboard-manager-DumQz_VG.js";import"./widget-upload-EdH-RL5r.js";import"./cloud-upload-DzQTDkpW.js";import"./profile_banner-Eu8vPd6E.js";import"https://www.gstatic.com/firebasejs/11.10.0/firebase-auth.js";import"https://www.gstatic.com/firebasejs/11.10.0/firebase-app.js";import"https://www.gstatic.com/firebasejs/11.10.0/firebase-analytics.js";import"https://www.gstatic.com/firebasejs/11.10.0/firebase-functions.js";const i={log:(o,e=null)=>{console.log(`[MAIN DEBUG] ${o}`,e||"")},error:(o,e=null)=>{console.error(`[MAIN DEBUG ERROR] ${o}`,e||"")},warn:(o,e=null)=>{console.warn(`[MAIN DEBUG WARN] ${o}`,e||"")}};i.log("Starting enhanced inque social app initialization");window.authState={isInitialized:!1,lastLoginTime:null,hasShownWelcome:!1,currentUser:null};i.log("Importing firebase-core.js");try{h(()=>import("./firebase-core-BO8UvLyb.js"),[],import.meta.url).then(o=>{o&&o.db?(window.db=o.db,i.log("firebase-core.js imported successfully (db exposed)")):i.warn("firebase-core.js imported but db was not found in exports")}).catch(o=>{i.error("Failed to import firebase-core.js",o)})}catch(o){i.error("Error importing firebase-core.js",o)}i.log("Importing enhanced auth system");try{h(()=>import("./auth-COKA9b7m.js"),__vite__mapDeps([0,1,2,3]),import.meta.url).then(()=>{i.log("Enhanced auth system imported successfully")}).catch(o=>{i.error("Failed to import enhanced auth system",o)})}catch(o){i.error("Error importing enhanced auth system",o),i.log("Attempting fallback auth system load")}i.log("Importing enhanced widget upload system");try{h(()=>import("./widget-upload-EdH-RL5r.js"),__vite__mapDeps([4,5,2]),import.meta.url).then(()=>{i.log("Enhanced widget upload system imported successfully")}).catch(o=>{i.error("Failed to import enhanced widget upload system",o)})}catch(o){i.error("Error importing enhanced widget upload system",o)}i.log("Importing Firestore functions");try{h(()=>import("https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js"),[],import.meta.url).then(o=>{window.firestore=o,i.log("Firestore functions imported successfully")}).catch(o=>{i.error("Failed to import Firestore functions",o)})}catch(o){i.error("Error importing Firestore functions",o)}i.log("Importing social features");try{h(()=>Promise.resolve().then(()=>He),void 0,import.meta.url).then(()=>{i.log("Social features imported successfully")}).catch(o=>{i.error("Failed to import social features",o)})}catch(o){i.error("Error importing social features",o)}i.log("Importing navigation system");try{h(()=>import("./navigation-CiQvIeE9.js"),__vite__mapDeps([6,2]),import.meta.url).then(()=>{i.log("Navigation system imported successfully")}).catch(o=>{i.error("Failed to import navigation system",o)})}catch(o){i.error("Error importing navigation system",o)}i.log("Importing tools filter system");try{h(()=>import("./tools-filter-qyJYBFYl.js"),[],import.meta.url).then(()=>{i.log("Tools filter system imported successfully")}).catch(o=>{i.error("Failed to import tools filter system",o)})}catch(o){i.error("Error importing tools filter system",o)}i.log("Importing floating orb system");try{h(()=>Promise.resolve().then(()=>$e),void 0,import.meta.url).then(()=>{i.log("Floating orb system imported successfully")}).catch(o=>{i.error("Failed to import floating orb system",o)})}catch(o){i.error("Error importing floating orb system",o)}i.log("Importing ProfileHub system");try{h(()=>import("./profile_banner-Eu8vPd6E.js"),[],import.meta.url).then(()=>{i.log("ProfileHub system imported successfully")}).catch(o=>{i.error("Failed to import ProfileHub system",o)})}catch(o){i.error("Error importing ProfileHub system",o)}document.addEventListener("DOMContentLoaded",async()=>{i.log("DOM Content Loaded - Starting enhanced initialization");try{le(),de(),ue(),fe(),he(),ve();try{await D.init()}catch(o){i.error("Social stats manager initialization failed, continuing without it",o)}Le();try{ee()}catch(o){i.error("Enhanced scroll and fullscreen initialization failed, continuing without it",o)}me(),pe(),ze(),Be(),i.log("Enhanced initialization completed successfully"),ke()}catch(o){i.error("Error during enhanced initialization",o)}});function le(){i.log("Initializing authentication modal functionality");const o=document.getElementById("authModal"),e=document.querySelector(".auth-close-button"),t=document.getElementById("loginForm"),n=document.getElementById("signUpForm"),s=document.getElementById("showSignUp"),a=document.getElementById("showLogin"),r=document.getElementById("showLoginFromForgot"),l=document.getElementById("authModalTitle"),g=document.getElementById("forgotPasswordLink"),d=document.getElementById("forgotPasswordForm"),u=document.getElementById("googleLoginBtn"),p=document.getElementById("githubLoginBtn");if(!o||!e||!t||!n){i.warn("Some auth modal elements not found",{authModal:!!o,authCloseBtn:!!e,loginForm:!!t,signUpForm:!!n});return}u?(i.log("Google login button found, setting up event listener"),u.addEventListener("click",async()=>{try{i.log("Google login button clicked");const{GoogleAuthProvider:c,signInWithPopup:m}=await h(async()=>{const{GoogleAuthProvider:y,signInWithPopup:E}=await import("https://www.gstatic.com/firebasejs/11.10.0/firebase-auth.js");return{GoogleAuthProvider:y,signInWithPopup:E}},[],import.meta.url),{auth:f}=await h(async()=>{const{auth:y}=await import("./firebase-core-BO8UvLyb.js");return{auth:y}},[],import.meta.url),b=new c,v=await m(f,b);i.log("Google login successful",{user:v.user.displayName}),o.style.display="none",document.body.style.overflow=""}catch(c){i.error("Google login failed",c),alert(`Google login failed: ${c.message}`)}})):i.warn("Google login button not found in DOM"),p?(i.log("GitHub login button found, setting up event listener"),p.addEventListener("click",async()=>{try{i.log("GitHub login button clicked");const{GithubAuthProvider:c,signInWithPopup:m}=await h(async()=>{const{GithubAuthProvider:y,signInWithPopup:E}=await import("https://www.gstatic.com/firebasejs/11.10.0/firebase-auth.js");return{GithubAuthProvider:y,signInWithPopup:E}},[],import.meta.url),{auth:f}=await h(async()=>{const{auth:y}=await import("./firebase-core-BO8UvLyb.js");return{auth:y}},[],import.meta.url),b=new c,v=await m(f,b);i.log("GitHub login successful",{user:v.user.displayName}),o.style.display="none",document.body.style.overflow=""}catch(c){i.error("GitHub login failed",c),alert(`GitHub login failed: ${c.message}`)}})):i.warn("GitHub login button not found in DOM"),s&&s.addEventListener("click",c=>{c.preventDefault(),i.log("Switching to sign up form"),t.style.display="none",n.style.display="block",d.style.display="none",l.textContent="Sign Up"}),a&&a.addEventListener("click",c=>{c.preventDefault(),i.log("Switching to login form"),n.style.display="none",t.style.display="block",d.style.display="none",l.textContent="Login"}),r&&r.addEventListener("click",c=>{c.preventDefault(),i.log("Switching from forgot password to login form"),d.style.display="none",t.style.display="block",l.textContent="Login"}),g&&g.addEventListener("click",c=>{c.preventDefault(),i.log("Switching to forgot password form"),t.style.display="none",n.style.display="none",d.style.display="block",l.textContent="Reset Password"}),e&&e.addEventListener("click",()=>{i.log("Closing auth modal"),o.style.display="none",document.body.style.overflow=""}),window.addEventListener("click",c=>{c.target===o&&(i.log("Closing auth modal via outside click"),o.style.display="none",document.body.style.overflow="")}),document.addEventListener("keydown",c=>{c.key==="Escape"&&o.style.display==="block"&&(i.log("Closing auth modal via escape key"),o.style.display="none",document.body.style.overflow="")}),i.log("Authentication modal functionality initialized")}function O(o){i.log("Updating home section for auth state",{userId:o?.uid});const e=document.getElementById("home-greeting"),t=document.getElementById("home-subtitle"),n=document.getElementById("guest-cta-section"),s=document.getElementById("user-quick-actions");if(o){if(e){const a=o.displayName||o.email?.split("@")[0]||"Developer";e.textContent=`welcome back, ${a}.`}t&&(t.textContent="Ready to build something amazing? Choose your path:"),n&&(n.style.display="none"),s&&(s.style.display="block")}else e&&(e.textContent="welcome home."),t&&(t.textContent="Join 1,200+ developers building the future with AI IDEs. Share your projects, learn from others, and showcase your creativity."),n&&(n.style.display="block"),s&&(s.style.display="none")}function de(){i.log("Initializing home section button handlers");const o=document.getElementById("guest-signup-btn"),e=document.getElementById("guest-login-btn");o&&o.addEventListener("click",()=>{i.log("Guest signup button clicked");const a=document.getElementById("authModal");a&&(a.style.display="block",document.body.style.overflow="hidden",setTimeout(()=>{const r=document.querySelector('[data-tab="signup"]');r&&r.click()},100))}),e&&e.addEventListener("click",()=>{i.log("Guest login button clicked");const a=document.getElementById("authModal");a&&(a.style.display="block",document.body.style.overflow="hidden",setTimeout(()=>{const r=document.querySelector('[data-tab="login"]');r&&r.click()},100))});const t=document.getElementById("explore-projects-btn"),n=document.getElementById("my-dashboard-btn"),s=document.getElementById("improve-craft-btn");t&&t.addEventListener("click",()=>{i.log("Explore projects button clicked"),window.location.href="pages/explore.html"}),n&&n.addEventListener("click",()=>{i.log("My dashboard button clicked"),window.location.href="pages/my-projects.html"}),s&&s.addEventListener("click",()=>{i.log("Improve craft button clicked"),ce()})}function ce(){if(i.log("Opening knowledge base"),!window.authState||!window.authState.currentUser){window.showToast("Please sign in to access the knowledge base","info");return}window.location.href="pages/knowledge-base.html"}const W={isInitialized:!1,updateInterval:null,lastUpdate:null,async init(){if(i.log("Initializing live stats manager"),this.isInitialized){i.log("Live stats already initialized");return}try{await this.loadAndUpdateStats(),this.updateInterval=setInterval(async()=>{await this.loadAndUpdateStats()},3e4),this.isInitialized=!0,i.log("Live stats manager initialized successfully")}catch(o){i.error("Failed to initialize live stats manager",o)}},async loadAndUpdateStats(){i.log("Loading live stats from Firestore");try{const o=document.querySelector(".live-stats-container");if(o&&o.classList.add("loading"),!window.firestore||!window.db){i.warn("Firestore not available yet, using fallback stats"),this.updateStatsDisplay({users:1247,widgets:856,posts:342});return}const e=await this.fetchStatsFromFirestore();this.updateStatsDisplay(e),this.updateLastUpdatedTime(),o&&o.classList.remove("loading")}catch(o){i.error("Failed to load live stats",o),this.updateStatsDisplay({users:1247,widgets:856,posts:342})}},async fetchStatsFromFirestore(){i.log("Fetching stats from Firestore collections");try{const o={};try{const e=window.firestore.collection(window.db,"users"),t=await window.firestore.getDocs(e);o.users=t.size,i.log("Users count fetched",{count:o.users})}catch(e){i.warn("Failed to fetch users count",e),o.users=1247}try{const e=window.firestore.collection(window.db,"widgets"),t=await window.firestore.getDocs(e);o.widgets=t.size,i.log("Widgets count fetched",{count:o.widgets})}catch(e){i.warn("Failed to fetch widgets count",e),o.widgets=856}try{o.posts=Math.floor(o.users*.28+o.widgets*.15),i.log("Posts count calculated",{count:o.posts})}catch(e){i.warn("Failed to calculate posts count",e),o.posts=342}return o}catch(o){return i.error("Error fetching stats from Firestore",o),{users:1247,widgets:856,posts:342}}},updateStatsDisplay(o){i.log("Updating stats display",o);const e=document.querySelector(".stats-grid");e&&(e.classList.add("updating"),setTimeout(()=>{e.classList.remove("updating")},1500)),setTimeout(()=>this.animateCounter("live-users-count",o.users),200),setTimeout(()=>this.animateCounter("live-widgets-count",o.widgets),400),setTimeout(()=>this.animateCounter("live-posts-count",o.posts),600),setTimeout(()=>this.updateTrendIndicators(o),800),this.addSparkleEffect()},animateCounter(o,e){const t=document.getElementById(o);if(!t){i.warn("Counter element not found",{elementId:o});return}const n=t.querySelector(".count-value");if(!n){i.warn("Count value span not found",{elementId:o});return}const s=parseInt(n.textContent)||0,a=e-s;if(a===0){i.log("No change in counter value",{elementId:o,value:e});return}i.log("Animating counter",{elementId:o,from:s,to:e}),n.classList.add("updating");const r=1500,l=50,g=a/l,d=r/l;let u=0;const p=()=>{if(u>=l){n.textContent=e.toLocaleString(),n.classList.remove("updating"),n.classList.add("bounce"),setTimeout(()=>{n.classList.remove("bounce")},400);return}const c=Math.round(s+g*u);n.textContent=c.toLocaleString(),u++,setTimeout(p,d)};p()},updateTrendIndicators(o){const e={users:Math.floor(Math.random()*20)+5,widgets:Math.floor(Math.random()*15)+3,posts:Math.floor(Math.random()*10)+2},t=document.querySelector('[data-stat="users"] .trend-text'),n=document.querySelector('[data-stat="widgets"] .trend-text'),s=document.querySelector('[data-stat="posts"] .trend-text');t&&(t.textContent=`+${e.users} this week`),n&&(n.textContent=`+${e.widgets} today`),s&&(s.textContent=`+${e.posts} this week`),this.updateHotIndicators(e,o)},updateHotIndicators(o,e){document.querySelectorAll(".hot-indicator").forEach(n=>n.remove());const t={users:15,widgets:10,posts:8};Object.keys(o).forEach(n=>{if(o[n]>=t[n]){const s=document.querySelector(`[data-stat="${n}"]`);if(s){const a=document.createElement("div");a.className="hot-indicator",a.style.cssText=`
            position: absolute;
            top: 8px;
            right: 8px;
            background: linear-gradient(135deg, #ff4444, #ff8800);
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            animation: hot-pulse 1.5s ease-in-out infinite;
            box-shadow: 0 2px 8px rgba(255, 68, 68, 0.4);
            z-index: 10;
          `,a.textContent="ðŸ”¥ HOT",s.appendChild(a)}}})},addSparkleEffect(){i.log("Adding sparkle effect to stats"),document.querySelectorAll(".live-stat-card").forEach((e,t)=>{setTimeout(()=>{const n=document.createElement("div");n.style.cssText=`
          position: absolute;
          top: 20px;
          right: 20px;
          font-size: 20px;
          color: var(--primary-neon);
          animation: sparkle 1s ease-out forwards;
          pointer-events: none;
          z-index: 10;
        `,n.textContent="âœ¨",e.style.position="relative",e.appendChild(n),setTimeout(()=>{n.parentNode&&n.parentNode.removeChild(n)},1e3)},t*200)})},updateLastUpdatedTime(){const o=document.getElementById("stats-last-updated");if(o){const e=new Date,t=e.toLocaleTimeString("en-US",{hour12:!0,hour:"numeric",minute:"2-digit"});o.textContent=t,this.lastUpdate=e}},destroy(){this.updateInterval&&(clearInterval(this.updateInterval),this.updateInterval=null),this.isInitialized=!1,i.log("Live stats manager destroyed")}};function ue(){i.log("Initializing live stats functionality"),setTimeout(async()=>{await W.init()},1e3),window.addEventListener("beforeunload",()=>{W.destroy()}),ge();const o=document.getElementById("refresh-stats-btn");o&&(o.addEventListener("keydown",e=>{(e.key==="Enter"||e.key===" ")&&(e.preventDefault(),$())}),o.setAttribute("tabindex","0"),o.setAttribute("aria-label","Refresh live community statistics"))}function ge(){i.log("Setting up stats card interactions"),document.querySelectorAll(".live-stat-card").forEach(t=>{t.addEventListener("click",()=>{const n=t.getAttribute("data-stat");J(n)}),t.setAttribute("tabindex","0"),t.setAttribute("role","button"),t.setAttribute("aria-label",`View details for ${t.getAttribute("data-stat")} statistics`),t.addEventListener("keydown",n=>{if(n.key==="Enter"||n.key===" "){n.preventDefault();const s=t.getAttribute("data-stat");J(s)}}),t.addEventListener("focus",()=>{t.style.transform="translateY(-2px)",t.style.borderColor="var(--primary-neon)"}),t.addEventListener("blur",()=>{t.style.transform="",t.style.borderColor=""})});const e=document.querySelector(".live-stats-container");if(e){let t=0;e.addEventListener("click",()=>{t++,t===1&&setTimeout(()=>{t===2&&(i.log("Double-click detected on stats container - refreshing"),$()),t=0},300)})}}function J(o){i.log("Stats card clicked",{statType:o});const t={users:"ðŸ‘¥ Active developers building amazing projects with AI IDEs! Join the community to connect with fellow creators.",widgets:"ðŸŽ¨ Interactive widgets created by our talented community! Share your own creations in the Widget Studio.",posts:"ðŸ“š Knowledge base posts with tips, guides, and insights! Contribute your expertise to help others learn."}[o]||"Click to learn more about our growing community!";window.showToast(t,"info");const n=document.querySelector(`[data-stat="${o}"]`);n&&(n.style.transform="scale(0.98)",setTimeout(()=>{n.style.transform=""},150))}async function $(){i.log("Manual stats refresh triggered");const o=document.getElementById("refresh-stats-btn"),e=document.querySelector(".live-stats-container");o&&(o.classList.add("refreshing"),o.style.pointerEvents="none"),e&&e.classList.add("updating"),window.showToast("ðŸ”„ Refreshing live stats...","info");try{await W.loadAndUpdateStats(),e&&(e.classList.remove("updating"),e.classList.add("success"),setTimeout(()=>{e.classList.remove("success")},2e3)),window.showToast("âœ… Stats updated successfully!","success")}catch(t){i.error("Manual stats refresh failed",t),e&&e.classList.remove("updating"),window.showToast("âŒ Failed to refresh stats","error")}finally{o&&setTimeout(()=>{o.classList.remove("refreshing"),o.style.pointerEvents="auto"},1e3)}}window.manualRefreshStats=$;function me(){i.log("Initializing auth state tracking"),window.addEventListener("auth-state-changed",o=>{const{user:e,profile:t,isNewLogin:n}=o.detail;if(i.log("Auth state change event received",{userId:e?.uid,isNewLogin:n,hasProfile:!!t,currentState:window.authState.isInitialized}),e&&!window.authState.isInitialized){if(window.authState.isInitialized=!0,window.authState.currentUser=e,window.authState.userProfile=t,window.authState.lastLoginTime=Date.now(),n&&(window.authState.hasShownWelcome=!0,i.log("New login detected, will show welcome message"),window.socialAuth&&window.socialAuth.showToast)){const s=t?.displayName||t?.name||e.displayName||e.email?.split("@")[0];window.socialAuth.showToast(`Welcome to inque, ${s}! ðŸŽ‰ Your account is ready.`,"success",5e3)}}else e||(window.authState.isInitialized=!1,window.authState.currentUser=null,window.authState.userProfile=null,window.authState.lastLoginTime=null,window.authState.hasShownWelcome=!1,i.log("User logged out, reset auth state"));O(e)}),setTimeout(()=>{window.authState&&window.authState.currentUser?O(window.authState.currentUser):O(null)},100),i.log("Auth state tracking initialized")}function pe(){i.log("Initializing additional modals");const o=document.getElementById("widgetStudioModal"),e=document.querySelector(".widget-studio-close-button");if(o&&e){e.addEventListener("click",()=>{i.log("Closing Widget Studio modal"),o.style.display="none",document.body.style.overflow=""}),window.addEventListener("click",d=>{d.target===o&&(i.log("Closing Widget Studio modal via outside click"),o.style.display="none",document.body.style.overflow="")}),document.addEventListener("keydown",d=>{d.key==="Escape"&&o.style.display==="block"&&(i.log("Closing Widget Studio modal via escape key"),o.style.display="none",document.body.style.overflow="")});const r=document.getElementById("widgetFileInput"),l=document.getElementById("uploadedFiles"),g=document.getElementById("createWidgetBtn");r&&l&&g&&(r.addEventListener("change",d=>{const u=Array.from(d.target.files);i.log("Widget files selected",{count:u.length}),l.innerHTML="",u.forEach(c=>{const m=document.createElement("div");m.className="file-item",m.style.cssText="display: flex; align-items: center; gap: 10px; padding: 12px; background: rgba(0, 240, 255, 0.1); border-radius: 8px; border: 1px solid rgba(0, 240, 255, 0.2); margin-bottom: 8px;";const f=p(c.name);m.innerHTML=`
            <span style="font-size: 1.2rem;">${f}</span>
            <span style="flex: 1; color: var(--text-light); font-weight: 500;">${c.name}</span>
            <span style="color: var(--primary-color); font-size: 0.9rem; font-weight: 600;">${(c.size/1024).toFixed(1)} KB</span>
          `,l.appendChild(m)}),window.showToast(`${u.length} file${u.length>1?"s":""} selected successfully! ðŸ“`,"success");function p(c){const m=c.split(".").pop().toLowerCase();return{html:"ðŸŒ",css:"ðŸŽ¨",js:"âš¡",png:"ðŸ–¼ï¸",jpg:"ðŸ–¼ï¸",jpeg:"ðŸ–¼ï¸",gif:"ðŸ–¼ï¸",svg:"ðŸ–¼ï¸",json:"ðŸ“‹",txt:"ðŸ“„",md:"ðŸ“"}[m]||"ðŸ“"}g.disabled=u.length===0}),g.addEventListener("click",async()=>{i.log("Create widget button clicked");try{if(Array.from(r.files).length===0){window.showToast("Please select files to create a widget","warning");return}g.disabled=!0,g.innerHTML='<span class="btn-loader">Creating...</span>',await new Promise(u=>setTimeout(u,2e3)),window.showToast("Widget created successfully! ðŸŽ‰","success"),r.value="",l.innerHTML="",g.disabled=!0,setTimeout(()=>{const u=document.getElementById("widgetStudioModal");u&&(u.style.display="none",document.body.style.overflow="")},1500),i.log("Widget created successfully")}catch(d){i.error("Failed to create widget",d),window.showToast("Failed to create widget: "+d.message,"error")}finally{g.disabled=!1,g.innerHTML="Create Widget"}})),i.log("Widget Studio modal initialized")}const t=document.getElementById("editProfileModal"),n=document.querySelector(".edit-profile-close-button"),s=document.getElementById("editProfileForm"),a=document.getElementById("cancelEditBtn");if(t&&n){n.addEventListener("click",()=>{i.log("Closing Edit Profile modal"),t.style.display="none",document.body.style.overflow=""}),a&&a.addEventListener("click",()=>{i.log("Canceling profile edit"),t.style.display="none",document.body.style.overflow=""}),window.addEventListener("click",g=>{g.target===t&&(i.log("Closing Edit Profile modal via outside click"),t.style.display="none",document.body.style.overflow="")}),document.addEventListener("keydown",g=>{g.key==="Escape"&&t.style.display==="block"&&(i.log("Closing Edit Profile modal via escape key"),t.style.display="none",document.body.style.overflow=""),g.key==="Enter"&&g.ctrlKey&&t.style.display==="block"&&(g.preventDefault(),i.log("Form submission triggered via Ctrl+Enter"),s.dispatchEvent(new Event("submit")))}),s&&s.addEventListener("submit",async g=>{g.preventDefault(),i.log("Edit profile form submitted");const d=s.querySelector(".save-btn"),u=d.textContent;d.disabled=!0,d.innerHTML='<span class="btn-loader">Saving...</span>';try{const p=new FormData(s),c=document.getElementById("editDisplayName").value,m=document.getElementById("editBio").value,f=document.getElementById("editTwitter").value,b=document.getElementById("editInstagram").value,v=document.getElementById("editGithub").value,y=document.getElementById("editWebsite").value;if(!window.authState||!window.authState.currentUser){window.showToast("Please log in to update your profile","error");return}if(window.firestore&&window.firestore.doc&&window.firestore.updateDoc){const S=window.firestore.doc(db,"users",window.authState.currentUser.uid);await window.firestore.updateDoc(S,{name:c,bio:m,socialLinks:{twitter:f,instagram:b,github:v,website:y},updatedAt:new Date})}else throw new Error("Firestore functions not available");window.authState.currentUser&&(window.authState.currentUser.displayName=c),window.showToast(`Profile updated successfully! Welcome back, ${c}! âœ¨`,"success"),t.style.display="none",document.body.style.overflow="";const E=document.querySelector(".profile-name");E&&(E.textContent=c),i.log("Profile updated successfully",{displayName:c,bio:m})}catch(p){i.error("Failed to update profile",p),window.showToast("Failed to update profile: "+p.message,"error")}finally{d.disabled=!1,d.innerHTML=u}});const r=document.getElementById("editPhoto"),l=document.getElementById("photoPreview");r&&l&&r.addEventListener("change",g=>{const d=g.target.files[0];if(d){const u=new FileReader;u.onload=p=>{l.innerHTML=`<img src="${p.target.result}" alt="Profile preview" style="max-width: 100px; border-radius: 50%;" />`},u.readAsDataURL(d)}}),i.log("Edit Profile modal initialized")}window.openWidgetStudio=function(){i.log("Opening Widget Studio modal"),o?(i.log("Widget Studio modal found, opening..."),o.style.display="block",document.body.style.overflow="hidden",i.log("Widget Studio modal opened successfully")):(i.error("Widget Studio modal not found"),console.error("Widget Studio modal element not found in DOM"))},window.openEditProfile=function(){if(i.log("Opening Edit Profile modal"),t){i.log("Edit Profile modal found, opening..."),t.style.display="block",document.body.style.overflow="hidden";const r=document.getElementById("editDisplayName");document.getElementById("editBio"),r&&window.authState&&window.authState.currentUser?(r.value=window.authState.currentUser.displayName||"",i.log("Populated form with user data")):i.log("No user data available for form population"),i.log("Edit Profile modal opened successfully")}else i.error("Edit Profile modal not found"),console.error("Edit Profile modal element not found in DOM")},window.openChatbot=function(){i.log("Opening Chatbot card");const r=document.getElementById("chatbotCard");r?(r.classList.add("open"),r.classList.remove("minimized"),setTimeout(()=>{typeof initializeChatbot=="function"?(initializeChatbot(),i.log("Chatbot initialized successfully")):i.warn("initializeChatbot function not found")},100),i.log("Chatbot card opened successfully")):(i.error("Chatbot card not found"),console.error("Chatbot card element not found in DOM"))},window.openWorkflowManager=function(){i.log("Opening Workflow Manager modal");const r=document.getElementById("workflowManagerModal");r?(r.style.display="block",setTimeout(()=>{typeof initializeWorkflowManager=="function"?(initializeWorkflowManager(),i.log("Workflow Manager initialized successfully")):i.warn("initializeWorkflowManager function not found")},100),i.log("Workflow Manager modal opened successfully")):(i.error("Workflow Manager modal not found"),console.error("Workflow Manager modal element not found in DOM"))},i.log("Additional modals initialization completed"),window.debugModals=function(){const r=document.getElementById("chatbotCard");i.log("=== MODAL DEBUG INFO ==="),i.log("Widget Studio Modal:",{element:!!o,display:o?o.style.display:"N/A",id:o?o.id:"N/A"}),i.log("Edit Profile Modal:",{element:!!t,display:t?t.style.display:"N/A",id:t?t.id:"N/A"}),i.log("Chatbot Card:",{element:!!r,classes:r?r.className:"N/A",id:r?r.id:"N/A"}),i.log("Global functions:",{openWidgetStudio:typeof window.openWidgetStudio,openEditProfile:typeof window.openEditProfile,openChatbot:typeof window.openChatbot}),i.log("=== END MODAL DEBUG ===")}}function fe(){document.querySelectorAll(".password-toggle").forEach(e=>{e.addEventListener("click",t=>{t.preventDefault();const n=e.previousElementSibling,s=n.type==="password"?"text":"password";n.type=s,e.textContent=s==="password"?"ðŸ‘ï¸":"ðŸ™ˆ",i.log("Password visibility toggled",{type:s})})}),i.log("Password toggles initialized")}function he(){const o=document.getElementById("signUpUsername");if(o){let n;o.addEventListener("input",()=>{clearTimeout(n),n=setTimeout(()=>{we(o.value)},500)})}const e=document.getElementById("signUpPassword");e&&e.addEventListener("input",()=>{ye(e.value)});const t=document.getElementById("confirmPassword");t&&t.addEventListener("input",()=>{be()}),i.log("Form validation initialized")}async function we(o){const e=document.getElementById("usernameAvailability");if(!(!e||!o)){e.className="username-availability checking",e.textContent="Checking availability...";try{await new Promise(n=>setTimeout(n,1e3));const t=!o.toLowerCase().includes("test");e.className=`username-availability ${t?"available":"unavailable"}`,e.textContent=t?"Username available":"Username taken",i.log("Username availability checked",{username:o,isAvailable:t})}catch(t){e.className="username-availability unavailable",e.textContent="Error checking availability",i.error("Username availability check failed",t)}}}function ye(o){const e=document.getElementById("passwordStrength");if(!e)return;let t=0;o.length>=8&&t++,/[a-z]/.test(o)&&t++,/[A-Z]/.test(o)&&t++,/[0-9]/.test(o)&&t++,/[^A-Za-z0-9]/.test(o)&&t++;const n=["weak","medium","strong","very-strong"],s=["Weak","Medium","Strong","Very Strong"];e.className=`password-strength ${n[Math.min(t-1,3)]}`,e.textContent=s[Math.min(t-1,3)]||"Weak"}function be(){const o=document.getElementById("signUpPassword"),e=document.getElementById("confirmPassword"),t=document.getElementById("signUpSubmitBtn");if(!o||!e||!t)return;const n=o.value===e.value;t.disabled=!n,e.value&&!n?e.style.borderColor="#f44336":e.style.borderColor=""}function ve(){document.addEventListener("click",o=>{if(o.target.matches(".follow-btn")){o.preventDefault();const e=o.target.dataset.userId,t=o.target.dataset.following==="true";o.target.dataset.following=(!t).toString(),o.target.textContent=t?"Follow":"Following",o.target.className=t?"follow-btn":"follow-btn following",i.log("Follow button clicked",{userId:e,isFollowing:t})}}),document.addEventListener("click",o=>{if(o.target.matches(".like-btn")){o.preventDefault();const e=o.target.dataset.widgetId,t=o.target.dataset.liked==="true";o.target.dataset.liked=(!t).toString(),o.target.innerHTML=t?"ðŸ¤ Like":"â¤ï¸ Liked",o.target.className=t?"like-btn":"like-btn liked",i.log("Like button clicked",{widgetId:e,isLiked:t})}}),document.addEventListener("click",o=>{o.target.matches("#editProfileSocialBtn")&&(o.preventDefault(),i.log("Edit profile social button clicked"),window.openEditProfile&&window.openEditProfile()),o.target.matches("#shareProfileBtn")&&(o.preventDefault(),i.log("Share profile button clicked"),Ee()),o.target.matches("#viewActivityBtn")&&(o.preventDefault(),i.log("View activity button clicked"),Se())}),i.log("Social interactions initialized")}let D={currentUser:null,socialFeatures:null,debugMode:!0,async init(){i.log("Initializing social stats manager");try{await this.waitForSocialFeatures(),this.setupAuthListener(),i.log("Social stats manager initialized successfully")}catch(o){i.error("Failed to initialize social stats manager",o)}},async waitForSocialFeatures(){let o=0;const e=30;for(;o<e;){if(window.socialFeatures){this.socialFeatures=window.socialFeatures,i.log("Social features found for stats manager",{attempts:o});return}this.debugMode&&o%10===0&&console.log(`[SOCIAL STATS] Waiting for social features... attempt ${o+1}/${e}`),await new Promise(t=>setTimeout(t,100)),o++}i.warn("Social features not available after maximum attempts - continuing without social stats"),this.socialFeatures=null},setupAuthListener(){document.addEventListener("authStateChanged",async o=>{i.log("Auth state changed event received in stats manager",o.detail),await this.handleAuthStateChange(o.detail)}),window.authState&&window.authState.currentUser&&this.handleAuthStateChange(window.authState.currentUser)},async handleAuthStateChange(o){i.log("Handling auth state change in stats manager",{userId:o?.uid}),o?(this.currentUser=o,await this.loadAndDisplaySocialData(o.uid),this.showSocialElements(!0)):(this.currentUser=null,this.showSocialElements(!1),this.clearSocialData())},async loadAndDisplaySocialData(o){try{i.log("Loading social data for user",o),this.socialFeatures?await this.socialFeatures.loadUserSocialData(o):i.warn("Social features not available, skipping social data load");const e=await this.getUserStats(o);this.updateSocialStats(e),i.log("Social data loaded and displayed successfully")}catch(e){i.error("Failed to load social data",e)}},async getUserStats(o){try{const{db:e}=await h(async()=>{const{db:f}=await import("./firebase-core-BO8UvLyb.js");return{db:f}},[],import.meta.url),{doc:t,getDoc:n,collection:s,query:a,where:r,getDocs:l}=await h(async()=>{const{doc:f,getDoc:b,collection:v,query:y,where:E,getDocs:S}=await import("https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js");return{doc:f,getDoc:b,collection:v,query:y,where:E,getDocs:S}},[],import.meta.url),g=await n(t(e,"users",o)),d=g.exists()?g.data():{},u=a(s(e,"widgets"),r("userId","==",o)),p=await l(u),c=p.size;let m=0;return p.forEach(f=>{const b=f.data();m+=b.stats?.likes||0}),{followers:this.socialFeatures.followers.size,following:this.socialFeatures.following.size,widgets:c,likes:m,displayName:d.displayName||"User",bio:d.bio||""}}catch(e){return i.error("Failed to get user stats",e),{followers:0,following:0,widgets:0,likes:0,displayName:"User",bio:""}}},updateSocialStats(o){i.log("Updating social stats in UI",o);const e=document.getElementById("profileFollowers");e&&(e.textContent=o.followers);const t=document.getElementById("profileFollowing");t&&(t.textContent=o.following);const n=document.getElementById("profileWidgets");n&&(n.textContent=o.widgets);const s=document.getElementById("profileLikes");if(s&&(s.textContent=o.likes),o.displayName&&o.displayName!=="User"){const a=document.getElementById("profileName");a&&(a.textContent=o.displayName)}if(o.bio){const a=document.getElementById("profileBio");a&&(a.textContent=o.bio)}},showSocialElements(o){const e=document.getElementById("profileSocialStats"),t=document.getElementById("profileSocialActions");e&&(e.style.display=o?"flex":"none"),t&&(t.style.display=o?"flex":"none")},clearSocialData(){i.log("Clearing social data from UI"),["profileFollowers","profileFollowing","profileWidgets","profileLikes"].forEach(e=>{const t=document.getElementById(e);t&&(t.textContent="0")})}};async function Ee(){try{if(!D.currentUser){window.showToast("Please log in to share your profile","error");return}const o=`${window.location.origin}/profile/${D.currentUser.uid}`,e="Check out my profile on inque!";navigator.share?await navigator.share({title:"My inque Profile",text:e,url:o}):(await navigator.clipboard.writeText(`${e}
${o}`),window.showToast("Profile link copied to clipboard!","success")),i.log("Profile shared successfully")}catch(o){i.error("Failed to share profile",o),window.showToast("Failed to share profile","error")}}function Se(){i.log("Showing user activity"),window.showToast("Activity feature coming soon! Check back for updates.","info")}window.testSocialFeatures=function(){i.log("Testing social features..."),console.log("Social Stats Manager:",D),console.log("Window Social Features:",window.socialFeatures),console.log("Social Stats Elements:",{followers:document.getElementById("profileFollowers"),following:document.getElementById("profileFollowing"),widgets:document.getElementById("profileWidgets"),likes:document.getElementById("profileLikes"),socialStats:document.getElementById("profileSocialStats"),socialActions:document.getElementById("profileSocialActions")}),D.currentUser?console.log("Current User:",D.currentUser):console.log("No current user - try logging in first")};function Le(){document.querySelectorAll(".modal").forEach(t=>{t.addEventListener("show.bs.modal",()=>{t.querySelector(".modal-content").style.animation="slideInUp 0.3s ease-out"})}),document.querySelectorAll(".auth-form").forEach(t=>{t.addEventListener("submit",n=>{const s=t.querySelector(".auth-submit-btn");s&&(s.classList.add("loading"),s.querySelector(".btn-text").style.display="none",s.querySelector(".btn-loader").style.display="inline-block")})}),window.showToast=function(t,n="info",s=5e3){i.log(`Showing toast notification: ${n} - ${t}`);const a=document.createElement("div");a.className=`toast ${n}`,a.innerHTML=`
      <span class="toast-message">${t}</span>
      <button class="toast-close">&times;</button>
    `;const r=document.getElementById("toast-container")||document.body;document.getElementById("toast-container")||i.warn("Toast container not found, appending to body"),r.appendChild(a),i.log("Toast element created and added to DOM"),setTimeout(()=>{a.classList.add("show"),i.log("Toast animation triggered")},100),setTimeout(()=>{a.classList.remove("show"),i.log("Toast auto-removal started"),setTimeout(()=>{a.parentNode&&(a.parentNode.removeChild(a),i.log("Toast element removed from DOM"))},300)},s),a.querySelector(".toast-close").addEventListener("click",()=>{i.log("Toast manually closed by user"),a.classList.remove("show"),setTimeout(()=>{a.parentNode&&(a.parentNode.removeChild(a),i.log("Toast element removed from DOM after manual close"))},300)}),i.log(`Toast notification displayed successfully: ${n} - ${t}`)},i.log("Enhanced UI features initialized")}function ke(){sessionStorage.getItem("isNewUser")&&!window.authState.hasShownWelcome&&setTimeout(()=>{window.showToast("Welcome to inque! ðŸŽ‰ Start by uploading your first widget!","success",8e3),sessionStorage.removeItem("isNewUser"),window.authState.hasShownWelcome=!0,i.log("Welcome message shown for new user")},2e3)}function Be(){i.log("Initializing header quick actions and sidebar login bindings");try{const o=document.getElementById("tutorialBtn");o?(o.addEventListener("click",d=>{d.preventDefault(),d.stopPropagation(),i.log("Tutorial button clicked"),window.showToast?window.showToast("Tutorial feature coming soon! This will explain everything about inque.","info",5e3):alert("Tutorial feature coming soon! This will explain everything about inque.")}),i.log("Tutorial button listener attached successfully")):i.warn("Tutorial button not found in DOM");const e=document.getElementById("editProfileQuickBtn");e?(e.addEventListener("click",d=>{if(d.preventDefault(),d.stopPropagation(),i.log("Edit Profile quick button clicked"),window.openEditProfile)window.openEditProfile(),i.log("Edit Profile modal opened via global function");else{i.warn("openEditProfile global function not available, using fallback");const u=document.getElementById("editProfileModal");u?(u.style.display="block",document.body.style.overflow="hidden",i.log("Edit Profile modal shown via fallback")):(i.error("Edit Profile modal not found"),window.showToast&&window.showToast("Edit Profile not available","error"))}}),i.log("Edit Profile quick button listener attached successfully")):i.warn("Edit Profile quick button not found in DOM");const t=document.getElementById("sidebarLoginBtn");t?(t.addEventListener("click",d=>{if(d.preventDefault(),d.stopPropagation(),i.log("Sidebar Login button clicked"),window.openAuthModal)window.openAuthModal("login"),i.log("Auth modal opened via global function");else{i.warn("openAuthModal global function not available, using fallback");const u=document.getElementById("authModal");u?(u.style.display="block",document.body.style.overflow="hidden",i.log("Auth modal shown via fallback")):(i.error("Auth modal not found"),window.showToast&&window.showToast("Login not available","error"))}}),i.log("Sidebar login button listener attached successfully")):i.warn("Sidebar login button not found in DOM");const n=document.querySelector('[data-action="openChatbot"]');n?(n.addEventListener("click",d=>{d.preventDefault(),d.stopPropagation(),i.log("AI Assistant button clicked"),typeof openChatbot=="function"?(openChatbot(),i.log("AI Assistant opened successfully")):(i.error("openChatbot function not found"),window.showToast&&window.showToast("AI Assistant not available","error"))}),i.log("AI Assistant button listener attached successfully")):i.warn("AI Assistant button not found in DOM");const s=document.querySelectorAll(".nav-btn[data-page]");s.length>0?(s.forEach(d=>{d.addEventListener("click",()=>{const u=d.getAttribute("data-page");if(u)switch(i.log("Profile navigation button clicked",{page:u}),u){case"about":window.location.href="core/personal/about.html";break;case"explore":window.location.href="pages/explore.html";break;case"inventory":window.location.href="pages/inventory.html";break;default:i.warn("Unknown page navigation",{page:u})}})}),i.log("Profile navigation buttons initialized",{count:s.length})):i.warn("Profile navigation buttons not found in DOM");const a=document.getElementById("profileLoginBtn");if(a){const d=()=>{const u=window.authState&&window.authState.isInitialized;a.style.display=u?"none":"inline-flex",i.log("Profile login button visibility updated",{isLoggedIn:u})};d(),window.addEventListener("auth-state-changed",()=>{i.log("Auth state changed, updating profile login button"),d()}),a.addEventListener("click",()=>{if(i.log("Profile login button clicked"),window.openAuthModal)window.openAuthModal("login");else{const u=document.getElementById("authModal");u?(u.style.display="block",document.body.style.overflow="hidden",i.log("Auth modal shown via fallback")):i.error("Auth modal not found")}}),i.log("Profile login button listener attached successfully")}else i.log("Profile login button not found (this is normal on pages without login forms)");const r=document.getElementById("collapseProfileBtn"),l=document.getElementById("profile-banner");if(r&&l){const d=r.querySelector(".collapse-icon");let u=!1;d?(r.addEventListener("click",()=>{u=!u,i.log("Profile banner collapse toggled",{collapsed:u}),u?(l.classList.add("collapsed"),l.style.maxHeight="120px",l.style.overflow="hidden",r.classList.add("collapsed"),d.textContent="â–²"):(l.classList.remove("collapsed"),l.style.maxHeight="none",l.style.overflow="visible",r.classList.remove("collapsed"),d.textContent="â–¼")}),i.log("Profile banner collapse functionality initialized")):i.warn("Profile banner collapse icon not found")}else i.warn("Profile banner collapse elements not found",{collapseBtn:!!r,profileBanner:!!l});const g=document.getElementById("leaveNoteBtn");g?(g.addEventListener("click",d=>{d.preventDefault(),d.stopPropagation(),i.log("Leave a Note button clicked"),window.showToast?window.showToast("Leave a Note feature coming soon! This will let you leave messages in the yearbook.","info",5e3):alert("Leave a Note feature coming soon! This will let you leave messages in the yearbook.")}),i.log("Leave a Note button listener attached successfully")):i.warn("Leave a Note button not found in DOM"),i.log("Header quick actions initialization completed successfully"),Ie()}catch(o){i.error("Error during header quick actions initialization",o)}}function Ie(){i.log("Validating button states...");const o=[{id:"tutorialBtn",name:"Tutorial Button"},{id:"editProfileQuickBtn",name:"Edit Profile Quick Button"},{id:"sidebarLoginBtn",name:"Sidebar Login Button"},{id:"leaveNoteBtn",name:"Leave a Note Button"},{id:"collapseProfileBtn",name:"Profile Collapse Button"}],e=[],t=[];o.forEach(a=>{document.getElementById(a.id)?t.push(a.name):e.push(a.name)}),t.length>0&&i.log("âœ… Working buttons",t),e.length>0&&i.warn("âš ï¸ Missing buttons",e),document.querySelector('[data-action="openChatbot"]')?i.log("âœ… AI Assistant button found"):i.log("AI Assistant button not found (this is normal on pages without chatbot)");const s=document.querySelectorAll(".nav-btn[data-page]");s.length>0?i.log("âœ… Profile navigation buttons found",{count:s.length}):i.log("Profile navigation buttons not found (this is normal on pages without profile navigation)")}window.openAuthModal=function(o="login"){i.log("Opening auth modal",{formType:o});const e=document.getElementById("authModal"),t=document.getElementById("loginForm"),n=document.getElementById("signUpForm"),s=document.getElementById("authModalTitle");e&&t&&n&&s?(o==="signup"?(t.style.display="none",n.style.display="block",s.textContent="Sign Up"):(n.style.display="none",t.style.display="block",s.textContent="Login"),e.style.display="block",document.body.style.overflow="hidden",i.log("Auth modal opened successfully",{formType:o})):i.error("Failed to open auth modal - elements not found")};i.log("Initializing enhanced scroll and fullscreen functionality");window.fullscreenState={isFullscreen:!1,originalScrollPosition:0,isInitialized:!1};function Te(){i.log("Creating fullscreen toggle button");try{let o=document.getElementById("fullscreenToggleBtn");o?i.log("Fullscreen toggle button already exists"):(o=document.createElement("button"),o.id="fullscreenToggleBtn",o.className="fullscreen-toggle-btn",o.innerHTML="â›¶",o.title="Toggle Fullscreen (F11)",o.style.cssText=`
        position: fixed;
        top: auto;
        bottom: 20px;
        left: 20px;
        right: auto;
        width: 40px;
        height: 40px;
        background: rgba(0, 240, 255, 0.1);
        border: 2px solid rgba(0, 240, 255, 0.3);
        border-radius: 8px;
        color: #00f0ff;
        font-size: 16px;
        cursor: pointer;
        z-index: 1000;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: center;
      `,o.addEventListener("mouseenter",()=>{o.style.background="rgba(0, 240, 255, 0.2)",o.style.borderColor="rgba(0, 240, 255, 0.5)",o.style.transform="scale(1.1)"}),o.addEventListener("mouseleave",()=>{o.style.background="rgba(0, 240, 255, 0.1)",o.style.borderColor="rgba(0, 240, 255, 0.3)",o.style.transform="scale(1)"}),o.addEventListener("click",e=>{e.preventDefault(),i.log("Fullscreen toggle button clicked"),x()}),document.body.appendChild(o),i.log("Fullscreen toggle button created successfully and positioned at bottom-left"))}catch(o){i.error("Failed to create fullscreen toggle button",o)}}function Ce(){i.log("Setting up scroll event listeners");try{let o=0,e;const t=()=>{clearTimeout(e),e=setTimeout(()=>{const n=window.pageYOffset||document.documentElement.scrollTop,s=document.getElementById("fullscreenToggleBtn");s&&(n>100?s.style.opacity="0.8":s.style.opacity="1"),window.scrollDirection=n>o?"down":"up",o=n},16)};window.addEventListener("scroll",t,{passive:!0}),i.log("Scroll event listeners setup complete")}catch(o){i.error("Failed to setup scroll event listeners",o)}}function x(){i.log("Toggling fullscreen mode");try{if(document.fullscreenElement){document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen(),window.fullscreenState.isFullscreen=!1;const o=document.getElementById("fullscreenToggleBtn");o&&(o.innerHTML="â›¶",o.title="Toggle Fullscreen (F11)"),i.log("Exited fullscreen mode")}else{document.documentElement.requestFullscreen?document.documentElement.requestFullscreen():document.documentElement.webkitRequestFullscreen?document.documentElement.webkitRequestFullscreen():document.documentElement.msRequestFullscreen&&document.documentElement.msRequestFullscreen(),window.fullscreenState.isFullscreen=!0,window.fullscreenState.originalScrollPosition=window.pageYOffset;const o=document.getElementById("fullscreenToggleBtn");o&&(o.innerHTML="â›·",o.title="Exit Fullscreen (F11 or Esc)"),i.log("Entered fullscreen mode")}}catch(o){i.error("Failed to toggle fullscreen mode",o)}}document.addEventListener("fullscreenchange",()=>{const o=!!document.fullscreenElement;window.fullscreenState.isFullscreen=o;const e=document.getElementById("fullscreenToggleBtn");e&&(e.innerHTML=o?"â›·":"â›¶",e.title=o?"Exit Fullscreen (F11 or Esc)":"Toggle Fullscreen (F11)"),i.log("Fullscreen state changed",{isFullscreen:o})});function ee(){i.log("Setting up enhanced scroll and fullscreen features");try{Te(),Ce(),De(),xe(),window.fullscreenState.isInitialized=!0,i.log("Enhanced scroll and fullscreen features initialized successfully")}catch(o){i.error("Failed to initialize enhanced scroll and fullscreen features",o)}}function De(){i.log("Setting up keyboard shortcuts for fullscreen"),document.addEventListener("keydown",o=>{o.key==="F11"&&(o.preventDefault(),i.log("F11 key pressed - toggling fullscreen"),x()),o.key==="Escape"&&window.fullscreenState.isFullscreen&&(i.log("Escape key pressed - exiting fullscreen"),x()),o.ctrlKey&&o.shiftKey&&o.key==="D"&&(o.preventDefault(),Me(),i.log("Debug mode toggled via keyboard shortcut"))}),i.log("Keyboard shortcuts setup complete")}function xe(){i.log("Initializing scroll position restoration"),window.addEventListener("load",()=>{const o=sessionStorage.getItem("scrollPosition");o&&setTimeout(()=>{window.scrollTo(0,parseInt(o)),i.log("Scroll position restored from session storage",{position:o})},100)}),window.addEventListener("beforeunload",()=>{sessionStorage.setItem("scrollPosition",window.pageYOffset.toString()),i.log("Scroll position saved to session storage",{position:window.pageYOffset})}),i.log("Scroll position restoration initialized")}function Me(){const o=document.body;o.classList.contains("debug-mode")?(o.classList.remove("debug-mode"),i.log("Debug mode disabled"),window.showToast&&window.showToast("Debug mode disabled","info",2e3)):(o.classList.add("debug-mode"),i.log("Debug mode enabled"),window.showToast&&window.showToast("Debug mode enabled - Press Ctrl+Shift+D to toggle","success",3e3))}function Ae(){i.log("Setting up smooth scrolling for anchor links"),document.addEventListener("click",o=>{const e=o.target.closest('a[href^="#"]');if(e){o.preventDefault();const t=e.getAttribute("href").substring(1),n=document.getElementById(t);if(n){const s=document.querySelector("header")?.offsetHeight||0,a=n.offsetTop-s-20;window.scrollTo({top:a,behavior:"smooth"}),i.log("Smooth scroll to element",{targetId:t,position:a})}}}),i.log("Smooth scrolling setup complete")}window.toggleFullscreen=function(){i.log("Fullscreen toggle called via global function"),x()};window.isFullscreen=function(){return window.fullscreenState.isFullscreen};window.enterFullscreen=function(){window.fullscreenState.isFullscreen||(i.log("Entering fullscreen via global function"),x())};window.exitFullscreen=function(){window.fullscreenState.isFullscreen&&(i.log("Exiting fullscreen via global function"),x())};document.addEventListener("DOMContentLoaded",()=>{i.log("DOM Content Loaded - Initializing enhanced scroll and fullscreen features"),setTimeout(()=>{ee(),Ae()},500)});i.log("Enhanced scroll and fullscreen functionality loaded");i.log("Setting up global compatibility functions");window.testVibeCodersIntegration=function(){i.log("Testing inQ platform integration"),window.navigationManager?i.log("âœ… Navigation manager available"):i.warn("âš ï¸ Navigation manager not available"),window.toolsFilterManager?i.log("âœ… Tools filter manager available"):i.warn("âš ï¸ Tools filter manager not available"),window.authState&&window.authState.isInitialized?i.log("âœ… Auth system initialized"):i.log("Auth system not initialized (this is normal during startup)"),window.showToast&&window.showToast("inQ Platform integration test completed! ðŸŽ‰","success",3e3),i.log("inQ platform integration test completed")};function ze(){i.log("Initializing banner customization functionality");try{const o=document.getElementById("bannerCustomizationModal"),e=document.getElementById("bannerCustomizationCloseBtn"),t=document.getElementById("customizeBannerBtn"),n=document.getElementById("saveBannerBtn"),s=document.getElementById("resetBannerBtn");if(!o||!e||!t){i.warn("Some banner customization elements not found",{bannerModal:!!o,bannerCloseBtn:!!e,customizeBannerBtn:!!t});return}t.addEventListener("click",l=>{l.preventDefault(),i.log("Opening banner customization modal"),o.style.display="block",document.body.style.overflow="hidden",X()}),e.addEventListener("click",()=>{i.log("Closing banner customization modal"),o.style.display="none",document.body.style.overflow=""}),window.addEventListener("click",l=>{l.target===o&&(i.log("Closing banner customization modal via outside click"),o.style.display="none",document.body.style.overflow="")}),document.addEventListener("keydown",l=>{l.key==="Escape"&&o.style.display==="block"&&(i.log("Closing banner customization modal via escape key"),o.style.display="none",document.body.style.overflow="")});const a=document.querySelectorAll(".layout-option");a.forEach(l=>{l.addEventListener("click",g=>{g.preventDefault(),i.log("Layout option clicked",{layout:l.dataset.layout}),a.forEach(d=>d.classList.remove("active")),l.classList.add("active"),F(l.dataset.layout)})});const r=document.querySelectorAll(".theme-option");r.forEach(l=>{l.addEventListener("click",g=>{g.preventDefault(),i.log("Theme option clicked",{theme:l.dataset.theme}),r.forEach(d=>d.classList.remove("active")),l.classList.add("active"),q(l.dataset.theme)})}),n&&n.addEventListener("click",l=>{l.preventDefault(),i.log("Saving banner customization"),Pe()}),s&&s.addEventListener("click",l=>{l.preventDefault(),i.log("Resetting banner customization"),_e()}),window.openProfileCustomization=function(){i.log("Opening profile customization via global function"),o&&(o.style.display="block",document.body.style.overflow="hidden",X())},Ne(),i.log("Banner customization functionality initialized successfully")}catch(o){i.error("Error initializing banner customization",o)}}function X(){i.log("Populating banner customization options");try{const o=document.getElementById("quickLinksCustomization");if(!o){i.warn("Quick links customization container not found");return}const e=[{id:"projects",label:"ðŸ“Š Projects",href:"pages/my-projects.html",enabled:!0},{id:"studio",label:"ðŸŽ¨ Studio",href:"pages/widget_studio.html",enabled:!0},{id:"explore",label:"ðŸ” Explore",href:"pages/explore.html",enabled:!0},{id:"community",label:"ðŸ‘¥ Community",href:"pages/users.html",enabled:!0},{id:"inventory",label:"ðŸ“¦ Inventory",href:"pages/inventory.html",enabled:!1},{id:"profile",label:"ðŸ‘¤ Profile",href:"pages/profile-edit.html",enabled:!1}];o.innerHTML="",e.forEach(t=>{const n=document.createElement("div");n.className="quick-link-option",n.style.cssText=`
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 12px;
        background: var(--bg-tertiary);
        border: 1px solid var(--primary-neon);
        border-radius: 6px;
        margin-bottom: 8px;
      `,n.innerHTML=`
        <input 
          type="checkbox" 
          id="link-${t.id}" 
          ${t.enabled?"checked":""}
          style="margin: 0;"
        >
        <label for="link-${t.id}" style="color: var(--text-primary); cursor: pointer; flex: 1;">
          ${t.label}
        </label>
        <span style="color: var(--text-secondary); font-size: 0.8rem;">
          ${t.enabled?"Enabled":"Disabled"}
        </span>
      `,o.appendChild(n)}),i.log("Customization options populated successfully")}catch(o){i.error("Error populating customization options",o)}}function F(o){i.log("Applying banner layout",{layout:o});try{const e=document.getElementById("profileBanner"),t=e?.querySelector(".banner-user-section"),n=e?.querySelector(".banner-quick-links"),s=e?.querySelector(".banner-actions");if(!e){i.warn("Profile banner not found");return}switch(e.style.flexDirection="row",e.style.gap="20px",e.style.padding="12px 20px",o){case"horizontal":e.style.flexDirection="row",e.style.gap="20px";break;case"compact":e.style.flexDirection="row",e.style.gap="12px",e.style.padding="8px 16px";break;case"minimal":e.style.flexDirection="column",e.style.gap="8px",e.style.padding="16px 20px";break}i.log("Banner layout applied successfully",{layout:o})}catch(e){i.error("Error applying banner layout",e)}}function q(o){i.log("Applying banner theme",{theme:o});try{const e=document.getElementById("profileBanner"),t=e?.querySelectorAll(".banner-quick-link");if(!e){i.warn("Profile banner not found");return}switch(e.style.background="linear-gradient(135deg, var(--bg-secondary) 0%, var(--bg-tertiary) 100%)",e.style.borderColor="var(--primary-neon)",o){case"neon":e.style.background="linear-gradient(135deg, var(--bg-secondary) 0%, var(--bg-tertiary) 100%)",e.style.borderColor="var(--primary-neon)";break;case"monochrome":e.style.background="linear-gradient(135deg, #1a1a1a 0%, #2a2a2a 100%)",e.style.borderColor="#ffffff";break;case"pastel":e.style.background="linear-gradient(135deg, #2a1a2a 0%, #3a2a3a 100%)",e.style.borderColor="#ff69b4";break}i.log("Banner theme applied successfully",{theme:o})}catch(e){i.error("Error applying banner theme",e)}}function Pe(){i.log("Saving banner customization");try{const o=document.querySelector(".layout-option.active")?.dataset.layout||"horizontal",e=document.querySelector(".theme-option.active")?.dataset.theme||"neon",t=[];document.querySelectorAll("#quickLinksCustomization input[type='checkbox']:checked").forEach(l=>{const g=l.id.replace("link-","");t.push(g)});const s={layout:o,theme:e,enabledLinks:t,lastUpdated:new Date().toISOString()};localStorage.setItem("bannerCustomization",JSON.stringify(s)),F(o),q(e),R(t),window.showToast&&window.showToast("Banner customization saved! ðŸŽ¨","success",3e3);const a=document.getElementById("bannerCustomizationIndicator");a&&(a.style.display="block",setTimeout(()=>{a.style.display="none"},3e3));const r=document.getElementById("bannerCustomizationModal");r&&(r.style.display="none",document.body.style.overflow=""),i.log("Banner customization saved successfully",s)}catch(o){i.error("Error saving banner customization",o),window.showToast&&window.showToast("Failed to save banner customization","error")}}function _e(){i.log("Resetting banner customization");try{localStorage.removeItem("bannerCustomization"),F("horizontal"),q("neon"),R(["projects","studio","explore","community"]),document.querySelectorAll(".layout-option").forEach(t=>{t.classList.remove("active"),t.dataset.layout==="horizontal"&&t.classList.add("active")}),document.querySelectorAll(".theme-option").forEach(t=>{t.classList.remove("active"),t.dataset.theme==="neon"&&t.classList.add("active")}),window.showToast&&window.showToast("Banner customization reset! ðŸ”„","info",3e3),i.log("Banner customization reset successfully")}catch(o){i.error("Error resetting banner customization",o),window.showToast&&window.showToast("Failed to reset banner customization","error")}}function R(o){i.log("Updating quick links",{enabledLinks:o});try{const e=document.querySelector(".banner-quick-links");if(!e){i.warn("Banner quick links container not found");return}e.innerHTML="";const t={projects:{label:"ðŸ“Š Projects",href:"pages/my-projects.html",color:"primary"},studio:{label:"ðŸŽ¨ Studio",href:"pages/widget_studio.html",color:"secondary"},explore:{label:"ðŸ” Explore",href:"pages/explore.html",color:"accent"},community:{label:"ðŸ‘¥ Community",href:"pages/users.html",color:"error"},inventory:{label:"ðŸ“¦ Inventory",href:"pages/inventory.html",color:"success"},profile:{label:"ðŸ‘¤ Profile",href:"pages/profile-edit.html",color:"warning"}};o.forEach(n=>{const s=t[n];if(s){const a=document.createElement("a");a.href=s.href,a.className="banner-quick-link",a.setAttribute("data-color",s.color),a.title=s.label,a.style.cssText=`
          padding: 8px 12px;
          background: rgba(0, 240, 255, 0.15);
          border: 1px solid #00f0ff;
          border-radius: 6px;
          color: #00f0ff;
          text-decoration: none;
          font-size: 11px;
          font-weight: 600;
          text-transform: uppercase;
          letter-spacing: 0.5px;
          transition: all 0.3s ease;
          display: flex;
          align-items: center;
          gap: 4px;
        `,a.textContent=s.label,e.appendChild(a)}}),i.log("Quick links updated successfully")}catch(e){i.error("Error updating quick links",e)}}function Fe(){i.log("Loading saved banner customization");try{const o=localStorage.getItem("bannerCustomization");if(o){const e=JSON.parse(o);F(e.layout||"horizontal"),q(e.theme||"neon"),R(e.enabledLinks||["projects","studio","explore","community"]),i.log("Banner customization loaded successfully",e)}else i.log("No saved banner customization found, using defaults")}catch(o){i.error("Error loading banner customization",o)}}function K(){i.log("Adding banner restore button to header");try{if(document.getElementById("bannerRestoreBtn"))return;const o=document.querySelector("header");if(!o){i.warn("Header not found for restore button");return}const e=document.createElement("button");e.id="bannerRestoreBtn",e.innerHTML="ðŸ´â€â˜ ï¸",e.title="Restore Profile Banner",e.style.cssText=`
      width: 40px;
      height: 40px;
      background: rgba(0, 255, 255, 0.2);
      border: 2px solid var(--primary-neon);
      border-radius: 50%;
      color: var(--primary-neon);
      font-size: 16px;
      cursor: pointer;
      transition: all 0.3s ease;
      animation: pulse 2s infinite;
      margin-left: 20px;
    `,e.addEventListener("mouseenter",()=>{e.style.background="rgba(0, 255, 255, 0.3)",e.style.transform="scale(1.1)",e.style.boxShadow="0 0 20px rgba(0, 255, 255, 0.5)"}),e.addEventListener("mouseleave",()=>{e.style.background="rgba(0, 255, 255, 0.2)",e.style.transform="scale(1)",e.style.boxShadow="none"}),e.addEventListener("click",()=>{i.log("Restoring banner from closed state"),document.getElementById("profileBanner")&&(C("visible",!0),localStorage.removeItem("bannerClosed"),setTimeout(()=>{e.remove()},100),window.showToast&&window.showToast("Profile banner restored! ðŸ´â€â˜ ï¸","success",3e3))});const t=o.querySelector('div[style*="display: flex"]');if(t){const n=t.querySelector("nav");if(n)n.appendChild(e);else{const s=t.querySelector('div[style*="display: flex"][style*="align-items: center"]');s?s.appendChild(e):t.appendChild(e)}}else o.appendChild(e);i.log("Banner restore button added successfully")}catch(o){i.error("Error adding banner restore button",o)}}function qe(){i.log("Adding banner activation button");try{if(document.getElementById("bannerActivationBtn"))return;const o=document.querySelector("header");if(!o){i.warn("Header not found for activation button");return}const e=document.createElement("button");e.id="bannerActivationBtn",e.innerHTML="ðŸ”—",e.title="Expand Profile Banner",e.style.cssText=`
      width: 40px;
      height: 40px;
      background: rgba(0, 255, 255, 0.2);
      border: 2px solid var(--primary-neon);
      border-radius: 50%;
      color: var(--primary-neon);
      font-size: 16px;
      cursor: pointer;
      transition: all 0.3s ease;
      animation: pulse 2s infinite;
      margin-left: 20px;
    `,e.addEventListener("mouseenter",()=>{e.style.background="rgba(0, 255, 255, 0.3)",e.style.transform="scale(1.1)",e.style.boxShadow="0 0 20px rgba(0, 255, 255, 0.5)"}),e.addEventListener("mouseleave",()=>{e.style.background="rgba(0, 255, 255, 0.2)",e.style.transform="scale(1)",e.style.boxShadow="none"}),e.addEventListener("click",()=>{i.log("Activating banner from minimized state"),C("visible",!0),setTimeout(()=>{e.remove()},100),window.showToast&&window.showToast("Profile banner expanded! ðŸ”—","success",2e3)});const t=o.querySelector('div[style*="display: flex"]');if(t){const n=t.querySelector("nav");if(n)n.appendChild(e);else{const s=t.querySelector('div[style*="display: flex"][style*="align-items: center"]');s?s.appendChild(e):t.appendChild(e)}}else o.appendChild(e);i.log("Banner activation button added successfully")}catch(o){i.error("Error adding banner activation button",o)}}function C(o,e=!0){i.log(`Updating banner state to: ${o}`);const t=document.getElementById("profileBanner"),n=document.getElementById("profile-banner-section"),s=document.getElementById("bannerChain"),a=document.getElementById("chainLink"),r=document.getElementById("header-banner-container");if(!t||!n||!r){i.warn("Banner elements not found for state update");return}switch(t.classList.remove("hidden","minimized","entered"),r.classList.remove("hidden","minimized","fullscreen-hidden"),o){case"visible":t.classList.add("entered"),r.style.opacity="1",r.style.pointerEvents="auto",e&&(t.style.animation="bannerDropAndSway 1.5s cubic-bezier(0.34, 1.56, 0.64, 1) forwards"),s&&(s.style.opacity="1"),a&&(a.style.opacity="1");const l=document.getElementById("bannerActivationBtn");l&&l.remove(),localStorage.removeItem("bannerMinimized"),i.log("Banner visible state restored, minimized state cleared");break;case"minimized":t.classList.add("minimized"),r.classList.add("minimized"),r.style.opacity="1",r.style.pointerEvents="auto",t.style.animation="none",s&&(s.style.opacity="0"),a&&(a.style.opacity="0"),qe(),localStorage.setItem("bannerMinimized","true"),i.log("Banner minimized state stored");break;case"hidden":t.classList.add("hidden"),r.classList.add("hidden"),r.style.opacity="0",r.style.pointerEvents="none",e&&(t.style.animation="zipUpToHeader 0.6s cubic-bezier(0.55, 0.055, 0.675, 0.19) forwards"),s&&(s.style.opacity="0"),a&&(a.style.opacity="0");break;case"fullscreen-hidden":r.classList.add("fullscreen-hidden"),r.style.opacity="0",r.style.pointerEvents="none",t.style.animation="none",s&&(s.style.opacity="0"),a&&(a.style.opacity="0");break}i.log(`Banner state updated to: ${o}`),window.dispatchEvent(new CustomEvent("banner-state-changed",{detail:{state:o}}))}function Ue(){i.log("Initializing UI positioning adjustments");try{const o=document.getElementById("fullscreenToggle"),e=document.getElementById("toast-container"),t=document.getElementById("header-banner-container");if(!o||!e){i.warn("UI elements not found for positioning adjustments");return}const n=()=>{const s=window.innerWidth<=768,a=t&&!t.classList.contains("hidden")&&!t.classList.contains("fullscreen-hidden");s&&a?(o.style.top="200px",e.style.top="200px",i.log("UI positioning adjusted for mobile with visible banner")):s?(o.style.top="100px",e.style.top="100px",i.log("UI positioning adjusted for mobile without banner")):(o.style.top="140px",e.style.top="140px",i.log("UI positioning adjusted for desktop"))};n(),window.addEventListener("banner-state-changed",n),window.addEventListener("resize",()=>{setTimeout(n,100)}),i.log("UI positioning adjustments initialized successfully")}catch(o){i.error("Error initializing UI positioning adjustments",o)}}function te(){i.log("Initializing mobile-specific banner behavior");try{const o=document.getElementById("profileBanner"),e=document.getElementById("header-banner-container");if(!o||!e){i.warn("Banner elements not found for mobile behavior");return}const t=window.innerWidth<=768;if(t){i.log("Mobile device detected - applying mobile banner optimizations"),e.classList.add("mobile-optimized"),o.classList.add("mobile-optimized"),o.style.touchAction="manipulation",o.style.webkitTouchCallout="none",o.style.webkitUserSelect="none",o.style.userSelect="none",o.addEventListener("touchstart",s=>{s.preventDefault()},{passive:!1}),window.addEventListener("orientationchange",()=>{i.log("Orientation changed - recalculating banner position"),setTimeout(()=>{e.style.transform="translateZ(0)",setTimeout(()=>{e.style.transform=""},100)},100)});let n;window.addEventListener("resize",()=>{clearTimeout(n),n=setTimeout(()=>{window.innerWidth<=768!==t&&(i.log("Screen size changed - reinitializing mobile behavior"),te())},250)})}else i.log("Desktop device detected - using standard banner behavior"),e.classList.remove("mobile-optimized"),o.classList.remove("mobile-optimized")}catch(o){i.error("Error initializing mobile banner behavior",o)}}function Ne(){i.log("Initializing hanging banner controls");try{const o=document.getElementById("profileBanner"),e=document.getElementById("minimizeBannerBtn"),t=document.getElementById("closeBannerBtn");if(!o){i.warn("Profile banner not found for controls");return}o.addEventListener("animationend",a=>{a.animationName==="bannerDropAndSway"&&(i.log("Hanging banner entrance animation completed"),o.classList.add("entered"),window.showToast&&setTimeout(()=>{window.showToast("Welcome! Your hanging profile banner is ready ðŸ´â€â˜ ï¸","info",4e3)},1e3))}),e&&e.addEventListener("click",a=>{a.preventDefault(),a.stopPropagation(),i.log("Toggling banner minimize state");const r=o.classList.contains("minimized");C(r?"visible":"minimized",!1),e.textContent=r?"âˆ’":"+",e.title=r?"Minimize Banner":"Expand Banner",window.showToast&&window.showToast(r?"Banner expanded":"Banner minimized","info",2e3)}),t&&t.addEventListener("click",a=>{a.preventDefault(),a.stopPropagation(),i.log("Closing banner with zip-up animation"),C("hidden",!0),window.showToast&&window.showToast("Banner zipped up! Use restore button to bring it back ðŸ´â€â˜ ï¸","info",3e3),localStorage.setItem("bannerClosed","true"),setTimeout(()=>{K()},700)});const n=localStorage.getItem("bannerClosed"),s=localStorage.getItem("bannerMinimized");n==="true"?(i.log("Banner was previously closed, hiding it"),C("hidden",!1),K()):s==="true"?(i.log("Banner was previously minimized, showing minimized state"),C("minimized",!1)):(i.log("Banner is visible, starting entrance animation"),C("visible",!0)),i.log("Banner positioning fixed to header - drag functionality removed for better mobile UX"),localStorage.removeItem("bannerPosition"),te(),Oe(),i.log("Banner card controls initialized successfully"),Ue()}catch(o){i.error("Error initializing banner card controls",o)}}function Oe(){i.log("Initializing mobile drawer functionality");try{const o=document.getElementById("mobileMenuToggle"),e=document.getElementById("mobileDrawer"),t=document.getElementById("mobileDrawerClose"),n=document.getElementById("mobileDrawerOverlay"),s=document.getElementById("mobileAuthBtn"),a=document.getElementById("authBtn");if(!o||!e||!t){i.warn("Mobile drawer elements not found");return}const r=()=>{i.log("Opening mobile drawer"),e.classList.add("active"),document.body.style.overflow="hidden"},l=()=>{i.log("Closing mobile drawer"),e.classList.remove("active"),document.body.style.overflow=""};o.addEventListener("click",c=>{c.preventDefault(),c.stopPropagation(),r()}),t.addEventListener("click",c=>{c.preventDefault(),c.stopPropagation(),l()}),n.addEventListener("click",c=>{c.preventDefault(),c.stopPropagation(),l()}),document.querySelectorAll(".mobile-nav-item").forEach(c=>{c.addEventListener("click",m=>{c.href&&c.href.includes("pages/")?setTimeout(()=>{l()},100):l()})}),s&&a&&s.addEventListener("click",c=>{c.preventDefault(),c.stopPropagation(),l(),a.click()}),document.addEventListener("keydown",c=>{c.key==="Escape"&&e.classList.contains("active")&&l()}),window.addEventListener("resize",()=>{window.innerWidth>768&&e.classList.contains("active")&&l()});const d=()=>{const c=document.getElementById("userName"),m=document.getElementById("userStatus"),f=document.getElementById("mobileUserName"),b=document.getElementById("mobileUserStatus");c&&f&&(f.textContent=c.textContent),m&&b&&(b.textContent=m.textContent)};d();const u=new MutationObserver(d),p=document.getElementById("userName");p&&u.observe(p,{childList:!0,subtree:!0}),i.log("Mobile drawer functionality initialized successfully")}catch(o){i.error("Error initializing mobile drawer",o)}}document.addEventListener("DOMContentLoaded",()=>{setTimeout(()=>{Fe()},1e3)});i.log("Enhanced inque social app initialization complete");function We(){i.log("Initializing mobile-specific enhancements");const o=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),e="ontouchstart"in window||navigator.maxTouchPoints>0;if(i.log("Device detection",{isMobile:o,isTouchDevice:e,userAgent:navigator.userAgent}),(o||e)&&(document.body.classList.add("mobile-device"),i.log("Mobile device class added to body")),e){const a=document.querySelectorAll("button, .neo-button, .mobile-nav-item, .hub-action-btn, .floating-orb");a.forEach(r=>{r.addEventListener("touchstart",function(){this.style.transform="scale(0.98)",this.style.transition="transform 0.1s ease"}),r.addEventListener("touchend",function(){this.style.transform=""}),r.addEventListener("touchcancel",function(){this.style.transform=""})}),i.log("Enhanced touch feedback applied to",a.length,"elements")}const t=document.querySelector(".floating-orb-wrapper");t&&o&&(t.addEventListener("touchstart",function(a){a.preventDefault(),this.style.transform="scale(0.95)"}),t.addEventListener("touchend",function(a){a.preventDefault(),this.style.transform="";const r=this.querySelector(".floating-orb");r&&r.click()}),i.log("Mobile orb touch handling initialized"));const n=document.querySelector(".profile-hub");if(n&&o){let a=0,r=0;n.addEventListener("touchstart",function(l){a=l.touches[0].clientY,r=l.touches[0].clientX}),n.addEventListener("touchmove",function(l){const g=l.touches[0].clientY,d=l.touches[0].clientX,u=a-g,p=r-d;if(u>50&&Math.abs(p)<50){const c=this.querySelector('[data-action="expand"]');c&&c.click()}}),i.log("Mobile profile hub swipe gestures initialized")}const s=document.getElementById("mobileMenuToggle");if(s&&o&&(s.addEventListener("click",function(){this.style.transform="scale(0.95)",setTimeout(()=>{this.style.transform=""},150)}),i.log("Mobile menu haptic feedback initialized")),o){const a=()=>{const r=window.innerHeight*.01;document.documentElement.style.setProperty("--vh",`${r}px`)};a(),window.addEventListener("resize",a),window.addEventListener("orientationchange",a),i.log("Mobile viewport height fix applied")}if(o){const a=document.createElement("style");a.textContent=`
      @media (max-width: 768px) {
        * {
          animation-duration: 0.3s !important;
          transition-duration: 0.2s !important;
        }
        
        .floating-orb.idle {
          animation-duration: 3s !important;
        }
        
        .pulse-ring {
          animation-duration: 2s !important;
        }
      }
    `,document.head.appendChild(a),i.log("Mobile performance optimizations applied")}window.addEventListener("error",function(a){o&&i.error("Mobile error detected",{message:a.message,filename:a.filename,lineno:a.lineno,colno:a.colno})}),i.log("Mobile enhancements initialization complete")}document.addEventListener("DOMContentLoaded",()=>{i.log("DOM Content Loaded - Starting enhanced initialization"),We(),setTimeout(()=>{i.log("Checking feature initialization status"),window.socialAuth?i.log("Social auth system initialized"):i.warn("Social auth system not initialized"),window.db&&window.auth?i.log("Firebase services available"):i.warn("Firebase services not available");const o=document.getElementById("authModal"),e=document.getElementById("googleLoginBtn");i.log("Critical DOM elements status",{authModal:!!o,googleLoginBtn:!!e})},2e3)});const w={log:(o,e=null)=>{console.log(`[FLOATING ORB] ${o}`,e||"")},error:(o,e=null)=>{console.error(`[FLOATING ORB ERROR] ${o}`,e||"")},warn:(o,e=null)=>{console.warn(`[FLOATING ORB WARN] ${o}`,e||"")}};class oe{constructor(e={}){this.options={debugMode:!1,maxNotifications:6,autoRemoveDelay:3e4,enableSounds:!0,useThreeJS:!0,threeJsCdn:"https://unpkg.com/three@0.160.0/build/three.module.js",...e},this.notifications=[],this.container=null,this.orb=null,this.isInitialized=!1,this.popupTimeout=null,w.log("Floating Orb Manager initialized",this.options)}async init(){if(this.isInitialized){w.warn("Orb already initialized");return}try{await this.createOrb(),this.setupEventListeners(),this.adjustSidebarSpacing(),this.bindProfileHubEvents(),this.isInitialized=!0,w.log("Floating orb system initialized successfully"),window.innerWidth<=768&&w.log("Mobile layout detected - orb positioned in center-right area"),this.options.debugMode&&this.addDemoNotifications()}catch(e){w.error("Failed to initialize floating orb",e)}}bindProfileHubEvents(){try{if(this._hubBound)return;this._hubBound=!0;const e=(n,s)=>{if(!n)return;const a=n.ui?.hubState==="chatbot-active",r=!!n.chatbot?.isTyping;this.container&&(this.container.setAttribute("data-chatbot",a?"active":"inactive"),this.container.setAttribute("data-typing",r?"true":"false")),this.orb&&(this.orb.classList.toggle("chat-active",a),this.orb.classList.toggle("typing",r)),s?.chatbot?.messages&&this.orb&&(this.orb.classList.add("message-ping"),setTimeout(()=>this.orb&&this.orb.classList.remove("message-ping"),380))},t=window.profileHubManager?.state;t&&(w.log("Syncing orb with existing ProfileHub state"),e(t,null)),window.addEventListener("profilehub-state-changed",n=>{const{state:s,changes:a}=n.detail||{};w.log("ProfileHub state changed detected by orb",{hubState:s?.ui?.hubState,typing:s?.chatbot?.isTyping}),e(s,a)}),w.log("Floating orb bound to ProfileHub events")}catch(e){w.warn("Failed to bind ProfileHub events",e)}}async createOrb(){this.container=document.createElement("div"),this.container.className="floating-orb-wrapper",this.container.setAttribute("data-debug",this.options.debugMode),this.stage=document.createElement("div"),this.stage.style.position="absolute",this.stage.style.top="50%",this.stage.style.left="50%",this.stage.style.transform="translate(-50%, -50%)",this.stage.style.width="var(--orbit-size)",this.stage.style.height="var(--orbit-size)",this.orb=document.createElement("div"),this.orb.className="floating-orb",this.orb.title="Notification Center - Click to expand",this.orbit=document.createElement("div"),this.orbit.className="notification-orbit",this.popup=document.createElement("div"),this.popup.className="notification-popup",this.navContainer=document.createElement("div"),this.navContainer.className="orb-nav-container rotating",this.stage.appendChild(this.orbit),this.stage.appendChild(this.navContainer),this.stage.appendChild(this.orb),this.container.appendChild(this.stage),this.container.appendChild(this.popup),document.body.appendChild(this.container),w.log("Orb DOM structure created"),this.updateDockingPosition(),window.addEventListener("resize",()=>this.updateDockingPosition(),{passive:!0});try{window.dispatchEvent(new CustomEvent("floating-orb:ready",{detail:{container:this.container,orb:this.orb,orbit:this.orbit,popup:this.popup}})),w.log("Dispatched floating-orb:ready event")}catch(e){w.warn("Failed to dispatch floating-orb:ready event",e)}this.options.useThreeJS&&this.tryInitThreeJS().catch(e=>{w.warn("Three.js enhancement unavailable; using CSS orb only",e)}),this.buildOrbNavigation(),this.startRingOrbit()}updateDockingPosition(){const e=window.innerWidth<=768,t=document.getElementById("title-container")||document.querySelector(".title-main-container");if(e&&t){this.container.classList.add("mobile-under-title");const n=document.querySelector(".title-header-section")||t.parentElement;n&&n.contains(t)&&(t.style.position=t.style.position||"relative",this.container.parentElement!==t&&(t.appendChild(this.container),w.log("Docked orb under title for mobile")))}else this.container.classList.remove("mobile-under-title"),this.container.parentElement!==document.body&&(document.body.appendChild(this.container),w.log("Restored orb to desktop top-left position"))}buildOrbNavigation(){try{const e=[{id:"nav-home",icon:"ðŸ ",title:"Home",onClick:()=>this.navigateToSection("home-section")},{id:"nav-guides",icon:"ðŸ“š",title:"Guides",onClick:()=>this.navigateToSection("guides-section")},{id:"nav-showcase",icon:"ðŸ†",title:"Showcase",onClick:()=>this.navigateToSection("showcase-section")},{id:"nav-tools",icon:"ðŸ› ï¸",title:"Tools",onClick:()=>this.navigateToSection("tools-section")},{id:"nav-projects",icon:"ðŸš€",title:"Projects",onClick:()=>this.navigateToSection("projects-section")},{id:"nav-chat",icon:"ðŸ’¬",title:"Chatbot",onClick:()=>window.profileHubManager?.toggleChatbot?.()}];this.navContainer.innerHTML="";const t=360/e.length;e.forEach((n,s)=>{const a=document.createElement("button");a.type="button",a.className="orb-nav-item",a.setAttribute("title",n.title),a.style.setProperty("--angle",`${s*t}deg`),a.innerText=n.icon,a.addEventListener("click",r=>{r.stopPropagation(),n.onClick?.()}),this.navContainer.appendChild(a)}),w.log("Orb navigation constructed",{count:e.length})}catch(e){w.warn("Failed to build orb navigation",e)}}navigateToSection(e){try{const t=document.getElementById(e);if(!t)return;t.style.display="block";const n=document.getElementById("mobileDrawer");n?.classList?.contains("active")&&n.classList.remove("active"),t.scrollIntoView({behavior:"smooth",block:"start"}),w.log("Navigated to section via orb",{sectionId:e})}catch{}}startRingOrbit(){try{const e=Array.from(this.navContainer?.children||[]);if(!e.length)return;const t=Math.PI*2;let n=performance.now();const a=window.innerWidth<=768?65e3:55e3,r=l=>{const d=(l-n)%a/a,p=(this.navContainer.getBoundingClientRect().width||180)/2.3,c=.3;e.forEach((m,f)=>{const b=t*(d+f/e.length),v=Math.cos(b)*p,y=Math.sin(b)*p*c;Math.cos(b)>0?m.classList.add("in-front"):m.classList.remove("in-front"),m.style.setProperty("--x",`${v}px`),m.style.setProperty("--y",`${y}px`)}),this._ringFrame=requestAnimationFrame(r)};this._ringFrame&&cancelAnimationFrame(this._ringFrame),this._ringFrame=requestAnimationFrame(r),w.log("Saturn ring orbit started"),window.addEventListener("resize",()=>{this._ringFrame&&(cancelAnimationFrame(this._ringFrame),this._ringFrame=null),this.startRingOrbit()},{passive:!0})}catch(e){w.warn("Failed to start ring orbit",e)}}async tryInitThreeJS(){if(window.__orbThree)return w.log("Three.js already loaded, reusing module"),this.initThreeScene(window.__orbThree);try{w.log("Loading Three.js from CDN",{url:this.options.threeJsCdn});const e=await import(this.options.threeJsCdn);window.__orbThree=e,w.log("Three.js CDN module loaded successfully"),await this.initThreeScene(e)}catch(e){throw w.error("Failed to load Three.js from CDN",e),e}}async initThreeScene(e){w.log("Initializing Three.js scene");const t=document.createElement("div");t.className="orb-3d-layer",this.container.appendChild(t),w.log("WebGL layer created and added to container");const n=t.clientWidth||200,s=t.clientHeight||200,a=new e.WebGLRenderer({antialias:!0,alpha:!0});t.appendChild(a.domElement);const r=new e.Scene,l=new e.PerspectiveCamera(45,n/s,.1,100);l.position.z=3.2;const g=()=>{const L=t.clientWidth||parseInt(getComputedStyle(t).width),B=t.clientHeight||parseInt(getComputedStyle(t).height),I=Math.min(window.devicePixelRatio||1,2);a.setPixelRatio(I),a.setSize(L,B,!1),l.aspect=L/B,l.updateProjectionMatrix()};g(),new ResizeObserver(g).observe(t),window.addEventListener("resize",g);const d=new e.SphereGeometry(1,64,64),u=document.createElement("canvas");u.width=256,u.height=256;const p=u.getContext("2d"),c=p.createImageData(256,256),m=c.data;for(let L=0;L<m.length;L+=4){const B=L/4%256,I=Math.floor(L/4/256),z=Math.sin(B*.1)*Math.cos(I*.1),P=Math.sin(B*.05+I*.03)*Math.cos(B*.03-I*.05),_=(z+P)*.5+.5,se=(z-P)*.5+.5;m[L]=_*255,m[L+1]=se*255,m[L+2]=255,m[L+3]=255}p.putImageData(c,0,0);const f=new e.CanvasTexture(u);f.wrapS=f.wrapT=e.RepeatWrapping;const b=new e.MeshStandardMaterial({color:3470847,roughness:.15,metalness:.8,emissive:848127,emissiveIntensity:.3,transparent:!0,opacity:.9,normalMap:f,normalScale:new e.Vector2(.3,.3),envMapIntensity:1.2}),v=new e.Mesh(d,b);r.add(v);const y=new e.AmbientLight(6750207,.6);r.add(y);const E=new e.PointLight(8956671,1.5);E.position.set(2,2,2),r.add(E);const S=new e.Clock,A=()=>{const L=S.getElapsedTime();v.rotation.y=L*.4,v.rotation.x=Math.sin(L*.6)*.15,a.render(r,l),requestAnimationFrame(A)};A(),w.log("Three.js orb enhancement initialized"),this.webglLayer=t,this.threeRenderer=a,this.threeScene=r,this.threeSphere=v}setupEventListeners(){this.orb.addEventListener("click",n=>{n.preventDefault(),this.toggleNotificationsList(),w.log("Orb clicked - toggling notifications")}),this.orb.addEventListener("mouseenter",()=>{window.innerWidth>768&&this.showLatestNotification()}),this.orb.addEventListener("mouseleave",()=>{window.innerWidth>768&&this.hideNotificationPopup()}),this.orb.addEventListener("touchstart",n=>{window.innerWidth<=768&&(this.showLatestNotification(),w.log("Mobile touch detected - showing notification"))},{passive:!0}),this.orb.addEventListener("touchend",n=>{window.innerWidth<=768&&setTimeout(()=>{this.hideNotificationPopup()},2e3)},{passive:!0}),document.addEventListener("click",n=>{this.container.contains(n.target)||this.hideNotificationPopup()});const e=document.getElementById("mobileMenuToggle");e&&e.addEventListener("click",()=>{this.hideNotificationPopup(),w.log("Mobile menu opened - hiding orb notifications")});const t=document.getElementById("mobileDrawer");t&&new MutationObserver(s=>{s.forEach(a=>{a.type==="attributes"&&a.attributeName==="class"&&t.classList.contains("active")&&(this.hideNotificationPopup(),w.log("Mobile drawer opened - hiding orb notifications"))})}).observe(t,{attributes:!0}),this.orb.addEventListener("keydown",n=>{(n.key==="Enter"||n.key===" ")&&(n.preventDefault(),this.toggleNotificationsList())}),this.orb.setAttribute("tabindex","0"),this.orb.setAttribute("role","button"),this.orb.setAttribute("aria-label","Notification Center"),w.log("Event listeners set up")}adjustSidebarSpacing(){w.log("Orb floating mode - no layout adjustments needed")}addNotification(e){const t=Date.now()+Math.random(),n={id:t,title:e.title||"New Notification",message:e.message||"",type:e.type||"info",timestamp:new Date,icon:this.getIconForType(e.type),priority:e.priority||"normal",actions:e.actions||[],...e};if(this.notifications.unshift(n),this.notifications.length>this.options.maxNotifications){const s=this.notifications.pop();this.removeNotificationCard(s.id)}return this.createNotificationCard(n),this.updateOrbState(),this.options.autoRemoveDelay>0&&e.autoRemove!==!1&&setTimeout(()=>{this.removeNotification(t)},this.options.autoRemoveDelay),w.log("Notification added",n),t}removeNotification(e){const t=this.notifications.findIndex(n=>n.id===e);if(t!==-1){const n=this.notifications.splice(t,1)[0];this.removeNotificationCard(e),this.updateOrbState(),w.log("Notification removed",n)}}createNotificationCard(e){const t=document.createElement("div");t.className="notification-card",t.setAttribute("data-id",e.id),t.innerHTML=e.icon,t.title=e.title,t.addEventListener("click",n=>{n.stopPropagation(),this.showNotificationDetails(e),w.log("Notification card clicked",e)}),t.addEventListener("mouseenter",()=>{this.showNotificationPreview(e)}),this.orbit.appendChild(t),requestAnimationFrame(()=>{t.style.transform="scale(1.2)",setTimeout(()=>{t.style.transform=""},300)})}removeNotificationCard(e){const t=this.orbit.querySelector(`[data-id="${e}"]`);t&&(t.style.animation="none",t.style.transform="scale(0)",t.style.opacity="0",setTimeout(()=>{t.parentNode&&t.parentNode.removeChild(t)},300))}updateOrbState(){const e=this.notifications.length>0;this.container.classList.toggle("has-notifications",e),this.orb.setAttribute("aria-label",e?`Notification Center - ${this.notifications.length} notifications`:"Notification Center - No notifications")}showNotificationDetails(e){this.popup.innerHTML=`
            <h4>${this.escapeHtml(e.title)}</h4>
            <p>${this.escapeHtml(e.message)}</p>
            ${e.actions?this.renderNotificationActions(e.actions):""}
            <div class="timestamp">${this.formatTimestamp(e.timestamp)}</div>
        `,this.popup.classList.add("show"),clearTimeout(this.popupTimeout),this.popupTimeout=setTimeout(()=>{this.hideNotificationPopup()},5e3)}showNotificationPreview(e){this.popup.innerHTML=`
            <h4>${this.escapeHtml(e.title)}</h4>
            <p>${this.escapeHtml(e.message.substring(0,100))}${e.message.length>100?"...":""}</p>
        `,this.popup.classList.add("show")}showLatestNotification(){this.notifications.length>0&&this.showNotificationPreview(this.notifications[0])}hideNotificationPopup(){this.popup.classList.remove("show"),clearTimeout(this.popupTimeout)}toggleNotificationsList(){this.notifications.length===0?this.addNotification({title:"No Notifications",message:"You're all caught up! ðŸŽ‰",type:"info",autoRemove:!1}):this.showNotificationDetails(this.notifications[0])}getIconForType(e){const t={info:"ðŸ’¬",success:"âœ…",warning:"âš ï¸",error:"âŒ",update:"ðŸ”„",like:"â¤ï¸",comment:"ðŸ’­",follow:"ðŸ‘¥",system:"âš™ï¸"};return t[e]||t.info}formatTimestamp(e){const n=new Date-e;return n<6e4?"Just now":n<36e5?`${Math.floor(n/6e4)}m ago`:n<864e5?`${Math.floor(n/36e5)}h ago`:e.toLocaleDateString()}escapeHtml(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}renderNotificationActions(e){return e.map(t=>`<button class="notification-action-btn" onclick="window.floatingOrb.handleNotificationAction('${t.id}', '${t.handler}')">${t.label}</button>`).join("")}handleNotificationAction(e,t){w.log("Notification action triggered",{actionId:e,handler:t}),typeof window[t]=="function"&&window[t](e)}addDemoNotifications(){[{title:"Welcome!",message:"Your floating orb is now active and ready for notifications! ðŸš€",type:"success"},{title:"New Feature",message:"Check out the latest widget studio updates.",type:"info"},{title:"System Update",message:"Your profile has been synced successfully.",type:"update"}].forEach((t,n)=>{setTimeout(()=>{this.addNotification(t)},n*1e3)})}clear(){this.notifications=[],this.orbit.innerHTML="",this.updateOrbState(),this.hideNotificationPopup(),w.log("All notifications cleared")}destroy(){this.container&&this.container.parentNode&&this.container.parentNode.removeChild(this.container);const e=document.querySelector(".sidebar-nav");e&&(e.style.paddingLeft=""),this.isInitialized=!1,w.log("Floating orb destroyed")}}document.addEventListener("DOMContentLoaded",()=>{window.floatingOrb=new oe({debugMode:!0,maxNotifications:6,autoRemoveDelay:3e4}),window.floatingOrb.init(),w.log("Floating orb system loaded and ready!")});(()=>{const o=(...s)=>console.debug("[Orb3D]",...s);let e=!1;const t=()=>{if(e)return;const s=document.querySelector(".floating-orb-wrapper"),a=document.querySelector(".floating-orb"),r=document.querySelector(".notification-popup");if(!s||!a){o("Orb not yet in DOM. Will wait for ready event/observer.");return}e=!0,o("Initializing 3D tilt controller");let l=0,g=0,d=0,u=0,p=null;const c=(y,E,S)=>Math.min(S,Math.max(E,y)),m=y=>{a&&(y?a.classList.add("idle"):a.classList.remove("idle"))},f=(y,E)=>{const S=s.getBoundingClientRect(),A=S.left+S.width/2,L=S.top+S.height/2,B=y-A,I=E-L,z=c(B/(S.width/2),-1,1),P=c(I/(S.height/2),-1,1),_=10;g=z*_,l=-P*_},b=()=>{const E=l-d,S=g-u;d+=E*.12,u+=S*.12,a.style.transform=`translate(-50%,-50%) rotateX(${d.toFixed(2)}deg) rotateY(${u.toFixed(2)}deg)`,requestAnimationFrame(b)},v=y=>{m(!1),y.touches&&y.touches[0]?f(y.touches[0].clientX,y.touches[0].clientY):f(y.clientX,y.clientY),clearTimeout(p),p=setTimeout(()=>m(!0),2200)};window.addEventListener("pointermove",v,{passive:!0}),window.addEventListener("touchmove",v,{passive:!0}),a.addEventListener("click",()=>{r&&r.classList.toggle("show")}),m(!0),requestAnimationFrame(b),o("3D tilt engaged. Try moving your pointer around.")};document.querySelector(".floating-orb")&&t(),window.addEventListener("floating-orb:ready",()=>{o("Received floating-orb:ready"),t()});const n=new MutationObserver(()=>{document.querySelector(".floating-orb")&&(o("Observer detected orb in DOM"),t(),n.disconnect())});document.body?n.observe(document.body,{childList:!0,subtree:!0}):window.addEventListener("DOMContentLoaded",()=>{n.observe(document.body,{childList:!0,subtree:!0})})})();window.debugOrb={checkStatus:()=>{const o=document.querySelector(".floating-orb"),e=document.querySelector(".floating-orb-wrapper"),t=document.querySelector(".orb-3d-layer"),n=t?.querySelector("canvas");console.log("[ORB DEBUG] Status check:",{orb:!!o,wrapper:!!e,webglLayer:!!t,canvas:!!n,canvasSize:n?`${n.width}x${n.height}`:"N/A",orbPosition:o?getComputedStyle(o).transform:"N/A",threeLoaded:!!window.__orbThree})},testWebGL:()=>{const o=document.querySelector(".orb-3d-layer canvas");if(o){const e=o.getContext("webgl")||o.getContext("webgl2");console.log("[ORB DEBUG] WebGL context:",!!e),e&&console.log("[ORB DEBUG] WebGL info:",{vendor:e.getParameter(e.VENDOR),renderer:e.getParameter(e.RENDERER),version:e.getParameter(e.VERSION)})}else console.log("[ORB DEBUG] No WebGL canvas found")},repositionTopLeft:()=>{const o=document.querySelector(".floating-orb-wrapper");o&&(o.style.top="12px",o.style.left="12px",console.log("[ORB DEBUG] Repositioned to top-left"))}};const $e=Object.freeze(Object.defineProperty({__proto__:null,default:oe},Symbol.toStringTag,{value:"Module"}));class Re{constructor(){this.currentUser=null,this.userWidgets=[],this.widgetData={},this.userQuips=[],this.quipData={},this.debugMode=!0}log(e,t=null){this.debugMode&&console.log(`[WidgetDisplay] ${e}`,t)}error(e,t=null){console.error(`[WidgetDisplay] ${e}`,t)}async init(){if(this.currentUser=Z.currentUser,!this.currentUser){this.log("No user logged in for widget display");return}this.log("Initializing enhanced widget display system with quip support"),await this.loadUserWidgets(),await this.loadUserQuips(),this.setupWidgetSlots(),this.setupQuipSlots(),this.setupProfileMenuIntegration()}async loadUserWidgets(){try{const e=await U(T(k,"users",this.currentUser.uid));if(e.exists()){const t=e.data();this.userWidgets=t.widgets||[],this.log("Loaded user widgets",{widgetCount:this.userWidgets.length}),await this.loadWidgetMetadata()}}catch(e){this.error("Error loading user widgets",e)}}async loadWidgetMetadata(){try{for(const e of this.userWidgets){const t=await U(T(k,"widgets",e));t.exists()&&(this.widgetData[e]=t.data())}this.log("Loaded widget metadata",{widgetCount:Object.keys(this.widgetData).length})}catch(e){this.error("Error loading widget metadata",e)}}async loadUserQuips(){try{this.log("Loading user quips for user:",this.currentUser.uid);const e=H(k,"quips"),t=Q(e,j("userId","==",this.currentUser.uid)),n=await V(t);this.userQuips=n.docs.map(s=>s.id),this.log("Loaded user quips",{quipCount:this.userQuips.length,quipIds:this.userQuips}),await this.loadQuipMetadata()}catch(e){if(this.error("Error loading user quips",e),e.code==="permission-denied"&&(this.log("Permission denied - user may not be authenticated properly"),window.socialAuth&&window.socialAuth.currentUser)){this.log("Retrying with current auth user"),this.currentUser=window.socialAuth.currentUser;try{const t=H(k,"quips"),n=Q(t,j("userId","==",this.currentUser.uid)),s=await V(n);this.userQuips=s.docs.map(a=>a.id),this.log("Retry successful - loaded user quips",{quipCount:this.userQuips.length}),await this.loadQuipMetadata()}catch(t){this.error("Retry also failed",t)}}}}async loadQuipMetadata(){try{for(const e of this.userQuips){const t=await U(T(k,"quips",e));t.exists()&&(this.quipData[e]=t.data())}this.log("Loaded quip metadata",{quipCount:Object.keys(this.quipData).length})}catch(e){this.error("Error loading quip metadata",e)}}findHtmlFile(e){if(!Array.isArray(e)||e.length===0)return null;const t=e.find(n=>n.fileName&&/index\.html?$/i.test(n.fileName));return t||e.find(n=>n.fileName&&/\.html?$/i.test(n.fileName))}setupWidgetSlots(){document.querySelectorAll("[data-widget-slot]").forEach(t=>{const n=t.dataset.widgetSlot;this.renderWidgetSlot(t,n)})}setupQuipSlots(){document.querySelectorAll(".quip-slot, .quip-preview, .timeline-event-card").forEach((t,n)=>{this.renderQuipSlot(t,n+1)})}async renderQuipSlot(e,t){const n=Object.values(this.quipData).find(s=>s.slot===parseInt(t));if(n&&n.files&&this.findHtmlFile(n.files)){const s=this.findHtmlFile(n.files);this.showQuipIframe(e,s.downloadURL,n)}else this.showEmptyQuipSlot(e,t)}async renderWidgetSlot(e,t){const n=Object.values(this.widgetData).find(s=>s.slot===parseInt(t));if(n&&n.files&&this.findHtmlFile(n.files)){const s=this.findHtmlFile(n.files);this.showWidgetIframe(e,s.downloadURL,n)}else this.showUploadInterface(e,t)}showWidgetIframe(e,t,n){e.innerHTML=`
      <div class="widget-container">
        <div class="widget-header">
          <h3>${n.title||"Untitled Widget"}</h3>
          <div class="widget-actions">
            <button class="btn btn-secondary edit-widget-btn" data-widget-id="${n.id}">
              <span class="material-icons">edit</span>
              Edit
            </button>
            <button class="btn btn-secondary preview-widget-btn" data-widget-id="${n.id}">
              <span class="material-icons">open_in_new</span>
              Full View
            </button>
            <button class="btn btn-danger delete-widget-btn" data-widget-id="${n.id}">
              <span class="material-icons">delete</span>
              Delete
            </button>
          </div>
        </div>
        <div class="widget-frame-container">
          <iframe 
            src="${t}" 
            class="widget-iframe"
            frameborder="0"
            sandbox="allow-scripts allow-same-origin allow-forms"
            title="Widget ${n.title}"
          ></iframe>
        </div>
        <div class="widget-info">
          <p><strong>Description:</strong> ${n.description||"No description"}</p>
          <p><strong>Category:</strong> ${n.category||"General"}</p>
          <p><strong>Tags:</strong> ${n.tags?.join(", ")||"No tags"}</p>
          <p><strong>Last Updated:</strong> ${new Date(n.updatedAt?.toDate()||n.updatedAt).toLocaleDateString()}</p>
          <div class="widget-stats">
            <span class="stat">ðŸ‘ï¸ ${n.stats?.views||0} views</span>
            <span class="stat">â¤ï¸ ${n.stats?.likes||0} likes</span>
            <span class="stat">ðŸ“¤ ${n.stats?.shares||0} shares</span>
          </div>
        </div>
      </div>
    `,this.setupWidgetActionHandlers(e)}showQuipIframe(e,t,n){e.innerHTML=`
      <div class="quip-container">
        <div class="quip-header">
          <h3 style="color: #00f0ff; font-family: JetBrains Mono;">${n.title||"Untitled Quip"}</h3>
          <div class="quip-badges">
            <span class="quip-type-badge" style="background: rgba(0,240,255,0.2); color: #00f0ff; padding: 4px 8px; border-radius: 12px; font-size: 0.8rem;">QUIP</span>
            ${n.webglEnabled?'<span class="webgl-badge" style="background: rgba(255,0,255,0.2); color: #ff00ff; padding: 4px 8px; border-radius: 12px; font-size: 0.8rem;">WebGL</span>':""}
          </div>
          <div class="quip-actions">
            <button class="btn btn-primary interact-quip-btn" data-quip-id="${n.id}">
              <span>ðŸŽ®</span>
              Interact
            </button>
            <button class="btn btn-secondary edit-quip-btn" data-quip-id="${n.id}">
              <span>âœï¸</span>
              Edit
            </button>
            <button class="btn btn-secondary preview-quip-btn" data-quip-id="${n.id}">
              <span>ðŸ‘ï¸</span>
              Full View
            </button>
            <button class="btn btn-danger delete-quip-btn" data-quip-id="${n.id}">
              <span>ðŸ—‘ï¸</span>
              Delete
            </button>
          </div>
        </div>
        <div class="quip-frame-container">
          <iframe 
            src="${t}" 
            class="quip-iframe webgl-enabled"
            frameborder="0"
            loading="lazy"
            sandbox="allow-scripts allow-same-origin allow-forms allow-webgl allow-pointer-lock"
            style="width: 100%; height: 300px; border-radius: 12px; border: 2px solid #00f0ff; background: #0a0a0a;"
            title="Quip Preview - ${n.title||"Untitled Quip"}"
          ></iframe>
        </div>
        <div class="quip-info">
          <p style="color: #a0a0a0; margin: 8px 0;">${n.description||"No description available"}</p>
          <div class="quip-meta">
            <span class="quip-interactions" style="color: #00f0ff;">Interactions: ${n.interactionCount||0}</span>
            <span class="quip-category" style="color: #ff00ff;">Category: ${n.category||"general"}</span>
          </div>
        </div>
      </div>
    `;const s=e.querySelector(".quip-iframe");N&&typeof N.applyDashboardSettings=="function"&&N.applyDashboardSettings(s,{borderColor:"#00f0ff",borderWidth:"2px",borderRadius:"12px",shadow:"0 0 20px rgba(0, 240, 255, 0.3), inset 0 1px 0 rgba(255, 255, 255, 0.1)"}),this.setupQuipActionHandlers(e)}showEmptyQuipSlot(e,t){e.innerHTML=`
      <div class="empty-quip-slot" style="text-align: center; padding: 40px; border: 2px dashed #333; border-radius: 12px; background: rgba(0,240,255,0.05);">
        <div style="font-size: 3rem; margin-bottom: 16px; color: #00f0ff;">ðŸŽ®</div>
        <h3 style="color: #00f0ff; margin-bottom: 8px; font-family: JetBrains Mono;">Empty Quip Slot ${t}</h3>
        <p style="color: #a0a0a0; margin-bottom: 16px;">Create an interactive WebGL quip to fill this slot</p>
        <button class="btn btn-primary create-quip-btn" data-slot="${t}" style="background: rgba(0,240,255,0.1); border: 1px solid #00f0ff; color: #00f0ff; padding: 8px 16px; border-radius: 6px;">
          <span>âž•</span>
          Create Quip
        </button>
      </div>
    `,this.setupEmptyQuipHandlers(e)}showUploadInterface(e,t){e.innerHTML=`
      <div class="widget-upload-container">
        <h3>Widget Slot ${t}</h3>
        <p>Upload your widget files to get started</p>
        <div class="upload-area" data-slot="${t}">
          <input type="file" id="widgetFiles${t}" multiple accept=".html,.js,.css,.png,.jpg,.jpeg,.gif,.svg,.json,.mp3,.mp4,.wav,.ogg" style="display: none;">
          <div class="upload-placeholder">
            <span class="material-icons">cloud_upload</span>
            <p>Drop files here or click to upload</p>
            <p class="upload-hint">Supports: HTML, CSS, JS, Images, Audio, Video</p>
          </div>
        </div>
        <div class="upload-form" style="display: none;">
          <input type="text" placeholder="Widget Title" class="widget-title-input" data-slot="${t}">
          <textarea placeholder="Widget Description" class="widget-desc-input" data-slot="${t}" rows="3"></textarea>
          <input type="text" placeholder="Category (e.g., game, tool, art)" class="widget-category-input" data-slot="${t}">
          <input type="text" placeholder="Tags (comma separated)" class="widget-tags-input" data-slot="${t}">
          <button class="btn btn-primary upload-widget-btn" data-slot="${t}">
            <span class="material-icons">upload</span>
            Upload Widget
          </button>
        </div>
      </div>
    `,this.setupUploadHandlers(e,t)}setupUploadHandlers(e,t){const n=e.querySelector(".upload-area"),s=e.querySelector(`#widgetFiles${t}`),a=e.querySelector(".upload-form");s.addEventListener("change",l=>{l.target.files.length>0&&this.handleFileSelection(l.target.files,a)}),n.addEventListener("dragover",l=>{l.preventDefault(),n.classList.add("drag-over")}),n.addEventListener("dragleave",l=>{l.preventDefault(),n.classList.remove("drag-over")}),n.addEventListener("drop",l=>{l.preventDefault(),n.classList.remove("drag-over");const g=l.dataTransfer.files;g.length>0&&(s.files=g,this.handleFileSelection(g,a))}),n.addEventListener("click",()=>{s.click()}),e.querySelector(".upload-widget-btn").addEventListener("click",()=>{this.uploadWidget(t)})}handleFileSelection(e,t){t.style.display="block";const n=Array.from(e).map(s=>s.name).join(", ");t.querySelector(".upload-placeholder p").textContent=`Selected: ${n}`}async uploadWidget(e){if(this.log("Widget upload requested, delegating to WidgetUploadManager"),!window.widgetUploadManager){const{default:n}=await h(async()=>{const{default:s}=await import("./widget-upload-EdH-RL5r.js");return{default:s}},__vite__mapDeps([4,5,2]),import.meta.url);window.widgetUploadManager=n}const t=document.querySelector(`.upload-widget-btn[data-slot="${e}"]`);t?await window.widgetUploadManager.handleUploadButtonClick(t):this.error("Upload button not found for slot",{slotNumber:e})}setupWidgetActionHandlers(e){const t=e.querySelector(".edit-widget-btn");t&&t.addEventListener("click",a=>{const r=a.target.closest(".edit-widget-btn").dataset.widgetId;this.editWidget(r)});const n=e.querySelector(".preview-widget-btn");n&&n.addEventListener("click",a=>{const r=a.target.closest(".preview-widget-btn").dataset.widgetId;this.previewWidget(r)});const s=e.querySelector(".delete-widget-btn");s&&s.addEventListener("click",a=>{const r=a.target.closest(".delete-widget-btn").dataset.widgetId;this.deleteWidget(r)})}setupQuipActionHandlers(e){const t=e.querySelector(".interact-quip-btn");t&&t.addEventListener("click",r=>{const l=r.target.closest(".interact-quip-btn").dataset.quipId;this.interactWithQuip(l)});const n=e.querySelector(".edit-quip-btn");n&&n.addEventListener("click",r=>{const l=r.target.closest(".edit-quip-btn").dataset.quipId;this.editQuip(l)});const s=e.querySelector(".preview-quip-btn");s&&s.addEventListener("click",r=>{const l=r.target.closest(".preview-quip-btn").dataset.quipId;this.previewQuip(l)});const a=e.querySelector(".delete-quip-btn");a&&a.addEventListener("click",r=>{const l=r.target.closest(".delete-quip-btn").dataset.quipId;this.deleteQuip(l)})}setupEmptyQuipHandlers(e){const t=e.querySelector(".create-quip-btn");t&&t.addEventListener("click",n=>{const s=n.target.closest(".create-quip-btn").dataset.slot;this.createNewQuip(s)})}previewWidget(e){const t=this.widgetData[e];if(!t){this.showToast("Widget not found","error");return}const n=this.findHtmlFile(t.files);if(!n||!n.downloadURL){this.showToast("Widget HTML file not found","error");return}let s=document.getElementById("widgetPreviewModal");s||(s=document.createElement("div"),s.id="widgetPreviewModal",s.className="modal",s.innerHTML=`
        <div class="modal-content widget-preview-modal">
          <div class="modal-header">
            <h3>${t.title}</h3>
            <button class="close-modal">Ã—</button>
          </div>
          <div class="modal-body">
            <iframe 
              src="${n.downloadURL}" 
              class="widget-preview-iframe"
              frameborder="0"
              sandbox="allow-scripts allow-same-origin allow-forms"
              title="Widget Preview"
            ></iframe>
          </div>
        </div>
      `,document.body.appendChild(s),s.querySelector(".close-modal").addEventListener("click",()=>{s.style.display="none"}),s.addEventListener("click",r=>{r.target===s&&(s.style.display="none")})),s.querySelector("h3").textContent=t.title,s.querySelector("iframe").src=n.downloadURL,s.style.display="block"}editWidget(e){const t=this.widgetData[e];if(!t){this.showToast("Widget not found","error");return}const n=document.querySelector(`[data-widget-slot="${t.slot}"]`);if(n){this.showUploadInterface(n,t.slot);const s=n.querySelector(".widget-title-input"),a=n.querySelector(".widget-desc-input"),r=n.querySelector(".widget-category-input"),l=n.querySelector(".widget-tags-input");s&&(s.value=t.title||""),a&&(a.value=t.description||""),r&&(r.value=t.category||""),l&&(l.value=t.tags?.join(", ")||"")}}async deleteWidget(e){const t=this.widgetData[e];if(!t){this.showToast("Widget not found","error");return}if(confirm(`Are you sure you want to delete "${t.title}"?`))try{await G(T(k,"widgets",e)),await Y(T(k,"users",this.currentUser.uid),{widgets:ae(e)}),await this.loadUserWidgets(),this.setupWidgetSlots(),this.showToast(`Widget "${t.title}" deleted successfully`,"success"),this.log("Widget deleted successfully",{widgetId:e})}catch(n){this.error("Error deleting widget",n),this.showToast("Failed to delete widget: "+n.message,"error")}}setupProfileMenuIntegration(){this.updateProfileMenuWidgetCount(),this.addWidgetManagementToProfile()}updateProfileMenuWidgetCount(){const e=document.querySelector(".profile-menu");if(e){const t=e.querySelector(".widget-count");if(t)t.textContent=this.userWidgets.length;else{const n=document.createElement("div");n.className="widget-count",n.textContent=this.userWidgets.length,e.appendChild(n)}}}addWidgetManagementToProfile(){const e=document.querySelector(".profile-menu");if(e&&!e.querySelector(".widget-management")){const t=document.createElement("div");t.className="widget-management",t.innerHTML=`
        <h4>My Widgets (${this.userWidgets.length})</h4>
        <div class="widget-list">
          ${this.userWidgets.length===0?'<p>No widgets yet. <a href="#" class="upload-widget-link">Upload your first widget!</a></p>':this.userWidgets.map(n=>{const s=this.widgetData[n];return s?`
                <div class="widget-item" data-widget-id="${n}">
                  <div class="widget-info">
                    <h5>${s.title}</h5>
                    <p>${s.description||"No description"}</p>
                    <span class="widget-category">${s.category}</span>
                  </div>
                  <div class="widget-actions">
                    <button class="btn btn-sm preview-widget-btn" data-widget-id="${n}">Preview</button>
                    <button class="btn btn-sm edit-widget-btn" data-widget-id="${n}">Edit</button>
                    <button class="btn btn-sm btn-danger delete-widget-btn" data-widget-id="${n}">Delete</button>
                  </div>
                </div>
              `:""}).join("")}
        </div>
      `,e.appendChild(t),this.setupProfileMenuEventListeners(t)}}setupProfileMenuEventListeners(e){e.querySelectorAll(".preview-widget-btn").forEach(n=>{n.addEventListener("click",s=>{const a=s.target.dataset.widgetId;this.previewWidget(a)})}),e.querySelectorAll(".edit-widget-btn").forEach(n=>{n.addEventListener("click",s=>{const a=s.target.dataset.widgetId;this.editWidget(a)})}),e.querySelectorAll(".delete-widget-btn").forEach(n=>{n.addEventListener("click",s=>{const a=s.target.dataset.widgetId;this.deleteWidget(a)})});const t=e.querySelector(".upload-widget-link");t&&t.addEventListener("click",n=>{n.preventDefault();const s=document.querySelector("[data-widget-slot]");s&&s.scrollIntoView({behavior:"smooth"})})}async interactWithQuip(e){const t=this.quipData[e];if(!t){this.showToast("Quip not found","error");return}const n=document.querySelector(`[data-quip-id="${e}"] .quip-iframe`);n&&(n.focus(),n.style.borderColor="#ffff00",setTimeout(()=>{n.style.borderColor="#00f0ff"},2e3));try{await Y(T(k,"quips",e),{interactionCount:(t.interactionCount||0)+1,lastInteracted:re()}),this.log("Quip interaction tracked",{quipId:e})}catch(s){this.error("Failed to track quip interaction",s)}}editQuip(e){if(!this.quipData[e]){this.showToast("Quip not found","error");return}const n=`pages/widget_studio.html?edit=${e}`;window.location.href=n}previewQuip(e){const t=this.quipData[e];if(!t){this.showToast("Quip not found","error");return}const n=this.findHtmlFile(t.files);if(!n||!n.downloadURL){this.showToast("Quip HTML file not found","error");return}let s=document.getElementById("quipPreviewModal");s||(s=document.createElement("div"),s.id="quipPreviewModal",s.className="modal",s.innerHTML=`
        <div class="modal-content" style="max-width: 90vw; max-height: 90vh;">
          <div class="modal-header">
            <h3>Quip Preview</h3>
            <button class="modal-close">&times;</button>
          </div>
          <div class="modal-body">
            <iframe 
              src="${n.downloadURL}" 
              style="width: 100%; height: 70vh; border: none; border-radius: 8px;"
              sandbox="allow-scripts allow-same-origin allow-forms allow-webgl allow-pointer-lock"
            ></iframe>
          </div>
        </div>
      `,document.body.appendChild(s));const a=s.querySelector("iframe");a.src=n.downloadURL,s.querySelector("h3").textContent=`Quip Preview - ${t.title||"Untitled Quip"}`,s.style.display="flex",s.querySelector(".modal-close").onclick=()=>{s.style.display="none"},s.onclick=r=>{r.target===s&&(s.style.display="none")}}async deleteQuip(e){const t=this.quipData[e];if(!t){this.showToast("Quip not found","error");return}if(confirm(`Are you sure you want to delete "${t.title||"Untitled Quip"}"?`))try{await G(T(k,"quips",e)),delete this.quipData[e],this.userQuips=this.userQuips.filter(n=>n!==e),this.showToast("Quip deleted successfully","success"),this.log("Quip deleted",{quipId:e}),this.setupQuipSlots()}catch(n){this.error("Failed to delete quip",n),this.showToast("Failed to delete quip","error")}}createNewQuip(e){const t=`pages/widget_studio.html?slot=${e}&type=quip`;window.location.href=t}showToast(e,t="info"){window.showToast?window.showToast(e,t):console.log(`[${t.toUpperCase()}] ${e}`)}}window.previewWidget=function(o){window.widgetDisplay&&window.widgetDisplay.previewWidget(o)};window.uploadWidget=function(o){window.widgetDisplay&&window.widgetDisplay.uploadWidget(o)};window.editWidget=function(o){window.widgetDisplay&&window.widgetDisplay.editWidget(o)};window.deleteWidget=function(o){window.widgetDisplay&&window.widgetDisplay.deleteWidget(o)};let M=null;Z.onAuthStateChanged(o=>{o?M||(M=new Re,M.init(),window.widgetDisplay=M):(M=null,window.widgetDisplay=null)});class ie{constructor(){this.currentUser=null,this.following=new Set,this.followers=new Set,this.debugMode=!0}log(e,t=null){this.debugMode&&console.log(`[SOCIAL FEATURES] ${e}`,t||"")}error(e,t=null){console.error(`[SOCIAL FEATURES ERROR] ${e}`,t||"")}async init(){this.log("Initializing Social Features Manager"),this.setupAuthListener(),this.setupEventListeners(),this.log("Social Features Manager initialized")}async setupAuthListener(){try{this.log("Setting up auth state listener");const{auth:e,onAuthStateChanged:t}=await h(async()=>{const{auth:n,onAuthStateChanged:s}=await import("./firebase-core-BO8UvLyb.js");return{auth:n,onAuthStateChanged:s}},[],import.meta.url);this.log("Firebase imports successful",{auth:!!e,onAuthStateChanged:!!t}),t(e,async n=>{this.currentUser=n,n?await this.loadUserSocialData(n.uid):(this.following.clear(),this.followers.clear())})}catch(e){this.error("Failed to setup auth listener",e)}}async loadUserSocialData(e){try{const{db:t}=await h(async()=>{const{db:r}=await import("./firebase-core-BO8UvLyb.js");return{db:r}},[],import.meta.url),{doc:n,getDoc:s}=await h(async()=>{const{doc:r,getDoc:l}=await import("https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js");return{doc:r,getDoc:l}},[],import.meta.url),a=await s(n(t,"users",e));if(a.exists()){const r=a.data();this.following=new Set(r.following||[]),this.followers=new Set(r.followers||[]),this.log("User social data loaded",{following:this.following.size,followers:this.followers.size})}}catch(t){this.error("Failed to load user social data",t)}}async followUser(e){try{if(!this.currentUser)throw new Error("User must be logged in to follow others");const t=this.currentUser.uid;if(t===e)throw new Error("You cannot follow yourself");if(this.following.has(e))throw new Error("You are already following this user");const{db:n}=await h(async()=>{const{db:l}=await import("./firebase-core-BO8UvLyb.js");return{db:l}},[],import.meta.url),{doc:s,updateDoc:a,arrayUnion:r}=await h(async()=>{const{doc:l,updateDoc:g,arrayUnion:d}=await import("https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js");return{doc:l,updateDoc:g,arrayUnion:d}},[],import.meta.url);return await a(s(n,"users",t),{following:r(e)}),await a(s(n,"users",e),{followers:r(t)}),this.following.add(e),await this.createFollowNotification(e,t),this.log("User followed successfully",{targetUserId:e}),{success:!0}}catch(t){return this.error("Follow action failed",t),{success:!1,error:t.message}}}async unfollowUser(e){try{if(!this.currentUser)throw new Error("User must be logged in to unfollow others");const t=this.currentUser.uid;if(!this.following.has(e))throw new Error("You are not following this user");const{db:n}=await h(async()=>{const{db:l}=await import("./firebase-core-BO8UvLyb.js");return{db:l}},[],import.meta.url),{doc:s,updateDoc:a,arrayRemove:r}=await h(async()=>{const{doc:l,updateDoc:g,arrayRemove:d}=await import("https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js");return{doc:l,updateDoc:g,arrayRemove:d}},[],import.meta.url);return await a(s(n,"users",t),{following:r(e)}),await a(s(n,"users",e),{followers:r(t)}),this.following.delete(e),this.log("User unfollowed successfully",{targetUserId:e}),{success:!0}}catch(t){return this.error("Unfollow action failed",t),{success:!1,error:t.message}}}async likeWidget(e){try{if(!this.currentUser)throw new Error("User must be logged in to like widgets");const{db:t}=await h(async()=>{const{db:u}=await import("./firebase-core-BO8UvLyb.js");return{db:u}},[],import.meta.url),{doc:n,updateDoc:s,arrayUnion:a,getDoc:r}=await h(async()=>{const{doc:u,updateDoc:p,arrayUnion:c,getDoc:m}=await import("https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js");return{doc:u,updateDoc:p,arrayUnion:c,getDoc:m}},[],import.meta.url),l=await r(n(t,"widgets",e));if(!l.exists())throw new Error("Widget not found");const g=l.data(),d=this.currentUser.uid;if(g.likes&&g.likes.includes(d))throw new Error("You have already liked this widget");return await s(n(t,"widgets",e),{likes:a(d),"stats.likes":(g.stats?.likes||0)+1}),await this.createLikeNotification(g.userId,d,e,g.title),this.log("Widget liked successfully",{widgetId:e}),{success:!0}}catch(t){return this.error("Like action failed",t),{success:!1,error:t.message}}}async unlikeWidget(e){try{if(!this.currentUser)throw new Error("User must be logged in to unlike widgets");const{db:t}=await h(async()=>{const{db:u}=await import("./firebase-core-BO8UvLyb.js");return{db:u}},[],import.meta.url),{doc:n,updateDoc:s,arrayRemove:a,getDoc:r}=await h(async()=>{const{doc:u,updateDoc:p,arrayRemove:c,getDoc:m}=await import("https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js");return{doc:u,updateDoc:p,arrayRemove:c,getDoc:m}},[],import.meta.url),l=await r(n(t,"widgets",e));if(!l.exists())throw new Error("Widget not found");const g=l.data(),d=this.currentUser.uid;if(!g.likes||!g.likes.includes(d))throw new Error("You have not liked this widget");return await s(n(t,"widgets",e),{likes:a(d),"stats.likes":Math.max(0,(g.stats?.likes||1)-1)}),this.log("Widget unliked successfully",{widgetId:e}),{success:!0}}catch(t){return this.error("Unlike action failed",t),{success:!1,error:t.message}}}async shareWidget(e,t="general"){try{if(!this.currentUser)throw new Error("User must be logged in to share widgets");const{db:n}=await h(async()=>{const{db:u}=await import("./firebase-core-BO8UvLyb.js");return{db:u}},[],import.meta.url),{doc:s,getDoc:a,updateDoc:r,increment:l}=await h(async()=>{const{doc:u,getDoc:p,updateDoc:c,increment:m}=await import("https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js");return{doc:u,getDoc:p,updateDoc:c,increment:m}},[],import.meta.url),g=await a(s(n,"widgets",e));if(!g.exists())throw new Error("Widget not found");const d=g.data();return await r(s(n,"widgets",e),{"stats.shares":l(1)}),await this.createShareNotification(d.userId,this.currentUser.uid,e,d.title,t),await this.handlePlatformSharing(d,t),this.log("Widget shared successfully",{widgetId:e,platform:t}),{success:!0}}catch(n){return this.error("Share action failed",n),{success:!1,error:n.message}}}async handlePlatformSharing(e,t){const n=`${window.location.origin}/widget/${e.id}`,s=`Check out this amazing widget: ${e.title}`;switch(t){case"twitter":window.open(`https://twitter.com/intent/tweet?text=${encodeURIComponent(s)}&url=${encodeURIComponent(n)}`);break;case"facebook":window.open(`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(n)}`);break;case"linkedin":window.open(`https://www.linkedin.com/sharing/share-offsite/?url=${encodeURIComponent(n)}`);break;case"copy":await navigator.clipboard.writeText(`${s}
${n}`),this.showToast("Link copied to clipboard!","success");break;case"native":navigator.share?await navigator.share({title:e.title,text:e.description||s,url:n}):(await navigator.clipboard.writeText(`${s}
${n}`),this.showToast("Link copied to clipboard!","success"));break;default:await navigator.clipboard.writeText(`${s}
${n}`),this.showToast("Link copied to clipboard!","success")}}async discoverUsers(e=10,t=!0){try{const{db:n}=await h(async()=>{const{db:m}=await import("./firebase-core-BO8UvLyb.js");return{db:m}},[],import.meta.url),{collection:s,query:a,where:r,orderBy:l,limit:g,getDocs:d}=await h(async()=>{const{collection:m,query:f,where:b,orderBy:v,limit:y,getDocs:E}=await import("https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js");return{collection:m,query:f,where:b,orderBy:v,limit:y,getDocs:E}},[],import.meta.url);let u=a(s(n,"users"),l("createdAt","desc"),g(e));t&&this.currentUser&&(u=a(s(n,"users"),r("uid","!=",this.currentUser.uid),l("createdAt","desc"),g(e)));const p=await d(u),c=[];return p.forEach(m=>{const f=m.data();c.push({id:m.id,...f,isFollowing:this.following.has(m.id)})}),this.log("Users discovered",{count:c.length}),{success:!0,users:c}}catch(n){return this.error("Failed to discover users",n),{success:!1,error:n.message}}}async getUserFeed(e=20){try{if(!this.currentUser)throw new Error("User must be logged in to view feed");const{db:t}=await h(async()=>{const{db:p}=await import("./firebase-core-BO8UvLyb.js");return{db:p}},[],import.meta.url),{collection:n,query:s,where:a,orderBy:r,limit:l,getDocs:g}=await h(async()=>{const{collection:p,query:c,where:m,orderBy:f,limit:b,getDocs:v}=await import("https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js");return{collection:p,query:c,where:m,orderBy:f,limit:b,getDocs:v}},[],import.meta.url),d=Array.from(this.following),u=[];if(d.length>0){const p=s(n(t,"widgets"),a("userId","in",d),a("isPublic","==",!0),r("createdAt","desc"),l(e));(await g(p)).forEach(m=>{const f=m.data();u.push({type:"widget",id:m.id,data:f,timestamp:f.createdAt})})}return u.sort((p,c)=>c.timestamp?.toDate()-p.timestamp?.toDate()),this.log("User feed loaded",{count:u.length}),{success:!0,feed:u}}catch(t){return this.error("Failed to load user feed",t),{success:!1,error:t.message}}}async createFollowNotification(e,t){try{const{db:n}=await h(async()=>{const{db:c}=await import("./firebase-core-BO8UvLyb.js");return{db:c}},[],import.meta.url),{collection:s,addDoc:a,serverTimestamp:r}=await h(async()=>{const{collection:c,addDoc:m,serverTimestamp:f}=await import("https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js");return{collection:c,addDoc:m,serverTimestamp:f}},[],import.meta.url),{doc:l,getDoc:g}=await h(async()=>{const{doc:c,getDoc:m}=await import("https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js");return{doc:c,getDoc:m}},[],import.meta.url),d=await g(l(n,"users",t)),u=d.exists()?d.data().displayName:"Someone",p={userId:e,type:"follow",title:"New follower! ðŸ‘¥",message:`${u} started following you.`,icon:"ðŸ‘¥",data:{followerId:t,action:"view_profile"},read:!1,timestamp:r()};await a(s(n,"notifications"),p),this.log("Follow notification created",{targetUserId:e,followerId:t})}catch(n){this.error("Failed to create follow notification",n)}}async createLikeNotification(e,t,n,s){try{const{db:a}=await h(async()=>{const{db:f}=await import("./firebase-core-BO8UvLyb.js");return{db:f}},[],import.meta.url),{collection:r,addDoc:l,serverTimestamp:g}=await h(async()=>{const{collection:f,addDoc:b,serverTimestamp:v}=await import("https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js");return{collection:f,addDoc:b,serverTimestamp:v}},[],import.meta.url),{doc:d,getDoc:u}=await h(async()=>{const{doc:f,getDoc:b}=await import("https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js");return{doc:f,getDoc:b}},[],import.meta.url),p=await u(d(a,"users",t)),c=p.exists()?p.data().displayName:"Someone",m={userId:e,type:"like",title:"New like! â¤ï¸",message:`${c} liked your widget "${s}".`,icon:"â¤ï¸",data:{widgetId:n,likerId:t,action:"view_widget"},read:!1,timestamp:g()};await l(r(a,"notifications"),m),this.log("Like notification created",{widgetOwnerId:e,likerId:t,widgetId:n})}catch(a){this.error("Failed to create like notification",a)}}async createShareNotification(e,t,n,s,a){try{const{db:r}=await h(async()=>{const{db:y}=await import("./firebase-core-BO8UvLyb.js");return{db:y}},[],import.meta.url),{collection:l,addDoc:g,serverTimestamp:d}=await h(async()=>{const{collection:y,addDoc:E,serverTimestamp:S}=await import("https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js");return{collection:y,addDoc:E,serverTimestamp:S}},[],import.meta.url),{doc:u,getDoc:p}=await h(async()=>{const{doc:y,getDoc:E}=await import("https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js");return{doc:y,getDoc:E}},[],import.meta.url),c=await p(u(r,"users",t)),m=c.exists()?c.data().displayName:"Someone",b={twitter:"Twitter",facebook:"Facebook",linkedin:"LinkedIn",copy:"copied",native:"shared"}[a]||"shared",v={userId:e,type:"share",title:"Widget shared! ðŸ“¤",message:`${m} ${b} your widget "${s}".`,icon:"ðŸ“¤",data:{widgetId:n,sharerId:t,platform:a,action:"view_widget"},read:!1,timestamp:d()};await g(l(r,"notifications"),v),this.log("Share notification created",{widgetOwnerId:e,sharerId:t,widgetId:n,platform:a})}catch(r){this.error("Failed to create share notification",r)}}setupEventListeners(){document.addEventListener("click",async e=>{if(e.target.matches(".follow-btn")){e.preventDefault();const t=e.target.dataset.userId,n=e.target.dataset.following==="true";n?await this.unfollowUser(t):await this.followUser(t),this.updateFollowButton(e.target,!n)}}),document.addEventListener("click",async e=>{if(e.target.matches(".like-btn")){e.preventDefault();const t=e.target.dataset.widgetId,n=e.target.dataset.liked==="true";n?await this.unlikeWidget(t):await this.likeWidget(t),this.updateLikeButton(e.target,!n)}}),document.addEventListener("click",async e=>{if(e.target.matches(".share-btn")){e.preventDefault();const t=e.target.dataset.widgetId,n=e.target.dataset.platform||"native";await this.shareWidget(t,n)}})}updateFollowButton(e,t){e.dataset.following=t.toString(),e.textContent=t?"Following":"Follow",e.className=t?"follow-btn following":"follow-btn"}updateLikeButton(e,t){e.dataset.liked=t.toString(),e.innerHTML=t?"â¤ï¸ Liked":"ðŸ¤ Like",e.className=t?"like-btn liked":"like-btn"}showToast(e,t="info"){const n=document.createElement("div");n.className=`toast ${t}`,n.innerHTML=`
      <span class="toast-message">${e}</span>
      <button class="toast-close">&times;</button>
    `,(document.getElementById("toast-container")||document.body).appendChild(n),setTimeout(()=>{n.parentNode&&n.remove()},5e3),n.querySelector(".toast-close").addEventListener("click",()=>{n.remove()})}}const ne=new ie;window.socialFeatures=ne;document.addEventListener("DOMContentLoaded",()=>{ne.init()});const He=Object.freeze(Object.defineProperty({__proto__:null,SocialFeaturesManager:ie},Symbol.toStringTag,{value:"Module"}));
