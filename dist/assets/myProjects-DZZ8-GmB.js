import"./modulepreload-polyfill-B5Qt9EMX.js";/* empty css              *//* empty css                      */import{_ as m}from"./timeline-manager-Dc3qpIy7.js";import{auth as u,db as d}from"./firebase-core-BO8UvLyb.js";import{getDoc as E,doc as v,query as g,collection as h,where as p,orderBy as y,limit as f,getDocs as w,onSnapshot as B}from"https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js";import{onAuthStateChanged as I,signInWithEmailAndPassword as b,createUserWithEmailAndPassword as L,updateProfile as T}from"https://www.gstatic.com/firebasejs/11.10.0/firebase-auth.js";import{r as C,d as P,g as M}from"./cloud-upload-B4hV8L3F.js";import"./auth-BVr2Pxz_.js";import"./profile_banner-Eu8vPd6E.js";import"https://www.gstatic.com/firebasejs/11.10.0/firebase-app.js";import"https://www.gstatic.com/firebasejs/11.10.0/firebase-analytics.js";import"https://www.gstatic.com/firebasejs/11.10.0/firebase-storage.js";import"https://www.gstatic.com/firebasejs/11.10.0/firebase-functions.js";const n={log:(a,e=null)=>{console.log(`[MY PROJECTS] ${a}`,e||"")},error:(a,e=null)=>{console.error(`[MY PROJECTS ERROR] ${a}`,e||"")},warn:(a,e=null)=>{console.warn(`[MY PROJECTS WARN] ${a}`,e||"")}};class S{constructor(){this.currentUser=null,this.userProfile=null,this.timelineUnsubscribe=null,this.widgets=[],this.domElements={},this.initializeDOMElements(),this.setupEventListeners(),this.init()}initializeDOMElements(){this.domElements={userAvatar:document.getElementById("userAvatar"),userName:document.getElementById("userName"),profileAvatar:document.getElementById("profileAvatar"),profileName:document.getElementById("profileName"),profileBio:document.getElementById("profileBio"),widgetsCount:document.getElementById("widgetsCount"),followersCount:document.getElementById("followersCount"),viewsCount:document.getElementById("viewsCount"),profileSection:document.getElementById("profileSection"),authSection:document.getElementById("authSection"),loginForm:document.getElementById("loginForm"),loginEmail:document.getElementById("loginEmail"),loginPassword:document.getElementById("loginPassword"),loginBtn:document.getElementById("loginBtn"),signupForm:document.getElementById("signupForm"),signupEmail:document.getElementById("signupEmail"),signupPassword:document.getElementById("signupPassword"),signupDisplayName:document.getElementById("signupDisplayName"),signupBtn:document.getElementById("signupBtn"),showSignupBtn:document.getElementById("showSignupBtn"),showLoginBtn:document.getElementById("showLoginBtn"),loginFormContainer:document.getElementById("loginFormContainer"),signupFormContainer:document.getElementById("signupFormContainer"),timelineSection:document.getElementById("timelineSection"),refreshTimelineBtn:document.getElementById("refreshTimelineBtn"),widgetsGrid:document.getElementById("widgetsGrid"),toastContainer:document.getElementById("toastContainer")},n.log("DOM elements initialized",Object.keys(this.domElements))}setupEventListeners(){this.domElements.loginForm&&this.domElements.loginForm.addEventListener("submit",i=>{i.preventDefault(),this.handleLogin()}),this.domElements.signupForm&&this.domElements.signupForm.addEventListener("submit",i=>{i.preventDefault(),this.handleSignup()}),this.domElements.showSignupBtn&&this.domElements.showSignupBtn.addEventListener("click",()=>{this.showSignupForm()}),this.domElements.showLoginBtn&&this.domElements.showLoginBtn.addEventListener("click",()=>{this.showLoginForm()}),this.domElements.refreshTimelineBtn&&this.domElements.refreshTimelineBtn.addEventListener("click",()=>{this.refreshTimeline()});const e=document.getElementById("aiAssistantBtn");e&&e.addEventListener("click",()=>{this.openChatbot()});const t=document.getElementById("profileLoginBtn");t&&t.addEventListener("click",()=>{this.handleProfileLogin()}),n.log("Event listeners setup complete")}async init(){n.log("Initializing My Projects Manager"),I(u,async e=>{this.currentUser=e,n.log("Auth state changed",{userId:e?.uid}),e?await this.handleUserLogin(e):await this.handleUserLogout()}),n.log("My Projects Manager initialized - Features ready to initialize")}async handleUserLogin(e){n.log("Handling user login",{uid:e.uid});try{await this.loadUserProfile(e.uid),this.updateUIForLoggedInUser(),n.log("Initializing widget loading feature"),await this.loadUserWidgets(),n.log("Initializing timeline listener feature"),this.setupTimelineListener(),n.log("Initializing profile stats feature"),this.updateProfileStats()}catch(t){n.error("Error handling user login",t),this.showToast("Error loading profile","error")}}async handleUserLogout(){n.log("Handling user logout"),this.userProfile=null,this.widgets=[],this.updateUIForLoggedOutUser(),this.timelineUnsubscribe&&(this.timelineUnsubscribe(),this.timelineUnsubscribe=null)}async loadUserProfile(e){try{n.log("Loading user profile",{userId:e});const t=await E(v(d,"users",e));if(t.exists())this.userProfile=t.data(),n.log("User profile loaded",this.userProfile);else throw new Error("User profile not found")}catch(t){throw n.error("Failed to load user profile",t),t}}updateUIForLoggedInUser(){if(!this.userProfile)return;n.log("Updating UI for logged-in user");const{userAvatar:e,userName:t,profileAvatar:i,profileName:s,profileBio:o}=this.domElements;e&&(e.style.backgroundImage=this.userProfile.photoURL?`url(${this.userProfile.photoURL})`:"",e.innerHTML=this.userProfile.photoURL?"":"👤"),t&&(t.textContent=this.userProfile.displayName||this.userProfile.email?.split("@")[0]||"User"),i&&(i.style.backgroundImage=this.userProfile.photoURL?`url(${this.userProfile.photoURL})`:"",i.innerHTML=this.userProfile.photoURL?"":"👤"),s&&(s.textContent=this.userProfile.displayName||this.userProfile.email?.split("@")[0]||"User"),o&&(o.textContent=this.userProfile.bio||"Welcome to your creative dashboard!"),this.domElements.profileSection&&(this.domElements.profileSection.style.display="block"),this.domElements.authSection&&(this.domElements.authSection.style.display="none")}updateUIForLoggedOutUser(){n.log("Updating UI for logged-out user");const{userAvatar:e,userName:t,profileName:i,profileBio:s}=this.domElements;e&&(e.style.backgroundImage="",e.innerHTML="👤"),t&&(t.textContent="Guest"),i&&(i.textContent="Welcome Guest"),s&&(s.textContent="Sign in to access your projects and connect with the community."),this.domElements.profileSection&&(this.domElements.profileSection.style.display="none"),this.domElements.authSection&&(this.domElements.authSection.style.display="block")}async loadUserWidgets(){try{if(!this.currentUser)return;n.log("Loading user widgets",{userId:this.currentUser.uid});let e;try{e=g(h(d,"widgets"),p("userId","==",this.currentUser.uid),y("createdAt","desc"),f(20));const t=await w(e);this.widgets=[],t.forEach(i=>{const s={id:i.id,...i.data()};this.widgets.push(s)})}catch(t){n.warn("Index not available, using fallback query",t),e=g(h(d,"widgets"),p("userId","==",this.currentUser.uid),f(20));const i=await w(e);this.widgets=[],i.forEach(s=>{const o={id:s.id,...s.data()};this.widgets.push(o)}),this.widgets.sort((s,o)=>{const r=s.createdAt?.toDate?.()||new Date(0);return(o.createdAt?.toDate?.()||new Date(0))-r})}n.log("User widgets loaded",{count:this.widgets.length}),this.renderWidgets()}catch(e){n.error("Failed to load user widgets",e),e.code==="failed-precondition"?this.showToast("Database index is being created. Please refresh in a moment.","warning"):this.showToast("Failed to load widgets. Please check your connection.","error")}}renderWidgets(){const{widgetsGrid:e}=this.domElements;if(e){if(this.widgets.length===0){e.innerHTML=`
        <div class="neo-card" style="text-align: center; color: #a0a0a0;">
          <div style="font-size: 3rem; margin-bottom: 1rem;">🎨</div>
          <h3>No widgets yet</h3>
          <p>Create your first widget in the Widget Studio</p>
          <a href="widget_studio.html" class="quick-action-btn" style="margin-top: 1rem; display: inline-block;">Get Started</a>
        </div>
      `;return}e.innerHTML="",this.widgets.forEach(t=>{const i=this.createWidgetCard(t);e.appendChild(i)})}}createWidgetCard(e){const t=document.createElement("div");return t.className="neo-card",t.style.display="flex",t.style.flexDirection="column",t.style.gap="8px",t.innerHTML=`
      <div style="display:flex; align-items:flex-start; justify-content:space-between; gap: 12px;">
        <div>
          <h3 style="margin:0 0 6px 0">${e.title||"Untitled Widget"}</h3>
          <div style="font-size:.85rem; color:#a0a0a0; margin-bottom:8px">Slot ${e.slot||"?"} • ${e.files?.length||0} files</div>
          <p style="margin:0; color:#a0a0a0">${e.description||"No description"}</p>
        </div>
        <div style="display:flex; gap:6px; flex-wrap:wrap">
          <button class="quick-action-btn" data-action="preview" data-id="${e.id}">👁️ Preview</button>
          <button class="quick-action-btn" data-action="urls" data-id="${e.id}">🔗 Links</button>
        </div>
      </div>
      <div style="display:flex; gap:8px; flex-wrap:wrap; margin-top: 8px;">
        <button class="quick-action-btn" data-action="edit" data-id="${e.id}">✏️ Edit</button>
        <button class="quick-action-btn" data-action="reupload" data-id="${e.id}">🔁 Reupload</button>
        <button class="quick-action-btn" data-action="move" data-id="${e.id}">📦 Move</button>
        <button class="quick-action-btn" data-action="delete" data-id="${e.id}" style="border-color:#ef4444; color:#ef4444">🗑️ Delete</button>
      </div>
    `,t.querySelectorAll("button[data-action]").forEach(i=>{i.addEventListener("click",s=>{const o=s.currentTarget.getAttribute("data-action"),r=s.currentTarget.getAttribute("data-id"),l=this.widgets.find(c=>c.id===r);if(l)switch(o){case"preview":window.open(l.files?.[0]?.downloadURL||"#","_blank");break;case"urls":this.showDownloadUrls(l);break;case"edit":this.openEditModal(l);break;case"reupload":this.openReuploadModal(l);break;case"move":this.openMoveModal(l);break;case"delete":this.openDeleteModal(l);break}})}),t}openEditModal(e){const t=document.getElementById("editWidgetModal");if(!t)return;t.style.display="flex",this.editingWidgetId=e.id;const i=document.getElementById("editWidgetTitle"),s=document.getElementById("editWidgetDescription"),o=document.getElementById("editWidgetTags");i&&(i.value=e.title||""),s&&(s.value=e.description||""),o&&(o.value=e.tags||"");const r=document.getElementById("editWidgetClose");r&&(r.onclick=()=>t.style.display="none");const l=document.getElementById("editWidgetForm");l&&!l._wired&&(l.addEventListener("submit",async c=>{c.preventDefault(),await this.saveWidgetEdits()}),l._wired=!0)}async saveWidgetEdits(){try{const e=this.editingWidgetId,t=document.getElementById("editWidgetTitle").value.trim(),i=document.getElementById("editWidgetDescription").value.trim(),s=document.getElementById("editWidgetTags").value.trim();await(await m(()=>import("https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js"),[],import.meta.url)).updateDoc((await m(()=>import("https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js"),[],import.meta.url)).doc(d,"widgets",e),{title:t,description:i,tags:s,updatedAt:(await m(()=>import("https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js"),[],import.meta.url)).serverTimestamp?.()||new Date});const o=this.widgets.find(r=>r.id===e);o&&(o.title=t,o.description=i,o.tags=s),this.renderWidgets(),document.getElementById("editWidgetModal").style.display="none",this.showToast("Widget updated","success")}catch(e){n.error("Failed to save edits",e),this.showToast("Failed to save changes","error")}}openReuploadModal(e){const t=document.getElementById("reuploadModal");if(!t)return;t.style.display="flex",this.reuploadWidgetId=e.id;const i=document.getElementById("reuploadClose");i&&(i.onclick=()=>t.style.display="none");const s=document.getElementById("confirmReuploadBtn");s&&!s._wired&&(s.addEventListener("click",()=>this.performReupload()),s._wired=!0)}async performReupload(){const e=document.getElementById("reuploadFileInput");if(!e||!e.files||e.files.length===0){this.showToast("Select files to upload","warning");return}const t=document.getElementById("reuploadProgress"),i=document.getElementById("reuploadProgressFill"),s=document.getElementById("reuploadProgressText");t.style.display="block",i.style.width="10%",s.textContent="Preparing...";try{const o=await C(this.reuploadWidgetId,Array.from(e.files));i.style.width="100%",s.textContent="Uploaded";const r=this.widgets.find(l=>l.id===this.reuploadWidgetId);r&&(r.files=o.files||r.files),this.renderWidgets(),this.showToast("Files reuploaded","success"),document.getElementById("reuploadModal").style.display="none",e.value=""}catch(o){n.error("Reupload failed",o),this.showToast("Reupload failed","error")}}openMoveModal(e){const t=document.getElementById("moveModal");if(!t)return;t.style.display="flex",this.movingWidgetId=e.id;const i=document.getElementById("moveSlotSelect");i&&(i.value=String(e.slot||1));const s=document.getElementById("moveClose");s&&(s.onclick=()=>t.style.display="none");const o=document.getElementById("confirmMoveBtn");o&&!o._wired&&(o.addEventListener("click",()=>this.performMove()),o._wired=!0)}async performMove(){try{const e=this.movingWidgetId,t=parseInt(document.getElementById("moveSlotSelect").value,10),{doc:i,updateDoc:s}=await m(async()=>{const{doc:r,updateDoc:l}=await import("https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js");return{doc:r,updateDoc:l}},[],import.meta.url);await s(i(d,"widgets",e),{slot:t,updatedAt:new Date});const o=this.widgets.find(r=>r.id===e);o&&(o.slot=t),this.renderWidgets(),document.getElementById("moveModal").style.display="none",this.showToast("Widget moved","success")}catch(e){n.error("Move failed",e),this.showToast("Move failed","error")}}openDeleteModal(e){const t=document.getElementById("deleteModal");if(!t)return;t.style.display="flex",this.deletingWidgetId=e.id;const i=document.getElementById("deleteClose");i&&(i.onclick=()=>t.style.display="none");const s=document.getElementById("cancelDeleteBtn");s&&(s.onclick=()=>t.style.display="none");const o=document.getElementById("confirmDeleteBtn");o&&!o._wired&&(o.addEventListener("click",()=>this.performDelete()),o._wired=!0)}async performDelete(){try{const e=this.deletingWidgetId;await P(e),this.widgets=this.widgets.filter(t=>t.id!==e),this.renderWidgets(),document.getElementById("deleteModal").style.display="none",this.showToast("Widget deleted","success")}catch(e){n.error("Delete failed",e),this.showToast("Delete failed","error")}}async showDownloadUrls(e){try{const i=(await M(e.id)).downloadUrls||[];if(i.length===0){this.showToast("No files available","info");return}const s=i.map(l=>`<div style="display:flex; justify-content:space-between; gap:8px; align-items:center; margin:6px 0"><span style="color:#a0a0a0">${l.fileName}</span><a class="quick-action-btn" href="${l.downloadURL}" target="_blank">Download</a></div>`).join(""),o=document.createElement("div");o.innerHTML=s;const r=document.createElement("div");r.className="toast info",r.appendChild(o),this.domElements.toastContainer.appendChild(r),setTimeout(()=>r.remove(),6e3)}catch(t){n.error("Failed to fetch URLs",t),this.showToast("Failed to fetch links","error")}}setupTimelineListener(){if(this.currentUser){n.log("Setting up timeline listener",{userId:this.currentUser.uid}),this.timelineUnsubscribe&&this.timelineUnsubscribe();try{const e=g(h(d,"notifications"),p("userId","==",this.currentUser.uid),y("timestamp","desc"),f(10));this.timelineUnsubscribe=B(e,t=>{this.renderTimeline(t.docs.map(i=>({id:i.id,...i.data()})))},t=>{n.error("Timeline listener error",t),this.renderTimeline([])})}catch(e){n.error("Failed to setup timeline listener",e),this.renderTimeline([])}}}renderTimeline(e){const{timelineSection:t}=this.domElements;if(t){if(e.length===0){t.innerHTML=`
        <div class="timeline-event">
          <div class="timeline-event-title">No recent activity</div>
          <div class="timeline-event-content">
            Your activity timeline will appear here as you create widgets and interact with the community.
          </div>
        </div>
      `;return}t.innerHTML="",e.forEach(i=>{const s=this.createTimelineEvent(i);t.appendChild(s)})}}createTimelineEvent(e){const t=document.createElement("div");t.className="timeline-event";const i=e.timestamp?.toDate?new Date(e.timestamp.toDate()).toLocaleString():"Just now";return t.innerHTML=`
      <div class="timeline-event-title">${e.title||"Activity"}</div>
      <div class="timeline-event-content">
        ${e.message||""}
        <div style="font-size: 0.8rem; color: #666; margin-top: 0.5rem;">${i}</div>
      </div>
    `,t}updateProfileStats(){if(!this.userProfile)return;const{widgetsCount:e,followersCount:t,viewsCount:i}=this.domElements;e&&(e.textContent=this.widgets.length||0),t&&(t.textContent=this.userProfile.followers?.length||0),i&&(i.textContent=this.userProfile.stats?.totalViews||0)}async handleLogin(){try{const e=this.domElements.loginEmail.value,t=this.domElements.loginPassword.value;if(!e||!t){this.showToast("Please fill in all fields","warning");return}n.log("Attempting login",{email:e}),this.setLoginButtonLoading(!0),await b(u,e,t),this.showToast("Login successful!","success"),this.clearLoginForm()}catch(e){n.error("Login failed",e),this.showToast(this.getAuthErrorMessage(e),"error")}finally{this.setLoginButtonLoading(!1)}}async handleSignup(){try{const e=this.domElements.signupEmail.value,t=this.domElements.signupPassword.value,i=this.domElements.signupDisplayName.value;if(!e||!t){this.showToast("Please fill in email and password","warning");return}if(t.length<6){this.showToast("Password must be at least 6 characters","warning");return}n.log("Attempting signup",{email:e}),this.setSignupButtonLoading(!0);const o=(await L(u,e,t)).user;n.log("User created successfully",{uid:o.uid}),i&&(await T(o,{displayName:i}),n.log("Display name updated",{displayName:i})),this.showToast("Account created successfully! Welcome to inQ!","success"),this.clearSignupForm(),setTimeout(()=>{this.showLoginForm()},2e3)}catch(e){n.error("Signup failed",e),this.showToast(this.getSignupErrorMessage(e),"error")}finally{this.setSignupButtonLoading(!1)}}showSignupForm(){n.log("Showing signup form"),this.domElements.loginFormContainer&&(this.domElements.loginFormContainer.style.display="none"),this.domElements.signupFormContainer&&(this.domElements.signupFormContainer.style.display="block"),this.domElements.showSignupBtn&&this.domElements.showSignupBtn.parentElement&&(this.domElements.showSignupBtn.parentElement.style.display="none"),this.domElements.showLoginBtn&&this.domElements.showLoginBtn.parentElement&&(this.domElements.showLoginBtn.parentElement.style.display="block")}showLoginForm(){n.log("Showing login form"),this.domElements.signupFormContainer&&(this.domElements.signupFormContainer.style.display="none"),this.domElements.loginFormContainer&&(this.domElements.loginFormContainer.style.display="block"),this.domElements.showLoginBtn&&this.domElements.showLoginBtn.parentElement&&(this.domElements.showLoginBtn.parentElement.style.display="none"),this.domElements.showSignupBtn&&this.domElements.showSignupBtn.parentElement&&(this.domElements.showSignupBtn.parentElement.style.display="block")}setLoginButtonLoading(e){const{loginBtn:t}=this.domElements;t&&(t.disabled=e,t.textContent=e?"Signing In...":"Sign In")}clearLoginForm(){this.domElements.loginEmail&&(this.domElements.loginEmail.value=""),this.domElements.loginPassword&&(this.domElements.loginPassword.value="")}setSignupButtonLoading(e){const{signupBtn:t}=this.domElements;t&&(t.disabled=e,t.textContent=e?"Creating Account...":"Create Account")}clearSignupForm(){this.domElements.signupEmail&&(this.domElements.signupEmail.value=""),this.domElements.signupPassword&&(this.domElements.signupPassword.value=""),this.domElements.signupDisplayName&&(this.domElements.signupDisplayName.value="")}getSignupErrorMessage(e){return{"auth/email-already-in-use":"An account with this email already exists.","auth/invalid-email":"Please enter a valid email address.","auth/weak-password":"Password is too weak. Please choose a stronger password.","auth/network-request-failed":"Network error. Please check your connection.","auth/too-many-requests":"Too many requests. Please try again later."}[e.code]||"Account creation failed. Please try again."}getAuthErrorMessage(e){return{"auth/user-not-found":"No account found with this email.","auth/wrong-password":"Incorrect password.","auth/invalid-email":"Invalid email address.","auth/user-disabled":"This account has been disabled.","auth/too-many-requests":"Too many failed attempts. Try again later."}[e.code]||"Login failed. Please try again."}refreshTimeline(){n.log("Refreshing timeline"),this.timelineUnsubscribe&&this.timelineUnsubscribe(),this.setupTimelineListener(),this.showToast("Timeline refreshed!","success")}openChatbot(){n.log("Opening chatbot modal");const e=document.getElementById("chatbotModal");e?(e.style.display="flex",this.showToast("AI Assistant opened!","info"),setTimeout(()=>{const t=document.getElementById("chatInput");t&&t.focus()},100)):(n.error("Chatbot modal not found"),this.showToast("AI Assistant not available","error"))}handleProfileLogin(){n.log("Handling profile login button click");const e=document.getElementById("authModal");e?(e.style.display="block",document.body.style.overflow="hidden"):this.showToast("Login system initializing...","info")}showToast(e,t="info"){const{toastContainer:i}=this.domElements;if(!i)return;const s=document.createElement("div");s.className=`toast ${t}`,s.innerHTML=`
      <div class="toast-icon">${this.getToastIcon(t)}</div>
      <div class="toast-content">
        <div class="toast-message">${e}</div>
      </div>
      <button class="toast-close">&times;</button>
    `,i.appendChild(s),setTimeout(()=>{s.parentNode&&s.parentNode.removeChild(s)},5e3),s.querySelector(".toast-close").addEventListener("click",()=>{s.parentNode&&s.parentNode.removeChild(s)})}getToastIcon(e){const t={success:"✅",error:"❌",warning:"⚠️",info:"ℹ️"};return t[e]||t.info}}document.addEventListener("DOMContentLoaded",()=>{n.log("DOM Content Loaded - Starting My Projects initialization");try{const a=new S;window.myProjectsManager=a,n.log("My Projects page ready")}catch(a){n.error("Failed to initialize My Projects",a)}});window.openChatbot=function(){window.myProjectsManager?window.myProjectsManager.openChatbot():console.warn("[MY PROJECTS] MyProjectsManager not found")};console.log("[CHATBOT] Chatbot module loaded");window.initializeChatbot=function(){console.log("[CHATBOT] initializeChatbot called")};
