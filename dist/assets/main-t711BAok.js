const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./auth-BVr2Pxz_.js","./timeline-manager-Dc3qpIy7.js","./firebase-core-BO8UvLyb.js","./cloud-upload-B4hV8L3F.js","./navigation-CiQvIeE9.js","./widget-upload-BclOXes8.js"])))=>i.map(i=>d[i]);
import"./modulepreload-polyfill-B5Qt9EMX.js";/* empty css              */import{_ as m}from"./timeline-manager-Dc3qpIy7.js";import{auth as z,db as E}from"./firebase-core-BO8UvLyb.js";import{getDoc as P,doc as T,collection as U,query as O,where as R,getDocs as B,deleteDoc as x,updateDoc as F,arrayRemove as V,serverTimestamp as G}from"https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js";import"https://www.gstatic.com/firebasejs/11.10.0/firebase-storage.js";import{p as $}from"./cloud-upload-B4hV8L3F.js";import"./widget-upload-BclOXes8.js";import"./profile_banner-Eu8vPd6E.js";import"https://www.gstatic.com/firebasejs/11.10.0/firebase-auth.js";import"https://www.gstatic.com/firebasejs/11.10.0/firebase-app.js";import"https://www.gstatic.com/firebasejs/11.10.0/firebase-analytics.js";import"https://www.gstatic.com/firebasejs/11.10.0/firebase-functions.js";console.log("[MAIN] Starting application initialization...");class j{constructor(){this.state={initialized:!1,modules:{auth:null,social:null,profileHub:null,navigation:null,ui:null},user:{isAuthenticated:!1,profile:null,preferences:{}},ui:{theme:"auto",sidebarOpen:!1,modals:{auth:!1,profile:!1,notifications:!1}},performance:{loadTime:Date.now(),moduleLoadTimes:{},functionCallCount:0}},this.eventListeners=new Map,this.debugMode=!0,console.log("[MAIN] AppStateManager initialized")}log(t,e=null){this.debugMode&&(this.state.performance.functionCallCount++,console.log(`[MAIN] ${t}`,e||""))}setState(t,e="unknown"){this.log(`State update from ${e}:`,t),this.state=this.deepMerge(this.state,t),this.emit("state-changed",{state:this.state,updates:t,source:e})}deepMerge(t,e){const i={...t};for(const o in e)e[o]&&typeof e[o]=="object"&&!Array.isArray(e[o])?i[o]=this.deepMerge(i[o]||{},e[o]):i[o]=e[o];return i}emit(t,e){this.log(`Emitting event: ${t}`,e);const i=new CustomEvent(`app-${t}`,{detail:e});window.dispatchEvent(i)}addEventListener(t,e){const i=o=>e(o.detail);window.addEventListener(`app-${t}`,i),this.eventListeners.set(t,i)}trackFunctionCall(t,e){this.state.performance.moduleLoadTimes[t]||(this.state.performance.moduleLoadTimes[t]=[]),this.state.performance.moduleLoadTimes[t].push(e)}getPerformanceMetrics(){return{totalLoadTime:Date.now()-this.state.performance.loadTime,functionCallCount:this.state.performance.functionCallCount,moduleLoadTimes:this.state.performance.moduleLoadTimes,memoryUsage:performance.memory?{used:Math.round(performance.memory.usedJSHeapSize/1024/1024),total:Math.round(performance.memory.totalJSHeapSize/1024/1024)}:null}}}class Y{constructor(t){this.appState=t,this.modules=new Map,this.loadingPromises=new Map,this.log("ModuleOrchestrator initialized")}log(t,e=null){this.appState.log(`[ORCHESTRATOR] ${t}`,e)}async loadModule(t,e){if(this.modules.has(t))return this.log(`Module ${t} already loaded`),this.modules.get(t);if(this.loadingPromises.has(t))return this.log(`Module ${t} is already loading`),this.loadingPromises.get(t);const i=Date.now();this.log(`Loading module: ${t}`);const o=this.loadModuleWithRetry(t,e,3);this.loadingPromises.set(t,o);try{const a=await o,s=Date.now()-i;return this.modules.set(t,a),this.loadingPromises.delete(t),this.appState.trackFunctionCall(`load-${t}`,s),this.log(`Module ${t} loaded successfully in ${s}ms`),a}catch(a){throw this.loadingPromises.delete(t),this.log(`Failed to load module ${t}:`,a),a}}async loadModuleWithRetry(t,e,i){let o;for(let a=1;a<=i;a++)try{return await e()}catch(s){o=s,this.log(`Module ${t} load attempt ${a} failed:`,s),a<i&&await new Promise(n=>setTimeout(n,1e3*a))}throw new Error(`Failed to load module ${t} after ${i} attempts: ${o.message}`)}getModule(t){return this.modules.get(t)||null}async initializeCoreModules(){this.log("Initializing core modules...");const t=[["firebase-core",()=>m(()=>import("./firebase-core-BO8UvLyb.js"),[],import.meta.url)],["auth",()=>m(()=>import("./auth-BVr2Pxz_.js"),__vite__mapDeps([0,1,2,3]),import.meta.url)],["social",()=>m(()=>Promise.resolve().then(()=>Z),void 0,import.meta.url)],["profile-hub",()=>m(()=>import("./profile_banner-Eu8vPd6E.js"),[],import.meta.url)],["navigation",()=>m(()=>import("./navigation-CiQvIeE9.js"),__vite__mapDeps([4,2]),import.meta.url)]],e=t.map(([o,a])=>this.loadModule(o,a).catch(s=>(this.log(`Warning: Failed to load ${o}:`,s),null)));(await Promise.allSettled(e)).forEach((o,a)=>{const[s]=t[a];o.status==="fulfilled"&&o.value?this.log(`Core module ${s} ready`):this.log(`Core module ${s} failed to load`)}),this.log("Core modules initialization complete")}}class J{constructor(){this.appState=new j,this.orchestrator=new Y(this.appState),this.initializationSteps=[],this.log("ApplicationInitializer created")}log(t,e=null){this.appState.log(`[INIT] ${t}`,e)}addStep(t,e,i=[]){this.initializationSteps.push({name:t,function:e,dependencies:i,completed:!1})}async executeInitializationSteps(){this.log("Executing initialization steps...");const t=new Set;let e=!0;for(;e&&t.size<this.initializationSteps.length;){e=!1;for(const o of this.initializationSteps){if(o.completed||t.has(o.name))continue;if(o.dependencies.every(s=>t.has(s)))try{this.log(`Executing step: ${o.name}`),await o.function(),o.completed=!0,t.add(o.name),e=!0,this.log(`Step completed: ${o.name}`)}catch(s){this.log(`Step failed: ${o.name}`,s)}}}const i=this.initializationSteps.filter(o=>!o.completed);i.length>0&&this.log(`Warning: ${i.length} steps failed:`,i.map(o=>o.name)),this.log(`Initialization complete. ${t.size}/${this.initializationSteps.length} steps successful`)}setupInitializationSteps(){this.addStep("dom-ready",async()=>{document.readyState==="loading"&&await new Promise(t=>document.addEventListener("DOMContentLoaded",t)),this.log("DOM is ready")}),this.addStep("load-modules",async()=>{await this.orchestrator.initializeCoreModules()},["dom-ready"]),this.addStep("init-auth",async()=>{this.orchestrator.getModule("auth")&&window.socialAuth?(await window.socialAuth.init(),this.log("Auth system initialized")):this.log("Auth module not available")},["load-modules"]),this.addStep("init-social",async()=>{this.orchestrator.getModule("social")&&window.socialFeatures?(await window.socialFeatures.init(),this.log("Social features initialized")):this.log("Social module not available")},["init-auth"]),this.addStep("init-profile-hub",async()=>{window.profileHubManager?this.log("ProfileHub is available"):this.log("ProfileHub not yet available, will retry")},["init-auth"]),this.addStep("setup-global-handlers",async()=>{this.setupGlobalEventHandlers()},["init-auth","init-social"]),this.addStep("init-ui",async()=>{await this.initializeUIComponents()},["setup-global-handlers"]),this.addStep("finalize",async()=>{this.finalizeApplication()},["init-ui"])}setupGlobalEventHandlers(){this.log("Setting up global event handlers..."),this.appState.addEventListener("state-changed",t=>{t.updates.user&&this.handleUserStateChange(t.updates.user)}),window.addEventListener("auth-state-changed",t=>{this.log("Auth state change received:",t.detail),this.appState.setState({user:{isAuthenticated:t.detail.isAuthenticated,profile:t.detail.profile}},"auth-system")}),window.addEventListener("social-action",t=>{this.log("Social action received:",t.detail),this.handleSocialAction(t.detail)}),window.addEventListener("profilehub-state-changed",t=>{this.log("ProfileHub state change received:",t.detail),this.handleProfileHubStateChange(t.detail)}),this.log("Global event handlers set up")}handleUserStateChange(t){this.log("Handling user state change:",t),this.updateAuthUI(t.isAuthenticated),window.profileHubManager&&t.profile&&window.profileHubManager.handleAuthStateChange(t.isAuthenticated?{uid:"user"}:null,t.profile)}handleSocialAction(t){this.log("Handling social action:",t),this.appState.setState({performance:{socialActions:(this.appState.state.performance.socialActions||0)+1}},"social-action")}handleProfileHubStateChange(t){this.log("Handling ProfileHub state change:",t),this.appState.setState({ui:{modals:{profile:t.state?.ui?.hubState==="expanded"}}},"profile-hub")}updateAuthUI(t){this.log("Updating auth UI:",t);const e=document.getElementById("sidebarLoginBtn");e&&(e.style.display=t?"none":"block");const i=document.getElementById("sidebarUserActions");i&&(i.style.display=t?"block":"none"),document.querySelectorAll(".profile-element").forEach(a=>{a.style.display=t?"block":"none"})}async initializeUIComponents(){this.log("Initializing UI components..."),this.orchestrator.getModule("navigation")&&window.navigationManager&&await window.navigationManager.init(),this.setupMobileOptimizations(),this.setupThemeHandling(),this.log("UI components initialized")}setupMobileOptimizations(){this.log("Setting up mobile optimizations..."),document.addEventListener("touchstart",e=>{e.target.classList.add("touch-active")},{passive:!0}),document.addEventListener("touchend",e=>{e.target.classList.remove("touch-active")},{passive:!0}),document.querySelectorAll("input, textarea, select").forEach(e=>{e.addEventListener("focus",()=>{const i=document.querySelector('meta[name="viewport"]');i&&(i.content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no")})}),this.log("Mobile optimizations set up")}setupThemeHandling(){this.log("Setting up theme handling...");const t=window.matchMedia("(prefers-color-scheme: dark)").matches,i=localStorage.getItem("app-theme")||(t?"dark":"light");this.appState.setState({ui:{theme:i}},"theme-detection"),document.documentElement.setAttribute("data-theme",i),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",o=>{if(!localStorage.getItem("app-theme")){const a=o.matches?"dark":"light";this.appState.setState({ui:{theme:a}},"theme-change"),document.documentElement.setAttribute("data-theme",a)}}),this.log("Theme handling set up")}finalizeApplication(){this.log("Finalizing application initialization..."),this.appState.setState({initialized:!0},"finalization"),this.setupPerformanceMonitoring(),this.setupErrorHandling();const t=this.appState.getPerformanceMetrics();this.log("Application initialization complete",t),this.appState.emit("app-ready",{state:this.appState.state,metrics:t}),this.log("Application ready!")}setupPerformanceMonitoring(){this.log("Setting up performance monitoring..."),setInterval(()=>{if(performance.memory){const t=performance.memory.usedJSHeapSize/1024/1024;t>50&&this.log(`High memory usage: ${t.toFixed(2)}MB`)}},3e4),setInterval(()=>{const t=this.appState.state.performance.functionCallCount;this.log(`Function call count: ${t}`)},6e4)}setupErrorHandling(){this.log("Setting up error handling..."),window.addEventListener("error",t=>{this.log("Global error caught:",t.error),this.appState.emit("app-error",{error:t.error,filename:t.filename,lineno:t.lineno})}),window.addEventListener("unhandledrejection",t=>{this.log("Unhandled promise rejection:",t.reason),this.appState.emit("app-error",{error:t.reason,type:"unhandled-rejection"})})}getAppState(){return this.appState.state}getPerformanceMetrics(){return this.appState.getPerformanceMetrics()}async init(){this.log("Starting application initialization...");try{return this.setupInitializationSteps(),await this.executeInitializationSteps(),this.log("Application initialization successful"),!0}catch(t){return this.log("Application initialization failed:",t),this.appState.emit("app-error",{error:t,type:"initialization-failure"}),!1}}}let D=null;async function W(){console.log("[MAIN] Initializing application...");try{D=new J,await D.init()?(console.log("[MAIN] Application initialized successfully"),window.app=D,window.getAppState=()=>D.getAppState(),window.getPerformanceMetrics=()=>D.getPerformanceMetrics(),window.debugApp=()=>{console.log("App State:",D.getAppState()),console.log("Performance:",D.getPerformanceMetrics())},window.debugAuthState=()=>{console.log("=== AUTH STATE DEBUG ==="),console.log("SocialAuth:",window.socialAuth?.currentUser?.uid||"Not authenticated"),console.log("SocialFeatures:",window.socialFeatures?.currentUser?.uid||"Not authenticated"),console.log("ProfileHub:",window.profileHubManager?.state?.user?.isAuthenticated||!1),console.log("App State User:",D.getAppState().user)},window.debugModuleStatus=()=>{console.log("=== MODULE STATUS DEBUG ==="),console.log("Auth Module:",!!window.socialAuth),console.log("Social Module:",!!window.socialFeatures),console.log("ProfileHub:",!!window.profileHubManager),console.log("Navigation:",!!window.navigationManager),console.log("Firebase Core:",!!window.firebase)},window.debugIntegration=()=>{console.log("=== INTEGRATION DEBUG ==="),console.log("Auth State Listeners:",{auth:window.socialAuth?.authListenerSetUp||!1,social:"Listening via events",profileHub:"Listening via events"}),console.log("Event System:",{authEvents:"auth-state-changed",socialEvents:"social-action",profileHubEvents:"profilehub-state-changed",appEvents:"app-ready, app-error, app-state-changed"})}):console.error("[MAIN] Application initialization failed")}catch(c){console.error("[MAIN] Critical error during initialization:",c)}}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",W):W();console.log("[MAIN] Main.js loaded successfully");const l={log:(c,t=null)=>{console.log(`[FLOATING ORB] ${c}`,t||"")},error:(c,t=null)=>{console.error(`[FLOATING ORB ERROR] ${c}`,t||"")},warn:(c,t=null)=>{console.warn(`[FLOATING ORB WARN] ${c}`,t||"")}};class X{constructor(t={}){this.options={debugMode:!1,enableSounds:!0,useThreeJS:!0,threeJsCdn:"https://unpkg.com/three@0.160.0/build/three.module.js",...t},this.container=null,this.orb=null,this.isInitialized=!1,this.chatDock=null,this.activeTab="dms",this.chatBadges={dms:0,ai:0,space:0},l.log("Floating Orb Manager initialized",this.options)}async init(){if(this.isInitialized){l.warn("Orb already initialized");return}try{await this.createOrb(),this.setupEventListeners(),this.adjustSidebarSpacing(),this.bindProfileHubEvents(),this.isInitialized=!0,l.log("Floating orb system initialized successfully"),window.innerWidth<=768&&l.log("Mobile layout detected - orb positioned in center-right area"),this.options.debugMode&&this.addDemoFeatures()}catch(t){l.error("Failed to initialize floating orb",t)}}bindProfileHubEvents(){try{if(this._hubBound)return;this._hubBound=!0;const t=(i,o)=>{if(!i)return;const a=i.ui?.hubState==="chatbot-active",s=!!i.chatbot?.isTyping;this.container&&(this.container.setAttribute("data-chatbot",a?"active":"inactive"),this.container.setAttribute("data-typing",s?"true":"false")),this.orb&&(this.orb.classList.toggle("chat-active",a),this.orb.classList.toggle("typing",s)),o?.chatbot?.messages&&this.orb&&(this.orb.classList.add("message-ping"),setTimeout(()=>this.orb&&this.orb.classList.remove("message-ping"),380))},e=window.profileHubManager?.state;e&&(l.log("Syncing orb with existing ProfileHub state"),t(e,null)),window.addEventListener("profilehub-state-changed",i=>{const{state:o,changes:a}=i.detail||{};l.log("ProfileHub state changed detected by orb",{hubState:o?.ui?.hubState,typing:o?.chatbot?.isTyping}),t(o,a)}),l.log("Floating orb bound to ProfileHub events")}catch(t){l.warn("Failed to bind ProfileHub events",t)}}async createOrb(){this.container=document.createElement("div"),this.container.className="floating-orb-wrapper",this.container.setAttribute("data-debug",this.options.debugMode),this.stage=document.createElement("div"),this.stage.style.position="absolute",this.stage.style.top="50%",this.stage.style.left="50%",this.stage.style.transform="translate(-50%, -50%)",this.stage.style.width="var(--orbit-size)",this.stage.style.height="var(--orbit-size)",this.scrollLine=document.createElement("div"),this.scrollLine.className="orb-scroll-line",this.scrollState={currentRotation:0,targetRotation:0,lockPoints:[0,60,120,180,240,300],isLocked:!1,sensitivity:.5},l.log("Orb scroll system initialized with lock points"),this.orb=document.createElement("div"),this.orb.className="floating-orb",this.orb.title="Chat Center - Click to expand",this.navContainer=document.createElement("div"),this.navContainer.className="orb-nav-container rotating",this.tooltip=document.createElement("div"),this.tooltip.className="orb-usage-tooltip",this.tooltip.setAttribute("role","status"),this.tooltip.setAttribute("aria-live","polite"),this.tooltip.textContent="Scroll or drag to rotate ‚Ä¢ Release to snap",this.stage.appendChild(this.scrollLine),this.stage.appendChild(this.navContainer),this.stage.appendChild(this.orb),this.container.appendChild(this.stage),this.container.appendChild(this.tooltip),document.body.appendChild(this.container),l.log("Orb DOM structure created"),this.updateDockingPosition(),window.addEventListener("resize",()=>this.updateDockingPosition(),{passive:!0});try{window.dispatchEvent(new CustomEvent("floating-orb:ready",{detail:{container:this.container,orb:this.orb,orbit:this.orbit,popup:this.popup}})),l.log("Dispatched floating-orb:ready event")}catch(t){l.warn("Failed to dispatch floating-orb:ready event",t)}this.options.useThreeJS&&this.tryInitThreeJS().catch(t=>{l.warn("Three.js enhancement unavailable; using CSS orb only",t)}),this.buildOrbNavigation(),this.startRingOrbit(),this.setupScrollSystem(),this.createChatDock(),this.createInputBar();try{localStorage.getItem("orb_tooltip_seen")||(this.showToolTip(),localStorage.setItem("orb_tooltip_seen","1"))}catch{}}showToolTip(){this.tooltip&&(this.tooltip.classList.add("show"),clearTimeout(this._tooltipTimer),this._tooltipTimer=setTimeout(()=>{this.tooltip&&this.tooltip.classList.remove("show")},3200))}updateDockingPosition(){const t=document.getElementById("title-container")||document.querySelector(".title-main-container"),e=document.getElementById("home-subtitle");t?(this.container.parentElement!==t&&(e&&t.contains(e)?t.insertBefore(this.container,e):t.appendChild(this.container),l.log("Orb docked inline under title container")),this.container.classList.add("inline-under-title"),this.container.classList.remove("mobile-under-title"),this.container.style.top="",this.container.style.left="",this.container.style.transform=""):(this.container.parentElement!==document.body&&document.body.appendChild(this.container),this.container.classList.remove("inline-under-title"),this.container.classList.remove("mobile-under-title"))}buildOrbNavigation(){try{const t=[{id:"nav-home",icon:"üè†",title:"Home",onClick:()=>this.navigateToSection("home-section")},{id:"nav-guides",icon:"üìö",title:"Guides",onClick:()=>this.navigateToSection("guides-section")},{id:"nav-showcase",icon:"üèÜ",title:"Showcase",onClick:()=>this.navigateToSection("showcase-section")},{id:"nav-tools",icon:"üõ†Ô∏è",title:"Tools",onClick:()=>this.navigateToSection("tools-section")},{id:"nav-projects",icon:"üöÄ",title:"Projects",onClick:()=>this.navigateToSection("projects-section")},{id:"nav-chat",icon:"üí¨",title:"Chatbot",onClick:()=>this.toggleChatDock(),badge:0}];this.navContainer.innerHTML="";const e=360/t.length;t.forEach((i,o)=>{const a=document.createElement("button");a.type="button",a.className="orb-nav-item",a.setAttribute("title",i.title),a.style.setProperty("--angle",`${o*e}deg`),a.innerText=i.icon,i.badge!==void 0&&(a.setAttribute("data-badge",i.badge),this.updateNavBadge(i.id,i.badge)),a.addEventListener("click",s=>{s.stopPropagation(),i.onClick?.()}),this.navContainer.appendChild(a)}),l.log("Orb navigation constructed",{count:t.length})}catch(t){l.warn("Failed to build orb navigation",t)}}navigateToSection(t){try{const e=document.getElementById(t);if(!e)return;e.style.display="block";const i=document.getElementById("mobileDrawer");i?.classList?.contains("active")&&i.classList.remove("active"),e.scrollIntoView({behavior:"smooth",block:"start"}),l.log("Navigated to section via orb",{sectionId:t})}catch{}}startRingOrbit(){try{const t=Array.from(this.navContainer?.children||[]);if(!t.length)return;const e=Math.PI*2,i=()=>{const o=this.scrollState.currentRotation*Math.PI/180,s=(this.navContainer.getBoundingClientRect().width||180)/2.3,n=.3;t.forEach((r,d)=>{const g=e*d/t.length+o,p=Math.cos(g)*s,u=Math.sin(g)*s*n;Math.cos(g)>0?r.classList.add("in-front"):r.classList.remove("in-front"),r.style.setProperty("--x",`${p}px`),r.style.setProperty("--y",`${u}px`)}),this._ringFrame=requestAnimationFrame(i)};this._ringFrame&&cancelAnimationFrame(this._ringFrame),this._ringFrame=requestAnimationFrame(i),l.log("Saturn ring orbit started with scroll control"),window.addEventListener("resize",()=>{this._ringFrame&&(cancelAnimationFrame(this._ringFrame),this._ringFrame=null),this.startRingOrbit()},{passive:!0})}catch(t){l.warn("Failed to start ring orbit",t)}}setupScrollSystem(){try{let t,e=!1,i=0;l.log("Setting up orb scroll system with lock points");const o=()=>{const r=this.scrollState.targetRotation-this.scrollState.currentRotation;Math.abs(r)>.1&&(this.scrollState.currentRotation+=r*.15,this.scrollLine.style.setProperty("--scroll-rotation",`${this.scrollState.currentRotation}deg`),requestAnimationFrame(o))},a=r=>{const d=Date.now();d-i<16||(i=d,this.scrollState.targetRotation+=r*this.scrollState.sensitivity,clearTimeout(t),o(),t=setTimeout(()=>{this.snapToNearestLockPoint()},150))};this.container.addEventListener("wheel",r=>{r.preventDefault(),a(r.deltaY),this.scrollLine.style.opacity="1",clearTimeout(this._scrollLineTimeout),this._scrollLineTimeout=setTimeout(()=>{this.scrollLine.style.opacity="0.3"},2e3)},{passive:!1});let s=0,n=0;this.container.addEventListener("touchstart",r=>{r.touches.length===1&&(e=!0,s=r.touches[0].clientY,n=this.scrollState.currentRotation,this.scrollLine.style.opacity="1")},{passive:!0}),this.container.addEventListener("touchmove",r=>{if(e&&r.touches.length===1){r.preventDefault();const d=(s-r.touches[0].clientY)*2;this.scrollState.targetRotation=n+d,o()}},{passive:!1}),this.container.addEventListener("touchend",()=>{e&&(e=!1,setTimeout(()=>this.snapToNearestLockPoint(),100),setTimeout(()=>{this.scrollLine.style.opacity="0.3"},1500))},{passive:!0}),this.scrollLine.style.opacity="0.3",l.log("Scroll system initialized with lock points:",this.scrollState.lockPoints)}catch(t){l.warn("Failed to setup scroll system",t)}}snapToNearestLockPoint(){try{let t=this.scrollState.targetRotation%360;t<0&&(t+=360);let e=this.scrollState.lockPoints[0],i=Math.abs(t-e);for(const a of this.scrollState.lockPoints){const s=Math.min(Math.abs(t-a),Math.abs(t-a-360),Math.abs(t-a+360));s<i&&(i=s,e=a)}const o=Math.floor(this.scrollState.targetRotation/360)*360+e;this.scrollState.targetRotation=o,this.scrollState.isLocked=!0,this.container&&(this.container.classList.add("lock-snap"),setTimeout(()=>{this.container&&this.container.classList.remove("lock-snap")},200)),l.log("Snapped to lock point:",e)}catch(t){l.warn("Failed to snap to lock point",t)}}async tryInitThreeJS(){if(window.__orbThree)return l.log("Three.js already loaded, reusing module"),this.initThreeScene(window.__orbThree);try{l.log("Loading Three.js from CDN",{url:this.options.threeJsCdn});const t=await import(this.options.threeJsCdn);window.__orbThree=t,l.log("Three.js CDN module loaded successfully"),await this.initThreeScene(t)}catch(t){throw l.error("Failed to load Three.js from CDN",t),t}}async initThreeScene(t){l.log("Initializing Three.js scene");const e=document.createElement("div");e.className="orb-3d-layer",this.container.appendChild(e),l.log("WebGL layer created and added to container");const i=e.clientWidth||200,o=e.clientHeight||200,a=new t.WebGLRenderer({antialias:!0,alpha:!0});e.appendChild(a.domElement);const s=new t.Scene,n=new t.PerspectiveCamera(45,i/o,.1,100);n.position.z=3.2;const r=()=>{const y=e.clientWidth||parseInt(getComputedStyle(e).width),k=e.clientHeight||parseInt(getComputedStyle(e).height),_=Math.min(window.devicePixelRatio||1,2);a.setPixelRatio(_),a.setSize(y,k,!1),n.aspect=y/k,n.updateProjectionMatrix()};r(),new ResizeObserver(r).observe(e),window.addEventListener("resize",r);const d=new t.SphereGeometry(1,64,64),h=document.createElement("canvas");h.width=256,h.height=256;const g=h.getContext("2d"),p=g.createImageData(256,256),u=p.data;for(let y=0;y<u.length;y+=4){const k=y/4%256,_=Math.floor(y/4/256),A=Math.sin(k*.1)*Math.cos(_*.1),q=Math.sin(k*.05+_*.03)*Math.cos(k*.03-_*.05),I=(A+q)*.5+.5,Q=(A-q)*.5+.5;u[y]=I*255,u[y+1]=Q*255,u[y+2]=255,u[y+3]=255}g.putImageData(p,0,0);const w=new t.CanvasTexture(h);w.wrapS=w.wrapT=t.RepeatWrapping;const v=new t.MeshStandardMaterial({color:3470847,roughness:.15,metalness:.8,emissive:848127,emissiveIntensity:.3,transparent:!0,opacity:.9,normalMap:w,normalScale:new t.Vector2(.3,.3),envMapIntensity:1.2}),b=new t.Mesh(d,v);s.add(b);const f=new t.AmbientLight(6750207,.6);s.add(f);const S=new t.PointLight(8956671,1.5);S.position.set(2,2,2),s.add(S);const L=new t.Clock,C=()=>{const y=L.getElapsedTime();b.rotation.y=y*.4,b.rotation.x=Math.sin(y*.6)*.15,a.render(s,n),requestAnimationFrame(C)};C(),l.log("Three.js orb enhancement initialized"),this.webglLayer=e,this.threeRenderer=a,this.threeScene=s,this.threeSphere=b}setupEventListeners(){this.orb.addEventListener("click",t=>{t.preventDefault(),this.openChatDock(),l.log("Orb clicked - opening chat dock")}),this.orb.addEventListener("keydown",t=>{(t.key==="Enter"||t.key===" ")&&(t.preventDefault(),this.openChatDock())}),this.orb.setAttribute("tabindex","0"),this.orb.setAttribute("role","button"),this.orb.setAttribute("aria-label","Chat Center"),l.log("Event listeners set up")}adjustSidebarSpacing(){l.log("Orb floating mode - no layout adjustments needed")}escapeHtml(t){const e=document.createElement("div");return e.textContent=t,e.innerHTML}createChatDock(){try{this.chatDock=document.createElement("div"),this.chatDock.className="chat-dock",this.chatDock.innerHTML=`
        <div class="dock-tabs">
          <button class="dock-tab active" data-tab="dms">DMs</button>
          <button class="dock-tab" data-tab="ai">AI</button>
          <button class="dock-tab" data-tab="space">Space</button>
        </div>
        <div class="dock-body">
          <div class="dock-list">
            <div class="list-item active">General</div>
            <div class="list-item">Development</div>
            <div class="list-item">Design</div>
          </div>
          <div class="dock-thread">
            <div class="dock-msg me">Hello there!</div>
            <div class="dock-msg bot">Hi! How can I help you today?</div>
          </div>
        </div>
      `,this.container.appendChild(this.chatDock),this.chatDock.querySelectorAll(".dock-tab").forEach(t=>{t.addEventListener("click",e=>{this.switchTab(e.target.dataset.tab)})}),document.addEventListener("click",t=>{!this.chatDock.contains(t.target)&&!this.inputBar.contains(t.target)&&this.closeChatDock()}),l.log("Chat dock created successfully")}catch(t){l.warn("Failed to create chat dock",t)}}createInputBar(){try{this.inputBar=document.createElement("div"),this.inputBar.className="orb-input-wrap",this.inputBar.innerHTML=`
        <div class="orb-input">
          <input type="text" placeholder="Send a DM...">
          <button class="send-btn">Send</button>
        </div>
      `,this.container.appendChild(this.inputBar);const t=this.inputBar.querySelector("input"),e=this.inputBar.querySelector(".send-btn"),i=()=>{const o=t.value.trim();o&&(this.sendMessageToActiveTab(o),t.value="",this.openChatDock())};e.addEventListener("click",i),t.addEventListener("keypress",o=>{o.key==="Enter"&&i()}),t.addEventListener("focus",()=>{this.openChatDock(),l.log("Input focused - opening chat dock")}),l.log("Input bar created successfully")}catch(t){l.warn("Failed to create input bar",t)}}toggleChatDock(){if(!this.chatDock)return;const t=this.chatDock.classList.contains("open");t?this.closeChatDock():this.openChatDock(),l.log("Chat dock toggled",{isOpen:!t})}openChatDock(){this.chatDock&&(this.chatDock.classList.add("open"),document.body.classList.add("chat-dock-open"),this.updateInputBarPlaceholder(),this.inputBar.classList.add("dock-triggered"),l.log("Chat dock opened smoothly"))}closeChatDock(){this.chatDock&&(this.chatDock.classList.remove("open"),document.body.classList.remove("chat-dock-open"),this.inputBar.classList.remove("dock-triggered"),l.log("Chat dock closed smoothly"))}updateInputBarPlaceholder(){if(!this.inputBar)return;const t=this.inputBar.querySelector("input"),e={dms:"Send a DM...",ai:"Ask AI anything...",space:"Post to Space..."};t.placeholder=e[this.activeTab]||"Type a message..."}switchTab(t){this.activeTab=t,this.chatDock.querySelectorAll(".dock-tab").forEach(e=>{e.classList.toggle("active",e.dataset.tab===t)}),this.updateInputBarPlaceholder(),l.log("Switched to tab",{tabName:t})}sendMessageToActiveTab(t){if(l.log("Sending message to active tab",{tab:this.activeTab,message:t}),this.chatDock){const e=this.chatDock.querySelector(".dock-thread"),i=document.createElement("div");i.className="dock-msg me",i.textContent=t,e.appendChild(i),e.scrollTop=e.scrollHeight}}updateNavBadge(t,e){const i=this.navContainer.querySelector("[data-badge]");i&&(i.setAttribute("data-badge",e),i.style.display=e>0?"block":"none")}updateChatBadges(t){this.chatBadges={...this.chatBadges,...t};const e=Object.values(this.chatBadges).reduce((i,o)=>i+o,0);this.updateNavBadge("nav-chat",e),l.log("Chat badges updated",{badges:this.chatBadges,total:e})}createStarNotification(t,e="info"){try{const i=this.container.querySelector(".orb-star-layer")||this.createStarLayer(),o=document.createElement("div");o.className="orb-star",o.innerHTML="‚≠ê",o.title=t;const a=Math.random()*360,s=this.getOrbitRadius(),n=Math.cos(a*Math.PI/180)*s,r=Math.sin(a*Math.PI/180)*s*.3;o.style.setProperty("--x",`${n}px`),o.style.setProperty("--y",`${r}px`),i.appendChild(o),setTimeout(()=>{o.parentNode&&o.parentNode.removeChild(o)},5e3),l.log("Star notification created",{message:t,type:e})}catch(i){l.warn("Failed to create star notification",i)}}createStarLayer(){const t=document.createElement("div");return t.className="orb-star-layer",this.container.appendChild(t),t}getOrbitRadius(){return parseInt(getComputedStyle(document.documentElement).getPropertyValue("--orbit-size"))/2.25}addDemoFeatures(){setTimeout(()=>{this.createStarNotification("New message from Sarah","dm")},2e3),setTimeout(()=>{this.createStarNotification("AI response ready","ai")},4e3),setTimeout(()=>{this.createStarNotification("Space activity detected","space")},6e3),setTimeout(()=>{this.updateChatBadges({dms:2,ai:1,space:3})},3e3)}clear(){this.updateChatBadges({dms:0,ai:0,space:0}),l.log("All chat badges cleared")}addChatMessage(t,e,i="bot"){if(this.chatDock){const o=this.chatDock.querySelector(".dock-thread"),a=document.createElement("div");if(a.className=`dock-msg ${i}`,a.textContent=e,o.appendChild(a),o.scrollTop=o.scrollHeight,i!=="me"){const s={...this.chatBadges};s[t]=(s[t]||0)+1,this.updateChatBadges(s)}}}showStarNotification(t,e="info"){this.createStarNotification(t,e)}updateBadges(t){this.updateChatBadges(t)}destroy(){this.container&&this.container.parentNode&&this.container.parentNode.removeChild(this.container),this.chatDock&&this.chatDock.parentNode&&this.chatDock.parentNode.removeChild(this.chatDock);const t=document.querySelector(".sidebar-nav");t&&(t.style.paddingLeft=""),this.isInitialized=!1,l.log("Floating orb destroyed")}}document.addEventListener("DOMContentLoaded",()=>{window.floatingOrb=new X({debugMode:!0}),window.floatingOrb.init(),l.log("Floating orb system loaded and ready!")});(()=>{const c=(...o)=>console.debug("[Orb3D]",...o);let t=!1;const e=()=>{if(t)return;const o=document.querySelector(".floating-orb-wrapper"),a=document.querySelector(".floating-orb"),s=document.querySelector(".notification-popup");if(!o||!a){c("Orb not yet in DOM. Will wait for ready event/observer.");return}t=!0,c("Initializing 3D tilt controller");let n=0,r=0,d=0,h=0,g=null;const p=(f,S,L)=>Math.min(L,Math.max(S,f)),u=f=>{a&&(f?a.classList.add("idle"):a.classList.remove("idle"))},w=(f,S)=>{const L=o.getBoundingClientRect(),C=L.left+L.width/2,y=L.top+L.height/2,k=f-C,_=S-y,A=p(k/(L.width/2),-1,1),q=p(_/(L.height/2),-1,1),I=10;r=A*I,n=-q*I},v=()=>{const S=n-d,L=r-h;d+=S*.12,h+=L*.12,a.style.transform=`translate(-50%,-50%) rotateX(${d.toFixed(2)}deg) rotateY(${h.toFixed(2)}deg)`,requestAnimationFrame(v)},b=f=>{u(!1),f.touches&&f.touches[0]?w(f.touches[0].clientX,f.touches[0].clientY):w(f.clientX,f.clientY),clearTimeout(g),g=setTimeout(()=>u(!0),2200)};window.addEventListener("pointermove",b,{passive:!0}),window.addEventListener("touchmove",b,{passive:!0}),a.addEventListener("click",()=>{s&&s.classList.toggle("show")}),u(!0),requestAnimationFrame(v),c("3D tilt engaged. Try moving your pointer around.")};document.querySelector(".floating-orb")&&e(),window.addEventListener("floating-orb:ready",()=>{c("Received floating-orb:ready"),e()});const i=new MutationObserver(()=>{document.querySelector(".floating-orb")&&(c("Observer detected orb in DOM"),e(),i.disconnect())});document.body?i.observe(document.body,{childList:!0,subtree:!0}):window.addEventListener("DOMContentLoaded",()=>{i.observe(document.body,{childList:!0,subtree:!0})})})();window.debugOrb={checkStatus:()=>{const c=document.querySelector(".floating-orb"),t=document.querySelector(".floating-orb-wrapper"),e=document.querySelector(".orb-3d-layer"),i=e?.querySelector("canvas"),o=document.querySelector(".chat-dock"),a=document.querySelector(".orb-input-wrap");console.log("[ORB DEBUG] Status check:",{orb:!!c,wrapper:!!t,webglLayer:!!e,canvas:!!i,canvasSize:i?`${i.width}x${i.height}`:"N/A",orbPosition:c?getComputedStyle(c).transform:"N/A",threeLoaded:!!window.__orbThree,chatDock:!!o,inputBar:!!a})},testWebGL:()=>{const c=document.querySelector(".orb-3d-layer canvas");if(c){const t=c.getContext("webgl")||c.getContext("webgl2");console.log("[ORB DEBUG] WebGL context:",!!t),t&&console.log("[ORB DEBUG] WebGL info:",{vendor:t.getParameter(t.VENDOR),renderer:t.getParameter(t.RENDERER),version:t.getParameter(t.VERSION)})}else console.log("[ORB DEBUG] No WebGL canvas found")},repositionTopLeft:()=>{const c=document.querySelector(".floating-orb-wrapper");c&&(c.style.top="12px",c.style.left="12px",console.log("[ORB DEBUG] Repositioned to top-left"))},testChatDock:()=>{window.floatingOrb&&(window.floatingOrb.toggleChatDock(),console.log("[ORB DEBUG] Chat dock toggled"))},openChatDock:()=>{window.floatingOrb&&(window.floatingOrb.openChatDock(),console.log("[ORB DEBUG] Chat dock opened smoothly"))},closeChatDock:()=>{window.floatingOrb&&(window.floatingOrb.closeChatDock(),console.log("[ORB DEBUG] Chat dock closed smoothly"))},testInputBar:()=>{const c=document.querySelector(".orb-input input");c&&(c.click(),console.log("[ORB DEBUG] Input bar clicked - should trigger chat dock"))},testStarNotification:(c="Test star notification")=>{window.floatingOrb&&(window.floatingOrb.showStarNotification(c),console.log("[ORB DEBUG] Star notification created:",c))},testChatBadges:()=>{window.floatingOrb&&(window.floatingOrb.updateBadges({dms:3,ai:1,space:2}),console.log("[ORB DEBUG] Chat badges updated"))},clearAll:()=>{window.floatingOrb&&(window.floatingOrb.clear(),console.log("[ORB DEBUG] All chat badges cleared"))}};class K{constructor(){this.currentUser=null,this.userWidgets=[],this.widgetData={},this.userQuips=[],this.quipData={},this.debugMode=!0}log(t,e=null){this.debugMode&&console.log(`[WidgetDisplay] ${t}`,e)}error(t,e=null){console.error(`[WidgetDisplay] ${t}`,e)}async init(){if(this.currentUser=z.currentUser,!this.currentUser){this.log("No user logged in for widget display");return}this.log("Initializing enhanced widget display system with quip support"),await this.loadUserWidgets(),await this.loadUserQuips(),this.setupWidgetSlots(),this.setupQuipSlots(),this.setupProfileMenuIntegration()}async loadUserWidgets(){try{const t=await P(T(E,"users",this.currentUser.uid));if(t.exists()){const e=t.data();this.userWidgets=e.widgets||[],this.log("Loaded user widgets",{widgetCount:this.userWidgets.length}),await this.loadWidgetMetadata()}}catch(t){this.error("Error loading user widgets",t)}}async loadWidgetMetadata(){try{for(const t of this.userWidgets){const e=await P(T(E,"widgets",t));e.exists()&&(this.widgetData[t]=e.data())}this.log("Loaded widget metadata",{widgetCount:Object.keys(this.widgetData).length})}catch(t){this.error("Error loading widget metadata",t)}}async loadUserQuips(){try{this.log("Loading user quips for user:",this.currentUser.uid);const t=U(E,"quips"),e=O(t,R("userId","==",this.currentUser.uid)),i=await B(e);this.userQuips=i.docs.map(o=>o.id),this.log("Loaded user quips",{quipCount:this.userQuips.length,quipIds:this.userQuips}),await this.loadQuipMetadata()}catch(t){if(this.error("Error loading user quips",t),t.code==="permission-denied"&&(this.log("Permission denied - user may not be authenticated properly"),window.socialAuth&&window.socialAuth.currentUser)){this.log("Retrying with current auth user"),this.currentUser=window.socialAuth.currentUser;try{const e=U(E,"quips"),i=O(e,R("userId","==",this.currentUser.uid)),o=await B(i);this.userQuips=o.docs.map(a=>a.id),this.log("Retry successful - loaded user quips",{quipCount:this.userQuips.length}),await this.loadQuipMetadata()}catch(e){this.error("Retry also failed",e)}}}}async loadQuipMetadata(){try{for(const t of this.userQuips){const e=await P(T(E,"quips",t));e.exists()&&(this.quipData[t]=e.data())}this.log("Loaded quip metadata",{quipCount:Object.keys(this.quipData).length})}catch(t){this.error("Error loading quip metadata",t)}}findHtmlFile(t){if(!Array.isArray(t)||t.length===0)return null;const e=t.find(i=>i.fileName&&/index\.html?$/i.test(i.fileName));return e||t.find(i=>i.fileName&&/\.html?$/i.test(i.fileName))}setupWidgetSlots(){document.querySelectorAll("[data-widget-slot]").forEach(e=>{const i=e.dataset.widgetSlot;this.renderWidgetSlot(e,i)})}setupQuipSlots(){document.querySelectorAll(".quip-slot, .quip-preview, .timeline-event-card").forEach((e,i)=>{this.renderQuipSlot(e,i+1)})}async renderQuipSlot(t,e){const i=Object.values(this.quipData).find(o=>o.slot===parseInt(e));if(i&&i.files&&this.findHtmlFile(i.files)){const o=this.findHtmlFile(i.files);this.showQuipIframe(t,o.downloadURL,i)}else this.showEmptyQuipSlot(t,e)}async renderWidgetSlot(t,e){const i=Object.values(this.widgetData).find(o=>o.slot===parseInt(e));if(i&&i.files&&this.findHtmlFile(i.files)){const o=this.findHtmlFile(i.files);this.showWidgetIframe(t,o.downloadURL,i)}else this.showUploadInterface(t,e)}showWidgetIframe(t,e,i){t.innerHTML=`
      <div class="widget-container">
        <div class="widget-header">
          <h3>${i.title||"Untitled Widget"}</h3>
          <div class="widget-actions">
            <button class="btn btn-secondary edit-widget-btn" data-widget-id="${i.id}">
              <span class="material-icons">edit</span>
              Edit
            </button>
            <button class="btn btn-secondary preview-widget-btn" data-widget-id="${i.id}">
              <span class="material-icons">open_in_new</span>
              Full View
            </button>
            <button class="btn btn-danger delete-widget-btn" data-widget-id="${i.id}">
              <span class="material-icons">delete</span>
              Delete
            </button>
          </div>
        </div>
        <div class="widget-frame-container">
          <iframe 
            src="${e}" 
            class="widget-iframe"
            frameborder="0"
            sandbox="allow-scripts allow-same-origin allow-forms"
            title="Widget ${i.title}"
          ></iframe>
        </div>
        <div class="widget-info">
          <p><strong>Description:</strong> ${i.description||"No description"}</p>
          <p><strong>Category:</strong> ${i.category||"General"}</p>
          <p><strong>Tags:</strong> ${i.tags?.join(", ")||"No tags"}</p>
          <p><strong>Last Updated:</strong> ${new Date(i.updatedAt?.toDate()||i.updatedAt).toLocaleDateString()}</p>
          <div class="widget-stats">
            <span class="stat">üëÅÔ∏è ${i.stats?.views||0} views</span>
            <span class="stat">‚ù§Ô∏è ${i.stats?.likes||0} likes</span>
            <span class="stat">üì§ ${i.stats?.shares||0} shares</span>
          </div>
        </div>
      </div>
    `,this.setupWidgetActionHandlers(t)}showQuipIframe(t,e,i){t.innerHTML=`
      <div class="quip-container">
        <div class="quip-header">
          <h3 style="color: #00f0ff; font-family: JetBrains Mono;">${i.title||"Untitled Quip"}</h3>
          <div class="quip-badges">
            <span class="quip-type-badge" style="background: rgba(0,240,255,0.2); color: #00f0ff; padding: 4px 8px; border-radius: 12px; font-size: 0.8rem;">QUIP</span>
            ${i.webglEnabled?'<span class="webgl-badge" style="background: rgba(255,0,255,0.2); color: #ff00ff; padding: 4px 8px; border-radius: 12px; font-size: 0.8rem;">WebGL</span>':""}
          </div>
          <div class="quip-actions">
            <button class="btn btn-primary interact-quip-btn" data-quip-id="${i.id}">
              <span>üéÆ</span>
              Interact
            </button>
            <button class="btn btn-secondary edit-quip-btn" data-quip-id="${i.id}">
              <span>‚úèÔ∏è</span>
              Edit
            </button>
            <button class="btn btn-secondary preview-quip-btn" data-quip-id="${i.id}">
              <span>üëÅÔ∏è</span>
              Full View
            </button>
            <button class="btn btn-danger delete-quip-btn" data-quip-id="${i.id}">
              <span>üóëÔ∏è</span>
              Delete
            </button>
          </div>
        </div>
        <div class="quip-frame-container">
          <iframe 
            src="${e}" 
            class="quip-iframe webgl-enabled"
            frameborder="0"
            loading="lazy"
            sandbox="allow-scripts allow-same-origin allow-forms allow-webgl allow-pointer-lock"
            style="width: 100%; height: 300px; border-radius: 12px; border: 2px solid #00f0ff; background: #0a0a0a;"
            title="Quip Preview - ${i.title||"Untitled Quip"}"
          ></iframe>
        </div>
        <div class="quip-info">
          <p style="color: #a0a0a0; margin: 8px 0;">${i.description||"No description available"}</p>
          <div class="quip-meta">
            <span class="quip-interactions" style="color: #00f0ff;">Interactions: ${i.interactionCount||0}</span>
            <span class="quip-category" style="color: #ff00ff;">Category: ${i.category||"general"}</span>
          </div>
        </div>
      </div>
    `;const o=t.querySelector(".quip-iframe");$&&typeof $.applyDashboardSettings=="function"&&$.applyDashboardSettings(o,{borderColor:"#00f0ff",borderWidth:"2px",borderRadius:"12px",shadow:"0 0 20px rgba(0, 240, 255, 0.3), inset 0 1px 0 rgba(255, 255, 255, 0.1)"}),this.setupQuipActionHandlers(t)}showEmptyQuipSlot(t,e){t.innerHTML=`
      <div class="empty-quip-slot" style="text-align: center; padding: 40px; border: 2px dashed #333; border-radius: 12px; background: rgba(0,240,255,0.05);">
        <div style="font-size: 3rem; margin-bottom: 16px; color: #00f0ff;">üéÆ</div>
        <h3 style="color: #00f0ff; margin-bottom: 8px; font-family: JetBrains Mono;">Empty Quip Slot ${e}</h3>
        <p style="color: #a0a0a0; margin-bottom: 16px;">Create an interactive WebGL quip to fill this slot</p>
        <button class="btn btn-primary create-quip-btn" data-slot="${e}" style="background: rgba(0,240,255,0.1); border: 1px solid #00f0ff; color: #00f0ff; padding: 8px 16px; border-radius: 6px;">
          <span>‚ûï</span>
          Create Quip
        </button>
      </div>
    `,this.setupEmptyQuipHandlers(t)}showUploadInterface(t,e){t.innerHTML=`
      <div class="widget-upload-container">
        <h3>Widget Slot ${e}</h3>
        <p>Upload your widget files to get started</p>
        <div class="upload-area" data-slot="${e}">
          <input type="file" id="widgetFiles${e}" multiple accept=".html,.js,.css,.png,.jpg,.jpeg,.gif,.svg,.json,.mp3,.mp4,.wav,.ogg" style="display: none;">
          <div class="upload-placeholder">
            <span class="material-icons">cloud_upload</span>
            <p>Drop files here or click to upload</p>
            <p class="upload-hint">Supports: HTML, CSS, JS, Images, Audio, Video</p>
          </div>
        </div>
        <div class="upload-form" style="display: none;">
          <input type="text" placeholder="Widget Title" class="widget-title-input" data-slot="${e}">
          <textarea placeholder="Widget Description" class="widget-desc-input" data-slot="${e}" rows="3"></textarea>
          <input type="text" placeholder="Category (e.g., game, tool, art)" class="widget-category-input" data-slot="${e}">
          <input type="text" placeholder="Tags (comma separated)" class="widget-tags-input" data-slot="${e}">
          <button class="btn btn-primary upload-widget-btn" data-slot="${e}">
            <span class="material-icons">upload</span>
            Upload Widget
          </button>
        </div>
      </div>
    `,this.setupUploadHandlers(t,e)}setupUploadHandlers(t,e){const i=t.querySelector(".upload-area"),o=t.querySelector(`#widgetFiles${e}`),a=t.querySelector(".upload-form");o.addEventListener("change",n=>{n.target.files.length>0&&this.handleFileSelection(n.target.files,a)}),i.addEventListener("dragover",n=>{n.preventDefault(),i.classList.add("drag-over")}),i.addEventListener("dragleave",n=>{n.preventDefault(),i.classList.remove("drag-over")}),i.addEventListener("drop",n=>{n.preventDefault(),i.classList.remove("drag-over");const r=n.dataTransfer.files;r.length>0&&(o.files=r,this.handleFileSelection(r,a))}),i.addEventListener("click",()=>{o.click()}),t.querySelector(".upload-widget-btn").addEventListener("click",()=>{this.uploadWidget(e)})}handleFileSelection(t,e){e.style.display="block";const i=Array.from(t).map(o=>o.name).join(", ");e.querySelector(".upload-placeholder p").textContent=`Selected: ${i}`}async uploadWidget(t){if(this.log("Widget upload requested, delegating to WidgetUploadManager"),!window.widgetUploadManager){const{default:i}=await m(async()=>{const{default:o}=await import("./widget-upload-BclOXes8.js");return{default:o}},__vite__mapDeps([5,3,2]),import.meta.url);window.widgetUploadManager=i}const e=document.querySelector(`.upload-widget-btn[data-slot="${t}"]`);e?await window.widgetUploadManager.handleUploadButtonClick(e):this.error("Upload button not found for slot",{slotNumber:t})}setupWidgetActionHandlers(t){const e=t.querySelector(".edit-widget-btn");e&&e.addEventListener("click",a=>{const s=a.target.closest(".edit-widget-btn").dataset.widgetId;this.editWidget(s)});const i=t.querySelector(".preview-widget-btn");i&&i.addEventListener("click",a=>{const s=a.target.closest(".preview-widget-btn").dataset.widgetId;this.previewWidget(s)});const o=t.querySelector(".delete-widget-btn");o&&o.addEventListener("click",a=>{const s=a.target.closest(".delete-widget-btn").dataset.widgetId;this.deleteWidget(s)})}setupQuipActionHandlers(t){const e=t.querySelector(".interact-quip-btn");e&&e.addEventListener("click",s=>{const n=s.target.closest(".interact-quip-btn").dataset.quipId;this.interactWithQuip(n)});const i=t.querySelector(".edit-quip-btn");i&&i.addEventListener("click",s=>{const n=s.target.closest(".edit-quip-btn").dataset.quipId;this.editQuip(n)});const o=t.querySelector(".preview-quip-btn");o&&o.addEventListener("click",s=>{const n=s.target.closest(".preview-quip-btn").dataset.quipId;this.previewQuip(n)});const a=t.querySelector(".delete-quip-btn");a&&a.addEventListener("click",s=>{const n=s.target.closest(".delete-quip-btn").dataset.quipId;this.deleteQuip(n)})}setupEmptyQuipHandlers(t){const e=t.querySelector(".create-quip-btn");e&&e.addEventListener("click",i=>{const o=i.target.closest(".create-quip-btn").dataset.slot;this.createNewQuip(o)})}previewWidget(t){const e=this.widgetData[t];if(!e){this.showToast("Widget not found","error");return}const i=this.findHtmlFile(e.files);if(!i||!i.downloadURL){this.showToast("Widget HTML file not found","error");return}let o=document.getElementById("widgetPreviewModal");o||(o=document.createElement("div"),o.id="widgetPreviewModal",o.className="modal",o.innerHTML=`
        <div class="modal-content widget-preview-modal">
          <div class="modal-header">
            <h3>${e.title}</h3>
            <button class="close-modal">√ó</button>
          </div>
          <div class="modal-body">
            <iframe 
              src="${i.downloadURL}" 
              class="widget-preview-iframe"
              frameborder="0"
              sandbox="allow-scripts allow-same-origin allow-forms"
              title="Widget Preview"
            ></iframe>
          </div>
        </div>
      `,document.body.appendChild(o),o.querySelector(".close-modal").addEventListener("click",()=>{o.style.display="none"}),o.addEventListener("click",s=>{s.target===o&&(o.style.display="none")})),o.querySelector("h3").textContent=e.title,o.querySelector("iframe").src=i.downloadURL,o.style.display="block"}editWidget(t){const e=this.widgetData[t];if(!e){this.showToast("Widget not found","error");return}const i=document.querySelector(`[data-widget-slot="${e.slot}"]`);if(i){this.showUploadInterface(i,e.slot);const o=i.querySelector(".widget-title-input"),a=i.querySelector(".widget-desc-input"),s=i.querySelector(".widget-category-input"),n=i.querySelector(".widget-tags-input");o&&(o.value=e.title||""),a&&(a.value=e.description||""),s&&(s.value=e.category||""),n&&(n.value=e.tags?.join(", ")||"")}}async deleteWidget(t){const e=this.widgetData[t];if(!e){this.showToast("Widget not found","error");return}if(confirm(`Are you sure you want to delete "${e.title}"?`))try{await x(T(E,"widgets",t)),await F(T(E,"users",this.currentUser.uid),{widgets:V(t)}),await this.loadUserWidgets(),this.setupWidgetSlots(),this.showToast(`Widget "${e.title}" deleted successfully`,"success"),this.log("Widget deleted successfully",{widgetId:t})}catch(i){this.error("Error deleting widget",i),this.showToast("Failed to delete widget: "+i.message,"error")}}setupProfileMenuIntegration(){this.updateProfileMenuWidgetCount(),this.addWidgetManagementToProfile()}updateProfileMenuWidgetCount(){const t=document.querySelector(".profile-menu");if(t){const e=t.querySelector(".widget-count");if(e)e.textContent=this.userWidgets.length;else{const i=document.createElement("div");i.className="widget-count",i.textContent=this.userWidgets.length,t.appendChild(i)}}}addWidgetManagementToProfile(){const t=document.querySelector(".profile-menu");if(t&&!t.querySelector(".widget-management")){const e=document.createElement("div");e.className="widget-management",e.innerHTML=`
        <h4>My Widgets (${this.userWidgets.length})</h4>
        <div class="widget-list">
          ${this.userWidgets.length===0?'<p>No widgets yet. <a href="#" class="upload-widget-link">Upload your first widget!</a></p>':this.userWidgets.map(i=>{const o=this.widgetData[i];return o?`
                <div class="widget-item" data-widget-id="${i}">
                  <div class="widget-info">
                    <h5>${o.title}</h5>
                    <p>${o.description||"No description"}</p>
                    <span class="widget-category">${o.category}</span>
                  </div>
                  <div class="widget-actions">
                    <button class="btn btn-sm preview-widget-btn" data-widget-id="${i}">Preview</button>
                    <button class="btn btn-sm edit-widget-btn" data-widget-id="${i}">Edit</button>
                    <button class="btn btn-sm btn-danger delete-widget-btn" data-widget-id="${i}">Delete</button>
                  </div>
                </div>
              `:""}).join("")}
        </div>
      `,t.appendChild(e),this.setupProfileMenuEventListeners(e)}}setupProfileMenuEventListeners(t){t.querySelectorAll(".preview-widget-btn").forEach(i=>{i.addEventListener("click",o=>{const a=o.target.dataset.widgetId;this.previewWidget(a)})}),t.querySelectorAll(".edit-widget-btn").forEach(i=>{i.addEventListener("click",o=>{const a=o.target.dataset.widgetId;this.editWidget(a)})}),t.querySelectorAll(".delete-widget-btn").forEach(i=>{i.addEventListener("click",o=>{const a=o.target.dataset.widgetId;this.deleteWidget(a)})});const e=t.querySelector(".upload-widget-link");e&&e.addEventListener("click",i=>{i.preventDefault();const o=document.querySelector("[data-widget-slot]");o&&o.scrollIntoView({behavior:"smooth"})})}async interactWithQuip(t){const e=this.quipData[t];if(!e){this.showToast("Quip not found","error");return}const i=document.querySelector(`[data-quip-id="${t}"] .quip-iframe`);i&&(i.focus(),i.style.borderColor="#ffff00",setTimeout(()=>{i.style.borderColor="#00f0ff"},2e3));try{await F(T(E,"quips",t),{interactionCount:(e.interactionCount||0)+1,lastInteracted:G()}),this.log("Quip interaction tracked",{quipId:t})}catch(o){this.error("Failed to track quip interaction",o)}}editQuip(t){if(!this.quipData[t]){this.showToast("Quip not found","error");return}const i=`pages/widget_studio.html?edit=${t}`;window.location.href=i}previewQuip(t){const e=this.quipData[t];if(!e){this.showToast("Quip not found","error");return}const i=this.findHtmlFile(e.files);if(!i||!i.downloadURL){this.showToast("Quip HTML file not found","error");return}let o=document.getElementById("quipPreviewModal");o||(o=document.createElement("div"),o.id="quipPreviewModal",o.className="modal",o.innerHTML=`
        <div class="modal-content" style="max-width: 90vw; max-height: 90vh;">
          <div class="modal-header">
            <h3>Quip Preview</h3>
            <button class="modal-close">&times;</button>
          </div>
          <div class="modal-body">
            <iframe 
              src="${i.downloadURL}" 
              style="width: 100%; height: 70vh; border: none; border-radius: 8px;"
              sandbox="allow-scripts allow-same-origin allow-forms allow-webgl allow-pointer-lock"
            ></iframe>
          </div>
        </div>
      `,document.body.appendChild(o));const a=o.querySelector("iframe");a.src=i.downloadURL,o.querySelector("h3").textContent=`Quip Preview - ${e.title||"Untitled Quip"}`,o.style.display="flex",o.querySelector(".modal-close").onclick=()=>{o.style.display="none"},o.onclick=s=>{s.target===o&&(o.style.display="none")}}async deleteQuip(t){const e=this.quipData[t];if(!e){this.showToast("Quip not found","error");return}if(confirm(`Are you sure you want to delete "${e.title||"Untitled Quip"}"?`))try{await x(T(E,"quips",t)),delete this.quipData[t],this.userQuips=this.userQuips.filter(i=>i!==t),this.showToast("Quip deleted successfully","success"),this.log("Quip deleted",{quipId:t}),this.setupQuipSlots()}catch(i){this.error("Failed to delete quip",i),this.showToast("Failed to delete quip","error")}}createNewQuip(t){const e=`pages/widget_studio.html?slot=${t}&type=quip`;window.location.href=e}showToast(t,e="info"){window.showToast?window.showToast(t,e):console.log(`[${e.toUpperCase()}] ${t}`)}}window.previewWidget=function(c){window.widgetDisplay&&window.widgetDisplay.previewWidget(c)};window.uploadWidget=function(c){window.widgetDisplay&&window.widgetDisplay.uploadWidget(c)};window.editWidget=function(c){window.widgetDisplay&&window.widgetDisplay.editWidget(c)};window.deleteWidget=function(c){window.widgetDisplay&&window.widgetDisplay.deleteWidget(c)};let M=null;z.onAuthStateChanged(c=>{c?M||(M=new K,M.init(),window.widgetDisplay=M):(M=null,window.widgetDisplay=null)});class N{constructor(){this.currentUser=null,this.following=new Set,this.followers=new Set,this.debugMode=!0}log(t,e=null){this.debugMode&&console.log(`[SOCIAL FEATURES] ${t}`,e||"")}error(t,e=null){console.error(`[SOCIAL FEATURES ERROR] ${t}`,e||"")}async init(){this.log("Initializing Social Features Manager"),this.setupAuthListener(),this.setupEventListeners(),this.log("Social Features Manager initialized")}async setupAuthListener(){try{this.log("Setting up auth state listener"),window.addEventListener("auth-state-changed",async t=>{const{user:e}=t.detail;this.currentUser=e,this.log("Social features received auth state change",{userId:e?.uid}),e?await this.loadUserSocialData(e.uid):(this.following.clear(),this.followers.clear())}),this.log("Social features auth listener set up via main auth system")}catch(t){this.error("Failed to setup auth listener",t)}}async loadUserSocialData(t){try{const{db:e}=await m(async()=>{const{db:s}=await import("./firebase-core-BO8UvLyb.js");return{db:s}},[],import.meta.url),{doc:i,getDoc:o}=await m(async()=>{const{doc:s,getDoc:n}=await import("https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js");return{doc:s,getDoc:n}},[],import.meta.url),a=await o(i(e,"users",t));if(a.exists()){const s=a.data();this.following=new Set(s.following||[]),this.followers=new Set(s.followers||[]),this.log("User social data loaded",{following:this.following.size,followers:this.followers.size})}}catch(e){this.error("Failed to load user social data",e)}}async followUser(t){try{if(!this.currentUser)throw new Error("User must be logged in to follow others");const e=this.currentUser.uid;if(e===t)throw new Error("You cannot follow yourself");if(this.following.has(t))throw new Error("You are already following this user");const{db:i}=await m(async()=>{const{db:n}=await import("./firebase-core-BO8UvLyb.js");return{db:n}},[],import.meta.url),{doc:o,updateDoc:a,arrayUnion:s}=await m(async()=>{const{doc:n,updateDoc:r,arrayUnion:d}=await import("https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js");return{doc:n,updateDoc:r,arrayUnion:d}},[],import.meta.url);return await a(o(i,"users",e),{following:s(t)}),await a(o(i,"users",t),{followers:s(e)}),this.following.add(t),await this.createFollowNotification(t,e),this.log("User followed successfully",{targetUserId:t}),{success:!0}}catch(e){return this.error("Follow action failed",e),{success:!1,error:e.message}}}async unfollowUser(t){try{if(!this.currentUser)throw new Error("User must be logged in to unfollow others");const e=this.currentUser.uid;if(!this.following.has(t))throw new Error("You are not following this user");const{db:i}=await m(async()=>{const{db:n}=await import("./firebase-core-BO8UvLyb.js");return{db:n}},[],import.meta.url),{doc:o,updateDoc:a,arrayRemove:s}=await m(async()=>{const{doc:n,updateDoc:r,arrayRemove:d}=await import("https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js");return{doc:n,updateDoc:r,arrayRemove:d}},[],import.meta.url);return await a(o(i,"users",e),{following:s(t)}),await a(o(i,"users",t),{followers:s(e)}),this.following.delete(t),this.log("User unfollowed successfully",{targetUserId:t}),{success:!0}}catch(e){return this.error("Unfollow action failed",e),{success:!1,error:e.message}}}async likeWidget(t){try{if(!this.currentUser)throw new Error("User must be logged in to like widgets");const{db:e}=await m(async()=>{const{db:h}=await import("./firebase-core-BO8UvLyb.js");return{db:h}},[],import.meta.url),{doc:i,updateDoc:o,arrayUnion:a,getDoc:s}=await m(async()=>{const{doc:h,updateDoc:g,arrayUnion:p,getDoc:u}=await import("https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js");return{doc:h,updateDoc:g,arrayUnion:p,getDoc:u}},[],import.meta.url),n=await s(i(e,"widgets",t));if(!n.exists())throw new Error("Widget not found");const r=n.data(),d=this.currentUser.uid;if(r.likes&&r.likes.includes(d))throw new Error("You have already liked this widget");return await o(i(e,"widgets",t),{likes:a(d),"stats.likes":(r.stats?.likes||0)+1}),await this.createLikeNotification(r.userId,d,t,r.title),this.log("Widget liked successfully",{widgetId:t}),{success:!0}}catch(e){return this.error("Like action failed",e),{success:!1,error:e.message}}}async unlikeWidget(t){try{if(!this.currentUser)throw new Error("User must be logged in to unlike widgets");const{db:e}=await m(async()=>{const{db:h}=await import("./firebase-core-BO8UvLyb.js");return{db:h}},[],import.meta.url),{doc:i,updateDoc:o,arrayRemove:a,getDoc:s}=await m(async()=>{const{doc:h,updateDoc:g,arrayRemove:p,getDoc:u}=await import("https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js");return{doc:h,updateDoc:g,arrayRemove:p,getDoc:u}},[],import.meta.url),n=await s(i(e,"widgets",t));if(!n.exists())throw new Error("Widget not found");const r=n.data(),d=this.currentUser.uid;if(!r.likes||!r.likes.includes(d))throw new Error("You have not liked this widget");return await o(i(e,"widgets",t),{likes:a(d),"stats.likes":Math.max(0,(r.stats?.likes||1)-1)}),this.log("Widget unliked successfully",{widgetId:t}),{success:!0}}catch(e){return this.error("Unlike action failed",e),{success:!1,error:e.message}}}async shareWidget(t,e="general"){try{if(!this.currentUser)throw new Error("User must be logged in to share widgets");const{db:i}=await m(async()=>{const{db:h}=await import("./firebase-core-BO8UvLyb.js");return{db:h}},[],import.meta.url),{doc:o,getDoc:a,updateDoc:s,increment:n}=await m(async()=>{const{doc:h,getDoc:g,updateDoc:p,increment:u}=await import("https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js");return{doc:h,getDoc:g,updateDoc:p,increment:u}},[],import.meta.url),r=await a(o(i,"widgets",t));if(!r.exists())throw new Error("Widget not found");const d=r.data();return await s(o(i,"widgets",t),{"stats.shares":n(1)}),await this.createShareNotification(d.userId,this.currentUser.uid,t,d.title,e),await this.handlePlatformSharing(d,e),this.log("Widget shared successfully",{widgetId:t,platform:e}),{success:!0}}catch(i){return this.error("Share action failed",i),{success:!1,error:i.message}}}async handlePlatformSharing(t,e){const i=`${window.location.origin}/widget/${t.id}`,o=`Check out this amazing widget: ${t.title}`;switch(e){case"twitter":window.open(`https://twitter.com/intent/tweet?text=${encodeURIComponent(o)}&url=${encodeURIComponent(i)}`);break;case"facebook":window.open(`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(i)}`);break;case"linkedin":window.open(`https://www.linkedin.com/sharing/share-offsite/?url=${encodeURIComponent(i)}`);break;case"copy":await navigator.clipboard.writeText(`${o}
${i}`),this.showToast("Link copied to clipboard!","success");break;case"native":navigator.share?await navigator.share({title:t.title,text:t.description||o,url:i}):(await navigator.clipboard.writeText(`${o}
${i}`),this.showToast("Link copied to clipboard!","success"));break;default:await navigator.clipboard.writeText(`${o}
${i}`),this.showToast("Link copied to clipboard!","success")}}async discoverUsers(t=10,e=!0){try{const{db:i}=await m(async()=>{const{db:u}=await import("./firebase-core-BO8UvLyb.js");return{db:u}},[],import.meta.url),{collection:o,query:a,where:s,orderBy:n,limit:r,getDocs:d}=await m(async()=>{const{collection:u,query:w,where:v,orderBy:b,limit:f,getDocs:S}=await import("https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js");return{collection:u,query:w,where:v,orderBy:b,limit:f,getDocs:S}},[],import.meta.url);let h=a(o(i,"users"),n("createdAt","desc"),r(t));e&&this.currentUser&&(h=a(o(i,"users"),s("uid","!=",this.currentUser.uid),n("createdAt","desc"),r(t)));const g=await d(h),p=[];return g.forEach(u=>{const w=u.data();p.push({id:u.id,...w,isFollowing:this.following.has(u.id)})}),this.log("Users discovered",{count:p.length}),{success:!0,users:p}}catch(i){return this.error("Failed to discover users",i),{success:!1,error:i.message}}}async getUserFeed(t=20){try{if(!this.currentUser)throw new Error("User must be logged in to view feed");const{db:e}=await m(async()=>{const{db:g}=await import("./firebase-core-BO8UvLyb.js");return{db:g}},[],import.meta.url),{collection:i,query:o,where:a,orderBy:s,limit:n,getDocs:r}=await m(async()=>{const{collection:g,query:p,where:u,orderBy:w,limit:v,getDocs:b}=await import("https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js");return{collection:g,query:p,where:u,orderBy:w,limit:v,getDocs:b}},[],import.meta.url),d=Array.from(this.following),h=[];if(d.length>0){const g=o(i(e,"widgets"),a("userId","in",d),a("isPublic","==",!0),s("createdAt","desc"),n(t));(await r(g)).forEach(u=>{const w=u.data();h.push({type:"widget",id:u.id,data:w,timestamp:w.createdAt})})}return h.sort((g,p)=>p.timestamp?.toDate()-g.timestamp?.toDate()),this.log("User feed loaded",{count:h.length}),{success:!0,feed:h}}catch(e){return this.error("Failed to load user feed",e),{success:!1,error:e.message}}}async createFollowNotification(t,e){try{const{db:i}=await m(async()=>{const{db:p}=await import("./firebase-core-BO8UvLyb.js");return{db:p}},[],import.meta.url),{collection:o,addDoc:a,serverTimestamp:s}=await m(async()=>{const{collection:p,addDoc:u,serverTimestamp:w}=await import("https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js");return{collection:p,addDoc:u,serverTimestamp:w}},[],import.meta.url),{doc:n,getDoc:r}=await m(async()=>{const{doc:p,getDoc:u}=await import("https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js");return{doc:p,getDoc:u}},[],import.meta.url),d=await r(n(i,"users",e)),h=d.exists()?d.data().displayName:"Someone",g={userId:t,type:"follow",title:"New follower! üë•",message:`${h} started following you.`,icon:"üë•",data:{followerId:e,action:"view_profile"},read:!1,timestamp:s()};await a(o(i,"notifications"),g),this.log("Follow notification created",{targetUserId:t,followerId:e})}catch(i){this.error("Failed to create follow notification",i)}}async createLikeNotification(t,e,i,o){try{const{db:a}=await m(async()=>{const{db:w}=await import("./firebase-core-BO8UvLyb.js");return{db:w}},[],import.meta.url),{collection:s,addDoc:n,serverTimestamp:r}=await m(async()=>{const{collection:w,addDoc:v,serverTimestamp:b}=await import("https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js");return{collection:w,addDoc:v,serverTimestamp:b}},[],import.meta.url),{doc:d,getDoc:h}=await m(async()=>{const{doc:w,getDoc:v}=await import("https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js");return{doc:w,getDoc:v}},[],import.meta.url),g=await h(d(a,"users",e)),p=g.exists()?g.data().displayName:"Someone",u={userId:t,type:"like",title:"New like! ‚ù§Ô∏è",message:`${p} liked your widget "${o}".`,icon:"‚ù§Ô∏è",data:{widgetId:i,likerId:e,action:"view_widget"},read:!1,timestamp:r()};await n(s(a,"notifications"),u),this.log("Like notification created",{widgetOwnerId:t,likerId:e,widgetId:i})}catch(a){this.error("Failed to create like notification",a)}}async createShareNotification(t,e,i,o,a){try{const{db:s}=await m(async()=>{const{db:f}=await import("./firebase-core-BO8UvLyb.js");return{db:f}},[],import.meta.url),{collection:n,addDoc:r,serverTimestamp:d}=await m(async()=>{const{collection:f,addDoc:S,serverTimestamp:L}=await import("https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js");return{collection:f,addDoc:S,serverTimestamp:L}},[],import.meta.url),{doc:h,getDoc:g}=await m(async()=>{const{doc:f,getDoc:S}=await import("https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js");return{doc:f,getDoc:S}},[],import.meta.url),p=await g(h(s,"users",e)),u=p.exists()?p.data().displayName:"Someone",v={twitter:"Twitter",facebook:"Facebook",linkedin:"LinkedIn",copy:"copied",native:"shared"}[a]||"shared",b={userId:t,type:"share",title:"Widget shared! üì§",message:`${u} ${v} your widget "${o}".`,icon:"üì§",data:{widgetId:i,sharerId:e,platform:a,action:"view_widget"},read:!1,timestamp:d()};await r(n(s,"notifications"),b),this.log("Share notification created",{widgetOwnerId:t,sharerId:e,widgetId:i,platform:a})}catch(s){this.error("Failed to create share notification",s)}}setupEventListeners(){document.addEventListener("click",async t=>{if(t.target.matches(".follow-btn")){t.preventDefault();const e=t.target.dataset.userId,i=t.target.dataset.following==="true";i?await this.unfollowUser(e):await this.followUser(e),this.updateFollowButton(t.target,!i)}}),document.addEventListener("click",async t=>{if(t.target.matches(".like-btn")){t.preventDefault();const e=t.target.dataset.widgetId,i=t.target.dataset.liked==="true";i?await this.unlikeWidget(e):await this.likeWidget(e),this.updateLikeButton(t.target,!i)}}),document.addEventListener("click",async t=>{if(t.target.matches(".share-btn")){t.preventDefault();const e=t.target.dataset.widgetId,i=t.target.dataset.platform||"native";await this.shareWidget(e,i)}})}updateFollowButton(t,e){t.dataset.following=e.toString(),t.textContent=e?"Following":"Follow",t.className=e?"follow-btn following":"follow-btn"}updateLikeButton(t,e){t.dataset.liked=e.toString(),t.innerHTML=e?"‚ù§Ô∏è Liked":"ü§ç Like",t.className=e?"like-btn liked":"like-btn"}showToast(t,e="info"){const i=document.createElement("div");i.className=`toast ${e}`,i.innerHTML=`
      <span class="toast-message">${t}</span>
      <button class="toast-close">&times;</button>
    `,(document.getElementById("toast-container")||document.body).appendChild(i),setTimeout(()=>{i.parentNode&&i.remove()},5e3),i.querySelector(".toast-close").addEventListener("click",()=>{i.remove()})}}const H=new N;window.socialFeatures=H;document.addEventListener("DOMContentLoaded",()=>{H.init()});const Z=Object.freeze(Object.defineProperty({__proto__:null,SocialFeaturesManager:N},Symbol.toStringTag,{value:"Module"}));
