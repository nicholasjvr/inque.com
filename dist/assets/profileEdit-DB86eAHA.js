import{a as m,d as y}from"./auth-YTXLyXWo.js";import{p as a}from"./profile-dashboard-manager-BjtFV_o8.js";import L from"https://cdn.jsdelivr.net/npm/sortablejs@1.15.2/modular/sortable.esm.js";import{updateDoc as C,doc as B,getDoc as P}from"https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js";import{u as R}from"./cloud-upload-xQtmBUJr.js";import{onAuthStateChanged as x}from"https://www.gstatic.com/firebasejs/11.10.0/firebase-auth.js";import"./profile_banner-s0IkmVks.js";import"https://www.gstatic.com/firebasejs/11.10.0/firebase-app.js";import"https://www.gstatic.com/firebasejs/11.10.0/firebase-analytics.js";import"https://www.gstatic.com/firebasejs/11.10.0/firebase-storage.js";import"https://www.gstatic.com/firebasejs/11.10.0/firebase-functions.js";console.log("[PROFILE EDIT] Initializing editor");const F=document.getElementById("sections"),T=document.getElementById("saveBtn"),O=document.getElementById("backBtn"),b=document.getElementById("editName"),w=document.getElementById("editBio"),g=document.getElementById("editPhotoFile");L.create(F,{handle:".section-handle",animation:150,ghostClass:"sortable-ghost",chosenClass:"sortable-chosen",onEnd:()=>console.log("[PROFILE EDIT] Sections reordered")});async function E(){console.log("[PROFILE EDIT] Loading profile");const e=m.currentUser;if(!e)return;const o=await P(B(y,"users",e.uid));if(o.exists()){const t=o.data();b.value=t.name||t.displayName||"",w.value=t.bio||"",t.dashboardSettings&&v(t.dashboardSettings)}}function v(e){console.log("[PROFILE EDIT] Loading dashboard settings",e);const o=document.getElementById("dashboardLayout");o&&(o.value=e.layout||"grid");const t=document.getElementById("dashboardTheme");t&&(t.value=e.theme||"neo-brutalist");const d=document.getElementById("primaryColor");d&&(d.value=e.customColors?.primary||"#00ffff");const n=document.getElementById("secondaryColor");n&&(n.value=e.customColors?.secondary||"#ff00ff");const r=document.getElementById("accentColor");r&&(r.value=e.customColors?.accent||"#ffff00");const i=document.getElementById("widgetBorderColor");i&&(i.value=e.widgetDefaults?.borderColor||"#00ffff");const s=document.getElementById("widgetBorderWidth");s&&(s.value=e.widgetDefaults?.borderWidth||"3px");const l=document.getElementById("widgetBorderRadius");l&&(l.value=e.widgetDefaults?.borderRadius||"0px");const c=document.getElementById("widgetHeight");c&&(c.value=e.widgetDefaults?.height||"300px");const u=document.getElementById("widgetGap");u&&(u.value=e.spacing?.widgetGap||"24px");const f=document.getElementById("animationsEnabled");f&&(f.checked=e.animations?.enabled!==!1)}async function S(){const e=m.currentUser;if(!e)return;const o=b.value.trim(),t={name:o,displayName:o,bio:w.value.trim(),updatedAt:new Date},d=D();if(d&&(t.dashboardSettings=d),g.files&&g.files[0]){console.log("[PROFILE EDIT] Uploading new profile photo");try{const n=await R(g.files[0]);t.photoURL=n.photoURL}catch(n){console.warn("[PROFILE EDIT] Photo upload failed",n)}}await C(B(y,"users",e.uid),t),console.log("[PROFILE EDIT] Profile saved"),alert("Saved!")}function D(){try{const e=document.getElementById("dashboardLayout")?.value||"grid",o=document.getElementById("dashboardTheme")?.value||"neo-brutalist",t=document.getElementById("primaryColor")?.value||"#00ffff",d=document.getElementById("secondaryColor")?.value||"#ff00ff",n=document.getElementById("accentColor")?.value||"#ffff00",r=document.getElementById("widgetBorderColor")?.value||"#00ffff",i=document.getElementById("widgetBorderWidth")?.value||"3px",s=document.getElementById("widgetBorderRadius")?.value||"0px",l=document.getElementById("widgetHeight")?.value||"300px",c=document.getElementById("widgetGap")?.value||"24px",u=document.getElementById("animationsEnabled")?.checked!==!1;return{layout:e,theme:o,customColors:{primary:t,secondary:d,accent:n,background:"#0a0a0a",text:"#ffffff"},widgetDefaults:{borderColor:r,borderWidth:i,borderRadius:s,width:"100%",height:l,shadow:`0 0 20px ${r}40`},spacing:{widgetGap:c,sectionPadding:"40px",cardPadding:"24px"},animations:{enabled:u,duration:"0.3s",easing:"ease-out"}}}catch(e){return console.error("[PROFILE EDIT] Error getting dashboard settings",e),null}}const h=document.getElementById("previewDashboard"),p=document.getElementById("resetDashboard"),I=document.getElementById("exportDashboard");h&&h.addEventListener("click",()=>{console.log("[PROFILE EDIT] Previewing dashboard settings");const e=D();e&&a&&a.previewDashboardSettings(e.widgetDefaults)});p&&p.addEventListener("click",()=>{console.log("[PROFILE EDIT] Resetting dashboard settings"),a&&(a.resetToDefaults(),v(a.getDefaultDashboardSettings()))});I&&I.addEventListener("click",()=>{console.log("[PROFILE EDIT] Exporting dashboard settings"),a&&a.exportSettings()});O.addEventListener("click",()=>{history.length>1?history.back():window.location.href="../index.html"});T.addEventListener("click",S);if(m.currentUser)console.log("[PROFILE EDIT] Auth ready, user present"),E();else{console.log("[PROFILE EDIT] Waiting for auth stateâ€¦");const e=x(m,o=>{e(),o?(console.log("[PROFILE EDIT] User detected, loading profile"),E()):(console.log("[PROFILE EDIT] No user, redirecting"),window.location.href="../index.html")})}
