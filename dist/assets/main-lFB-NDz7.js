const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./navigation-CeOPnReq.js","./auth-YTXLyXWo.js","./widget-upload-BU_ZWewu.js","./cloud-upload-xQtmBUJr.js","./css-analyzer-DJZTM973.js"])))=>i.map(i=>d[i]);
import{_ as g,a as P,d as D}from"./auth-YTXLyXWo.js";import{p as U}from"./profile-dashboard-manager-BjtFV_o8.js";/* empty css                       */import{getDocs as O,collection as $,getDoc as q,doc as k,query as H,where as F,deleteDoc as z,updateDoc as W,arrayRemove as X,serverTimestamp as K}from"https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js";import"https://www.gstatic.com/firebasejs/11.10.0/firebase-storage.js";import"./cloud-upload-xQtmBUJr.js";import"./profile_banner-s0IkmVks.js";import"https://www.gstatic.com/firebasejs/11.10.0/firebase-app.js";import"https://www.gstatic.com/firebasejs/11.10.0/firebase-analytics.js";import"https://www.gstatic.com/firebasejs/11.10.0/firebase-auth.js";import"https://www.gstatic.com/firebasejs/11.10.0/firebase-functions.js";console.log("[MAIN] Starting application initialization...");class Z{constructor(){this.state={initialized:!1,modules:{auth:null,social:null,profileHub:null,navigation:null,ui:null},user:{isAuthenticated:!1,profile:null,preferences:{}},ui:{theme:"auto",sidebarOpen:!1,modals:{auth:!1,profile:!1,notifications:!1}},performance:{loadTime:Date.now(),moduleLoadTimes:{},functionCallCount:0}},this.eventListeners=new Map,this.debugMode=!0,console.log("[MAIN] AppStateManager initialized")}log(t,e=null){this.debugMode&&(this.state.performance.functionCallCount++,console.log(`[MAIN] ${t}`,e||""))}setState(t,e="unknown"){this.log(`State update from ${e}:`,t),this.state=this.deepMerge(this.state,t),this.emit("state-changed",{state:this.state,updates:t,source:e})}deepMerge(t,e){const i={...t};for(const o in e)e[o]&&typeof e[o]=="object"&&!Array.isArray(e[o])?i[o]=this.deepMerge(i[o]||{},e[o]):i[o]=e[o];return i}emit(t,e){this.log(`Emitting event: ${t}`,e);const i=new CustomEvent(`app-${t}`,{detail:e});window.dispatchEvent(i)}addEventListener(t,e){const i=o=>e(o.detail);window.addEventListener(`app-${t}`,i),this.eventListeners.set(t,i)}trackFunctionCall(t,e){this.state.performance.moduleLoadTimes[t]||(this.state.performance.moduleLoadTimes[t]=[]),this.state.performance.moduleLoadTimes[t].push(e)}getPerformanceMetrics(){return{totalLoadTime:Date.now()-this.state.performance.loadTime,functionCallCount:this.state.performance.functionCallCount,moduleLoadTimes:this.state.performance.moduleLoadTimes,memoryUsage:performance.memory?{used:Math.round(performance.memory.usedJSHeapSize/1024/1024),total:Math.round(performance.memory.totalJSHeapSize/1024/1024)}:null}}}class tt{constructor(t){this.appState=t,this.modules=new Map,this.loadingPromises=new Map,this.log("ModuleOrchestrator initialized")}log(t,e=null){this.appState.log(`[ORCHESTRATOR] ${t}`,e)}async loadModule(t,e){if(this.modules.has(t))return this.log(`Module ${t} already loaded`),this.modules.get(t);if(this.loadingPromises.has(t))return this.log(`Module ${t} is already loading`),this.loadingPromises.get(t);const i=Date.now();this.log(`Loading module: ${t}`);const o=this.loadModuleWithRetry(t,e,3);this.loadingPromises.set(t,o);try{const a=await o,s=Date.now()-i;return this.modules.set(t,a),this.loadingPromises.delete(t),this.appState.trackFunctionCall(`load-${t}`,s),this.log(`Module ${t} loaded successfully in ${s}ms`),a}catch(a){throw this.loadingPromises.delete(t),this.log(`Failed to load module ${t}:`,a),a}}async loadModuleWithRetry(t,e,i){let o;for(let a=1;a<=i;a++)try{return await e()}catch(s){o=s,this.log(`Module ${t} load attempt ${a} failed:`,s),a<i&&await new Promise(n=>setTimeout(n,1e3*a))}throw new Error(`Failed to load module ${t} after ${i} attempts: ${o.message}`)}getModule(t){return this.modules.get(t)||null}async initializeCoreModules(){this.log("Initializing core modules...");const t=[["firebase-core",()=>g(()=>import("./auth-YTXLyXWo.js").then(o=>o.f),[],import.meta.url)],["auth",()=>g(()=>import("./auth-YTXLyXWo.js").then(o=>o.b),[],import.meta.url)],["social",()=>g(()=>Promise.resolve().then(()=>st),void 0,import.meta.url)],["navigation",()=>g(()=>import("./navigation-CeOPnReq.js"),__vite__mapDeps([0,1]),import.meta.url)]],e=t.map(([o,a])=>this.loadModule(o,a).catch(s=>(this.log(`Warning: Failed to load ${o}:`,s),null)));(await Promise.allSettled(e)).forEach((o,a)=>{const[s]=t[a];o.status==="fulfilled"&&o.value?this.log(`Core module ${s} ready`):this.log(`Core module ${s} failed to load`)}),this.log("Core modules initialization complete")}}class et{constructor(){this.appState=new Z,this.orchestrator=new tt(this.appState),this.initializationSteps=[],this.log("ApplicationInitializer created")}log(t,e=null){this.appState.log(`[INIT] ${t}`,e)}addStep(t,e,i=[]){this.initializationSteps.push({name:t,function:e,dependencies:i,completed:!1})}async executeInitializationSteps(){this.log("Executing initialization steps...");const t=new Set;let e=!0;for(;e&&t.size<this.initializationSteps.length;){e=!1;for(const o of this.initializationSteps){if(o.completed||t.has(o.name))continue;if(o.dependencies.every(s=>t.has(s)))try{this.log(`Executing step: ${o.name}`),await o.function(),o.completed=!0,t.add(o.name),e=!0,this.log(`Step completed: ${o.name}`)}catch(s){this.log(`Step failed: ${o.name}`,s)}}}const i=this.initializationSteps.filter(o=>!o.completed);i.length>0&&this.log(`Warning: ${i.length} steps failed:`,i.map(o=>o.name)),this.log(`Initialization complete. ${t.size}/${this.initializationSteps.length} steps successful`)}setupInitializationSteps(){this.addStep("dom-ready",async()=>{document.readyState==="loading"&&await new Promise(t=>document.addEventListener("DOMContentLoaded",t)),this.log("DOM is ready")}),this.addStep("load-modules",async()=>{await this.orchestrator.initializeCoreModules()},["dom-ready"]),this.addStep("init-auth",async()=>{this.orchestrator.getModule("auth")&&window.socialAuth?(await window.socialAuth.init(),this.log("Auth system initialized")):this.log("Auth module not available")},["load-modules"]),this.addStep("init-social",async()=>{this.orchestrator.getModule("social")&&window.socialFeatures?(await window.socialFeatures.init(),this.log("Social features initialized")):this.log("Social module not available")},["init-auth"]),this.addStep("init-profile-hub",async()=>{window.profileHubManager?this.log("ProfileHub is available"):this.log("ProfileHub not yet available, will retry")},["init-auth"]),this.addStep("setup-global-handlers",async()=>{this.setupGlobalEventHandlers()},["init-auth","init-social"]),this.addStep("init-ui",async()=>{await this.initializeUIComponents()},["setup-global-handlers"]),this.addStep("finalize",async()=>{this.finalizeApplication()},["init-ui"])}setupGlobalEventHandlers(){this.log("Setting up global event handlers..."),this.appState.addEventListener("state-changed",t=>{t.updates.user&&this.handleUserStateChange(t.updates.user)}),window.addEventListener("auth-state-changed",t=>{this.log("Auth state change received:",t.detail),this.appState.setState({user:{isAuthenticated:t.detail.isAuthenticated,profile:t.detail.profile}},"auth-system")}),window.addEventListener("social-action",t=>{this.log("Social action received:",t.detail),this.handleSocialAction(t.detail)}),this.log("Global event handlers set up")}handleUserStateChange(t){this.log("Handling user state change:",t),this.updateAuthUI(t.isAuthenticated),window.profileHubManager&&t.profile&&window.profileHubManager.handleAuthStateChange(t.isAuthenticated?{uid:"user"}:null,t.profile)}handleSocialAction(t){this.log("Handling social action:",t),this.appState.setState({performance:{socialActions:(this.appState.state.performance.socialActions||0)+1}},"social-action")}updateAuthUI(t){this.log("Updating auth UI:",t);const e=document.getElementById("sidebarLoginBtn");e&&(e.style.display=t?"none":"block");const i=document.getElementById("sidebarUserActions");i&&(i.style.display=t?"block":"none"),document.querySelectorAll(".profile-element").forEach(a=>{a.style.display=t?"block":"none"})}async initializeUIComponents(){this.log("Initializing UI components..."),this.orchestrator.getModule("navigation")&&window.navigationManager&&await window.navigationManager.init(),await this.ensureAuthModalInjected(),this.setupMobileOptimizations(),this.setupThemeHandling(),this.log("UI components initialized")}async ensureAuthModalInjected(){try{if(document.getElementById("authModal"))return;const t=["pages/page_modals/user_auth.html","./pages/page_modals/user_auth.html","/pages/page_modals/user_auth.html"];let e=null;for(const o of t)try{const a=await fetch(o);if(a.ok){e=await a.text();break}}catch{}if(!e)return;const i=document.createElement("div");i.innerHTML=e,document.body.appendChild(i),this.log("Auth modal injected globally")}catch(t){this.log("Auth modal injection failed",t)}}setupMobileOptimizations(){this.log("Setting up mobile optimizations..."),document.addEventListener("touchstart",e=>{e.target.classList.add("touch-active")},{passive:!0}),document.addEventListener("touchend",e=>{e.target.classList.remove("touch-active")},{passive:!0}),document.querySelectorAll("input, textarea, select").forEach(e=>{e.addEventListener("focus",()=>{const i=document.querySelector('meta[name="viewport"]');i&&(i.content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no")})}),this.log("Mobile optimizations set up")}setupThemeHandling(){this.log("Setting up theme handling...");const t=window.matchMedia("(prefers-color-scheme: dark)").matches,i=localStorage.getItem("app-theme")||(t?"dark":"light");this.appState.setState({ui:{theme:i}},"theme-detection"),document.documentElement.setAttribute("data-theme",i),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",o=>{if(!localStorage.getItem("app-theme")){const a=o.matches?"dark":"light";this.appState.setState({ui:{theme:a}},"theme-change"),document.documentElement.setAttribute("data-theme",a)}}),this.log("Theme handling set up")}finalizeApplication(){this.log("Finalizing application initialization..."),this.appState.setState({initialized:!0},"finalization"),this.setupPerformanceMonitoring(),this.setupErrorHandling();const t=this.appState.getPerformanceMetrics();this.log("Application initialization complete",t),this.appState.emit("app-ready",{state:this.appState.state,metrics:t}),this.log("Application ready!")}setupPerformanceMonitoring(){this.log("Setting up performance monitoring..."),setInterval(()=>{if(performance.memory){const t=performance.memory.usedJSHeapSize/1024/1024;t>50&&this.log(`High memory usage: ${t.toFixed(2)}MB`)}},3e4),setInterval(()=>{const t=this.appState.state.performance.functionCallCount;this.log(`Function call count: ${t}`)},6e4)}setupErrorHandling(){this.log("Setting up error handling..."),window.addEventListener("error",t=>{this.log("Global error caught:",t.error),this.appState.emit("app-error",{error:t.error,filename:t.filename,lineno:t.lineno})}),window.addEventListener("unhandledrejection",t=>{this.log("Unhandled promise rejection:",t.reason),this.appState.emit("app-error",{error:t.reason,type:"unhandled-rejection"})})}getAppState(){return this.appState.state}getPerformanceMetrics(){return this.appState.getPerformanceMetrics()}async init(){this.log("Starting application initialization...");try{return this.setupInitializationSteps(),await this.executeInitializationSteps(),this.log("Application initialization successful"),!0}catch(t){return this.log("Application initialization failed:",t),this.appState.emit("app-error",{error:t,type:"initialization-failure"}),!1}}}let _=null;async function G(){console.log("[MAIN] Initializing application...");try{_=new et,await _.init()?(console.log("[MAIN] Application initialized successfully"),window.app=_,window.getAppState=()=>_.getAppState(),window.getPerformanceMetrics=()=>_.getPerformanceMetrics(),window.debugApp=()=>{console.log("App State:",_.getAppState()),console.log("Performance:",_.getPerformanceMetrics())},window.debugAuthState=()=>{console.log("=== AUTH STATE DEBUG ==="),console.log("SocialAuth:",window.socialAuth?.currentUser?.uid||"Not authenticated"),console.log("SocialFeatures:",window.socialFeatures?.currentUser?.uid||"Not authenticated"),console.log("ProfileHub:",window.profileHubManager?.state?.user?.isAuthenticated||!1),console.log("App State User:",_.getAppState().user)},window.debugModuleStatus=()=>{console.log("=== MODULE STATUS DEBUG ==="),console.log("Auth Module:",!!window.socialAuth),console.log("Social Module:",!!window.socialFeatures),console.log("ProfileHub:",!!window.profileHubManager),console.log("Navigation:",!!window.navigationManager),console.log("Firebase Core:",!!window.firebase)},window.debugIntegration=()=>{console.log("=== INTEGRATION DEBUG ==="),console.log("Auth State Listeners:",{auth:window.socialAuth?.authListenerSetUp||!1,social:"Listening via events",profileHub:"Listening via events"}),console.log("Event System:",{authEvents:"auth-state-changed",socialEvents:"social-action",profileHubEvents:"profilehub-state-changed",appEvents:"app-ready, app-error, app-state-changed"})}):console.error("[MAIN] Application initialization failed")}catch(l){console.error("[MAIN] Critical error during initialization:",l)}}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",G):G();console.log("[MAIN] Main.js loaded successfully");window.ORB_DEBUG={log:(l,t=null)=>{console.log(`[FLOATING ORB] ${l}`,t||"")},error:(l,t=null)=>{console.error(`[FLOATING ORB ERROR] ${l}`,t||"")},warn:(l,t=null)=>{console.warn(`[FLOATING ORB WARN] ${l}`,t||"")}};class it{constructor(t={}){this.options={debugMode:!1,enableSounds:!0,useThreeJS:!0,threeJsCdn:"https://unpkg.com/three@0.160.0/build/three.module.js",...t},this.container=null,this.orb=null,this.isInitialized=!1,this.chatDock=null,this.activeTab="dms",this.chatBadges={dms:0,ai:0,space:0},this.activeIndex=0,this.navItems=[],ORB_DEBUG.log("Floating Orb Manager initialized",this.options)}async init(){if(this.isInitialized){ORB_DEBUG.warn("Orb already initialized");return}try{await this.createOrb(),this.adjustSidebarSpacing(),this.bindProfileHubEvents(),this.isInitialized=!0,ORB_DEBUG.log("Floating orb system initialized successfully"),window.innerWidth<=768&&ORB_DEBUG.log("Mobile layout detected - orb positioned in center-right area"),this.options.debugMode&&this.addDemoFeatures(),this.createSaturnRing(),window.innerWidth<=480&&this.orb&&(this.orb.style.boxShadow="0 0 24px rgba(0,229,255,0.55), 0 0 48px rgba(0,229,255,0.35), 0 0 72px rgba(0,229,255,0.18), inset 0 0 28px rgba(255,255,255,0.12), inset 0 0 52px rgba(0,229,255,0.18), inset 0 0 70px rgba(0,229,255,0.08)")}catch(t){ORB_DEBUG.error("Failed to initialize floating orb",t)}}bindProfileHubEvents(){try{if(this._hubBound)return;this._hubBound=!0;const t=(i,o)=>{if(!i)return;const a=i.ui?.hubState==="chatbot-active",s=!!i.chatbot?.isTyping;this.container&&(this.container.setAttribute("data-chatbot",a?"active":"inactive"),this.container.setAttribute("data-typing",s?"true":"false")),this.orb&&(this.orb.classList.toggle("chat-active",a),this.orb.classList.toggle("typing",s)),o?.chatbot?.messages&&this.orb&&(this.orb.classList.add("message-ping"),setTimeout(()=>this.orb&&this.orb.classList.remove("message-ping"),380))},e=window.profileHubManager?.state;e&&(ORB_DEBUG.log("Syncing orb with existing ProfileHub state"),t(e,null)),window.addEventListener("profilehub-state-changed",i=>{const{state:o,changes:a}=i.detail||{};ORB_DEBUG.log("ProfileHub state changed detected by orb",{hubState:o?.ui?.hubState,typing:o?.chatbot?.isTyping}),t(o,a)}),ORB_DEBUG.log("Floating orb bound to ProfileHub events")}catch(t){ORB_DEBUG.warn("Failed to bind ProfileHub events",t)}}async createOrb(){this.container=document.createElement("div"),this.container.className="floating-orb-wrapper",this.container.setAttribute("data-debug",this.options.debugMode),this.stage=document.createElement("div"),this.stage.style.position="absolute",this.stage.style.top="50%",this.stage.style.left="50%",this.stage.style.transform="translate(-50%, -50%)",this.stage.style.width="var(--orbit-size)",this.stage.style.height="var(--orbit-size)",this.scrollLine=document.createElement("div"),this.scrollLine.className="orb-scroll-line",this.scrollState={currentRotation:0,targetRotation:0,lockPoints:[0,60,120,180,240,300],isLocked:!1,sensitivity:.5},ORB_DEBUG.log("Orb scroll system initialized with lock points"),this.orb=document.createElement("div"),this.orb.className="floating-orb",this.orb.title="Chat Center - Click to expand",this.orb.style.transform="translate(-50%, -50%)",this.navContainer=document.createElement("div"),this.navContainer.className="orb-nav-container rotating",this.tooltip=document.createElement("div"),this.tooltip.className="orb-usage-tooltip",this.tooltip.setAttribute("role","status"),this.tooltip.setAttribute("aria-live","polite"),this.tooltip.textContent="Scroll or drag to rotate ‚Ä¢ Release to snap",this.stage.appendChild(this.scrollLine),this.stage.appendChild(this.navContainer),this.stage.appendChild(this.orb),this.container.appendChild(this.stage),this.container.appendChild(this.tooltip),document.body.appendChild(this.container),this.dimmer=document.createElement("div"),this.dimmer.className="chat-dimmer-overlay",document.body.appendChild(this.dimmer),ORB_DEBUG.log("Orb DOM structure created"),this.updateDockingPosition(),window.addEventListener("resize",()=>this.updateDockingPosition(),{passive:!0});try{window.dispatchEvent(new CustomEvent("floating-orb:ready",{detail:{container:this.container,orb:this.orb,orbit:this.orbit,popup:this.popup}})),ORB_DEBUG.log("Dispatched floating-orb:ready event")}catch(t){ORB_DEBUG.warn("Failed to dispatch floating-orb:ready event",t)}this.options.useThreeJS&&this.tryInitThreeJS().catch(t=>{ORB_DEBUG.warn("Three.js enhancement unavailable; using CSS orb only",t)}),this.buildOrbNavigation(),this.startRingOrbit(),this.setupScrollSystem(),this.createChatDrawer(),this.createInputBar(),this.setupEventListeners();try{localStorage.getItem("orb_tooltip_seen")||(this.showToolTip(),localStorage.setItem("orb_tooltip_seen","1"))}catch{}}showToolTip(){this.tooltip&&(this.tooltip.classList.add("show"),clearTimeout(this._tooltipTimer),this._tooltipTimer=setTimeout(()=>{this.tooltip&&this.tooltip.classList.remove("show")},3200))}updateDockingPosition(){const t=document.getElementById("orb-container");if(t)this.container.parentElement!==t&&t.appendChild(this.container),ORB_DEBUG.log("Orb positioned in orb-container");else{const e=document.getElementById("title-container")||document.querySelector(".title-main-container");e&&(e.appendChild(this.container),ORB_DEBUG.log("Orb positioned in title container"))}}buildOrbNavigation(){try{const t=[{id:"nav-home",icon:"üè†",title:"Home",onClick:()=>this.navigateToSection("home-section")},{id:"nav-guides",icon:"üìö",title:"Guides",onClick:()=>this.navigateToSection("guides-section")},{id:"nav-showcase",icon:"üèÜ",title:"Showcase",onClick:()=>this.navigateToSection("showcase-section")},{id:"nav-tools",icon:"üõ†Ô∏è",title:"Tools",onClick:()=>this.navigateToSection("tools-section")},{id:"nav-projects",icon:"üöÄ",title:"Projects",onClick:()=>this.navigateToSection("projects-section")},{id:"nav-chat",icon:"üí¨",title:"Chatbot",onClick:()=>this.toggleChatDrawer(),badge:0}];this.navItems=t,this.navContainer.innerHTML="";const e=360/t.length;t.forEach((i,o)=>{const a=document.createElement("button");a.type="button",a.className="orb-nav-item",a.setAttribute("title",i.title),a.setAttribute("aria-label",i.title),a.setAttribute("role","button"),a.style.setProperty("--angle",`${o*e}deg`),a.innerText=i.icon,i.badge!==void 0&&(a.setAttribute("data-badge",i.badge),this.updateNavBadge(i.id,i.badge)),a.addEventListener("click",s=>{s.preventDefault(),s.stopPropagation(),i.onClick?.()}),a.addEventListener("touchstart",s=>{s.preventDefault(),s.stopPropagation(),a.style.transform="translate(-50%, -50%) translate(var(--x), var(--y)) scale(0.9)",a.style.background="rgba(0, 240, 255, 0.2)"}),a.addEventListener("touchend",s=>{s.preventDefault(),s.stopPropagation(),a.style.transform="translate(-50%, -50%) translate(var(--x), var(--y))",a.style.background="",i.onClick?.()}),this.navContainer.appendChild(a)}),ORB_DEBUG.log("Orb navigation constructed",{count:t.length}),this.updateActiveFromRotation()}catch(t){ORB_DEBUG.warn("Failed to build orb navigation",t)}}createSaturnRing(){try{this.scrollLine||(this.scrollLine=document.createElement("div"),this.scrollLine.className="orb-scroll-line",this.stage&&this.stage.appendChild(this.scrollLine)),this.scrollLine.style.opacity="0.3",ORB_DEBUG.log("Saturn ring created/verified")}catch(t){ORB_DEBUG.warn("Failed to create Saturn ring",t)}}navigateToSection(t){try{const e=document.getElementById(t);if(!e)return;e.style.display="block";const i=document.getElementById("mobileDrawer");i?.classList?.contains("active")&&i.classList.remove("active"),e.scrollIntoView({behavior:"smooth",block:"start"}),ORB_DEBUG.log("Navigated to section via orb",{sectionId:t})}catch{}}startRingOrbit(){try{const t=Array.from(this.navContainer?.children||[]);if(!t.length)return;const e=Math.PI*2,i=()=>{const o=this.scrollState.currentRotation*Math.PI/180,s=(this.navContainer.getBoundingClientRect().width||180)/(window.innerWidth<=480?2.6:2.3),n=window.innerWidth<=480?.2:.3;t.forEach((r,c)=>{const d=e*c/t.length+o,p=Math.cos(d)*s,u=Math.sin(d)*s*n;Math.cos(d)>0?r.classList.add("in-front"):r.classList.remove("in-front"),r.style.setProperty("--x",`${p}px`),r.style.setProperty("--y",`${u}px`)}),this._ringFrame=requestAnimationFrame(i)};this._ringFrame&&cancelAnimationFrame(this._ringFrame),this._ringFrame=requestAnimationFrame(i),ORB_DEBUG.log("Saturn ring orbit started with scroll control"),window.addEventListener("resize",()=>{this._ringFrame&&(cancelAnimationFrame(this._ringFrame),this._ringFrame=null),this.startRingOrbit()},{passive:!0})}catch(t){ORB_DEBUG.warn("Failed to start ring orbit",t)}}setupScrollSystem(){try{let t,e=!1,i=0;ORB_DEBUG.log("Setting up orb scroll system with lock points");const o=()=>{const r=this.scrollState.targetRotation-this.scrollState.currentRotation;Math.abs(r)>.1&&(this.scrollState.currentRotation+=r*.15,this.scrollLine&&this.scrollLine.style.setProperty("--scroll-rotation",`${this.scrollState.currentRotation}deg`),this.updateActiveFromRotation(),requestAnimationFrame(o))},a=r=>{const c=Date.now();c-i<16||(i=c,this.scrollState.targetRotation+=r*this.scrollState.sensitivity,clearTimeout(t),o(),t=setTimeout(()=>{this.snapToNearestLockPoint()},150))};this.container.addEventListener("wheel",r=>{r.preventDefault(),r.stopPropagation(),a(r.deltaY),this.scrollLine&&(this.scrollLine.style.opacity="1"),clearTimeout(this._scrollLineTimeout),this._scrollLineTimeout=setTimeout(()=>{this.scrollLine&&(this.scrollLine.style.opacity="0.3")},2e3)},{passive:!1});let s=0,n=0;this.container.addEventListener("touchstart",r=>{r.touches.length===1&&(e=!0,s=r.touches[0].clientY,n=this.scrollState.currentRotation,this.scrollLine.style.opacity="1")},{passive:!0}),this.container.addEventListener("touchmove",r=>{if(e&&r.touches.length===1){r.preventDefault();const c=(s-r.touches[0].clientY)*2;this.scrollState.targetRotation=n+c,o()}},{passive:!1}),this.container.addEventListener("touchend",()=>{e&&(e=!1,setTimeout(()=>this.snapToNearestLockPoint(),100),setTimeout(()=>{this.scrollLine.style.opacity="0.3"},1500))},{passive:!0}),this.scrollLine.style.opacity="0.3",ORB_DEBUG.log("Scroll system initialized with lock points:",this.scrollState.lockPoints),this._animateScroll=o}catch(t){ORB_DEBUG.warn("Failed to setup scroll system",t)}}snapToNearestLockPoint(){try{let t=this.scrollState.targetRotation%360;t<0&&(t+=360);let e=this.scrollState.lockPoints[0],i=Math.abs(t-e);for(const a of this.scrollState.lockPoints){const s=Math.min(Math.abs(t-a),Math.abs(t-a-360),Math.abs(t-a+360));s<i&&(i=s,e=a)}const o=Math.floor(this.scrollState.targetRotation/360)*360+e;this.scrollState.targetRotation=o,this.scrollState.isLocked=!0,this.container&&(this.container.classList.add("lock-snap"),setTimeout(()=>{this.container&&this.container.classList.remove("lock-snap")},200));try{typeof navigator<"u"&&navigator.vibrate&&navigator.vibrate(30)}catch{}this.updateActiveFromRotation(),this._animateScroll&&requestAnimationFrame(this._animateScroll),ORB_DEBUG.log("Snapped to lock point:",e)}catch(t){ORB_DEBUG.warn("Failed to snap to lock point",t)}}updateActiveFromRotation(){if(!this.navItems||this.navItems.length===0)return;const t=360/this.navItems.length;let e=this.scrollState?.targetRotation??0;e=(e%360+360)%360;const i=Math.round(e/t)%this.navItems.length,o=(this.navItems.length-i)%this.navItems.length;o!==this.activeIndex?(this.activeIndex=o,this.updateCenterPreview()):this.updateCenterPreview()}setActiveIndex(t,e=!0){if(!this.navItems||this.navItems.length===0)return;const i=this.navItems.length,o=(t%i+i)%i;this.activeIndex=o;const a=360/i,s=-o*a,n=this.scrollState?.targetRotation??0,r=Math.round((n-s)/360),c=s+r*360;this.scrollState.targetRotation=c,e&&(this._animateScroll&&requestAnimationFrame(this._animateScroll),this.updateCenterPreview())}navigateActive(){if(!this.navItems||this.navItems.length===0)return;const t=this.navItems[this.activeIndex];if(t){ORB_DEBUG.log("Navigating active orb item",{index:this.activeIndex,title:t.title});try{typeof navigator<"u"&&navigator.vibrate&&navigator.vibrate(30)}catch{}t.onClick?.()}}updateCenterPreview(){try{const t=document.querySelector(".orb-center-preview"),e=document.querySelector(".orb-center-label"),i=this.navItems?.[this.activeIndex];i&&(t&&(t.textContent=i.icon),e&&(e.textContent=i.title),this.orb&&this.orb.setAttribute("aria-label",i.title))}catch{}}async tryInitThreeJS(){if(window.__orbThree)return ORB_DEBUG.log("Three.js already loaded, reusing module"),this.initThreeScene(window.__orbThree);try{ORB_DEBUG.log("Loading Three.js from CDN",{url:this.options.threeJsCdn});const t=await import(this.options.threeJsCdn);window.__orbThree=t,ORB_DEBUG.log("Three.js CDN module loaded successfully"),await this.initThreeScene(t)}catch(t){throw ORB_DEBUG.error("Failed to load Three.js from CDN",t),t}}async initThreeScene(t){ORB_DEBUG.log("Initializing Three.js scene");const e=document.createElement("div");e.className="orb-3d-layer",this.container.appendChild(e),ORB_DEBUG.log("WebGL layer created and added to container");const i=e.clientWidth||200,o=e.clientHeight||200,a=new t.WebGLRenderer({antialias:!0,alpha:!0});e.appendChild(a.domElement);const s=new t.Scene,n=new t.PerspectiveCamera(45,i/o,.1,100);n.position.z=3.2;const r=()=>{const b=e.clientWidth||parseInt(getComputedStyle(e).width),L=e.clientHeight||parseInt(getComputedStyle(e).height),T=Math.min(window.devicePixelRatio||1,2);a.setPixelRatio(T),a.setSize(b,L,!1),n.aspect=b/L,n.updateProjectionMatrix()};r(),new ResizeObserver(r).observe(e),window.addEventListener("resize",r);const c=new t.SphereGeometry(1,64,64),h=document.createElement("canvas");h.width=256,h.height=256;const d=h.getContext("2d"),p=d.createImageData(256,256),u=p.data;for(let b=0;b<u.length;b+=4){const L=b/4%256,T=Math.floor(b/4/256),A=Math.sin(L*.1)*Math.cos(T*.1),R=Math.sin(L*.05+T*.03)*Math.cos(L*.03-T*.05),I=(A+R)*.5+.5,J=(A-R)*.5+.5;u[b]=I*255,u[b+1]=J*255,u[b+2]=255,u[b+3]=255}d.putImageData(p,0,0);const m=new t.CanvasTexture(h);m.wrapS=m.wrapT=t.RepeatWrapping;const v=new t.MeshStandardMaterial({color:3470847,roughness:.15,metalness:.8,emissive:848127,emissiveIntensity:.3,transparent:!0,opacity:.9,normalMap:m,normalScale:new t.Vector2(.3,.3),envMapIntensity:1.2}),E=new t.Mesh(c,v);s.add(E);const w=new t.AmbientLight(6750207,.6);s.add(w);const y=new t.PointLight(8956671,1.5);y.position.set(2,2,2),s.add(y);const S=new t.Clock,x=()=>{const b=S.getElapsedTime();E.rotation.y=b*.4,E.rotation.x=Math.sin(b*.6)*.15,a.render(s,n),requestAnimationFrame(x)};x(),ORB_DEBUG.log("Three.js orb enhancement initialized"),this.webglLayer=e,this.threeRenderer=a,this.threeScene=s,this.threeSphere=E}setupEventListeners(){ORB_DEBUG.log("Setting up orb event listeners",{orb:!!this.orb,chatDrawer:!!this.chatDrawer}),this.orb.addEventListener("click",t=>{t.preventDefault(),t.stopPropagation(),ORB_DEBUG.log("Orb clicked - navigateActive"),this.navigateActive()}),this.orb.addEventListener("keydown",t=>{const e=t.key;e==="ArrowLeft"?(t.preventDefault(),this.setActiveIndex(this.activeIndex-1,!0)):e==="ArrowRight"?(t.preventDefault(),this.setActiveIndex(this.activeIndex+1,!0)):e===" "?(t.preventDefault(),this.snapToNearestLockPoint()):e==="Enter"&&(t.preventDefault(),this.navigateActive())}),this.orb.setAttribute("tabindex","0"),this.orb.setAttribute("role","button"),this.orb.setAttribute("aria-label","Navigation orb"),ORB_DEBUG.log("Event listeners set up")}adjustSidebarSpacing(){ORB_DEBUG.log("Orb floating mode - no layout adjustments needed")}escapeHtml(t){const e=document.createElement("div");return e.textContent=t,e.innerHTML}createChatDrawer(){try{this.chatDrawer=document.createElement("div"),this.chatDrawer.className="chat-drawer",this.chatDrawer.innerHTML=`
        <div class="chat-drawer-header">
          <h3 class="chat-drawer-title">üí¨ Chat Center</h3>
          <button class="chat-drawer-close" aria-label="Close chat">√ó</button>
        </div>
        <div class="chat-drawer-body">
          <div class="chat-drawer-tabs">
            <button class="chat-drawer-tab active" data-tab="dms">DMs</button>
            <button class="chat-drawer-tab" data-tab="ai">AI</button>
            <button class="chat-drawer-tab" data-tab="space">Space</button>
          </div>
          <div class="chat-drawer-content">
            <div class="chat-drawer-sidebar">
              <div class="chat-drawer-conversations" id="chat-conversations">
                <div class="conversation-item active" data-conversation="general">
                  <div class="conversation-avatar">üë•</div>
                  <div class="conversation-info">
                    <div class="conversation-name">General</div>
                    <div class="conversation-preview">Welcome to the community!</div>
                  </div>
                  <div class="conversation-time">now</div>
                </div>
              </div>
            </div>
            <div class="chat-drawer-thread">
              <div class="thread-messages" id="thread-messages">
                <div class="dock-msg me">Hello there!</div>
                <div class="dock-msg bot">Hi! How can I help you today?</div>
              </div>
              <div class="chat-drawer-input" id="drawer-input-slot"></div>
            </div>
          </div>
        </div>
      `,document.body.appendChild(this.chatDrawer),this.chatDrawer.querySelectorAll(".chat-drawer-tab").forEach(e=>{e.addEventListener("click",i=>{this.switchDrawerTab(i.target.dataset.tab)})});const t=this.chatDrawer.querySelector(".chat-drawer-close");t&&t.addEventListener("click",()=>{this.closeChatDrawer()}),this.chatDrawer.querySelectorAll(".conversation-item").forEach(e=>{e.addEventListener("click",i=>{i.stopPropagation(),this.switchConversation(e.dataset.conversation)})}),document.addEventListener("click",e=>{this.chatDrawer&&this.chatDrawer.classList.contains("open")&&!this.chatDrawer.contains(e.target)&&this.closeChatDrawer()}),ORB_DEBUG.log("Chat drawer created successfully")}catch(t){ORB_DEBUG.warn("Failed to create chat drawer",t)}}createInputBar(){try{this.inputBar=document.createElement("div"),this.inputBar.className="orb-input-wrap",this.inputBar.innerHTML=`
        <div class="orb-input">
          <input type="text" placeholder="Send a DM...">
          <button class="send-btn">Send</button>
        </div>
      `,this.container.appendChild(this.inputBar);const t=this.inputBar.querySelector("input"),e=this.inputBar.querySelector(".send-btn"),i=()=>{const o=t.value.trim();o&&(this.sendMessageToActiveTab(o),t.value="",this.openChatDrawer(),/Mobi|Android/i.test(navigator.userAgent)&&setTimeout(()=>t.blur(),50))};e.addEventListener("click",i),t.addEventListener("keypress",o=>{o.key==="Enter"&&i()}),t.addEventListener("click",o=>{o.preventDefault(),o.stopPropagation(),this.chatDrawer.classList.contains("open")||this.openChatDrawer(),ORB_DEBUG.log("Input clicked - opening chat drawer")}),t.addEventListener("focus",()=>{this.chatDrawer.classList.contains("open")||this.openChatDrawer(),ORB_DEBUG.log("Input focused - opening chat drawer")}),ORB_DEBUG.log("Input bar created successfully")}catch(t){ORB_DEBUG.warn("Failed to create input bar",t)}}toggleChatDrawer(){if(ORB_DEBUG.log("toggleChatDrawer called",{chatDrawer:!!this.chatDrawer}),!this.chatDrawer){ORB_DEBUG.warn("No chat drawer available to toggle");return}const t=this.chatDrawer.classList.contains("open");ORB_DEBUG.log("Current drawer state",{isOpen:t}),t?this.closeChatDrawer():this.openChatDrawer(),ORB_DEBUG.log("Chat drawer toggled",{isOpen:!t})}openChatDrawer(){if(this.chatDrawer){this.chatDrawer.classList.add("open");try{const t=this.chatDrawer.querySelector("#drawer-input-slot");t&&this.inputBar&&(this.inputBar.classList.add("inside-drawer"),this.inputBar.parentElement!==t&&t.appendChild(this.inputBar))}catch(t){console.error("[ORB DEBUG] Error moving input to drawer:",t)}this.orb.classList.add("orb-chat-active"),ORB_DEBUG.log("Chat drawer opened")}}closeChatDrawer(){if(this.chatDrawer){this.chatDrawer.classList.remove("open"),this.orb.classList.remove("orb-chat-active");try{this.inputBar&&this.inputBar.classList.remove("inside-drawer"),this.container&&this.inputBar&&this.inputBar.parentElement!==this.container&&this.container.appendChild(this.inputBar)}catch{}ORB_DEBUG.log("Chat drawer closed")}}_bindViewportHandlers(){window.visualViewport&&(this._vvHandler=()=>this._centerDockAndOrb(),window.visualViewport.addEventListener("resize",this._vvHandler),window.visualViewport.addEventListener("scroll",this._vvHandler))}_unbindViewportHandlers(){!window.visualViewport||!this._vvHandler||(window.visualViewport.removeEventListener("resize",this._vvHandler),window.visualViewport.removeEventListener("scroll",this._vvHandler),this._vvHandler=null)}_centerDockAndOrb(){try{if(!this.chatDock||!this.orb)return;const t=window.innerWidth/2,e=window.innerHeight/2,i=520,o=520,a=Math.max(20,Math.min(t-i/2,window.innerWidth-i-20)),s=Math.max(20,Math.min(e-o/2,window.innerHeight-o-20));this.chatDock.style.left=`${a}px`,this.chatDock.style.top=`${s}px`,ORB_DEBUG.log("Chat dock positioned within viewport",{left:Math.round(a),top:Math.round(s),viewport:`${window.innerWidth}x${window.innerHeight}`})}catch(t){ORB_DEBUG.warn("Failed to position dock",t)}}updateInputBarPlaceholder(){if(!this.inputBar)return;const t=this.inputBar.querySelector("input"),e={dms:"Send a DM...",ai:"Ask AI anything...",space:"Post to Space..."};t.placeholder=e[this.activeTab]||"Type a message..."}addDemoFeatures(){ORB_DEBUG.log("Adding demo features for debug mode");const t=document.createElement("div");t.className="orb-debug-indicator",t.innerHTML="üêõ",t.title="Debug Mode Active",t.style.cssText=`
      position: fixed;
      top: 10px;
      right: 10px;
      background: rgba(255, 107, 53, 0.8);
      color: white;
      padding: 4px 8px;
      border-radius: 12px;
      font-size: 12px;
      z-index: 100000;
      pointer-events: none;
    `,document.body.appendChild(t),ORB_DEBUG.log("Demo features added")}switchDrawerTab(t){this.activeTab=t,this.chatDrawer.querySelectorAll(".chat-drawer-tab").forEach(e=>{e.classList.toggle("active",e.dataset.tab===t)}),this.updateChatContent(t),this.updateInputBarPlaceholder(),ORB_DEBUG.log("Switched to drawer tab",{tabName:t})}updateChatContent(t){const e=this.chatDrawer.querySelector("#chat-conversations"),i=this.chatDrawer.querySelector(".thread-title"),o=this.chatDrawer.querySelector("#thread-messages");if(!(!e||!i||!o))switch(t){case"dms":this.updateDMsContent(e,i,o);break;case"ai":this.updateAIContent(e,i,o);break;case"space":this.updateSpaceContent(e,i,o);break}}updateDMsContent(t,e,i){t.innerHTML=`
      <div class="conversation-item active" data-conversation="general">
        <div class="conversation-avatar">üë•</div>
        <div class="conversation-info">
          <div class="conversation-name">General</div>
          <div class="conversation-preview">Welcome to the community!</div>
        </div>
        <div class="conversation-time">now</div>
      </div>
    `,e.textContent="General Chat",i.innerHTML=`
      <div class="dock-msg user">Hello there!</div>
      <div class="dock-msg bot">Hi! How can I help you today?</div>
    `,this.attachConversationListeners()}updateAIContent(t,e,i){t.innerHTML=`
      <div class="conversation-item active" data-conversation="ai-assistant">
        <div class="conversation-avatar">ü§ñ</div>
        <div class="conversation-info">
          <div class="conversation-name">AI Assistant</div>
          <div class="conversation-preview">Ready to help with your projects!</div>
        </div>
        <div class="conversation-time">online</div>
      </div>
    `,e.textContent="AI Assistant",i.innerHTML=`
      <div class="dock-msg ai">Hi! I'm your AI assistant integrated into your ProfileHub. How can I help you navigate or customize your experience?</div>
    `,this.attachConversationListeners()}updateSpaceContent(t,e,i){t.innerHTML=`
      <div class="conversation-item active" data-conversation="space-chat">
        <div class="conversation-avatar">üåå</div>
        <div class="conversation-info">
          <div class="conversation-name">Space Chat</div>
          <div class="conversation-preview">Community group chat - mark your visit!</div>
        </div>
        <div class="conversation-time">live</div>
      </div>
    `,e.textContent="Space Chat",i.innerHTML=`
      <div class="dock-msg system">Welcome to Space Chat! Send a message to mark your visit.</div>
      <div class="dock-msg user">üëã Just dropped by!</div>
      <div class="dock-msg user">üöÄ Building something cool today</div>
      <div class="dock-msg user">üí° Working on a new project</div>
    `,this.attachConversationListeners()}attachConversationListeners(){this.chatDrawer.querySelectorAll(".conversation-item").forEach(t=>{t.addEventListener("click",e=>{e.stopPropagation(),this.switchConversation(t.dataset.conversation)})})}addDemoFeatures(){ORB_DEBUG.log("Adding demo features for debug mode");const t=document.createElement("div");t.className="orb-debug-indicator",t.innerHTML="üêõ",t.title="Debug Mode Active",t.style.cssText=`
      position: fixed;
      top: 10px;
      right: 10px;
      background: rgba(255, 107, 53, 0.8);
      color: white;
      padding: 4px 8px;
      border-radius: 12px;
      font-size: 12px;
      z-index: 100000;
      pointer-events: none;
    `,document.body.appendChild(t),ORB_DEBUG.log("Demo features added")}sendMessageToActiveTab(t){if(ORB_DEBUG.log("Sending message to active tab",{tab:this.activeTab,message:t}),this.chatDock){const e=this.chatDock.querySelector("#thread-messages"),i=document.createElement("div");i.className="dock-msg user",i.textContent=t,e.appendChild(i),e.scrollTop=e.scrollHeight}switch(this.activeTab){case"dms":this.handleDMMessage(t);break;case"ai":this.handleAIMessage(t);break;case"space":this.handleSpaceMessage(t);break}}handleSpaceMessage(t){setTimeout(()=>{const e=this.chatDock.querySelector("#thread-messages");if(e){const i=document.createElement("div");i.className="dock-msg system",i.textContent=`üìç Visit marked: ${new Date().toLocaleTimeString()}`,e.appendChild(i),e.scrollTop=e.scrollHeight}},1e3)}handleAIMessage(t){setTimeout(()=>{const e=this.chatDock.querySelector("#thread-messages");if(e){const i=document.createElement("div");i.className="dock-msg ai",i.textContent="I'm here to help! How can I assist you with your projects today?",e.appendChild(i),e.scrollTop=e.scrollHeight}},1500)}handleDMMessage(t){setTimeout(()=>{const e=this.chatDock.querySelector("#thread-messages");if(e){const i=document.createElement("div");i.className="dock-msg bot",i.textContent="Thanks for your message! I'll get back to you soon.",e.appendChild(i),e.scrollTop=e.scrollHeight}},1200)}async showNewMessageModal(){ORB_DEBUG.log("Showing new message modal");try{const t=await this.fetchFollowers(),e=document.createElement("div");e.className="new-message-modal",e.innerHTML=`
        <div class="modal-content">
          <div class="modal-header">
            <h3>‚úâÔ∏è New Message</h3>
            <button class="modal-close">&times;</button>
          </div>
          <div class="modal-body">
            <div class="recipient-section">
              <label>To:</label>
              <div class="recipient-list" id="recipient-list">
                ${t.length>0?this.renderFollowersList(t):this.renderNoFollowersMessage()}
              </div>
            </div>
            <div class="message-section">
              <textarea id="new-message-text" placeholder="Type your message..." rows="4"></textarea>
            </div>
          </div>
          <div class="modal-actions">
            <button class="send-new-message-btn">Send Message</button>
            <button class="cancel-new-message-btn">Cancel</button>
          </div>
        </div>
      `,document.body.appendChild(e),e.style.display="flex";const i=e.querySelector(".modal-close"),o=e.querySelector(".cancel-new-message-btn"),a=e.querySelector(".send-new-message-btn"),s=e.querySelector("#new-message-text"),n=()=>{document.body.removeChild(e)};i.addEventListener("click",n),o.addEventListener("click",n),e.addEventListener("click",r=>{r.target===e&&n()}),a.addEventListener("click",()=>{const r=s.value.trim();if(!r){this.showNotification("Please enter a message","warning");return}const c=e.querySelector(".recipient-item.selected");if(!c){this.showNotification("Please select a recipient","warning");return}const h=c.dataset.userId,d=c.dataset.userName;this.sendNewMessage(h,d,r),n()}),e.querySelectorAll(".recipient-item").forEach(r=>{r.addEventListener("click",()=>{e.querySelectorAll(".recipient-item").forEach(c=>c.classList.remove("selected")),r.classList.add("selected")})}),setTimeout(()=>s.focus(),100)}catch(t){ORB_DEBUG.error("Failed to show new message modal",t),this.showNotification("Failed to load followers","error")}}async fetchFollowers(){try{const{auth:t,db:e}=await g(async()=>{const{auth:s,db:n}=await import("./auth-YTXLyXWo.js").then(r=>r.f);return{auth:s,db:n}},[],import.meta.url),{doc:i,getDoc:o}=await g(async()=>{const{doc:s,getDoc:n}=await import("https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js");return{doc:s,getDoc:n}},[],import.meta.url);if(!t.currentUser)return[];const a=await o(i(e,"users",t.currentUser.uid));return a.exists()?a.data().following||[]:[]}catch(t){return ORB_DEBUG.error("Failed to fetch followers",t),[]}}renderFollowersList(t){return t.map(e=>`
      <div class="recipient-item" data-user-id="${e}" data-user-name="User ${e.slice(0,8)}">
        <div class="recipient-avatar">üë§</div>
        <div class="recipient-name">User ${e.slice(0,8)}</div>
        <div class="recipient-status">üü¢</div>
      </div>
    `).join("")}renderNoFollowersMessage(){return`
      <div class="no-followers">
        <div class="no-followers-icon">üë•</div>
        <div class="no-followers-text">No followers yet</div>
        <a href="/pages/users.html" class="explore-link">Find friends on Explore page</a>
      </div>
    `}sendNewMessage(t,e,i){ORB_DEBUG.log("Sending new message",{recipientId:t,recipientName:e,message:i}),this.addConversationToList(t,e,i),this.showNotification(`Message sent to ${e}!`,"success")}addConversationToList(t,e,i){const o=this.chatDock.querySelector("#dock-conversations");if(!o)return;const a=document.createElement("div");a.className="conversation-item",a.dataset.conversation=t,a.innerHTML=`
      <div class="conversation-avatar">üë§</div>
      <div class="conversation-info">
        <div class="conversation-name">${e}</div>
        <div class="conversation-preview">${i}</div>
      </div>
      <div class="conversation-time">now</div>
    `,a.addEventListener("click",()=>{this.switchConversation(t)}),o.insertBefore(a,o.firstChild)}switchConversation(t){ORB_DEBUG.log("Switching conversation",{conversationId:t}),this.chatDock.querySelectorAll(".conversation-item").forEach(o=>{o.classList.toggle("active",o.dataset.conversation===t)}),this.chatDock.querySelectorAll(".conversation-item").forEach(o=>{o.replaceWith(o.cloneNode(!0))}),this.chatDock.querySelectorAll(".conversation-item").forEach(o=>{o.addEventListener("click",a=>{a.stopPropagation(),this.switchConversation(o.dataset.conversation)})});const e=this.chatDock.querySelector(".thread-title"),i=this.chatDock.querySelector("#thread-messages");t==="general"?(e.textContent="General Chat",i.innerHTML=`
        <div class="dock-msg me">Hello there!</div>
        <div class="dock-msg bot">Hi! How can I help you today?</div>
      `):(e.textContent=`Chat with User ${t.slice(0,8)}`,i.innerHTML=`
        <div class="dock-msg me">Started conversation</div>
        <div class="dock-msg bot">Hello! How can I help you?</div>
      `)}showNotification(t,e="info"){ORB_DEBUG.log("Showing notification",{message:t,type:e});const i=document.createElement("div");i.className=`orb-notification orb-notification-${e}`,i.textContent=t,document.body.appendChild(i),setTimeout(()=>{i.classList.add("show")},100),setTimeout(()=>{i.classList.remove("show"),setTimeout(()=>{i.parentNode&&i.parentNode.removeChild(i)},300)},3e3)}updateNavBadge(t,e){const i=this.navContainer.querySelector("[data-badge]");i&&(i.setAttribute("data-badge",e),i.style.display=e>0?"block":"none")}updateChatBadges(t){this.chatBadges={...this.chatBadges,...t};const e=Object.values(this.chatBadges).reduce((i,o)=>i+o,0);this.updateNavBadge("nav-chat",e),ORB_DEBUG.log("Chat badges updated",{badges:this.chatBadges,total:e})}createStarNotification(t,e="info"){try{const i=this.container.querySelector(".orb-star-layer")||this.createStarLayer(),o=document.createElement("div");o.className="orb-star",o.innerHTML="‚≠ê",o.title=t;const a=Math.random()*360,s=this.getOrbitRadius(),n=Math.cos(a*Math.PI/180)*s,r=Math.sin(a*Math.PI/180)*s*.3;o.style.setProperty("--x",`${n}px`),o.style.setProperty("--y",`${r}px`),i.appendChild(o),setTimeout(()=>{o.parentNode&&o.parentNode.removeChild(o)},5e3),ORB_DEBUG.log("Star notification created",{message:t,type:e})}catch(i){ORB_DEBUG.warn("Failed to create star notification",i)}}createStarLayer(){const t=document.createElement("div");return t.className="orb-star-layer",this.container.appendChild(t),t}getOrbitRadius(){return parseInt(getComputedStyle(document.documentElement).getPropertyValue("--orbit-size"))/3.5}addChatMessage(t,e,i="bot"){if(this.chatDock){const o=this.chatDock.querySelector(".dock-thread"),a=document.createElement("div");if(a.className=`dock-msg ${i}`,a.textContent=e,o.appendChild(a),o.scrollTop=o.scrollHeight,i!=="me"){const s={...this.chatBadges};s[t]=(s[t]||0)+1,this.updateChatBadges(s)}}}showStarNotification(t,e="info"){this.createStarNotification(t,e)}updateBadges(t){this.updateChatBadges(t)}destroy(){this.container&&this.container.parentNode&&this.container.parentNode.removeChild(this.container),this.chatDock&&this.chatDock.parentNode&&this.chatDock.parentNode.removeChild(this.chatDock);const t=document.querySelector(".sidebar-nav");t&&(t.style.paddingLeft=""),this.isInitialized=!1,ORB_DEBUG.log("Floating orb destroyed")}}document.addEventListener("DOMContentLoaded",()=>{window.floatingOrb=new it({debugMode:!0}),window.floatingOrb.init(),ORB_DEBUG.log("Floating orb system loaded and ready!")});(()=>{const l=(...o)=>console.debug("[Orb3D]",...o);let t=!1;const e=()=>{if(t)return;const o=document.querySelector(".floating-orb-wrapper"),a=document.querySelector(".floating-orb");if(!o||!a){l("Orb not yet in DOM. Will wait for ready event/observer.");return}t=!0,l("Initializing 3D tilt controller");let s=0,n=0,r=0,c=0,h=null;const d=(w,y,S)=>Math.min(S,Math.max(y,w)),p=w=>{a&&(w?a.classList.add("idle"):a.classList.remove("idle"))},u=(w,y)=>{const S=o.getBoundingClientRect(),x=S.left+S.width/2,b=S.top+S.height/2,L=w-x,T=y-b,A=d(L/(S.width/2),-1,1),R=d(T/(S.height/2),-1,1),I=10;n=A*I,s=-R*I};let m=!1;const v=()=>{if(m){requestAnimationFrame(v);return}const w=.12,y=s-r,S=n-c;r+=y*w,c+=S*w,a.style.transform=`translate(-50%,-50%) rotateX(${r.toFixed(2)}deg) rotateY(${c.toFixed(2)}deg)`,requestAnimationFrame(v)},E=w=>{p(!1),w.touches&&w.touches[0]?u(w.touches[0].clientX,w.touches[0].clientY):u(w.clientX,w.clientY),clearTimeout(h),h=setTimeout(()=>p(!0),2200)};window.addEventListener("pointermove",E,{passive:!0}),window.addEventListener("touchmove",E,{passive:!0}),p(!0),requestAnimationFrame(v),l("3D tilt engaged. Try moving your pointer around."),window.orb3dPauseTilt=()=>{m=!0,a.style.transform="translate(-50%,-50%)"},window.orb3dResumeTilt=()=>{m=!1}};document.querySelector(".floating-orb")&&e();const i=new MutationObserver(()=>{document.querySelector(".floating-orb")&&(l("Observer detected orb in DOM"),e(),i.disconnect())});document.body?i.observe(document.body,{childList:!0,subtree:!0}):window.addEventListener("DOMContentLoaded",()=>{i.observe(document.body,{childList:!0,subtree:!0})})})();window.debugOrb={checkStatus:()=>{const l=document.querySelector(".floating-orb"),t=document.querySelector(".floating-orb-wrapper"),e=document.querySelector(".orb-3d-layer"),i=e?.querySelector("canvas"),o=document.querySelector(".chat-dock"),a=document.querySelector(".orb-input-wrap");console.log("[ORB DEBUG] Status check:",{orb:!!l,wrapper:!!t,webglLayer:!!e,canvas:!!i,canvasSize:i?`${i.width}x${i.height}`:"N/A",orbPosition:l?getComputedStyle(l).transform:"N/A",threeLoaded:!!window.__orbThree,chatDock:!!o,inputBar:!!a,windowSize:`${window.innerWidth}x${window.innerHeight}`})},testPositioning:()=>{const l=document.querySelector(".floating-orb-wrapper"),t=document.querySelector(".floating-orb"),e=document.querySelector(".orb-scroll-line");if(l){const o=document.getElementById("title-container");console.log("[ORB DEBUG] Orb positioning test:",{wrapper:!!l,orb:!!t,scrollLine:!!e,parent:l?.parentElement?.id||l?.parentElement?.className,titleContainer:!!o,wrapperRect:l?.getBoundingClientRect(),orbRect:t?.getBoundingClientRect(),scrollLineRect:e?.getBoundingClientRect()})}const i=document.querySelector(".chat-dock");if(i&&console.log("[ORB DEBUG] Chat dock positioning test:",{chatDock:!!i,chatDockRect:i?.getBoundingClientRect(),chatDockClasses:i?.className,viewport:`${window.innerWidth}x${window.innerHeight}`}),e){const o=getComputedStyle(e);console.log("[ORB DEBUG] Saturn ring test:",{transform:o.transform,opacity:o.opacity,background:o.background})}},testInteractions:()=>{const l=document.querySelector(".chat-drawer"),t=document.querySelectorAll(".chat-drawer-tab"),e=document.querySelectorAll(".orb-nav-item");console.log("[ORB DEBUG] Mobile interaction test:",{chatDrawer:!!l,chatDrawerOpen:l?.classList.contains("open"),drawerTabsCount:t.length,navItemsCount:e.length,drawerTabsInteractive:Array.from(t).map(i=>({element:!!i,pointerEvents:getComputedStyle(i).pointerEvents,cursor:getComputedStyle(i).cursor})),navItemsInteractive:Array.from(e).map(i=>({element:!!i,pointerEvents:getComputedStyle(i).pointerEvents,touchAction:getComputedStyle(i).touchAction}))}),console.log("[ORB DEBUG] Mobile features:",{isMobile:/Mobi|Android/i.test(navigator.userAgent),viewportWidth:window.innerWidth,orbSize:getComputedStyle(document.querySelector(".floating-orb")).width,navItemSize:getComputedStyle(e[0]).width})},openChatDrawer:()=>{window.floatingOrb&&(window.floatingOrb.openChatDrawer(),console.log("[ORB DEBUG] Chat drawer opened"))},closeChatDrawer:()=>{window.floatingOrb&&(window.floatingOrb.closeChatDrawer(),console.log("[ORB DEBUG] Chat drawer closed"))},clearAll:()=>{window.floatingOrb&&(window.floatingOrb.clear(),console.log("[ORB DEBUG] All chat badges cleared"))}};const f={log:(l,t=null)=>{console.log(`[HOME TIMELINE] ${l}`,t||"")},error:(l,t=null)=>{console.error(`[HOME TIMELINE ERROR] ${l}`,t||"")}};let C=[];async function N(){f.log("Home Timeline: Loading random quips from explore page");try{const l=await O($(D,"widgets")),t=[];l.forEach(o=>{const a=o.data();f.log("Home Timeline: Processing explore widget",{id:o.id,title:a.title,userId:a.userId,fileCount:a.files?.length||0}),t.push({...a,id:o.id,userId:a.userId})}),f.log("Home Timeline: Total widgets found",{count:t.length});const e=t.filter(o=>{const a=Q(o.files);return a&&a.downloadURL});f.log("Home Timeline: Valid widgets with HTML",{count:e.length}),C=ot(e).slice(0,4),f.log("Home Timeline: Random quips selected",{count:C.length,quips:C.map(o=>({id:o.id,title:o.title}))})}catch(l){f.error("Home Timeline: Failed to load random quips",l),C=[]}}function ot(l){for(let t=l.length-1;t>0;t--){const e=Math.floor(Math.random()*(t+1));[l[t],l[e]]=[l[e],l[t]]}return l}function Q(l){if(!Array.isArray(l)||l.length===0)return null;const t=l.find(e=>e.fileName&&/index\.html?$/i.test(e.fileName));return t||l.find(e=>e.fileName&&/\.html?$/i.test(e.fileName))}async function M(){f.log("Home Timeline: Rendering random explore quips"),await N();let l=document.querySelector(".home-timeline-container");if(!l){l=document.createElement("div"),l.className="home-timeline-container",l.style.cssText=`
      max-width: 1200px;
      margin: 40px auto;
      padding: 0 20px;
    `;const o=document.getElementById("guest-cta-section");o&&o.parentNode.insertBefore(l,o.nextSibling)}l.innerHTML="";const t=document.createElement("div");t.style.cssText=`
    text-align: center;
    margin-bottom: 40px;
  `,t.innerHTML=`
    <h2 style="color: var(--primary-neon); font-family: 'Orbitron', monospace; font-size: 2rem; margin: 0 0 10px 0; text-shadow: 0 0 10px rgba(0, 240, 255, 0.5);">
      üåü Featured Quips
    </h2>
    <p style="color: var(--text-secondary); font-size: 1.1rem; margin: 0;">
      Discover amazing creations from our community
    </p>
  `,l.appendChild(t);const e=document.createElement("div");e.className="timeline-events-container",e.style.cssText=`
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 24px;
    margin-top: 30px;
  `,C.forEach((o,a)=>{f.log("Home Timeline: Rendering explore quip",{index:a,quipId:o.id,title:o.title});const s=document.createElement("div");s.className="timeline-event",s.style.cssText=`
      background: linear-gradient(135deg, rgba(0, 240, 255, 0.05) 0%, rgba(255, 0, 255, 0.02) 100%);
      border: 1px solid rgba(0, 240, 255, 0.2);
      border-radius: 16px;
      padding: 20px;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    `,s.addEventListener("mouseenter",()=>{s.style.transform="translateY(-5px)",s.style.boxShadow="0 10px 30px rgba(0, 240, 255, 0.2)"}),s.addEventListener("mouseleave",()=>{s.style.transform="translateY(0)",s.style.boxShadow="none"});const n=document.createElement("div");n.className="timeline-event-card";const r=Q(o.files);n.innerHTML=`
      <div class="quip-preview" style="margin-bottom:12px;position:relative;">
        <iframe class="quip-iframe webgl-enabled" title="Quip Preview - ${o.title||"Untitled Quip"}" style="width:100%;height:200px;border:0;border-radius:12px;background:#0a0a0a;"></iframe>
        <div class="quip-overlay" style="position:absolute;top:8px;right:8px;opacity:0.8;">
          <span class="quip-type-badge" style="background:rgba(0,240,255,0.2);color:#00f0ff;padding:4px 8px;border-radius:12px;font-size:0.8rem;font-family:JetBrains Mono;">QUIP</span>
        </div>
      </div>
      <div class="quip-info">
        <h3 style="color:#00f0ff;margin:0 0 8px 0;font-family:JetBrains Mono;font-size:1.1rem;">${o.title||"Untitled Quip"}</h3>
        <p style="color:#a0a0a0;margin:0 0 12px 0;line-height:1.4;font-size:0.9rem;">by ${o.userName||"Unknown Creator"}</p>
        <div class="quip-actions" style="display:flex;gap:8px;flex-wrap:wrap;">
          <button class="quip-interact-btn" style="background:rgba(0,240,255,0.1);border:1px solid #00f0ff;color:#00f0ff;padding:6px 12px;border-radius:6px;cursor:pointer;font-size:0.8rem;transition:all 0.3s ease;">üéÆ Interact</button>
          <button class="quip-explore-btn" onclick="window.location.href='pages/explore.html'" style="background:rgba(255,107,53,0.1);border:1px solid #ff6b35;color:#ff6b35;padding:6px 12px;border-radius:6px;cursor:pointer;font-size:0.8rem;transition:all 0.3s ease;">üîç Explore</button>
        </div>
      </div>
    `;const c=n.querySelector(".quip-iframe");c.setAttribute("sandbox","allow-scripts allow-same-origin allow-forms allow-webgl allow-pointer-lock"),r&&r.downloadURL?c.src=r.downloadURL:c.srcdoc=`
        <div style="padding: 20px; text-align: center; color: #888; background: #111; border-radius: 8px; font-family: Arial, sans-serif;">
          <h3>‚ö†Ô∏è Preview Unavailable</h3>
          <p>No preview available for this quip</p>
        </div>
      `,n.querySelector(".quip-interact-btn").addEventListener("click",()=>{f.log("Home Timeline: Quip interact button clicked",{quipId:o.id}),c.focus(),c.style.borderColor="#ffff00",setTimeout(()=>{c.style.borderColor="#00f0ff"},2e3)}),s.appendChild(n),e.appendChild(s)}),l.appendChild(e);const i=document.createElement("div");i.style.cssText=`
    text-align: center;
    margin-top: 30px;
  `,i.innerHTML=`
    <button id="refresh-timeline-btn" style="background: rgba(0,240,255,0.1); border: 1px solid var(--primary-neon); border-radius: 8px; color: var(--primary-neon); padding: 10px 20px; cursor: pointer; font-size: 0.9rem; font-family: 'Inter', sans-serif; font-weight: 500; transition: all 0.3s ease;" onmouseover="this.style.background='rgba(0,240,255,0.2)'" onmouseout="this.style.background='rgba(0,240,255,0.1)'">
      üîÑ Refresh Featured Quips
    </button>
  `,l.appendChild(i),document.getElementById("refresh-timeline-btn").addEventListener("click",()=>{f.log("Home Timeline: Refreshing featured quips"),console.log("üîÑ [FEATURE TRIGGER] Random Explore Quips refresh button clicked"),M()}),f.log("Home Timeline: Random explore quips rendered successfully")}async function V(){f.log("Home Timeline: Initializing random explore quips display");try{await M(),P.onAuthStateChanged(l=>{l?(f.log("Home Timeline: User authenticated, refreshing featured quips",{uid:l.uid}),M()):(f.log("Home Timeline: User signed out, refreshing featured quips"),M())}),f.log("Home Timeline: Initialization complete")}catch(l){f.error("Home Timeline: Failed to initialize",l)}}document.addEventListener("DOMContentLoaded",async function(){f.log("Home Timeline: DOM Content Loaded - Starting random explore quips initialization"),console.log("üåü [FEATURE INIT] Random Explore Quips Timeline feature initializing..."),await V(),console.log("‚úÖ [FEATURE INIT] Random Explore Quips Timeline feature initialized successfully!")});window.homeTimelineManager={renderHomeTimelineQuips:M,initializeHomeTimeline:V,loadRandomExploreQuips:N};f.log("Home Timeline: Script loaded successfully");class at{constructor(){this.currentUser=null,this.userWidgets=[],this.widgetData={},this.userQuips=[],this.quipData={},this.debugMode=!0}log(t,e=null){this.debugMode&&console.log(`[WidgetDisplay] ${t}`,e)}error(t,e=null){console.error(`[WidgetDisplay] ${t}`,e)}async init(){if(this.currentUser=P.currentUser,!this.currentUser){this.log("No user logged in for widget display");return}this.log("Initializing enhanced widget display system with quip support"),await this.loadUserWidgets(),await this.loadUserQuips(),this.setupWidgetSlots(),this.setupQuipSlots(),this.setupProfileMenuIntegration()}async loadUserWidgets(){try{const t=await q(k(D,"users",this.currentUser.uid));if(t.exists()){const e=t.data();this.userWidgets=e.widgets||[],this.log("Loaded user widgets",{widgetCount:this.userWidgets.length}),await this.loadWidgetMetadata()}}catch(t){this.error("Error loading user widgets",t)}}async loadWidgetMetadata(){try{for(const t of this.userWidgets){const e=await q(k(D,"widgets",t));e.exists()&&(this.widgetData[t]=e.data())}this.log("Loaded widget metadata",{widgetCount:Object.keys(this.widgetData).length})}catch(t){this.error("Error loading widget metadata",t)}}async loadUserQuips(){try{this.log("Loading user quips for user:",this.currentUser.uid);const t=$(D,"quips"),e=H(t,F("userId","==",this.currentUser.uid)),i=await O(e);this.userQuips=i.docs.map(o=>o.id),this.log("Loaded user quips",{quipCount:this.userQuips.length,quipIds:this.userQuips}),await this.loadQuipMetadata()}catch(t){if(this.error("Error loading user quips",t),t.code==="permission-denied"&&(this.log("Permission denied - user may not be authenticated properly"),window.socialAuth&&window.socialAuth.currentUser)){this.log("Retrying with current auth user"),this.currentUser=window.socialAuth.currentUser;try{const e=$(D,"quips"),i=H(e,F("userId","==",this.currentUser.uid)),o=await O(i);this.userQuips=o.docs.map(a=>a.id),this.log("Retry successful - loaded user quips",{quipCount:this.userQuips.length}),await this.loadQuipMetadata()}catch(e){this.error("Retry also failed",e)}}}}async loadQuipMetadata(){try{for(const t of this.userQuips){const e=await q(k(D,"quips",t));e.exists()&&(this.quipData[t]=e.data())}this.log("Loaded quip metadata",{quipCount:Object.keys(this.quipData).length})}catch(t){this.error("Error loading quip metadata",t)}}findHtmlFile(t){if(!Array.isArray(t)||t.length===0)return null;const e=t.find(i=>i.fileName&&/index\.html?$/i.test(i.fileName));return e||t.find(i=>i.fileName&&/\.html?$/i.test(i.fileName))}setupWidgetSlots(){document.querySelectorAll("[data-widget-slot]").forEach(e=>{const i=e.dataset.widgetSlot;this.renderWidgetSlot(e,i)})}setupQuipSlots(){document.querySelectorAll(".quip-slot, .quip-preview, .timeline-event-card").forEach((e,i)=>{this.renderQuipSlot(e,i+1)})}async renderQuipSlot(t,e){const i=Object.values(this.quipData).find(o=>o.slot===parseInt(e));if(i&&i.files&&this.findHtmlFile(i.files)){const o=this.findHtmlFile(i.files);this.showQuipIframe(t,o.downloadURL,i)}else this.showEmptyQuipSlot(t,e)}async renderWidgetSlot(t,e){const i=Object.values(this.widgetData).find(o=>o.slot===parseInt(e));if(i&&i.files&&this.findHtmlFile(i.files)){const o=this.findHtmlFile(i.files);this.showWidgetIframe(t,o.downloadURL,i)}else this.showUploadInterface(t,e)}showWidgetIframe(t,e,i){t.innerHTML=`
      <div class="widget-container">
        <div class="widget-header">
          <h3>${i.title||"Untitled Widget"}</h3>
          <div class="widget-actions">
            <button class="btn btn-secondary edit-widget-btn" data-widget-id="${i.id}">
              <span class="material-icons">edit</span>
              Edit
            </button>
            <button class="btn btn-secondary preview-widget-btn" data-widget-id="${i.id}">
              <span class="material-icons">open_in_new</span>
              Full View
            </button>
            <button class="btn btn-danger delete-widget-btn" data-widget-id="${i.id}">
              <span class="material-icons">delete</span>
              Delete
            </button>
          </div>
        </div>
        <div class="widget-frame-container">
          <iframe 
            src="${e}" 
            class="widget-iframe"
            frameborder="0"
            sandbox="allow-scripts allow-same-origin allow-forms"
            title="Widget ${i.title}"
          ></iframe>
        </div>
        <div class="widget-info">
          <p><strong>Description:</strong> ${i.description||"No description"}</p>
          <p><strong>Category:</strong> ${i.category||"General"}</p>
          <p><strong>Tags:</strong> ${i.tags?.join(", ")||"No tags"}</p>
          <p><strong>Last Updated:</strong> ${new Date(i.updatedAt?.toDate()||i.updatedAt).toLocaleDateString()}</p>
          <div class="widget-stats">
            <span class="stat">üëÅÔ∏è ${i.stats?.views||0} views</span>
            <span class="stat">‚ù§Ô∏è ${i.stats?.likes||0} likes</span>
            <span class="stat">üì§ ${i.stats?.shares||0} shares</span>
          </div>
        </div>
      </div>
    `,this.setupWidgetActionHandlers(t)}showQuipIframe(t,e,i){t.innerHTML=`
      <div class="quip-container">
        <div class="quip-header">
          <h3 style="color: #00f0ff; font-family: JetBrains Mono;">${i.title||"Untitled Quip"}</h3>
          <div class="quip-badges">
            <span class="quip-type-badge" style="background: rgba(0,240,255,0.2); color: #00f0ff; padding: 4px 8px; border-radius: 12px; font-size: 0.8rem;">QUIP</span>
            ${i.webglEnabled?'<span class="webgl-badge" style="background: rgba(255,0,255,0.2); color: #ff00ff; padding: 4px 8px; border-radius: 12px; font-size: 0.8rem;">WebGL</span>':""}
          </div>
          <div class="quip-actions">
            <button class="btn btn-primary interact-quip-btn" data-quip-id="${i.id}">
              <span>üéÆ</span>
              Interact
            </button>
            <button class="btn btn-secondary edit-quip-btn" data-quip-id="${i.id}">
              <span>‚úèÔ∏è</span>
              Edit
            </button>
            <button class="btn btn-secondary preview-quip-btn" data-quip-id="${i.id}">
              <span>üëÅÔ∏è</span>
              Full View
            </button>
            <button class="btn btn-danger delete-quip-btn" data-quip-id="${i.id}">
              <span>üóëÔ∏è</span>
              Delete
            </button>
          </div>
        </div>
        <div class="quip-frame-container">
          <iframe 
            src="${e}" 
            class="quip-iframe webgl-enabled"
            frameborder="0"
            loading="lazy"
            sandbox="allow-scripts allow-same-origin allow-forms allow-webgl allow-pointer-lock"
            style="width: 100%; height: 300px; border-radius: 12px; border: 2px solid #00f0ff; background: #0a0a0a;"
            title="Quip Preview - ${i.title||"Untitled Quip"}"
          ></iframe>
        </div>
        <div class="quip-info">
          <p style="color: #a0a0a0; margin: 8px 0;">${i.description||"No description available"}</p>
          <div class="quip-meta">
            <span class="quip-interactions" style="color: #00f0ff;">Interactions: ${i.interactionCount||0}</span>
            <span class="quip-category" style="color: #ff00ff;">Category: ${i.category||"general"}</span>
          </div>
        </div>
      </div>
    `;const o=t.querySelector(".quip-iframe");U&&typeof U.applyDashboardSettings=="function"&&U.applyDashboardSettings(o,{borderColor:"#00f0ff",borderWidth:"2px",borderRadius:"12px",shadow:"0 0 20px rgba(0, 240, 255, 0.3), inset 0 1px 0 rgba(255, 255, 255, 0.1)"}),this.setupQuipActionHandlers(t)}showEmptyQuipSlot(t,e){t.innerHTML=`
      <div class="empty-quip-slot" style="text-align: center; padding: 40px; border: 2px dashed #333; border-radius: 12px; background: rgba(0,240,255,0.05);">
        <div style="font-size: 3rem; margin-bottom: 16px; color: #00f0ff;">üéÆ</div>
        <h3 style="color: #00f0ff; margin-bottom: 8px; font-family: JetBrains Mono;">Empty Quip Slot ${e}</h3>
        <p style="color: #a0a0a0; margin-bottom: 16px;">Create an interactive WebGL quip to fill this slot</p>
        <button class="btn btn-primary create-quip-btn" data-slot="${e}" style="background: rgba(0,240,255,0.1); border: 1px solid #00f0ff; color: #00f0ff; padding: 8px 16px; border-radius: 6px;">
          <span>‚ûï</span>
          Create Quip
        </button>
      </div>
    `,this.setupEmptyQuipHandlers(t)}showUploadInterface(t,e){t.innerHTML=`
      <div class="widget-upload-container">
        <h3>Widget Slot ${e}</h3>
        <p>Upload your widget files to get started</p>
        <div class="upload-area" data-slot="${e}">
          <input type="file" id="widgetFiles${e}" multiple accept=".html,.js,.css,.png,.jpg,.jpeg,.gif,.svg,.json,.mp3,.mp4,.wav,.ogg" style="display: none;">
          <div class="upload-placeholder">
            <span class="material-icons">cloud_upload</span>
            <p>Drop files here or click to upload</p>
            <p class="upload-hint">Supports: HTML, CSS, JS, Images, Audio, Video</p>
          </div>
        </div>
        <div class="upload-form" style="display: none;">
          <input type="text" placeholder="Widget Title" class="widget-title-input" data-slot="${e}">
          <textarea placeholder="Widget Description" class="widget-desc-input" data-slot="${e}" rows="3"></textarea>
          <input type="text" placeholder="Category (e.g., game, tool, art)" class="widget-category-input" data-slot="${e}">
          <input type="text" placeholder="Tags (comma separated)" class="widget-tags-input" data-slot="${e}">
          <button class="btn btn-primary upload-widget-btn" data-slot="${e}">
            <span class="material-icons">upload</span>
            Upload Widget
          </button>
        </div>
      </div>
    `,this.setupUploadHandlers(t,e)}setupUploadHandlers(t,e){const i=t.querySelector(".upload-area"),o=t.querySelector(`#widgetFiles${e}`),a=t.querySelector(".upload-form");o.addEventListener("change",n=>{n.target.files.length>0&&this.handleFileSelection(n.target.files,a)}),i.addEventListener("dragover",n=>{n.preventDefault(),i.classList.add("drag-over")}),i.addEventListener("dragleave",n=>{n.preventDefault(),i.classList.remove("drag-over")}),i.addEventListener("drop",n=>{n.preventDefault(),i.classList.remove("drag-over");const r=n.dataTransfer.files;r.length>0&&(o.files=r,this.handleFileSelection(r,a))}),i.addEventListener("click",()=>{o.click()}),t.querySelector(".upload-widget-btn").addEventListener("click",()=>{this.uploadWidget(e)})}handleFileSelection(t,e){e.style.display="block";const i=Array.from(t).map(o=>o.name).join(", ");e.querySelector(".upload-placeholder p").textContent=`Selected: ${i}`}async uploadWidget(t){if(this.log("Widget upload requested, delegating to WidgetUploadManager"),!window.widgetUploadManager){const{default:i}=await g(async()=>{const{default:o}=await import("./widget-upload-BU_ZWewu.js");return{default:o}},__vite__mapDeps([2,3,1,4]),import.meta.url);window.widgetUploadManager=i}const e=document.querySelector(`.upload-widget-btn[data-slot="${t}"]`);e?await window.widgetUploadManager.handleUploadButtonClick(e):this.error("Upload button not found for slot",{slotNumber:t})}setupWidgetActionHandlers(t){const e=t.querySelector(".edit-widget-btn");e&&e.addEventListener("click",a=>{const s=a.target.closest(".edit-widget-btn").dataset.widgetId;this.editWidget(s)});const i=t.querySelector(".preview-widget-btn");i&&i.addEventListener("click",a=>{const s=a.target.closest(".preview-widget-btn").dataset.widgetId;this.previewWidget(s)});const o=t.querySelector(".delete-widget-btn");o&&o.addEventListener("click",a=>{const s=a.target.closest(".delete-widget-btn").dataset.widgetId;this.deleteWidget(s)})}setupQuipActionHandlers(t){const e=t.querySelector(".interact-quip-btn");e&&e.addEventListener("click",s=>{const n=s.target.closest(".interact-quip-btn").dataset.quipId;this.interactWithQuip(n)});const i=t.querySelector(".edit-quip-btn");i&&i.addEventListener("click",s=>{const n=s.target.closest(".edit-quip-btn").dataset.quipId;this.editQuip(n)});const o=t.querySelector(".preview-quip-btn");o&&o.addEventListener("click",s=>{const n=s.target.closest(".preview-quip-btn").dataset.quipId;this.previewQuip(n)});const a=t.querySelector(".delete-quip-btn");a&&a.addEventListener("click",s=>{const n=s.target.closest(".delete-quip-btn").dataset.quipId;this.deleteQuip(n)})}setupEmptyQuipHandlers(t){const e=t.querySelector(".create-quip-btn");e&&e.addEventListener("click",i=>{const o=i.target.closest(".create-quip-btn").dataset.slot;this.createNewQuip(o)})}previewWidget(t){const e=this.widgetData[t];if(!e){this.showToast("Widget not found","error");return}const i=this.findHtmlFile(e.files);if(!i||!i.downloadURL){this.showToast("Widget HTML file not found","error");return}let o=document.getElementById("widgetPreviewModal");o||(o=document.createElement("div"),o.id="widgetPreviewModal",o.className="modal",o.innerHTML=`
        <div class="modal-content widget-preview-modal">
          <div class="modal-header">
            <h3>${e.title}</h3>
            <button class="close-modal">√ó</button>
          </div>
          <div class="modal-body">
            <iframe 
              src="${i.downloadURL}" 
              class="widget-preview-iframe"
              frameborder="0"
              sandbox="allow-scripts allow-same-origin allow-forms"
              title="Widget Preview"
            ></iframe>
          </div>
        </div>
      `,document.body.appendChild(o),o.querySelector(".close-modal").addEventListener("click",()=>{o.style.display="none"}),o.addEventListener("click",s=>{s.target===o&&(o.style.display="none")})),o.querySelector("h3").textContent=e.title,o.querySelector("iframe").src=i.downloadURL,o.style.display="block"}editWidget(t){const e=this.widgetData[t];if(!e){this.showToast("Widget not found","error");return}const i=document.querySelector(`[data-widget-slot="${e.slot}"]`);if(i){this.showUploadInterface(i,e.slot);const o=i.querySelector(".widget-title-input"),a=i.querySelector(".widget-desc-input"),s=i.querySelector(".widget-category-input"),n=i.querySelector(".widget-tags-input");o&&(o.value=e.title||""),a&&(a.value=e.description||""),s&&(s.value=e.category||""),n&&(n.value=e.tags?.join(", ")||"")}}async deleteWidget(t){const e=this.widgetData[t];if(!e){this.showToast("Widget not found","error");return}if(confirm(`Are you sure you want to delete "${e.title}"?`))try{await z(k(D,"widgets",t)),await W(k(D,"users",this.currentUser.uid),{widgets:X(t)}),await this.loadUserWidgets(),this.setupWidgetSlots(),this.showToast(`Widget "${e.title}" deleted successfully`,"success"),this.log("Widget deleted successfully",{widgetId:t})}catch(i){this.error("Error deleting widget",i),this.showToast("Failed to delete widget: "+i.message,"error")}}setupProfileMenuIntegration(){this.updateProfileMenuWidgetCount(),this.addWidgetManagementToProfile()}updateProfileMenuWidgetCount(){const t=document.querySelector(".profile-menu");if(t){const e=t.querySelector(".widget-count");if(e)e.textContent=this.userWidgets.length;else{const i=document.createElement("div");i.className="widget-count",i.textContent=this.userWidgets.length,t.appendChild(i)}}}addWidgetManagementToProfile(){const t=document.querySelector(".profile-menu");if(t&&!t.querySelector(".widget-management")){const e=document.createElement("div");e.className="widget-management",e.innerHTML=`
        <h4>My Widgets (${this.userWidgets.length})</h4>
        <div class="widget-list">
          ${this.userWidgets.length===0?'<p>No widgets yet. <a href="#" class="upload-widget-link">Upload your first widget!</a></p>':this.userWidgets.map(i=>{const o=this.widgetData[i];return o?`
                <div class="widget-item" data-widget-id="${i}">
                  <div class="widget-info">
                    <h5>${o.title}</h5>
                    <p>${o.description||"No description"}</p>
                    <span class="widget-category">${o.category}</span>
                  </div>
                  <div class="widget-actions">
                    <button class="btn btn-sm preview-widget-btn" data-widget-id="${i}">Preview</button>
                    <button class="btn btn-sm edit-widget-btn" data-widget-id="${i}">Edit</button>
                    <button class="btn btn-sm btn-danger delete-widget-btn" data-widget-id="${i}">Delete</button>
                  </div>
                </div>
              `:""}).join("")}
        </div>
      `,t.appendChild(e),this.setupProfileMenuEventListeners(e)}}setupProfileMenuEventListeners(t){t.querySelectorAll(".preview-widget-btn").forEach(i=>{i.addEventListener("click",o=>{const a=o.target.dataset.widgetId;this.previewWidget(a)})}),t.querySelectorAll(".edit-widget-btn").forEach(i=>{i.addEventListener("click",o=>{const a=o.target.dataset.widgetId;this.editWidget(a)})}),t.querySelectorAll(".delete-widget-btn").forEach(i=>{i.addEventListener("click",o=>{const a=o.target.dataset.widgetId;this.deleteWidget(a)})});const e=t.querySelector(".upload-widget-link");e&&e.addEventListener("click",i=>{i.preventDefault();const o=document.querySelector("[data-widget-slot]");o&&o.scrollIntoView({behavior:"smooth"})})}async interactWithQuip(t){const e=this.quipData[t];if(!e){this.showToast("Quip not found","error");return}const i=document.querySelector(`[data-quip-id="${t}"] .quip-iframe`);i&&(i.focus(),i.style.borderColor="#ffff00",setTimeout(()=>{i.style.borderColor="#00f0ff"},2e3));try{await W(k(D,"quips",t),{interactionCount:(e.interactionCount||0)+1,lastInteracted:K()}),this.log("Quip interaction tracked",{quipId:t})}catch(o){this.error("Failed to track quip interaction",o)}}editQuip(t){if(!this.quipData[t]){this.showToast("Quip not found","error");return}const i=`pages/widget_studio.html?edit=${t}`;window.location.href=i}previewQuip(t){const e=this.quipData[t];if(!e){this.showToast("Quip not found","error");return}const i=this.findHtmlFile(e.files);if(!i||!i.downloadURL){this.showToast("Quip HTML file not found","error");return}let o=document.getElementById("quipPreviewModal");o||(o=document.createElement("div"),o.id="quipPreviewModal",o.className="modal",o.innerHTML=`
        <div class="modal-content" style="max-width: 90vw; max-height: 90vh;">
          <div class="modal-header">
            <h3>Quip Preview</h3>
            <button class="modal-close">&times;</button>
          </div>
          <div class="modal-body">
            <iframe 
              src="${i.downloadURL}" 
              style="width: 100%; height: 70vh; border: none; border-radius: 8px;"
              sandbox="allow-scripts allow-same-origin allow-forms allow-webgl allow-pointer-lock"
            ></iframe>
          </div>
        </div>
      `,document.body.appendChild(o));const a=o.querySelector("iframe");a.src=i.downloadURL,o.querySelector("h3").textContent=`Quip Preview - ${e.title||"Untitled Quip"}`,o.style.display="flex",o.querySelector(".modal-close").onclick=()=>{o.style.display="none"},o.onclick=s=>{s.target===o&&(o.style.display="none")}}async deleteQuip(t){const e=this.quipData[t];if(!e){this.showToast("Quip not found","error");return}if(confirm(`Are you sure you want to delete "${e.title||"Untitled Quip"}"?`))try{await z(k(D,"quips",t)),delete this.quipData[t],this.userQuips=this.userQuips.filter(i=>i!==t),this.showToast("Quip deleted successfully","success"),this.log("Quip deleted",{quipId:t}),this.setupQuipSlots()}catch(i){this.error("Failed to delete quip",i),this.showToast("Failed to delete quip","error")}}createNewQuip(t){const e=`pages/widget_studio.html?slot=${t}&type=quip`;window.location.href=e}showToast(t,e="info"){window.showToast?window.showToast(t,e):console.log(`[${e.toUpperCase()}] ${t}`)}}window.previewWidget=function(l){window.widgetDisplay&&window.widgetDisplay.previewWidget(l)};window.uploadWidget=function(l){window.widgetDisplay&&window.widgetDisplay.uploadWidget(l)};window.editWidget=function(l){window.widgetDisplay&&window.widgetDisplay.editWidget(l)};window.deleteWidget=function(l){window.widgetDisplay&&window.widgetDisplay.deleteWidget(l)};let B=null;P.onAuthStateChanged(l=>{l?B||(B=new at,B.init(),window.widgetDisplay=B):(B=null,window.widgetDisplay=null)});class j{constructor(){this.currentUser=null,this.following=new Set,this.followers=new Set,this.debugMode=!0}log(t,e=null){this.debugMode&&console.log(`[SOCIAL FEATURES] ${t}`,e||"")}error(t,e=null){console.error(`[SOCIAL FEATURES ERROR] ${t}`,e||"")}async init(){this.log("Initializing Social Features Manager"),this.setupAuthListener(),this.setupEventListeners(),this.log("Social Features Manager initialized")}async setupAuthListener(){try{this.log("Setting up auth state listener"),window.addEventListener("auth-state-changed",async t=>{const{user:e}=t.detail;this.currentUser=e,this.log("Social features received auth state change",{userId:e?.uid}),e?await this.loadUserSocialData(e.uid):(this.following.clear(),this.followers.clear())}),this.log("Social features auth listener set up via main auth system")}catch(t){this.error("Failed to setup auth listener",t)}}async loadUserSocialData(t){try{const{db:e}=await g(async()=>{const{db:s}=await import("./auth-YTXLyXWo.js").then(n=>n.f);return{db:s}},[],import.meta.url),{doc:i,getDoc:o}=await g(async()=>{const{doc:s,getDoc:n}=await import("https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js");return{doc:s,getDoc:n}},[],import.meta.url),a=await o(i(e,"users",t));if(a.exists()){const s=a.data();this.following=new Set(s.following||[]),this.followers=new Set(s.followers||[]),this.log("User social data loaded",{following:this.following.size,followers:this.followers.size})}}catch(e){this.error("Failed to load user social data",e)}}async followUser(t){try{if(!this.currentUser)throw new Error("User must be logged in to follow others");const e=this.currentUser.uid;if(e===t)throw new Error("You cannot follow yourself");if(this.following.has(t))throw new Error("You are already following this user");const{db:i}=await g(async()=>{const{db:n}=await import("./auth-YTXLyXWo.js").then(r=>r.f);return{db:n}},[],import.meta.url),{doc:o,updateDoc:a,arrayUnion:s}=await g(async()=>{const{doc:n,updateDoc:r,arrayUnion:c}=await import("https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js");return{doc:n,updateDoc:r,arrayUnion:c}},[],import.meta.url);return await a(o(i,"users",e),{following:s(t)}),await a(o(i,"users",t),{followers:s(e)}),this.following.add(t),await this.createFollowNotification(t,e),this.log("User followed successfully",{targetUserId:t}),{success:!0}}catch(e){return this.error("Follow action failed",e),{success:!1,error:e.message}}}async unfollowUser(t){try{if(!this.currentUser)throw new Error("User must be logged in to unfollow others");const e=this.currentUser.uid;if(!this.following.has(t))throw new Error("You are not following this user");const{db:i}=await g(async()=>{const{db:n}=await import("./auth-YTXLyXWo.js").then(r=>r.f);return{db:n}},[],import.meta.url),{doc:o,updateDoc:a,arrayRemove:s}=await g(async()=>{const{doc:n,updateDoc:r,arrayRemove:c}=await import("https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js");return{doc:n,updateDoc:r,arrayRemove:c}},[],import.meta.url);return await a(o(i,"users",e),{following:s(t)}),await a(o(i,"users",t),{followers:s(e)}),this.following.delete(t),this.log("User unfollowed successfully",{targetUserId:t}),{success:!0}}catch(e){return this.error("Unfollow action failed",e),{success:!1,error:e.message}}}async likeWidget(t){try{if(!this.currentUser)throw new Error("User must be logged in to like widgets");const{db:e}=await g(async()=>{const{db:h}=await import("./auth-YTXLyXWo.js").then(d=>d.f);return{db:h}},[],import.meta.url),{doc:i,updateDoc:o,arrayUnion:a,getDoc:s}=await g(async()=>{const{doc:h,updateDoc:d,arrayUnion:p,getDoc:u}=await import("https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js");return{doc:h,updateDoc:d,arrayUnion:p,getDoc:u}},[],import.meta.url),n=await s(i(e,"widgets",t));if(!n.exists())throw new Error("Widget not found");const r=n.data(),c=this.currentUser.uid;if(r.likes&&r.likes.includes(c))throw new Error("You have already liked this widget");return await o(i(e,"widgets",t),{likes:a(c),"stats.likes":(r.stats?.likes||0)+1}),await this.createLikeNotification(r.userId,c,t,r.title),this.log("Widget liked successfully",{widgetId:t}),{success:!0}}catch(e){return this.error("Like action failed",e),{success:!1,error:e.message}}}async unlikeWidget(t){try{if(!this.currentUser)throw new Error("User must be logged in to unlike widgets");const{db:e}=await g(async()=>{const{db:h}=await import("./auth-YTXLyXWo.js").then(d=>d.f);return{db:h}},[],import.meta.url),{doc:i,updateDoc:o,arrayRemove:a,getDoc:s}=await g(async()=>{const{doc:h,updateDoc:d,arrayRemove:p,getDoc:u}=await import("https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js");return{doc:h,updateDoc:d,arrayRemove:p,getDoc:u}},[],import.meta.url),n=await s(i(e,"widgets",t));if(!n.exists())throw new Error("Widget not found");const r=n.data(),c=this.currentUser.uid;if(!r.likes||!r.likes.includes(c))throw new Error("You have not liked this widget");return await o(i(e,"widgets",t),{likes:a(c),"stats.likes":Math.max(0,(r.stats?.likes||1)-1)}),this.log("Widget unliked successfully",{widgetId:t}),{success:!0}}catch(e){return this.error("Unlike action failed",e),{success:!1,error:e.message}}}async shareWidget(t,e="general"){try{if(!this.currentUser)throw new Error("User must be logged in to share widgets");const{db:i}=await g(async()=>{const{db:h}=await import("./auth-YTXLyXWo.js").then(d=>d.f);return{db:h}},[],import.meta.url),{doc:o,getDoc:a,updateDoc:s,increment:n}=await g(async()=>{const{doc:h,getDoc:d,updateDoc:p,increment:u}=await import("https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js");return{doc:h,getDoc:d,updateDoc:p,increment:u}},[],import.meta.url),r=await a(o(i,"widgets",t));if(!r.exists())throw new Error("Widget not found");const c=r.data();return await s(o(i,"widgets",t),{"stats.shares":n(1)}),await this.createShareNotification(c.userId,this.currentUser.uid,t,c.title,e),await this.handlePlatformSharing(c,e),this.log("Widget shared successfully",{widgetId:t,platform:e}),{success:!0}}catch(i){return this.error("Share action failed",i),{success:!1,error:i.message}}}async handlePlatformSharing(t,e){const i=`${window.location.origin}/widget/${t.id}`,o=`Check out this amazing widget: ${t.title}`;switch(e){case"twitter":window.open(`https://twitter.com/intent/tweet?text=${encodeURIComponent(o)}&url=${encodeURIComponent(i)}`);break;case"facebook":window.open(`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(i)}`);break;case"linkedin":window.open(`https://www.linkedin.com/sharing/share-offsite/?url=${encodeURIComponent(i)}`);break;case"copy":await navigator.clipboard.writeText(`${o}
${i}`),this.showToast("Link copied to clipboard!","success");break;case"native":navigator.share?await navigator.share({title:t.title,text:t.description||o,url:i}):(await navigator.clipboard.writeText(`${o}
${i}`),this.showToast("Link copied to clipboard!","success"));break;default:await navigator.clipboard.writeText(`${o}
${i}`),this.showToast("Link copied to clipboard!","success")}}async discoverUsers(t=10,e=!0){try{const{db:i}=await g(async()=>{const{db:u}=await import("./auth-YTXLyXWo.js").then(m=>m.f);return{db:u}},[],import.meta.url),{collection:o,query:a,where:s,orderBy:n,limit:r,getDocs:c}=await g(async()=>{const{collection:u,query:m,where:v,orderBy:E,limit:w,getDocs:y}=await import("https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js");return{collection:u,query:m,where:v,orderBy:E,limit:w,getDocs:y}},[],import.meta.url);let h=a(o(i,"users"),n("createdAt","desc"),r(t));e&&this.currentUser&&(h=a(o(i,"users"),s("uid","!=",this.currentUser.uid),n("createdAt","desc"),r(t)));const d=await c(h),p=[];return d.forEach(u=>{const m=u.data();p.push({id:u.id,...m,isFollowing:this.following.has(u.id)})}),this.log("Users discovered",{count:p.length}),{success:!0,users:p}}catch(i){return this.error("Failed to discover users",i),{success:!1,error:i.message}}}async getUserFeed(t=20){try{if(!this.currentUser)throw new Error("User must be logged in to view feed");const{db:e}=await g(async()=>{const{db:d}=await import("./auth-YTXLyXWo.js").then(p=>p.f);return{db:d}},[],import.meta.url),{collection:i,query:o,where:a,orderBy:s,limit:n,getDocs:r}=await g(async()=>{const{collection:d,query:p,where:u,orderBy:m,limit:v,getDocs:E}=await import("https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js");return{collection:d,query:p,where:u,orderBy:m,limit:v,getDocs:E}},[],import.meta.url),c=Array.from(this.following),h=[];if(c.length>0){const d=o(i(e,"widgets"),a("userId","in",c),a("isPublic","==",!0),s("createdAt","desc"),n(t));(await r(d)).forEach(u=>{const m=u.data();h.push({type:"widget",id:u.id,data:m,timestamp:m.createdAt})})}return h.sort((d,p)=>p.timestamp?.toDate()-d.timestamp?.toDate()),this.log("User feed loaded",{count:h.length}),{success:!0,feed:h}}catch(e){return this.error("Failed to load user feed",e),{success:!1,error:e.message}}}async createFollowNotification(t,e){try{const{db:i}=await g(async()=>{const{db:p}=await import("./auth-YTXLyXWo.js").then(u=>u.f);return{db:p}},[],import.meta.url),{collection:o,addDoc:a,serverTimestamp:s}=await g(async()=>{const{collection:p,addDoc:u,serverTimestamp:m}=await import("https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js");return{collection:p,addDoc:u,serverTimestamp:m}},[],import.meta.url),{doc:n,getDoc:r}=await g(async()=>{const{doc:p,getDoc:u}=await import("https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js");return{doc:p,getDoc:u}},[],import.meta.url),c=await r(n(i,"users",e)),h=c.exists()?c.data().displayName:"Someone",d={userId:t,type:"follow",title:"New follower! üë•",message:`${h} started following you.`,icon:"üë•",data:{followerId:e,action:"view_profile"},read:!1,timestamp:s()};await a(o(i,"notifications"),d),this.log("Follow notification created",{targetUserId:t,followerId:e})}catch(i){this.error("Failed to create follow notification",i)}}async createLikeNotification(t,e,i,o){try{const{db:a}=await g(async()=>{const{db:m}=await import("./auth-YTXLyXWo.js").then(v=>v.f);return{db:m}},[],import.meta.url),{collection:s,addDoc:n,serverTimestamp:r}=await g(async()=>{const{collection:m,addDoc:v,serverTimestamp:E}=await import("https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js");return{collection:m,addDoc:v,serverTimestamp:E}},[],import.meta.url),{doc:c,getDoc:h}=await g(async()=>{const{doc:m,getDoc:v}=await import("https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js");return{doc:m,getDoc:v}},[],import.meta.url),d=await h(c(a,"users",e)),p=d.exists()?d.data().displayName:"Someone",u={userId:t,type:"like",title:"New like! ‚ù§Ô∏è",message:`${p} liked your widget "${o}".`,icon:"‚ù§Ô∏è",data:{widgetId:i,likerId:e,action:"view_widget"},read:!1,timestamp:r()};await n(s(a,"notifications"),u),this.log("Like notification created",{widgetOwnerId:t,likerId:e,widgetId:i})}catch(a){this.error("Failed to create like notification",a)}}async createShareNotification(t,e,i,o,a){try{const{db:s}=await g(async()=>{const{db:w}=await import("./auth-YTXLyXWo.js").then(y=>y.f);return{db:w}},[],import.meta.url),{collection:n,addDoc:r,serverTimestamp:c}=await g(async()=>{const{collection:w,addDoc:y,serverTimestamp:S}=await import("https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js");return{collection:w,addDoc:y,serverTimestamp:S}},[],import.meta.url),{doc:h,getDoc:d}=await g(async()=>{const{doc:w,getDoc:y}=await import("https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js");return{doc:w,getDoc:y}},[],import.meta.url),p=await d(h(s,"users",e)),u=p.exists()?p.data().displayName:"Someone",v={twitter:"Twitter",facebook:"Facebook",linkedin:"LinkedIn",copy:"copied",native:"shared"}[a]||"shared",E={userId:t,type:"share",title:"Widget shared! üì§",message:`${u} ${v} your widget "${o}".`,icon:"üì§",data:{widgetId:i,sharerId:e,platform:a,action:"view_widget"},read:!1,timestamp:c()};await r(n(s,"notifications"),E),this.log("Share notification created",{widgetOwnerId:t,sharerId:e,widgetId:i,platform:a})}catch(s){this.error("Failed to create share notification",s)}}setupEventListeners(){document.addEventListener("click",async t=>{if(t.target.matches(".follow-btn")){t.preventDefault();const e=t.target.dataset.userId,i=t.target.dataset.following==="true";i?await this.unfollowUser(e):await this.followUser(e),this.updateFollowButton(t.target,!i)}}),document.addEventListener("click",async t=>{if(t.target.matches(".like-btn")){t.preventDefault();const e=t.target.dataset.widgetId,i=t.target.dataset.liked==="true";i?await this.unlikeWidget(e):await this.likeWidget(e),this.updateLikeButton(t.target,!i)}}),document.addEventListener("click",async t=>{if(t.target.matches(".share-btn")){t.preventDefault();const e=t.target.dataset.widgetId,i=t.target.dataset.platform||"native";await this.shareWidget(e,i)}})}updateFollowButton(t,e){t.dataset.following=e.toString(),t.textContent=e?"Following":"Follow",t.className=e?"follow-btn following":"follow-btn"}updateLikeButton(t,e){t.dataset.liked=e.toString(),t.innerHTML=e?"‚ù§Ô∏è Liked":"ü§ç Like",t.className=e?"like-btn liked":"like-btn"}showToast(t,e="info"){const i=document.createElement("div");i.className=`toast ${e}`,i.innerHTML=`
      <span class="toast-message">${t}</span>
      <button class="toast-close">&times;</button>
    `,(document.getElementById("toast-container")||document.body).appendChild(i),setTimeout(()=>{i.parentNode&&i.remove()},5e3),i.querySelector(".toast-close").addEventListener("click",()=>{i.remove()})}}const Y=new j;window.socialFeatures=Y;document.addEventListener("DOMContentLoaded",()=>{Y.init()});const st=Object.freeze(Object.defineProperty({__proto__:null,SocialFeaturesManager:j},Symbol.toStringTag,{value:"Module"}));
