const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./auth-COKA9b7m.js","./timeline-manager-B2jLQ0HO.js","./firebase-core-BO8UvLyb.js","./profile-dashboard-manager-DumQz_VG.js","./widget-upload-EdH-RL5r.js","./cloud-upload-DzQTDkpW.js","./navigation-CiQvIeE9.js"])))=>i.map(i=>d[i]);
import"./modulepreload-polyfill-B5Qt9EMX.js";/* empty css               */import{_ as h}from"./timeline-manager-B2jLQ0HO.js";import{auth as te,db as L}from"./firebase-core-BO8UvLyb.js";import{getDoc as N,doc as T,collection as G,query as Q,where as j,getDocs as V,deleteDoc as K,updateDoc as Y,arrayRemove as me,serverTimestamp as pe}from"https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js";import"https://www.gstatic.com/firebasejs/11.10.0/firebase-storage.js";import{p as O}from"./profile-dashboard-manager-DumQz_VG.js";import"./widget-upload-EdH-RL5r.js";import"./cloud-upload-DzQTDkpW.js";import"./profile_banner-Eu8vPd6E.js";import"https://www.gstatic.com/firebasejs/11.10.0/firebase-auth.js";import"https://www.gstatic.com/firebasejs/11.10.0/firebase-app.js";import"https://www.gstatic.com/firebasejs/11.10.0/firebase-analytics.js";import"https://www.gstatic.com/firebasejs/11.10.0/firebase-functions.js";const i={log:(t,e=null)=>{console.log(`[MAIN DEBUG] ${t}`,e||"")},error:(t,e=null)=>{console.error(`[MAIN DEBUG ERROR] ${t}`,e||"")},warn:(t,e=null)=>{console.warn(`[MAIN DEBUG WARN] ${t}`,e||"")}};i.log("Starting enhanced inque social app initialization");window.authState={isInitialized:!1,lastLoginTime:null,hasShownWelcome:!1,currentUser:null};i.log("Importing firebase-core.js");try{h(()=>import("./firebase-core-BO8UvLyb.js"),[],import.meta.url).then(t=>{t&&t.db?(window.db=t.db,i.log("firebase-core.js imported successfully (db exposed)")):i.warn("firebase-core.js imported but db was not found in exports")}).catch(t=>{i.error("Failed to import firebase-core.js",t)})}catch(t){i.error("Error importing firebase-core.js",t)}i.log("Importing enhanced auth system");try{h(()=>import("./auth-COKA9b7m.js"),__vite__mapDeps([0,1,2,3]),import.meta.url).then(()=>{i.log("Enhanced auth system imported successfully")}).catch(t=>{i.error("Failed to import enhanced auth system",t)})}catch(t){i.error("Error importing enhanced auth system",t),i.log("Attempting fallback auth system load")}i.log("Importing enhanced widget upload system");try{h(()=>import("./widget-upload-EdH-RL5r.js"),__vite__mapDeps([4,5,2]),import.meta.url).then(()=>{i.log("Enhanced widget upload system imported successfully")}).catch(t=>{i.error("Failed to import enhanced widget upload system",t)})}catch(t){i.error("Error importing enhanced widget upload system",t)}i.log("Importing Firestore functions");try{h(()=>import("https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js"),[],import.meta.url).then(t=>{window.firestore=t,i.log("Firestore functions imported successfully")}).catch(t=>{i.error("Failed to import Firestore functions",t)})}catch(t){i.error("Error importing Firestore functions",t)}i.log("Importing social features");try{h(()=>Promise.resolve().then(()=>Je),void 0,import.meta.url).then(()=>{i.log("Social features imported successfully")}).catch(t=>{i.error("Failed to import social features",t)})}catch(t){i.error("Error importing social features",t)}i.log("Importing navigation system");try{h(()=>import("./navigation-CiQvIeE9.js"),__vite__mapDeps([6,2]),import.meta.url).then(()=>{i.log("Navigation system imported successfully")}).catch(t=>{i.error("Failed to import navigation system",t)})}catch(t){i.error("Error importing navigation system",t)}i.log("Importing tools filter system");try{h(()=>import("./tools-filter-qyJYBFYl.js"),[],import.meta.url).then(()=>{i.log("Tools filter system imported successfully")}).catch(t=>{i.error("Failed to import tools filter system",t)})}catch(t){i.error("Error importing tools filter system",t)}i.log("Importing floating orb system");try{h(()=>Promise.resolve().then(()=>Ke),void 0,import.meta.url).then(()=>{i.log("Floating orb system imported successfully")}).catch(t=>{i.error("Failed to import floating orb system",t)})}catch(t){i.error("Error importing floating orb system",t)}i.log("Importing ProfileHub system");try{h(()=>import("./profile_banner-Eu8vPd6E.js"),[],import.meta.url).then(()=>{i.log("ProfileHub system imported successfully")}).catch(t=>{i.error("Failed to import ProfileHub system",t)})}catch(t){i.error("Error importing ProfileHub system",t)}document.addEventListener("DOMContentLoaded",async()=>{i.log("DOM Content Loaded - Starting enhanced initialization");try{fe(),he(),ye(),ke(),Se(),Te();try{await x.init()}catch(t){i.error("Social stats manager initialization failed, continuing without it",t)}De();try{oe()}catch(t){i.error("Enhanced scroll and fullscreen initialization failed, continuing without it",t)}ve(),Ee(),Oe(),Me(),i.log("Enhanced initialization completed successfully"),Ae()}catch(t){i.error("Error during enhanced initialization",t)}});function fe(){i.log("Initializing authentication modal functionality");const t=document.getElementById("authModal"),e=document.querySelector(".auth-close-button"),o=document.getElementById("loginForm"),n=document.getElementById("signUpForm"),s=document.getElementById("showSignUp"),a=document.getElementById("showLogin"),r=document.getElementById("showLoginFromForgot"),l=document.getElementById("authModalTitle"),u=document.getElementById("forgotPasswordLink"),d=document.getElementById("forgotPasswordForm"),g=document.getElementById("googleLoginBtn"),p=document.getElementById("githubLoginBtn");if(!t||!e||!o||!n){i.warn("Some auth modal elements not found",{authModal:!!t,authCloseBtn:!!e,loginForm:!!o,signUpForm:!!n});return}g?(i.log("Google login button found, setting up event listener"),g.addEventListener("click",async()=>{try{i.log("Google login button clicked");const{GoogleAuthProvider:c,signInWithPopup:m}=await h(async()=>{const{GoogleAuthProvider:w,signInWithPopup:E}=await import("https://www.gstatic.com/firebasejs/11.10.0/firebase-auth.js");return{GoogleAuthProvider:w,signInWithPopup:E}},[],import.meta.url),{auth:f}=await h(async()=>{const{auth:w}=await import("./firebase-core-BO8UvLyb.js");return{auth:w}},[],import.meta.url),b=new c,v=await m(f,b);i.log("Google login successful",{user:v.user.displayName}),t.style.display="none",document.body.style.overflow=""}catch(c){i.error("Google login failed",c),alert(`Google login failed: ${c.message}`)}})):i.warn("Google login button not found in DOM"),p?(i.log("GitHub login button found, setting up event listener"),p.addEventListener("click",async()=>{try{i.log("GitHub login button clicked");const{GithubAuthProvider:c,signInWithPopup:m}=await h(async()=>{const{GithubAuthProvider:w,signInWithPopup:E}=await import("https://www.gstatic.com/firebasejs/11.10.0/firebase-auth.js");return{GithubAuthProvider:w,signInWithPopup:E}},[],import.meta.url),{auth:f}=await h(async()=>{const{auth:w}=await import("./firebase-core-BO8UvLyb.js");return{auth:w}},[],import.meta.url),b=new c,v=await m(f,b);i.log("GitHub login successful",{user:v.user.displayName}),t.style.display="none",document.body.style.overflow=""}catch(c){i.error("GitHub login failed",c),alert(`GitHub login failed: ${c.message}`)}})):i.warn("GitHub login button not found in DOM"),s&&s.addEventListener("click",c=>{c.preventDefault(),i.log("Switching to sign up form"),o.style.display="none",n.style.display="block",d.style.display="none",l.textContent="Sign Up"}),a&&a.addEventListener("click",c=>{c.preventDefault(),i.log("Switching to login form"),n.style.display="none",o.style.display="block",d.style.display="none",l.textContent="Login"}),r&&r.addEventListener("click",c=>{c.preventDefault(),i.log("Switching from forgot password to login form"),d.style.display="none",o.style.display="block",l.textContent="Login"}),u&&u.addEventListener("click",c=>{c.preventDefault(),i.log("Switching to forgot password form"),o.style.display="none",n.style.display="none",d.style.display="block",l.textContent="Reset Password"}),e&&e.addEventListener("click",()=>{i.log("Closing auth modal"),t.style.display="none",document.body.style.overflow=""}),window.addEventListener("click",c=>{c.target===t&&(i.log("Closing auth modal via outside click"),t.style.display="none",document.body.style.overflow="")}),document.addEventListener("keydown",c=>{c.key==="Escape"&&t.style.display==="block"&&(i.log("Closing auth modal via escape key"),t.style.display="none",document.body.style.overflow="")}),i.log("Authentication modal functionality initialized")}function $(t){i.log("Updating home section for auth state",{userId:t?.uid});const e=document.getElementById("home-greeting"),o=document.getElementById("home-subtitle"),n=document.getElementById("guest-cta-section"),s=document.getElementById("user-quick-actions");if(t){if(e){const a=t.displayName||t.email?.split("@")[0]||"Developer";e.textContent=`welcome back, ${a}.`}o&&(o.textContent="Ready to build something amazing? Choose your path:"),n&&(n.style.display="none"),s&&(s.style.display="block")}else e&&(e.textContent="welcome home."),o&&(o.textContent="Join 1,200+ developers building the future with AI IDEs. Share your projects, learn from others, and showcase your creativity."),n&&(n.style.display="block"),s&&(s.style.display="none")}function he(){i.log("Initializing home section button handlers");const t=document.getElementById("guest-signup-btn"),e=document.getElementById("guest-login-btn");t&&t.addEventListener("click",()=>{i.log("Guest signup button clicked");const a=document.getElementById("authModal");a&&(a.style.display="block",document.body.style.overflow="hidden",setTimeout(()=>{const r=document.querySelector('[data-tab="signup"]');r&&r.click()},100))}),e&&e.addEventListener("click",()=>{i.log("Guest login button clicked");const a=document.getElementById("authModal");a&&(a.style.display="block",document.body.style.overflow="hidden",setTimeout(()=>{const r=document.querySelector('[data-tab="login"]');r&&r.click()},100))});const o=document.getElementById("explore-projects-btn"),n=document.getElementById("my-dashboard-btn"),s=document.getElementById("improve-craft-btn");o&&o.addEventListener("click",()=>{i.log("Explore projects button clicked"),window.location.href="pages/explore.html"}),n&&n.addEventListener("click",()=>{i.log("My dashboard button clicked"),window.location.href="pages/my-projects.html"}),s&&s.addEventListener("click",()=>{i.log("Improve craft button clicked"),we()})}function we(){if(i.log("Opening knowledge base"),!window.authState||!window.authState.currentUser){window.showToast("Please sign in to access the knowledge base","info");return}window.location.href="pages/knowledge-base.html"}const U={isInitialized:!1,updateInterval:null,lastUpdate:null,async init(){if(i.log("Initializing live stats manager"),this.isInitialized){i.log("Live stats already initialized");return}try{await this.loadAndUpdateStats(),this.updateInterval=setInterval(async()=>{await this.loadAndUpdateStats()},3e4),this.isInitialized=!0,i.log("Live stats manager initialized successfully")}catch(t){i.error("Failed to initialize live stats manager",t)}},async loadAndUpdateStats(){i.log("Loading live stats from Firestore");try{const t=document.querySelector(".live-stats-container");if(t&&t.classList.add("loading"),!window.firestore||!window.db){i.warn("Firestore not available yet, using fallback stats"),this.updateStatsDisplay({users:1247,widgets:856,posts:342});return}const e=await this.fetchStatsFromFirestore();this.updateStatsDisplay(e),this.updateLastUpdatedTime(),t&&t.classList.remove("loading")}catch(t){i.error("Failed to load live stats",t),this.updateStatsDisplay({users:1247,widgets:856,posts:342})}},async fetchStatsFromFirestore(){i.log("Fetching stats from Firestore collections");try{const t={};try{const e=window.firestore.collection(window.db,"users"),o=await window.firestore.getDocs(e);t.users=o.size,i.log("Users count fetched",{count:t.users})}catch(e){i.warn("Failed to fetch users count",e),t.users=1247}try{const e=window.firestore.collection(window.db,"widgets"),o=await window.firestore.getDocs(e);t.widgets=o.size,i.log("Widgets count fetched",{count:t.widgets})}catch(e){i.warn("Failed to fetch widgets count",e),t.widgets=856}try{t.posts=Math.floor(t.users*.28+t.widgets*.15),i.log("Posts count calculated",{count:t.posts})}catch(e){i.warn("Failed to calculate posts count",e),t.posts=342}return t}catch(t){return i.error("Error fetching stats from Firestore",t),{users:1247,widgets:856,posts:342}}},updateStatsDisplay(t){i.log("Updating stats display",t);const e=document.querySelector(".stats-grid");e&&(e.classList.add("updating"),setTimeout(()=>{e.classList.remove("updating")},1500)),setTimeout(()=>this.animateCounter("live-users-count",t.users),200),setTimeout(()=>this.animateCounter("live-widgets-count",t.widgets),400),setTimeout(()=>this.animateCounter("live-posts-count",t.posts),600),setTimeout(()=>this.updateTrendIndicators(t),800),this.addSparkleEffect()},animateCounter(t,e){const o=document.getElementById(t);if(!o){i.warn("Counter element not found",{elementId:t});return}const n=o.querySelector(".count-value");if(!n){i.warn("Count value span not found",{elementId:t});return}const s=parseInt(n.textContent)||0,a=e-s;if(a===0){i.log("No change in counter value",{elementId:t,value:e});return}i.log("Animating counter",{elementId:t,from:s,to:e}),n.classList.add("updating");const r=1500,l=50,u=a/l,d=r/l;let g=0;const p=()=>{if(g>=l){n.textContent=e.toLocaleString(),n.classList.remove("updating"),n.classList.add("bounce"),setTimeout(()=>{n.classList.remove("bounce")},400);return}const c=Math.round(s+u*g);n.textContent=c.toLocaleString(),g++,setTimeout(p,d)};p()},updateTrendIndicators(t){const e={users:Math.floor(Math.random()*20)+5,widgets:Math.floor(Math.random()*15)+3,posts:Math.floor(Math.random()*10)+2},o=document.querySelector('[data-stat="users"] .trend-text'),n=document.querySelector('[data-stat="widgets"] .trend-text'),s=document.querySelector('[data-stat="posts"] .trend-text');o&&(o.textContent=`+${e.users} this week`),n&&(n.textContent=`+${e.widgets} today`),s&&(s.textContent=`+${e.posts} this week`),this.updateHotIndicators(e,t)},updateHotIndicators(t,e){document.querySelectorAll(".hot-indicator").forEach(n=>n.remove());const o={users:15,widgets:10,posts:8};Object.keys(t).forEach(n=>{if(t[n]>=o[n]){const s=document.querySelector(`[data-stat="${n}"]`);if(s){const a=document.createElement("div");a.className="hot-indicator",a.style.cssText=`
            position: absolute;
            top: 8px;
            right: 8px;
            background: linear-gradient(135deg, #ff4444, #ff8800);
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            animation: hot-pulse 1.5s ease-in-out infinite;
            box-shadow: 0 2px 8px rgba(255, 68, 68, 0.4);
            z-index: 10;
          `,a.textContent="🔥 HOT",s.appendChild(a)}}})},addSparkleEffect(){i.log("Adding sparkle effect to stats"),document.querySelectorAll(".live-stat-card").forEach((e,o)=>{setTimeout(()=>{const n=document.createElement("div");n.style.cssText=`
          position: absolute;
          top: 20px;
          right: 20px;
          font-size: 20px;
          color: var(--primary-neon);
          animation: sparkle 1s ease-out forwards;
          pointer-events: none;
          z-index: 10;
        `,n.textContent="✨",e.style.position="relative",e.appendChild(n),setTimeout(()=>{n.parentNode&&n.parentNode.removeChild(n)},1e3)},o*200)})},updateLastUpdatedTime(){const t=document.getElementById("stats-last-updated");if(t){const e=new Date,o=e.toLocaleTimeString("en-US",{hour12:!0,hour:"numeric",minute:"2-digit"});t.textContent=o,this.lastUpdate=e}},destroy(){this.updateInterval&&(clearInterval(this.updateInterval),this.updateInterval=null),this.isInitialized=!1,i.log("Live stats manager destroyed")}};function ye(){i.log("Initializing live stats functionality"),setTimeout(async()=>{await U.init()},1e3),window.addEventListener("beforeunload",()=>{U.destroy()}),be();const t=document.getElementById("refresh-stats-btn");t&&(t.addEventListener("keydown",e=>{(e.key==="Enter"||e.key===" ")&&(e.preventDefault(),R())}),t.setAttribute("tabindex","0"),t.setAttribute("aria-label","Refresh live community statistics"))}function be(){i.log("Setting up stats card interactions"),document.querySelectorAll(".live-stat-card").forEach(o=>{o.addEventListener("click",()=>{const n=o.getAttribute("data-stat");J(n)}),o.setAttribute("tabindex","0"),o.setAttribute("role","button"),o.setAttribute("aria-label",`View details for ${o.getAttribute("data-stat")} statistics`),o.addEventListener("keydown",n=>{if(n.key==="Enter"||n.key===" "){n.preventDefault();const s=o.getAttribute("data-stat");J(s)}}),o.addEventListener("focus",()=>{o.style.transform="translateY(-2px)",o.style.borderColor="var(--primary-neon)"}),o.addEventListener("blur",()=>{o.style.transform="",o.style.borderColor=""})});const e=document.querySelector(".live-stats-container");if(e){let o=0;e.addEventListener("click",()=>{o++,o===1&&setTimeout(()=>{o===2&&(i.log("Double-click detected on stats container - refreshing"),R()),o=0},300)})}}function J(t){i.log("Stats card clicked",{statType:t});const o={users:"👥 Active developers building amazing projects with AI IDEs! Join the community to connect with fellow creators.",widgets:"🎨 Interactive widgets created by our talented community! Share your own creations in the Widget Studio.",posts:"📚 Knowledge base posts with tips, guides, and insights! Contribute your expertise to help others learn."}[t]||"Click to learn more about our growing community!";window.showToast(o,"info");const n=document.querySelector(`[data-stat="${t}"]`);n&&(n.style.transform="scale(0.98)",setTimeout(()=>{n.style.transform=""},150))}async function R(){i.log("Manual stats refresh triggered");const t=document.getElementById("refresh-stats-btn"),e=document.querySelector(".live-stats-container");t&&(t.classList.add("refreshing"),t.style.pointerEvents="none"),e&&e.classList.add("updating"),window.showToast("🔄 Refreshing live stats...","info");try{await U.loadAndUpdateStats(),e&&(e.classList.remove("updating"),e.classList.add("success"),setTimeout(()=>{e.classList.remove("success")},2e3)),window.showToast("✅ Stats updated successfully!","success")}catch(o){i.error("Manual stats refresh failed",o),e&&e.classList.remove("updating"),window.showToast("❌ Failed to refresh stats","error")}finally{t&&setTimeout(()=>{t.classList.remove("refreshing"),t.style.pointerEvents="auto"},1e3)}}window.manualRefreshStats=R;function ve(){i.log("Initializing auth state tracking"),window.addEventListener("auth-state-changed",t=>{const{user:e,profile:o,isNewLogin:n}=t.detail;if(i.log("Auth state change event received",{userId:e?.uid,isNewLogin:n,hasProfile:!!o,currentState:window.authState.isInitialized}),e&&!window.authState.isInitialized){if(window.authState.isInitialized=!0,window.authState.currentUser=e,window.authState.userProfile=o,window.authState.lastLoginTime=Date.now(),n&&(window.authState.hasShownWelcome=!0,i.log("New login detected, will show welcome message"),window.socialAuth&&window.socialAuth.showToast)){const s=o?.displayName||o?.name||e.displayName||e.email?.split("@")[0];window.socialAuth.showToast(`Welcome to inque, ${s}! 🎉 Your account is ready.`,"success",5e3)}}else e||(window.authState.isInitialized=!1,window.authState.currentUser=null,window.authState.userProfile=null,window.authState.lastLoginTime=null,window.authState.hasShownWelcome=!1,i.log("User logged out, reset auth state"));$(e)}),setTimeout(()=>{window.authState&&window.authState.currentUser?$(window.authState.currentUser):$(null)},100),i.log("Auth state tracking initialized")}function Ee(){i.log("Initializing additional modals");const t=document.getElementById("widgetStudioModal"),e=document.querySelector(".widget-studio-close-button");if(t&&e){e.addEventListener("click",()=>{i.log("Closing Widget Studio modal"),t.style.display="none",document.body.style.overflow=""}),window.addEventListener("click",d=>{d.target===t&&(i.log("Closing Widget Studio modal via outside click"),t.style.display="none",document.body.style.overflow="")}),document.addEventListener("keydown",d=>{d.key==="Escape"&&t.style.display==="block"&&(i.log("Closing Widget Studio modal via escape key"),t.style.display="none",document.body.style.overflow="")});const r=document.getElementById("widgetFileInput"),l=document.getElementById("uploadedFiles"),u=document.getElementById("createWidgetBtn");r&&l&&u&&(r.addEventListener("change",d=>{const g=Array.from(d.target.files);i.log("Widget files selected",{count:g.length}),l.innerHTML="",g.forEach(c=>{const m=document.createElement("div");m.className="file-item",m.style.cssText="display: flex; align-items: center; gap: 10px; padding: 12px; background: rgba(0, 240, 255, 0.1); border-radius: 8px; border: 1px solid rgba(0, 240, 255, 0.2); margin-bottom: 8px;";const f=p(c.name);m.innerHTML=`
            <span style="font-size: 1.2rem;">${f}</span>
            <span style="flex: 1; color: var(--text-light); font-weight: 500;">${c.name}</span>
            <span style="color: var(--primary-color); font-size: 0.9rem; font-weight: 600;">${(c.size/1024).toFixed(1)} KB</span>
          `,l.appendChild(m)}),window.showToast(`${g.length} file${g.length>1?"s":""} selected successfully! 📁`,"success");function p(c){const m=c.split(".").pop().toLowerCase();return{html:"🌐",css:"🎨",js:"⚡",png:"🖼️",jpg:"🖼️",jpeg:"🖼️",gif:"🖼️",svg:"🖼️",json:"📋",txt:"📄",md:"📝"}[m]||"📁"}u.disabled=g.length===0}),u.addEventListener("click",async()=>{i.log("Create widget button clicked");try{if(Array.from(r.files).length===0){window.showToast("Please select files to create a widget","warning");return}u.disabled=!0,u.innerHTML='<span class="btn-loader">Creating...</span>',await new Promise(g=>setTimeout(g,2e3)),window.showToast("Widget created successfully! 🎉","success"),r.value="",l.innerHTML="",u.disabled=!0,setTimeout(()=>{const g=document.getElementById("widgetStudioModal");g&&(g.style.display="none",document.body.style.overflow="")},1500),i.log("Widget created successfully")}catch(d){i.error("Failed to create widget",d),window.showToast("Failed to create widget: "+d.message,"error")}finally{u.disabled=!1,u.innerHTML="Create Widget"}})),i.log("Widget Studio modal initialized")}const o=document.getElementById("editProfileModal"),n=document.querySelector(".edit-profile-close-button"),s=document.getElementById("editProfileForm"),a=document.getElementById("cancelEditBtn");if(o&&n){n.addEventListener("click",()=>{i.log("Closing Edit Profile modal"),o.style.display="none",document.body.style.overflow=""}),a&&a.addEventListener("click",()=>{i.log("Canceling profile edit"),o.style.display="none",document.body.style.overflow=""}),window.addEventListener("click",u=>{u.target===o&&(i.log("Closing Edit Profile modal via outside click"),o.style.display="none",document.body.style.overflow="")}),document.addEventListener("keydown",u=>{u.key==="Escape"&&o.style.display==="block"&&(i.log("Closing Edit Profile modal via escape key"),o.style.display="none",document.body.style.overflow=""),u.key==="Enter"&&u.ctrlKey&&o.style.display==="block"&&(u.preventDefault(),i.log("Form submission triggered via Ctrl+Enter"),s.dispatchEvent(new Event("submit")))}),s&&s.addEventListener("submit",async u=>{u.preventDefault(),i.log("Edit profile form submitted");const d=s.querySelector(".save-btn"),g=d.textContent;d.disabled=!0,d.innerHTML='<span class="btn-loader">Saving...</span>';try{const p=new FormData(s),c=document.getElementById("editDisplayName").value,m=document.getElementById("editBio").value,f=document.getElementById("editTwitter").value,b=document.getElementById("editInstagram").value,v=document.getElementById("editGithub").value,w=document.getElementById("editWebsite").value;if(!window.authState||!window.authState.currentUser){window.showToast("Please log in to update your profile","error");return}if(window.firestore&&window.firestore.doc&&window.firestore.updateDoc){const k=window.firestore.doc(db,"users",window.authState.currentUser.uid);await window.firestore.updateDoc(k,{name:c,bio:m,socialLinks:{twitter:f,instagram:b,github:v,website:w},updatedAt:new Date})}else throw new Error("Firestore functions not available");window.authState.currentUser&&(window.authState.currentUser.displayName=c),window.showToast(`Profile updated successfully! Welcome back, ${c}! ✨`,"success"),o.style.display="none",document.body.style.overflow="";const E=document.querySelector(".profile-name");E&&(E.textContent=c),i.log("Profile updated successfully",{displayName:c,bio:m})}catch(p){i.error("Failed to update profile",p),window.showToast("Failed to update profile: "+p.message,"error")}finally{d.disabled=!1,d.innerHTML=g}});const r=document.getElementById("editPhoto"),l=document.getElementById("photoPreview");r&&l&&r.addEventListener("change",u=>{const d=u.target.files[0];if(d){const g=new FileReader;g.onload=p=>{l.innerHTML=`<img src="${p.target.result}" alt="Profile preview" style="max-width: 100px; border-radius: 50%;" />`},g.readAsDataURL(d)}}),i.log("Edit Profile modal initialized")}window.openWidgetStudio=function(){i.log("Opening Widget Studio modal"),t?(i.log("Widget Studio modal found, opening..."),t.style.display="block",document.body.style.overflow="hidden",i.log("Widget Studio modal opened successfully")):(i.error("Widget Studio modal not found"),console.error("Widget Studio modal element not found in DOM"))},window.openEditProfile=function(){if(i.log("Opening Edit Profile modal"),o){i.log("Edit Profile modal found, opening..."),o.style.display="block",document.body.style.overflow="hidden";const r=document.getElementById("editDisplayName");document.getElementById("editBio"),r&&window.authState&&window.authState.currentUser?(r.value=window.authState.currentUser.displayName||"",i.log("Populated form with user data")):i.log("No user data available for form population"),i.log("Edit Profile modal opened successfully")}else i.error("Edit Profile modal not found"),console.error("Edit Profile modal element not found in DOM")},window.openChatbot=function(){i.log("Opening Chatbot card");const r=document.getElementById("chatbotCard");r?(r.classList.add("open"),r.classList.remove("minimized"),setTimeout(()=>{typeof initializeChatbot=="function"?(initializeChatbot(),i.log("Chatbot initialized successfully")):i.warn("initializeChatbot function not found")},100),i.log("Chatbot card opened successfully")):(i.error("Chatbot card not found"),console.error("Chatbot card element not found in DOM"))},window.openWorkflowManager=function(){i.log("Opening Workflow Manager modal");const r=document.getElementById("workflowManagerModal");r?(r.style.display="block",setTimeout(()=>{typeof initializeWorkflowManager=="function"?(initializeWorkflowManager(),i.log("Workflow Manager initialized successfully")):i.warn("initializeWorkflowManager function not found")},100),i.log("Workflow Manager modal opened successfully")):(i.error("Workflow Manager modal not found"),console.error("Workflow Manager modal element not found in DOM"))},i.log("Additional modals initialization completed"),window.debugModals=function(){const r=document.getElementById("chatbotCard");i.log("=== MODAL DEBUG INFO ==="),i.log("Widget Studio Modal:",{element:!!t,display:t?t.style.display:"N/A",id:t?t.id:"N/A"}),i.log("Edit Profile Modal:",{element:!!o,display:o?o.style.display:"N/A",id:o?o.id:"N/A"}),i.log("Chatbot Card:",{element:!!r,classes:r?r.className:"N/A",id:r?r.id:"N/A"}),i.log("Global functions:",{openWidgetStudio:typeof window.openWidgetStudio,openEditProfile:typeof window.openEditProfile,openChatbot:typeof window.openChatbot}),i.log("=== END MODAL DEBUG ===")}}function ke(){document.querySelectorAll(".password-toggle").forEach(e=>{e.addEventListener("click",o=>{o.preventDefault();const n=e.previousElementSibling,s=n.type==="password"?"text":"password";n.type=s,e.textContent=s==="password"?"👁️":"🙈",i.log("Password visibility toggled",{type:s})})}),i.log("Password toggles initialized")}function Se(){const t=document.getElementById("signUpUsername");if(t){let n;t.addEventListener("input",()=>{clearTimeout(n),n=setTimeout(()=>{Le(t.value)},500)})}const e=document.getElementById("signUpPassword");e&&e.addEventListener("input",()=>{Be(e.value)});const o=document.getElementById("confirmPassword");o&&o.addEventListener("input",()=>{Ie()}),i.log("Form validation initialized")}async function Le(t){const e=document.getElementById("usernameAvailability");if(!(!e||!t)){e.className="username-availability checking",e.textContent="Checking availability...";try{await new Promise(n=>setTimeout(n,1e3));const o=!t.toLowerCase().includes("test");e.className=`username-availability ${o?"available":"unavailable"}`,e.textContent=o?"Username available":"Username taken",i.log("Username availability checked",{username:t,isAvailable:o})}catch(o){e.className="username-availability unavailable",e.textContent="Error checking availability",i.error("Username availability check failed",o)}}}function Be(t){const e=document.getElementById("passwordStrength");if(!e)return;let o=0;t.length>=8&&o++,/[a-z]/.test(t)&&o++,/[A-Z]/.test(t)&&o++,/[0-9]/.test(t)&&o++,/[^A-Za-z0-9]/.test(t)&&o++;const n=["weak","medium","strong","very-strong"],s=["Weak","Medium","Strong","Very Strong"];e.className=`password-strength ${n[Math.min(o-1,3)]}`,e.textContent=s[Math.min(o-1,3)]||"Weak"}function Ie(){const t=document.getElementById("signUpPassword"),e=document.getElementById("confirmPassword"),o=document.getElementById("signUpSubmitBtn");if(!t||!e||!o)return;const n=t.value===e.value;o.disabled=!n,e.value&&!n?e.style.borderColor="#f44336":e.style.borderColor=""}function Te(){document.addEventListener("click",t=>{if(t.target.matches(".follow-btn")){t.preventDefault();const e=t.target.dataset.userId,o=t.target.dataset.following==="true";t.target.dataset.following=(!o).toString(),t.target.textContent=o?"Follow":"Following",t.target.className=o?"follow-btn":"follow-btn following",i.log("Follow button clicked",{userId:e,isFollowing:o})}}),document.addEventListener("click",t=>{if(t.target.matches(".like-btn")){t.preventDefault();const e=t.target.dataset.widgetId,o=t.target.dataset.liked==="true";t.target.dataset.liked=(!o).toString(),t.target.innerHTML=o?"🤍 Like":"❤️ Liked",t.target.className=o?"like-btn":"like-btn liked",i.log("Like button clicked",{widgetId:e,isLiked:o})}}),document.addEventListener("click",t=>{t.target.matches("#editProfileSocialBtn")&&(t.preventDefault(),i.log("Edit profile social button clicked"),window.openEditProfile&&window.openEditProfile()),t.target.matches("#shareProfileBtn")&&(t.preventDefault(),i.log("Share profile button clicked"),Ce()),t.target.matches("#viewActivityBtn")&&(t.preventDefault(),i.log("View activity button clicked"),xe())}),i.log("Social interactions initialized")}let x={currentUser:null,socialFeatures:null,debugMode:!0,async init(){i.log("Initializing social stats manager");try{await this.waitForSocialFeatures(),this.setupAuthListener(),i.log("Social stats manager initialized successfully")}catch(t){i.error("Failed to initialize social stats manager",t)}},async waitForSocialFeatures(){let t=0;const e=30;for(;t<e;){if(window.socialFeatures){this.socialFeatures=window.socialFeatures,i.log("Social features found for stats manager",{attempts:t});return}this.debugMode&&t%10===0&&console.log(`[SOCIAL STATS] Waiting for social features... attempt ${t+1}/${e}`),await new Promise(o=>setTimeout(o,100)),t++}i.warn("Social features not available after maximum attempts - continuing without social stats"),this.socialFeatures=null},setupAuthListener(){document.addEventListener("authStateChanged",async t=>{i.log("Auth state changed event received in stats manager",t.detail),await this.handleAuthStateChange(t.detail)}),window.authState&&window.authState.currentUser&&this.handleAuthStateChange(window.authState.currentUser)},async handleAuthStateChange(t){i.log("Handling auth state change in stats manager",{userId:t?.uid}),t?(this.currentUser=t,await this.loadAndDisplaySocialData(t.uid),this.showSocialElements(!0)):(this.currentUser=null,this.showSocialElements(!1),this.clearSocialData())},async loadAndDisplaySocialData(t){try{i.log("Loading social data for user",t),this.socialFeatures?await this.socialFeatures.loadUserSocialData(t):i.warn("Social features not available, skipping social data load");const e=await this.getUserStats(t);this.updateSocialStats(e),i.log("Social data loaded and displayed successfully")}catch(e){i.error("Failed to load social data",e)}},async getUserStats(t){try{const{db:e}=await h(async()=>{const{db:f}=await import("./firebase-core-BO8UvLyb.js");return{db:f}},[],import.meta.url),{doc:o,getDoc:n,collection:s,query:a,where:r,getDocs:l}=await h(async()=>{const{doc:f,getDoc:b,collection:v,query:w,where:E,getDocs:k}=await import("https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js");return{doc:f,getDoc:b,collection:v,query:w,where:E,getDocs:k}},[],import.meta.url),u=await n(o(e,"users",t)),d=u.exists()?u.data():{},g=a(s(e,"widgets"),r("userId","==",t)),p=await l(g),c=p.size;let m=0;return p.forEach(f=>{const b=f.data();m+=b.stats?.likes||0}),{followers:this.socialFeatures.followers.size,following:this.socialFeatures.following.size,widgets:c,likes:m,displayName:d.displayName||"User",bio:d.bio||""}}catch(e){return i.error("Failed to get user stats",e),{followers:0,following:0,widgets:0,likes:0,displayName:"User",bio:""}}},updateSocialStats(t){i.log("Updating social stats in UI",t);const e=document.getElementById("profileFollowers");e&&(e.textContent=t.followers);const o=document.getElementById("profileFollowing");o&&(o.textContent=t.following);const n=document.getElementById("profileWidgets");n&&(n.textContent=t.widgets);const s=document.getElementById("profileLikes");if(s&&(s.textContent=t.likes),t.displayName&&t.displayName!=="User"){const a=document.getElementById("profileName");a&&(a.textContent=t.displayName)}if(t.bio){const a=document.getElementById("profileBio");a&&(a.textContent=t.bio)}},showSocialElements(t){const e=document.getElementById("profileSocialStats"),o=document.getElementById("profileSocialActions");e&&(e.style.display=t?"flex":"none"),o&&(o.style.display=t?"flex":"none")},clearSocialData(){i.log("Clearing social data from UI"),["profileFollowers","profileFollowing","profileWidgets","profileLikes"].forEach(e=>{const o=document.getElementById(e);o&&(o.textContent="0")})}};async function Ce(){try{if(!x.currentUser){window.showToast("Please log in to share your profile","error");return}const t=`${window.location.origin}/profile/${x.currentUser.uid}`,e="Check out my profile on inque!";navigator.share?await navigator.share({title:"My inque Profile",text:e,url:t}):(await navigator.clipboard.writeText(`${e}
${t}`),window.showToast("Profile link copied to clipboard!","success")),i.log("Profile shared successfully")}catch(t){i.error("Failed to share profile",t),window.showToast("Failed to share profile","error")}}function xe(){i.log("Showing user activity"),window.showToast("Activity feature coming soon! Check back for updates.","info")}window.testSocialFeatures=function(){i.log("Testing social features..."),console.log("Social Stats Manager:",x),console.log("Window Social Features:",window.socialFeatures),console.log("Social Stats Elements:",{followers:document.getElementById("profileFollowers"),following:document.getElementById("profileFollowing"),widgets:document.getElementById("profileWidgets"),likes:document.getElementById("profileLikes"),socialStats:document.getElementById("profileSocialStats"),socialActions:document.getElementById("profileSocialActions")}),x.currentUser?console.log("Current User:",x.currentUser):console.log("No current user - try logging in first")};function De(){document.querySelectorAll(".modal").forEach(o=>{o.addEventListener("show.bs.modal",()=>{o.querySelector(".modal-content").style.animation="slideInUp 0.3s ease-out"})}),document.querySelectorAll(".auth-form").forEach(o=>{o.addEventListener("submit",n=>{const s=o.querySelector(".auth-submit-btn");s&&(s.classList.add("loading"),s.querySelector(".btn-text").style.display="none",s.querySelector(".btn-loader").style.display="inline-block")})}),window.showToast=function(o,n="info",s=5e3){i.log(`Showing toast notification: ${n} - ${o}`);const a=document.createElement("div");a.className=`toast ${n}`,a.innerHTML=`
      <span class="toast-message">${o}</span>
      <button class="toast-close">&times;</button>
    `;const r=document.getElementById("toast-container")||document.body;document.getElementById("toast-container")||i.warn("Toast container not found, appending to body"),r.appendChild(a),i.log("Toast element created and added to DOM"),setTimeout(()=>{a.classList.add("show"),i.log("Toast animation triggered")},100),setTimeout(()=>{a.classList.remove("show"),i.log("Toast auto-removal started"),setTimeout(()=>{a.parentNode&&(a.parentNode.removeChild(a),i.log("Toast element removed from DOM"))},300)},s),a.querySelector(".toast-close").addEventListener("click",()=>{i.log("Toast manually closed by user"),a.classList.remove("show"),setTimeout(()=>{a.parentNode&&(a.parentNode.removeChild(a),i.log("Toast element removed from DOM after manual close"))},300)}),i.log(`Toast notification displayed successfully: ${n} - ${o}`)},i.log("Enhanced UI features initialized")}function Ae(){sessionStorage.getItem("isNewUser")&&!window.authState.hasShownWelcome&&setTimeout(()=>{window.showToast("Welcome to inque! 🎉 Start by uploading your first widget!","success",8e3),sessionStorage.removeItem("isNewUser"),window.authState.hasShownWelcome=!0,i.log("Welcome message shown for new user")},2e3)}function Me(){i.log("Initializing header quick actions and sidebar login bindings");try{const t=document.getElementById("tutorialBtn");t?(t.addEventListener("click",d=>{d.preventDefault(),d.stopPropagation(),i.log("Tutorial button clicked"),window.showToast?window.showToast("Tutorial feature coming soon! This will explain everything about inque.","info",5e3):alert("Tutorial feature coming soon! This will explain everything about inque.")}),i.log("Tutorial button listener attached successfully")):i.warn("Tutorial button not found in DOM");const e=document.getElementById("editProfileQuickBtn");e?(e.addEventListener("click",d=>{if(d.preventDefault(),d.stopPropagation(),i.log("Edit Profile quick button clicked"),window.openEditProfile)window.openEditProfile(),i.log("Edit Profile modal opened via global function");else{i.warn("openEditProfile global function not available, using fallback");const g=document.getElementById("editProfileModal");g?(g.style.display="block",document.body.style.overflow="hidden",i.log("Edit Profile modal shown via fallback")):(i.error("Edit Profile modal not found"),window.showToast&&window.showToast("Edit Profile not available","error"))}}),i.log("Edit Profile quick button listener attached successfully")):i.warn("Edit Profile quick button not found in DOM");const o=document.getElementById("sidebarLoginBtn");o?(o.addEventListener("click",d=>{if(d.preventDefault(),d.stopPropagation(),i.log("Sidebar Login button clicked"),window.openAuthModal)window.openAuthModal("login"),i.log("Auth modal opened via global function");else{i.warn("openAuthModal global function not available, using fallback");const g=document.getElementById("authModal");g?(g.style.display="block",document.body.style.overflow="hidden",i.log("Auth modal shown via fallback")):(i.error("Auth modal not found"),window.showToast&&window.showToast("Login not available","error"))}}),i.log("Sidebar login button listener attached successfully")):i.warn("Sidebar login button not found in DOM");const n=document.querySelector('[data-action="openChatbot"]');n?(n.addEventListener("click",d=>{d.preventDefault(),d.stopPropagation(),i.log("AI Assistant button clicked"),typeof openChatbot=="function"?(openChatbot(),i.log("AI Assistant opened successfully")):(i.error("openChatbot function not found"),window.showToast&&window.showToast("AI Assistant not available","error"))}),i.log("AI Assistant button listener attached successfully")):i.warn("AI Assistant button not found in DOM");const s=document.querySelectorAll(".nav-btn[data-page]");s.length>0?(s.forEach(d=>{d.addEventListener("click",()=>{const g=d.getAttribute("data-page");if(g)switch(i.log("Profile navigation button clicked",{page:g}),g){case"about":window.location.href="core/personal/about.html";break;case"explore":window.location.href="pages/explore.html";break;case"inventory":window.location.href="pages/inventory.html";break;default:i.warn("Unknown page navigation",{page:g})}})}),i.log("Profile navigation buttons initialized",{count:s.length})):i.warn("Profile navigation buttons not found in DOM");const a=document.getElementById("profileLoginBtn");if(a){const d=()=>{const g=window.authState&&window.authState.isInitialized;a.style.display=g?"none":"inline-flex",i.log("Profile login button visibility updated",{isLoggedIn:g})};d(),window.addEventListener("auth-state-changed",()=>{i.log("Auth state changed, updating profile login button"),d()}),a.addEventListener("click",()=>{if(i.log("Profile login button clicked"),window.openAuthModal)window.openAuthModal("login");else{const g=document.getElementById("authModal");g?(g.style.display="block",document.body.style.overflow="hidden",i.log("Auth modal shown via fallback")):i.error("Auth modal not found")}}),i.log("Profile login button listener attached successfully")}else i.log("Profile login button not found (this is normal on pages without login forms)");const r=document.getElementById("collapseProfileBtn"),l=document.getElementById("profile-banner");if(r&&l){const d=r.querySelector(".collapse-icon");let g=!1;d?(r.addEventListener("click",()=>{g=!g,i.log("Profile banner collapse toggled",{collapsed:g}),g?(l.classList.add("collapsed"),l.style.maxHeight="120px",l.style.overflow="hidden",r.classList.add("collapsed"),d.textContent="▲"):(l.classList.remove("collapsed"),l.style.maxHeight="none",l.style.overflow="visible",r.classList.remove("collapsed"),d.textContent="▼")}),i.log("Profile banner collapse functionality initialized")):i.warn("Profile banner collapse icon not found")}else i.warn("Profile banner collapse elements not found",{collapseBtn:!!r,profileBanner:!!l});const u=document.getElementById("leaveNoteBtn");u?(u.addEventListener("click",d=>{d.preventDefault(),d.stopPropagation(),i.log("Leave a Note button clicked"),window.showToast?window.showToast("Leave a Note feature coming soon! This will let you leave messages in the yearbook.","info",5e3):alert("Leave a Note feature coming soon! This will let you leave messages in the yearbook.")}),i.log("Leave a Note button listener attached successfully")):i.warn("Leave a Note button not found in DOM"),i.log("Header quick actions initialization completed successfully"),Fe()}catch(t){i.error("Error during header quick actions initialization",t)}}function Fe(){i.log("Validating button states...");const t=[{id:"tutorialBtn",name:"Tutorial Button"},{id:"editProfileQuickBtn",name:"Edit Profile Quick Button"},{id:"sidebarLoginBtn",name:"Sidebar Login Button"},{id:"leaveNoteBtn",name:"Leave a Note Button"},{id:"collapseProfileBtn",name:"Profile Collapse Button"}],e=[],o=[];t.forEach(a=>{document.getElementById(a.id)?o.push(a.name):e.push(a.name)}),o.length>0&&i.log("✅ Working buttons",o),e.length>0&&i.warn("⚠️ Missing buttons",e),document.querySelector('[data-action="openChatbot"]')?i.log("✅ AI Assistant button found"):i.log("AI Assistant button not found (this is normal on pages without chatbot)");const s=document.querySelectorAll(".nav-btn[data-page]");s.length>0?i.log("✅ Profile navigation buttons found",{count:s.length}):i.log("Profile navigation buttons not found (this is normal on pages without profile navigation)")}window.openAuthModal=function(t="login"){i.log("Opening auth modal",{formType:t});const e=document.getElementById("authModal"),o=document.getElementById("loginForm"),n=document.getElementById("signUpForm"),s=document.getElementById("authModalTitle");e&&o&&n&&s?(t==="signup"?(o.style.display="none",n.style.display="block",s.textContent="Sign Up"):(n.style.display="none",o.style.display="block",s.textContent="Login"),e.style.display="block",document.body.style.overflow="hidden",i.log("Auth modal opened successfully",{formType:t})):i.error("Failed to open auth modal - elements not found")};i.log("Initializing enhanced scroll and fullscreen functionality");window.fullscreenState={isFullscreen:!1,originalScrollPosition:0,isInitialized:!1};function ze(){i.log("Creating fullscreen toggle button");try{let t=document.getElementById("fullscreenToggleBtn");t?i.log("Fullscreen toggle button already exists"):(t=document.createElement("button"),t.id="fullscreenToggleBtn",t.className="fullscreen-toggle-btn",t.innerHTML="⛶",t.title="Toggle Fullscreen (F11)",t.style.cssText=`
        position: fixed;
        top: auto;
        bottom: 20px;
        left: 20px;
        right: auto;
        width: 40px;
        height: 40px;
        background: rgba(0, 240, 255, 0.1);
        border: 2px solid rgba(0, 240, 255, 0.3);
        border-radius: 8px;
        color: #00f0ff;
        font-size: 16px;
        cursor: pointer;
        z-index: 1000;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: center;
      `,t.addEventListener("mouseenter",()=>{t.style.background="rgba(0, 240, 255, 0.2)",t.style.borderColor="rgba(0, 240, 255, 0.5)",t.style.transform="scale(1.1)"}),t.addEventListener("mouseleave",()=>{t.style.background="rgba(0, 240, 255, 0.1)",t.style.borderColor="rgba(0, 240, 255, 0.3)",t.style.transform="scale(1)"}),t.addEventListener("click",e=>{e.preventDefault(),i.log("Fullscreen toggle button clicked"),D()}),document.body.appendChild(t),i.log("Fullscreen toggle button created successfully and positioned at bottom-left"))}catch(t){i.error("Failed to create fullscreen toggle button",t)}}function We(){i.log("Setting up scroll event listeners");try{let t=0,e;const o=()=>{clearTimeout(e),e=setTimeout(()=>{const n=window.pageYOffset||document.documentElement.scrollTop,s=document.getElementById("fullscreenToggleBtn");s&&(n>100?s.style.opacity="0.8":s.style.opacity="1"),window.scrollDirection=n>t?"down":"up",t=n},16)};window.addEventListener("scroll",o,{passive:!0}),i.log("Scroll event listeners setup complete")}catch(t){i.error("Failed to setup scroll event listeners",t)}}function D(){i.log("Toggling fullscreen mode");try{if(document.fullscreenElement){document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen(),window.fullscreenState.isFullscreen=!1;const t=document.getElementById("fullscreenToggleBtn");t&&(t.innerHTML="⛶",t.title="Toggle Fullscreen (F11)"),i.log("Exited fullscreen mode")}else{document.documentElement.requestFullscreen?document.documentElement.requestFullscreen():document.documentElement.webkitRequestFullscreen?document.documentElement.webkitRequestFullscreen():document.documentElement.msRequestFullscreen&&document.documentElement.msRequestFullscreen(),window.fullscreenState.isFullscreen=!0,window.fullscreenState.originalScrollPosition=window.pageYOffset;const t=document.getElementById("fullscreenToggleBtn");t&&(t.innerHTML="⛷",t.title="Exit Fullscreen (F11 or Esc)"),i.log("Entered fullscreen mode")}}catch(t){i.error("Failed to toggle fullscreen mode",t)}}document.addEventListener("fullscreenchange",()=>{const t=!!document.fullscreenElement;window.fullscreenState.isFullscreen=t;const e=document.getElementById("fullscreenToggleBtn");e&&(e.innerHTML=t?"⛷":"⛶",e.title=t?"Exit Fullscreen (F11 or Esc)":"Toggle Fullscreen (F11)"),i.log("Fullscreen state changed",{isFullscreen:t})});function oe(){i.log("Setting up enhanced scroll and fullscreen features");try{ze(),We(),qe(),Pe(),window.fullscreenState.isInitialized=!0,i.log("Enhanced scroll and fullscreen features initialized successfully")}catch(t){i.error("Failed to initialize enhanced scroll and fullscreen features",t)}}function qe(){i.log("Setting up keyboard shortcuts for fullscreen"),document.addEventListener("keydown",t=>{t.key==="F11"&&(t.preventDefault(),i.log("F11 key pressed - toggling fullscreen"),D()),t.key==="Escape"&&window.fullscreenState.isFullscreen&&(i.log("Escape key pressed - exiting fullscreen"),D()),t.ctrlKey&&t.shiftKey&&t.key==="D"&&(t.preventDefault(),_e(),i.log("Debug mode toggled via keyboard shortcut"))}),i.log("Keyboard shortcuts setup complete")}function Pe(){i.log("Initializing scroll position restoration"),window.addEventListener("load",()=>{const t=sessionStorage.getItem("scrollPosition");t&&setTimeout(()=>{window.scrollTo(0,parseInt(t)),i.log("Scroll position restored from session storage",{position:t})},100)}),window.addEventListener("beforeunload",()=>{sessionStorage.setItem("scrollPosition",window.pageYOffset.toString()),i.log("Scroll position saved to session storage",{position:window.pageYOffset})}),i.log("Scroll position restoration initialized")}function _e(){const t=document.body;t.classList.contains("debug-mode")?(t.classList.remove("debug-mode"),i.log("Debug mode disabled"),window.showToast&&window.showToast("Debug mode disabled","info",2e3)):(t.classList.add("debug-mode"),i.log("Debug mode enabled"),window.showToast&&window.showToast("Debug mode enabled - Press Ctrl+Shift+D to toggle","success",3e3))}function Ne(){i.log("Setting up smooth scrolling for anchor links"),document.addEventListener("click",t=>{const e=t.target.closest('a[href^="#"]');if(e){t.preventDefault();const o=e.getAttribute("href").substring(1),n=document.getElementById(o);if(n){const s=document.querySelector("header")?.offsetHeight||0,a=n.offsetTop-s-20;window.scrollTo({top:a,behavior:"smooth"}),i.log("Smooth scroll to element",{targetId:o,position:a})}}}),i.log("Smooth scrolling setup complete")}window.toggleFullscreen=function(){i.log("Fullscreen toggle called via global function"),D()};window.isFullscreen=function(){return window.fullscreenState.isFullscreen};window.enterFullscreen=function(){window.fullscreenState.isFullscreen||(i.log("Entering fullscreen via global function"),D())};window.exitFullscreen=function(){window.fullscreenState.isFullscreen&&(i.log("Exiting fullscreen via global function"),D())};document.addEventListener("DOMContentLoaded",()=>{i.log("DOM Content Loaded - Initializing enhanced scroll and fullscreen features"),setTimeout(()=>{oe(),Ne()},500)});i.log("Enhanced scroll and fullscreen functionality loaded");i.log("Setting up global compatibility functions");window.testVibeCodersIntegration=function(){i.log("Testing inQ platform integration"),window.navigationManager?i.log("✅ Navigation manager available"):i.warn("⚠️ Navigation manager not available"),window.toolsFilterManager?i.log("✅ Tools filter manager available"):i.warn("⚠️ Tools filter manager not available"),window.authState&&window.authState.isInitialized?i.log("✅ Auth system initialized"):i.log("Auth system not initialized (this is normal during startup)"),window.showToast&&window.showToast("inQ Platform integration test completed! 🎉","success",3e3),i.log("inQ platform integration test completed")};function Oe(){i.log("Initializing banner customization functionality");try{const t=document.getElementById("bannerCustomizationModal"),e=document.getElementById("bannerCustomizationCloseBtn"),o=document.getElementById("customizeBannerBtn"),n=document.getElementById("saveBannerBtn"),s=document.getElementById("resetBannerBtn");if(!t||!e||!o){i.warn("Some banner customization elements not found",{bannerModal:!!t,bannerCloseBtn:!!e,customizeBannerBtn:!!o});return}o.addEventListener("click",l=>{l.preventDefault(),i.log("Opening banner customization modal"),t.style.display="block",document.body.style.overflow="hidden",X()}),e.addEventListener("click",()=>{i.log("Closing banner customization modal"),t.style.display="none",document.body.style.overflow=""}),window.addEventListener("click",l=>{l.target===t&&(i.log("Closing banner customization modal via outside click"),t.style.display="none",document.body.style.overflow="")}),document.addEventListener("keydown",l=>{l.key==="Escape"&&t.style.display==="block"&&(i.log("Closing banner customization modal via escape key"),t.style.display="none",document.body.style.overflow="")});const a=document.querySelectorAll(".layout-option");a.forEach(l=>{l.addEventListener("click",u=>{u.preventDefault(),i.log("Layout option clicked",{layout:l.dataset.layout}),a.forEach(d=>d.classList.remove("active")),l.classList.add("active"),q(l.dataset.layout)})});const r=document.querySelectorAll(".theme-option");r.forEach(l=>{l.addEventListener("click",u=>{u.preventDefault(),i.log("Theme option clicked",{theme:l.dataset.theme}),r.forEach(d=>d.classList.remove("active")),l.classList.add("active"),P(l.dataset.theme)})}),n&&n.addEventListener("click",l=>{l.preventDefault(),i.log("Saving banner customization"),$e()}),s&&s.addEventListener("click",l=>{l.preventDefault(),i.log("Resetting banner customization"),Ue()}),window.openProfileCustomization=function(){i.log("Opening profile customization via global function"),t&&(t.style.display="block",document.body.style.overflow="hidden",X())},Qe(),i.log("Banner customization functionality initialized successfully")}catch(t){i.error("Error initializing banner customization",t)}}function X(){i.log("Populating banner customization options");try{const t=document.getElementById("quickLinksCustomization");if(!t){i.warn("Quick links customization container not found");return}const e=[{id:"projects",label:"📊 Projects",href:"pages/my-projects.html",enabled:!0},{id:"studio",label:"🎨 Studio",href:"pages/widget_studio.html",enabled:!0},{id:"explore",label:"🔍 Explore",href:"pages/explore.html",enabled:!0},{id:"community",label:"👥 Community",href:"pages/users.html",enabled:!0},{id:"inventory",label:"📦 Inventory",href:"pages/inventory.html",enabled:!1},{id:"profile",label:"👤 Profile",href:"pages/profile-edit.html",enabled:!1}];t.innerHTML="",e.forEach(o=>{const n=document.createElement("div");n.className="quick-link-option",n.style.cssText=`
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 12px;
        background: var(--bg-tertiary);
        border: 1px solid var(--primary-neon);
        border-radius: 6px;
        margin-bottom: 8px;
      `,n.innerHTML=`
        <input 
          type="checkbox" 
          id="link-${o.id}" 
          ${o.enabled?"checked":""}
          style="margin: 0;"
        >
        <label for="link-${o.id}" style="color: var(--text-primary); cursor: pointer; flex: 1;">
          ${o.label}
        </label>
        <span style="color: var(--text-secondary); font-size: 0.8rem;">
          ${o.enabled?"Enabled":"Disabled"}
        </span>
      `,t.appendChild(n)}),i.log("Customization options populated successfully")}catch(t){i.error("Error populating customization options",t)}}function q(t){i.log("Applying banner layout",{layout:t});try{const e=document.getElementById("profileBanner"),o=e?.querySelector(".banner-user-section"),n=e?.querySelector(".banner-quick-links"),s=e?.querySelector(".banner-actions");if(!e){i.warn("Profile banner not found");return}switch(e.style.flexDirection="row",e.style.gap="20px",e.style.padding="12px 20px",t){case"horizontal":e.style.flexDirection="row",e.style.gap="20px";break;case"compact":e.style.flexDirection="row",e.style.gap="12px",e.style.padding="8px 16px";break;case"minimal":e.style.flexDirection="column",e.style.gap="8px",e.style.padding="16px 20px";break}i.log("Banner layout applied successfully",{layout:t})}catch(e){i.error("Error applying banner layout",e)}}function P(t){i.log("Applying banner theme",{theme:t});try{const e=document.getElementById("profileBanner"),o=e?.querySelectorAll(".banner-quick-link");if(!e){i.warn("Profile banner not found");return}switch(e.style.background="linear-gradient(135deg, var(--bg-secondary) 0%, var(--bg-tertiary) 100%)",e.style.borderColor="var(--primary-neon)",t){case"neon":e.style.background="linear-gradient(135deg, var(--bg-secondary) 0%, var(--bg-tertiary) 100%)",e.style.borderColor="var(--primary-neon)";break;case"monochrome":e.style.background="linear-gradient(135deg, #1a1a1a 0%, #2a2a2a 100%)",e.style.borderColor="#ffffff";break;case"pastel":e.style.background="linear-gradient(135deg, #2a1a2a 0%, #3a2a3a 100%)",e.style.borderColor="#ff69b4";break}i.log("Banner theme applied successfully",{theme:t})}catch(e){i.error("Error applying banner theme",e)}}function $e(){i.log("Saving banner customization");try{const t=document.querySelector(".layout-option.active")?.dataset.layout||"horizontal",e=document.querySelector(".theme-option.active")?.dataset.theme||"neon",o=[];document.querySelectorAll("#quickLinksCustomization input[type='checkbox']:checked").forEach(l=>{const u=l.id.replace("link-","");o.push(u)});const s={layout:t,theme:e,enabledLinks:o,lastUpdated:new Date().toISOString()};localStorage.setItem("bannerCustomization",JSON.stringify(s)),q(t),P(e),H(o),window.showToast&&window.showToast("Banner customization saved! 🎨","success",3e3);const a=document.getElementById("bannerCustomizationIndicator");a&&(a.style.display="block",setTimeout(()=>{a.style.display="none"},3e3));const r=document.getElementById("bannerCustomizationModal");r&&(r.style.display="none",document.body.style.overflow=""),i.log("Banner customization saved successfully",s)}catch(t){i.error("Error saving banner customization",t),window.showToast&&window.showToast("Failed to save banner customization","error")}}function Ue(){i.log("Resetting banner customization");try{localStorage.removeItem("bannerCustomization"),q("horizontal"),P("neon"),H(["projects","studio","explore","community"]),document.querySelectorAll(".layout-option").forEach(o=>{o.classList.remove("active"),o.dataset.layout==="horizontal"&&o.classList.add("active")}),document.querySelectorAll(".theme-option").forEach(o=>{o.classList.remove("active"),o.dataset.theme==="neon"&&o.classList.add("active")}),window.showToast&&window.showToast("Banner customization reset! 🔄","info",3e3),i.log("Banner customization reset successfully")}catch(t){i.error("Error resetting banner customization",t),window.showToast&&window.showToast("Failed to reset banner customization","error")}}function H(t){i.log("Updating quick links",{enabledLinks:t});try{const e=document.querySelector(".banner-quick-links");if(!e){i.warn("Banner quick links container not found");return}e.innerHTML="";const o={projects:{label:"📊 Projects",href:"pages/my-projects.html",color:"primary"},studio:{label:"🎨 Studio",href:"pages/widget_studio.html",color:"secondary"},explore:{label:"🔍 Explore",href:"pages/explore.html",color:"accent"},community:{label:"👥 Community",href:"pages/users.html",color:"error"},inventory:{label:"📦 Inventory",href:"pages/inventory.html",color:"success"},profile:{label:"👤 Profile",href:"pages/profile-edit.html",color:"warning"}};t.forEach(n=>{const s=o[n];if(s){const a=document.createElement("a");a.href=s.href,a.className="banner-quick-link",a.setAttribute("data-color",s.color),a.title=s.label,a.style.cssText=`
          padding: 8px 12px;
          background: rgba(0, 240, 255, 0.15);
          border: 1px solid #00f0ff;
          border-radius: 6px;
          color: #00f0ff;
          text-decoration: none;
          font-size: 11px;
          font-weight: 600;
          text-transform: uppercase;
          letter-spacing: 0.5px;
          transition: all 0.3s ease;
          display: flex;
          align-items: center;
          gap: 4px;
        `,a.textContent=s.label,e.appendChild(a)}}),i.log("Quick links updated successfully")}catch(e){i.error("Error updating quick links",e)}}function Re(){i.log("Loading saved banner customization");try{const t=localStorage.getItem("bannerCustomization");if(t){const e=JSON.parse(t);q(e.layout||"horizontal"),P(e.theme||"neon"),H(e.enabledLinks||["projects","studio","explore","community"]),i.log("Banner customization loaded successfully",e)}else i.log("No saved banner customization found, using defaults")}catch(t){i.error("Error loading banner customization",t)}}function Z(){i.log("Adding banner restore button to header");try{if(document.getElementById("bannerRestoreBtn"))return;const t=document.querySelector("header");if(!t){i.warn("Header not found for restore button");return}const e=document.createElement("button");e.id="bannerRestoreBtn",e.innerHTML="🏴‍☠️",e.title="Restore Profile Banner",e.style.cssText=`
      width: 40px;
      height: 40px;
      background: rgba(0, 255, 255, 0.2);
      border: 2px solid var(--primary-neon);
      border-radius: 50%;
      color: var(--primary-neon);
      font-size: 16px;
      cursor: pointer;
      transition: all 0.3s ease;
      animation: pulse 2s infinite;
      margin-left: 20px;
    `,e.addEventListener("mouseenter",()=>{e.style.background="rgba(0, 255, 255, 0.3)",e.style.transform="scale(1.1)",e.style.boxShadow="0 0 20px rgba(0, 255, 255, 0.5)"}),e.addEventListener("mouseleave",()=>{e.style.background="rgba(0, 255, 255, 0.2)",e.style.transform="scale(1)",e.style.boxShadow="none"}),e.addEventListener("click",()=>{i.log("Restoring banner from closed state"),document.getElementById("profileBanner")&&(C("visible",!0),localStorage.removeItem("bannerClosed"),setTimeout(()=>{e.remove()},100),window.showToast&&window.showToast("Profile banner restored! 🏴‍☠️","success",3e3))});const o=t.querySelector('div[style*="display: flex"]');if(o){const n=o.querySelector("nav");if(n)n.appendChild(e);else{const s=o.querySelector('div[style*="display: flex"][style*="align-items: center"]');s?s.appendChild(e):o.appendChild(e)}}else t.appendChild(e);i.log("Banner restore button added successfully")}catch(t){i.error("Error adding banner restore button",t)}}function He(){i.log("Adding banner activation button");try{if(document.getElementById("bannerActivationBtn"))return;const t=document.querySelector("header");if(!t){i.warn("Header not found for activation button");return}const e=document.createElement("button");e.id="bannerActivationBtn",e.innerHTML="🔗",e.title="Expand Profile Banner",e.style.cssText=`
      width: 40px;
      height: 40px;
      background: rgba(0, 255, 255, 0.2);
      border: 2px solid var(--primary-neon);
      border-radius: 50%;
      color: var(--primary-neon);
      font-size: 16px;
      cursor: pointer;
      transition: all 0.3s ease;
      animation: pulse 2s infinite;
      margin-left: 20px;
    `,e.addEventListener("mouseenter",()=>{e.style.background="rgba(0, 255, 255, 0.3)",e.style.transform="scale(1.1)",e.style.boxShadow="0 0 20px rgba(0, 255, 255, 0.5)"}),e.addEventListener("mouseleave",()=>{e.style.background="rgba(0, 255, 255, 0.2)",e.style.transform="scale(1)",e.style.boxShadow="none"}),e.addEventListener("click",()=>{i.log("Activating banner from minimized state"),C("visible",!0),setTimeout(()=>{e.remove()},100),window.showToast&&window.showToast("Profile banner expanded! 🔗","success",2e3)});const o=t.querySelector('div[style*="display: flex"]');if(o){const n=o.querySelector("nav");if(n)n.appendChild(e);else{const s=o.querySelector('div[style*="display: flex"][style*="align-items: center"]');s?s.appendChild(e):o.appendChild(e)}}else t.appendChild(e);i.log("Banner activation button added successfully")}catch(t){i.error("Error adding banner activation button",t)}}function C(t,e=!0){i.log(`Updating banner state to: ${t}`);const o=document.getElementById("profileBanner"),n=document.getElementById("profile-banner-section"),s=document.getElementById("bannerChain"),a=document.getElementById("chainLink"),r=document.getElementById("header-banner-container");if(!o||!n||!r){i.warn("Banner elements not found for state update");return}switch(o.classList.remove("hidden","minimized","entered"),r.classList.remove("hidden","minimized","fullscreen-hidden"),t){case"visible":o.classList.add("entered"),r.style.opacity="1",r.style.pointerEvents="auto",e&&(o.style.animation="bannerDropAndSway 1.5s cubic-bezier(0.34, 1.56, 0.64, 1) forwards"),s&&(s.style.opacity="1"),a&&(a.style.opacity="1");const l=document.getElementById("bannerActivationBtn");l&&l.remove(),localStorage.removeItem("bannerMinimized"),i.log("Banner visible state restored, minimized state cleared");break;case"minimized":o.classList.add("minimized"),r.classList.add("minimized"),r.style.opacity="1",r.style.pointerEvents="auto",o.style.animation="none",s&&(s.style.opacity="0"),a&&(a.style.opacity="0"),He(),localStorage.setItem("bannerMinimized","true"),i.log("Banner minimized state stored");break;case"hidden":o.classList.add("hidden"),r.classList.add("hidden"),r.style.opacity="0",r.style.pointerEvents="none",e&&(o.style.animation="zipUpToHeader 0.6s cubic-bezier(0.55, 0.055, 0.675, 0.19) forwards"),s&&(s.style.opacity="0"),a&&(a.style.opacity="0");break;case"fullscreen-hidden":r.classList.add("fullscreen-hidden"),r.style.opacity="0",r.style.pointerEvents="none",o.style.animation="none",s&&(s.style.opacity="0"),a&&(a.style.opacity="0");break}i.log(`Banner state updated to: ${t}`),window.dispatchEvent(new CustomEvent("banner-state-changed",{detail:{state:t}}))}function Ge(){i.log("Initializing UI positioning adjustments");try{const t=document.getElementById("fullscreenToggle"),e=document.getElementById("toast-container"),o=document.getElementById("header-banner-container");if(!t||!e){i.warn("UI elements not found for positioning adjustments");return}const n=()=>{const s=window.innerWidth<=768,a=o&&!o.classList.contains("hidden")&&!o.classList.contains("fullscreen-hidden");s&&a?(t.style.top="200px",e.style.top="200px",i.log("UI positioning adjusted for mobile with visible banner")):s?(t.style.top="100px",e.style.top="100px",i.log("UI positioning adjusted for mobile without banner")):(t.style.top="140px",e.style.top="140px",i.log("UI positioning adjusted for desktop"))};n(),window.addEventListener("banner-state-changed",n),window.addEventListener("resize",()=>{setTimeout(n,100)}),i.log("UI positioning adjustments initialized successfully")}catch(t){i.error("Error initializing UI positioning adjustments",t)}}function ie(){i.log("Initializing mobile-specific banner behavior");try{const t=document.getElementById("profileBanner"),e=document.getElementById("header-banner-container");if(!t||!e){i.warn("Banner elements not found for mobile behavior");return}const o=window.innerWidth<=768;if(o){i.log("Mobile device detected - applying mobile banner optimizations"),e.classList.add("mobile-optimized"),t.classList.add("mobile-optimized"),t.style.touchAction="manipulation",t.style.webkitTouchCallout="none",t.style.webkitUserSelect="none",t.style.userSelect="none",t.addEventListener("touchstart",s=>{s.preventDefault()},{passive:!1}),window.addEventListener("orientationchange",()=>{i.log("Orientation changed - recalculating banner position"),setTimeout(()=>{e.style.transform="translateZ(0)",setTimeout(()=>{e.style.transform=""},100)},100)});let n;window.addEventListener("resize",()=>{clearTimeout(n),n=setTimeout(()=>{window.innerWidth<=768!==o&&(i.log("Screen size changed - reinitializing mobile behavior"),ie())},250)})}else i.log("Desktop device detected - using standard banner behavior"),e.classList.remove("mobile-optimized"),t.classList.remove("mobile-optimized")}catch(t){i.error("Error initializing mobile banner behavior",t)}}function Qe(){i.log("Initializing hanging banner controls");try{const t=document.getElementById("profileBanner"),e=document.getElementById("minimizeBannerBtn"),o=document.getElementById("closeBannerBtn");if(!t){i.warn("Profile banner not found for controls");return}t.addEventListener("animationend",a=>{a.animationName==="bannerDropAndSway"&&(i.log("Hanging banner entrance animation completed"),t.classList.add("entered"),window.showToast&&setTimeout(()=>{window.showToast("Welcome! Your hanging profile banner is ready 🏴‍☠️","info",4e3)},1e3))}),e&&e.addEventListener("click",a=>{a.preventDefault(),a.stopPropagation(),i.log("Toggling banner minimize state");const r=t.classList.contains("minimized");C(r?"visible":"minimized",!1),e.textContent=r?"−":"+",e.title=r?"Minimize Banner":"Expand Banner",window.showToast&&window.showToast(r?"Banner expanded":"Banner minimized","info",2e3)}),o&&o.addEventListener("click",a=>{a.preventDefault(),a.stopPropagation(),i.log("Closing banner with zip-up animation"),C("hidden",!0),window.showToast&&window.showToast("Banner zipped up! Use restore button to bring it back 🏴‍☠️","info",3e3),localStorage.setItem("bannerClosed","true"),setTimeout(()=>{Z()},700)});const n=localStorage.getItem("bannerClosed"),s=localStorage.getItem("bannerMinimized");n==="true"?(i.log("Banner was previously closed, hiding it"),C("hidden",!1),Z()):s==="true"?(i.log("Banner was previously minimized, showing minimized state"),C("minimized",!1)):(i.log("Banner is visible, starting entrance animation"),C("visible",!0)),i.log("Banner positioning fixed to header - drag functionality removed for better mobile UX"),localStorage.removeItem("bannerPosition"),ie(),je(),i.log("Banner card controls initialized successfully"),Ge()}catch(t){i.error("Error initializing banner card controls",t)}}function je(){i.log("Initializing mobile drawer functionality");try{const t=document.getElementById("mobileMenuToggle"),e=document.getElementById("mobileDrawer"),o=document.getElementById("mobileDrawerClose"),n=document.getElementById("mobileDrawerOverlay"),s=document.getElementById("mobileAuthBtn"),a=document.getElementById("authBtn");if(!t||!e||!o){i.warn("Mobile drawer elements not found");return}const r=()=>{i.log("Opening mobile drawer"),e.classList.add("active"),document.body.style.overflow="hidden"},l=()=>{i.log("Closing mobile drawer"),e.classList.remove("active"),document.body.style.overflow=""};t.addEventListener("click",c=>{c.preventDefault(),c.stopPropagation(),r()}),o.addEventListener("click",c=>{c.preventDefault(),c.stopPropagation(),l()}),n.addEventListener("click",c=>{c.preventDefault(),c.stopPropagation(),l()}),document.querySelectorAll(".mobile-nav-item").forEach(c=>{c.addEventListener("click",m=>{c.href&&c.href.includes("pages/")?setTimeout(()=>{l()},100):l()})}),s&&a&&s.addEventListener("click",c=>{c.preventDefault(),c.stopPropagation(),l(),a.click()}),document.addEventListener("keydown",c=>{c.key==="Escape"&&e.classList.contains("active")&&l()}),window.addEventListener("resize",()=>{window.innerWidth>768&&e.classList.contains("active")&&l()});const d=()=>{const c=document.getElementById("userName"),m=document.getElementById("userStatus"),f=document.getElementById("mobileUserName"),b=document.getElementById("mobileUserStatus");c&&f&&(f.textContent=c.textContent),m&&b&&(b.textContent=m.textContent)};d();const g=new MutationObserver(d),p=document.getElementById("userName");p&&g.observe(p,{childList:!0,subtree:!0}),i.log("Mobile drawer functionality initialized successfully")}catch(t){i.error("Error initializing mobile drawer",t)}}document.addEventListener("DOMContentLoaded",()=>{setTimeout(()=>{Re()},1e3)});i.log("Enhanced inque social app initialization complete");function Ve(){i.log("Initializing mobile-specific enhancements");const t=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),e="ontouchstart"in window||navigator.maxTouchPoints>0;if(i.log("Device detection",{isMobile:t,isTouchDevice:e,userAgent:navigator.userAgent}),(t||e)&&(document.body.classList.add("mobile-device"),i.log("Mobile device class added to body")),e){const a=document.querySelectorAll("button, .neo-button, .mobile-nav-item, .hub-action-btn, .floating-orb");a.forEach(r=>{r.addEventListener("touchstart",function(){this.style.transform="scale(0.98)",this.style.transition="transform 0.1s ease"}),r.addEventListener("touchend",function(){this.style.transform=""}),r.addEventListener("touchcancel",function(){this.style.transform=""})}),i.log("Enhanced touch feedback applied to",a.length,"elements")}const o=document.querySelector(".floating-orb-wrapper");o&&t&&(o.addEventListener("touchstart",function(a){a.preventDefault(),this.style.transform="scale(0.95)"}),o.addEventListener("touchend",function(a){a.preventDefault(),this.style.transform="";const r=this.querySelector(".floating-orb");r&&r.click()}),i.log("Mobile orb touch handling initialized"));const n=document.querySelector(".profile-hub");if(n&&t){let a=0,r=0;n.addEventListener("touchstart",function(l){a=l.touches[0].clientY,r=l.touches[0].clientX}),n.addEventListener("touchmove",function(l){const u=l.touches[0].clientY,d=l.touches[0].clientX,g=a-u,p=r-d;if(g>50&&Math.abs(p)<50){const c=this.querySelector('[data-action="expand"]');c&&c.click()}}),i.log("Mobile profile hub swipe gestures initialized")}const s=document.getElementById("mobileMenuToggle");if(s&&t&&(s.addEventListener("click",function(){this.style.transform="scale(0.95)",setTimeout(()=>{this.style.transform=""},150)}),i.log("Mobile menu haptic feedback initialized")),t){const a=()=>{const r=window.innerHeight*.01;document.documentElement.style.setProperty("--vh",`${r}px`)};a(),window.addEventListener("resize",a),window.addEventListener("orientationchange",a),i.log("Mobile viewport height fix applied")}if(t){const a=document.createElement("style");a.textContent=`
      @media (max-width: 768px) {
        * {
          animation-duration: 0.3s !important;
          transition-duration: 0.2s !important;
        }
        
        .floating-orb.idle {
          animation-duration: 3s !important;
        }
        
        .pulse-ring {
          animation-duration: 2s !important;
        }
      }
    `,document.head.appendChild(a),i.log("Mobile performance optimizations applied")}window.addEventListener("error",function(a){t&&i.error("Mobile error detected",{message:a.message,filename:a.filename,lineno:a.lineno,colno:a.colno})}),i.log("Mobile enhancements initialization complete")}document.addEventListener("DOMContentLoaded",()=>{i.log("DOM Content Loaded - Starting enhanced initialization"),Ve(),setTimeout(()=>{i.log("Checking feature initialization status"),window.socialAuth?i.log("Social auth system initialized"):i.warn("Social auth system not initialized"),window.db&&window.auth?i.log("Firebase services available"):i.warn("Firebase services not available");const t=document.getElementById("authModal"),e=document.getElementById("googleLoginBtn");i.log("Critical DOM elements status",{authModal:!!t,googleLoginBtn:!!e})},2e3)});const y={log:(t,e=null)=>{console.log(`[FLOATING ORB] ${t}`,e||"")},error:(t,e=null)=>{console.error(`[FLOATING ORB ERROR] ${t}`,e||"")},warn:(t,e=null)=>{console.warn(`[FLOATING ORB WARN] ${t}`,e||"")}};class ne{constructor(e={}){this.options={debugMode:!1,maxNotifications:6,autoRemoveDelay:3e4,enableSounds:!0,useThreeJS:!0,threeJsCdn:"https://unpkg.com/three@0.160.0/build/three.module.js",...e},this.notifications=[],this.container=null,this.orb=null,this.isInitialized=!1,this.popupTimeout=null,y.log("Floating Orb Manager initialized",this.options)}async init(){if(this.isInitialized){y.warn("Orb already initialized");return}try{await this.createOrb(),this.setupEventListeners(),this.adjustSidebarSpacing(),this.bindProfileHubEvents(),this.isInitialized=!0,y.log("Floating orb system initialized successfully"),this.options.debugMode&&this.addDemoNotifications()}catch(e){y.error("Failed to initialize floating orb",e)}}bindProfileHubEvents(){try{if(this._hubBound)return;this._hubBound=!0;const e=(n,s)=>{if(!n)return;const a=n.ui?.hubState==="chatbot-active",r=!!n.chatbot?.isTyping;this.container&&(this.container.setAttribute("data-chatbot",a?"active":"inactive"),this.container.setAttribute("data-typing",r?"true":"false")),this.orb&&(this.orb.classList.toggle("chat-active",a),this.orb.classList.toggle("typing",r)),s?.chatbot?.messages&&this.orb&&(this.orb.classList.add("message-ping"),setTimeout(()=>this.orb&&this.orb.classList.remove("message-ping"),380))},o=window.profileHubManager?.state;o&&(y.log("Syncing orb with existing ProfileHub state"),e(o,null)),window.addEventListener("profilehub-state-changed",n=>{const{state:s,changes:a}=n.detail||{};y.log("ProfileHub state changed detected by orb",{hubState:s?.ui?.hubState,typing:s?.chatbot?.isTyping}),e(s,a)}),y.log("Floating orb bound to ProfileHub events")}catch(e){y.warn("Failed to bind ProfileHub events",e)}}async createOrb(){this.container=document.createElement("div"),this.container.className="floating-orb-wrapper",this.container.setAttribute("data-debug",this.options.debugMode),this.stage=document.createElement("div"),this.stage.style.position="absolute",this.stage.style.top="50%",this.stage.style.left="50%",this.stage.style.transform="translate(-50%, -50%)",this.stage.style.width="var(--orbit-size)",this.stage.style.height="var(--orbit-size)",this.orb=document.createElement("div"),this.orb.className="floating-orb",this.orb.title="Notification Center - Click to expand",this.orbit=document.createElement("div"),this.orbit.className="notification-orbit",this.popup=document.createElement("div"),this.popup.className="notification-popup",this.stage.appendChild(this.orb),this.stage.appendChild(this.orbit),this.container.appendChild(this.stage),this.container.appendChild(this.popup),document.body.appendChild(this.container),y.log("Orb DOM structure created");try{window.dispatchEvent(new CustomEvent("floating-orb:ready",{detail:{container:this.container,orb:this.orb,orbit:this.orbit,popup:this.popup}})),y.log("Dispatched floating-orb:ready event")}catch(e){y.warn("Failed to dispatch floating-orb:ready event",e)}this.options.useThreeJS&&this.tryInitThreeJS().catch(e=>{y.warn("Three.js enhancement unavailable; using CSS orb only",e)})}async tryInitThreeJS(){if(window.__orbThree)return y.log("Three.js already loaded, reusing module"),this.initThreeScene(window.__orbThree);try{y.log("Loading Three.js from CDN",{url:this.options.threeJsCdn});const e=await import(this.options.threeJsCdn);window.__orbThree=e,y.log("Three.js CDN module loaded successfully"),await this.initThreeScene(e)}catch(e){throw y.error("Failed to load Three.js from CDN",e),e}}async initThreeScene(e){y.log("Initializing Three.js scene");const o=document.createElement("div");o.className="orb-3d-layer",this.container.appendChild(o),y.log("WebGL layer created and added to container");const n=o.clientWidth||200,s=o.clientHeight||200,a=new e.WebGLRenderer({antialias:!0,alpha:!0});o.appendChild(a.domElement);const r=new e.Scene,l=new e.PerspectiveCamera(45,n/s,.1,100);l.position.z=3.2;const u=()=>{const S=o.clientWidth||parseInt(getComputedStyle(o).width),B=o.clientHeight||parseInt(getComputedStyle(o).height),I=Math.min(window.devicePixelRatio||1,2);a.setPixelRatio(I),a.setSize(S,B,!1),l.aspect=S/B,l.updateProjectionMatrix()};u(),new ResizeObserver(u).observe(o),window.addEventListener("resize",u);const d=new e.SphereGeometry(1,64,64),g=document.createElement("canvas");g.width=256,g.height=256;const p=g.getContext("2d"),c=p.createImageData(256,256),m=c.data;for(let S=0;S<m.length;S+=4){const B=S/4%256,I=Math.floor(S/4/256),F=Math.sin(B*.1)*Math.cos(I*.1),z=Math.sin(B*.05+I*.03)*Math.cos(B*.03-I*.05),W=(F+z)*.5+.5,ge=(F-z)*.5+.5;m[S]=W*255,m[S+1]=ge*255,m[S+2]=255,m[S+3]=255}p.putImageData(c,0,0);const f=new e.CanvasTexture(g);f.wrapS=f.wrapT=e.RepeatWrapping;const b=new e.MeshStandardMaterial({color:3470847,roughness:.15,metalness:.8,emissive:848127,emissiveIntensity:.3,transparent:!0,opacity:.9,normalMap:f,normalScale:new e.Vector2(.3,.3),envMapIntensity:1.2}),v=new e.Mesh(d,b);r.add(v);const w=new e.AmbientLight(6750207,.6);r.add(w);const E=new e.PointLight(8956671,1.5);E.position.set(2,2,2),r.add(E);const k=new e.Clock,M=()=>{const S=k.getElapsedTime();v.rotation.y=S*.4,v.rotation.x=Math.sin(S*.6)*.15,a.render(r,l),requestAnimationFrame(M)};M(),y.log("Three.js orb enhancement initialized"),this.webglLayer=o,this.threeRenderer=a,this.threeScene=r,this.threeSphere=v}setupEventListeners(){this.orb.addEventListener("click",e=>{e.preventDefault(),this.toggleNotificationsList(),y.log("Orb clicked - toggling notifications")}),this.orb.addEventListener("mouseenter",()=>{this.showLatestNotification()}),this.orb.addEventListener("mouseleave",()=>{this.hideNotificationPopup()}),document.addEventListener("click",e=>{this.container.contains(e.target)||this.hideNotificationPopup()}),this.orb.addEventListener("keydown",e=>{(e.key==="Enter"||e.key===" ")&&(e.preventDefault(),this.toggleNotificationsList())}),this.orb.setAttribute("tabindex","0"),this.orb.setAttribute("role","button"),this.orb.setAttribute("aria-label","Notification Center"),y.log("Event listeners set up")}adjustSidebarSpacing(){y.log("Orb floating mode - no layout adjustments needed")}addNotification(e){const o=Date.now()+Math.random(),n={id:o,title:e.title||"New Notification",message:e.message||"",type:e.type||"info",timestamp:new Date,icon:this.getIconForType(e.type),priority:e.priority||"normal",actions:e.actions||[],...e};if(this.notifications.unshift(n),this.notifications.length>this.options.maxNotifications){const s=this.notifications.pop();this.removeNotificationCard(s.id)}return this.createNotificationCard(n),this.updateOrbState(),this.options.autoRemoveDelay>0&&e.autoRemove!==!1&&setTimeout(()=>{this.removeNotification(o)},this.options.autoRemoveDelay),y.log("Notification added",n),o}removeNotification(e){const o=this.notifications.findIndex(n=>n.id===e);if(o!==-1){const n=this.notifications.splice(o,1)[0];this.removeNotificationCard(e),this.updateOrbState(),y.log("Notification removed",n)}}createNotificationCard(e){const o=document.createElement("div");o.className="notification-card",o.setAttribute("data-id",e.id),o.innerHTML=e.icon,o.title=e.title,o.addEventListener("click",n=>{n.stopPropagation(),this.showNotificationDetails(e),y.log("Notification card clicked",e)}),o.addEventListener("mouseenter",()=>{this.showNotificationPreview(e)}),this.orbit.appendChild(o),requestAnimationFrame(()=>{o.style.transform="scale(1.2)",setTimeout(()=>{o.style.transform=""},300)})}removeNotificationCard(e){const o=this.orbit.querySelector(`[data-id="${e}"]`);o&&(o.style.animation="none",o.style.transform="scale(0)",o.style.opacity="0",setTimeout(()=>{o.parentNode&&o.parentNode.removeChild(o)},300))}updateOrbState(){const e=this.notifications.length>0;this.container.classList.toggle("has-notifications",e),this.orb.setAttribute("aria-label",e?`Notification Center - ${this.notifications.length} notifications`:"Notification Center - No notifications")}showNotificationDetails(e){this.popup.innerHTML=`
            <h4>${this.escapeHtml(e.title)}</h4>
            <p>${this.escapeHtml(e.message)}</p>
            ${e.actions?this.renderNotificationActions(e.actions):""}
            <div class="timestamp">${this.formatTimestamp(e.timestamp)}</div>
        `,this.popup.classList.add("show"),clearTimeout(this.popupTimeout),this.popupTimeout=setTimeout(()=>{this.hideNotificationPopup()},5e3)}showNotificationPreview(e){this.popup.innerHTML=`
            <h4>${this.escapeHtml(e.title)}</h4>
            <p>${this.escapeHtml(e.message.substring(0,100))}${e.message.length>100?"...":""}</p>
        `,this.popup.classList.add("show")}showLatestNotification(){this.notifications.length>0&&this.showNotificationPreview(this.notifications[0])}hideNotificationPopup(){this.popup.classList.remove("show"),clearTimeout(this.popupTimeout)}toggleNotificationsList(){this.notifications.length===0?this.addNotification({title:"No Notifications",message:"You're all caught up! 🎉",type:"info",autoRemove:!1}):this.showNotificationDetails(this.notifications[0])}getIconForType(e){const o={info:"💬",success:"✅",warning:"⚠️",error:"❌",update:"🔄",like:"❤️",comment:"💭",follow:"👥",system:"⚙️"};return o[e]||o.info}formatTimestamp(e){const n=new Date-e;return n<6e4?"Just now":n<36e5?`${Math.floor(n/6e4)}m ago`:n<864e5?`${Math.floor(n/36e5)}h ago`:e.toLocaleDateString()}escapeHtml(e){const o=document.createElement("div");return o.textContent=e,o.innerHTML}renderNotificationActions(e){return e.map(o=>`<button class="notification-action-btn" onclick="window.floatingOrb.handleNotificationAction('${o.id}', '${o.handler}')">${o.label}</button>`).join("")}handleNotificationAction(e,o){y.log("Notification action triggered",{actionId:e,handler:o}),typeof window[o]=="function"&&window[o](e)}addDemoNotifications(){[{title:"Welcome!",message:"Your floating orb is now active and ready for notifications! 🚀",type:"success"},{title:"New Feature",message:"Check out the latest widget studio updates.",type:"info"},{title:"System Update",message:"Your profile has been synced successfully.",type:"update"}].forEach((o,n)=>{setTimeout(()=>{this.addNotification(o)},n*1e3)})}clear(){this.notifications=[],this.orbit.innerHTML="",this.updateOrbState(),this.hideNotificationPopup(),y.log("All notifications cleared")}destroy(){this.container&&this.container.parentNode&&this.container.parentNode.removeChild(this.container);const e=document.querySelector(".sidebar-nav");e&&(e.style.paddingLeft=""),this.isInitialized=!1,y.log("Floating orb destroyed")}}document.addEventListener("DOMContentLoaded",()=>{window.floatingOrb=new ne({debugMode:!0,maxNotifications:6,autoRemoveDelay:3e4}),window.floatingOrb.init(),y.log("Floating orb system loaded and ready!")});(()=>{const t=(...s)=>console.debug("[Orb3D]",...s);let e=!1;const o=()=>{if(e)return;const s=document.querySelector(".floating-orb-wrapper"),a=document.querySelector(".floating-orb"),r=document.querySelector(".notification-popup");if(!s||!a){t("Orb not yet in DOM. Will wait for ready event/observer.");return}e=!0,t("Initializing 3D tilt controller");let l=0,u=0,d=0,g=0,p=null;const c=(w,E,k)=>Math.min(k,Math.max(E,w)),m=w=>{a&&(w?a.classList.add("idle"):a.classList.remove("idle"))},f=(w,E)=>{const k=s.getBoundingClientRect(),M=k.left+k.width/2,S=k.top+k.height/2,B=w-M,I=E-S,F=c(B/(k.width/2),-1,1),z=c(I/(k.height/2),-1,1),W=10;u=F*W,l=-z*W},b=()=>{const E=l-d,k=u-g;d+=E*.12,g+=k*.12,a.style.transform=`translate(-50%,-50%) rotateX(${d.toFixed(2)}deg) rotateY(${g.toFixed(2)}deg)`,requestAnimationFrame(b)},v=w=>{m(!1),w.touches&&w.touches[0]?f(w.touches[0].clientX,w.touches[0].clientY):f(w.clientX,w.clientY),clearTimeout(p),p=setTimeout(()=>m(!0),2200)};window.addEventListener("pointermove",v,{passive:!0}),window.addEventListener("touchmove",v,{passive:!0}),a.addEventListener("click",()=>{r&&r.classList.toggle("show")}),m(!0),requestAnimationFrame(b),t("3D tilt engaged. Try moving your pointer around.")};document.querySelector(".floating-orb")&&o(),window.addEventListener("floating-orb:ready",()=>{t("Received floating-orb:ready"),o()});const n=new MutationObserver(()=>{document.querySelector(".floating-orb")&&(t("Observer detected orb in DOM"),o(),n.disconnect())});document.body?n.observe(document.body,{childList:!0,subtree:!0}):window.addEventListener("DOMContentLoaded",()=>{n.observe(document.body,{childList:!0,subtree:!0})})})();window.debugOrb={checkStatus:()=>{const t=document.querySelector(".floating-orb"),e=document.querySelector(".floating-orb-wrapper"),o=document.querySelector(".orb-3d-layer"),n=o?.querySelector("canvas");console.log("[ORB DEBUG] Status check:",{orb:!!t,wrapper:!!e,webglLayer:!!o,canvas:!!n,canvasSize:n?`${n.width}x${n.height}`:"N/A",orbPosition:t?getComputedStyle(t).transform:"N/A",threeLoaded:!!window.__orbThree})},testWebGL:()=>{const t=document.querySelector(".orb-3d-layer canvas");if(t){const e=t.getContext("webgl")||t.getContext("webgl2");console.log("[ORB DEBUG] WebGL context:",!!e),e&&console.log("[ORB DEBUG] WebGL info:",{vendor:e.getParameter(e.VENDOR),renderer:e.getParameter(e.RENDERER),version:e.getParameter(e.VERSION)})}else console.log("[ORB DEBUG] No WebGL canvas found")},repositionTopLeft:()=>{const t=document.querySelector(".floating-orb-wrapper");t&&(t.style.top="12px",t.style.left="12px",console.log("[ORB DEBUG] Repositioned to top-left"))}};const Ke=Object.freeze(Object.defineProperty({__proto__:null,default:ne},Symbol.toStringTag,{value:"Module"}));class Ye{constructor(){this.currentUser=null,this.userWidgets=[],this.widgetData={},this.userQuips=[],this.quipData={},this.debugMode=!0}log(e,o=null){this.debugMode&&console.log(`[WidgetDisplay] ${e}`,o)}error(e,o=null){console.error(`[WidgetDisplay] ${e}`,o)}async init(){if(this.currentUser=te.currentUser,!this.currentUser){this.log("No user logged in for widget display");return}this.log("Initializing enhanced widget display system with quip support"),await this.loadUserWidgets(),await this.loadUserQuips(),this.setupWidgetSlots(),this.setupQuipSlots(),this.setupProfileMenuIntegration()}async loadUserWidgets(){try{const e=await N(T(L,"users",this.currentUser.uid));if(e.exists()){const o=e.data();this.userWidgets=o.widgets||[],this.log("Loaded user widgets",{widgetCount:this.userWidgets.length}),await this.loadWidgetMetadata()}}catch(e){this.error("Error loading user widgets",e)}}async loadWidgetMetadata(){try{for(const e of this.userWidgets){const o=await N(T(L,"widgets",e));o.exists()&&(this.widgetData[e]=o.data())}this.log("Loaded widget metadata",{widgetCount:Object.keys(this.widgetData).length})}catch(e){this.error("Error loading widget metadata",e)}}async loadUserQuips(){try{this.log("Loading user quips for user:",this.currentUser.uid);const e=G(L,"quips"),o=Q(e,j("userId","==",this.currentUser.uid)),n=await V(o);this.userQuips=n.docs.map(s=>s.id),this.log("Loaded user quips",{quipCount:this.userQuips.length,quipIds:this.userQuips}),await this.loadQuipMetadata()}catch(e){if(this.error("Error loading user quips",e),e.code==="permission-denied"&&(this.log("Permission denied - user may not be authenticated properly"),window.socialAuth&&window.socialAuth.currentUser)){this.log("Retrying with current auth user"),this.currentUser=window.socialAuth.currentUser;try{const o=G(L,"quips"),n=Q(o,j("userId","==",this.currentUser.uid)),s=await V(n);this.userQuips=s.docs.map(a=>a.id),this.log("Retry successful - loaded user quips",{quipCount:this.userQuips.length}),await this.loadQuipMetadata()}catch(o){this.error("Retry also failed",o)}}}}async loadQuipMetadata(){try{for(const e of this.userQuips){const o=await N(T(L,"quips",e));o.exists()&&(this.quipData[e]=o.data())}this.log("Loaded quip metadata",{quipCount:Object.keys(this.quipData).length})}catch(e){this.error("Error loading quip metadata",e)}}findHtmlFile(e){if(!Array.isArray(e)||e.length===0)return null;const o=e.find(n=>n.fileName&&/index\.html?$/i.test(n.fileName));return o||e.find(n=>n.fileName&&/\.html?$/i.test(n.fileName))}setupWidgetSlots(){document.querySelectorAll("[data-widget-slot]").forEach(o=>{const n=o.dataset.widgetSlot;this.renderWidgetSlot(o,n)})}setupQuipSlots(){document.querySelectorAll(".quip-slot, .quip-preview, .timeline-event-card").forEach((o,n)=>{this.renderQuipSlot(o,n+1)})}async renderQuipSlot(e,o){const n=Object.values(this.quipData).find(s=>s.slot===parseInt(o));if(n&&n.files&&this.findHtmlFile(n.files)){const s=this.findHtmlFile(n.files);this.showQuipIframe(e,s.downloadURL,n)}else this.showEmptyQuipSlot(e,o)}async renderWidgetSlot(e,o){const n=Object.values(this.widgetData).find(s=>s.slot===parseInt(o));if(n&&n.files&&this.findHtmlFile(n.files)){const s=this.findHtmlFile(n.files);this.showWidgetIframe(e,s.downloadURL,n)}else this.showUploadInterface(e,o)}showWidgetIframe(e,o,n){e.innerHTML=`
      <div class="widget-container">
        <div class="widget-header">
          <h3>${n.title||"Untitled Widget"}</h3>
          <div class="widget-actions">
            <button class="btn btn-secondary edit-widget-btn" data-widget-id="${n.id}">
              <span class="material-icons">edit</span>
              Edit
            </button>
            <button class="btn btn-secondary preview-widget-btn" data-widget-id="${n.id}">
              <span class="material-icons">open_in_new</span>
              Full View
            </button>
            <button class="btn btn-danger delete-widget-btn" data-widget-id="${n.id}">
              <span class="material-icons">delete</span>
              Delete
            </button>
          </div>
        </div>
        <div class="widget-frame-container">
          <iframe 
            src="${o}" 
            class="widget-iframe"
            frameborder="0"
            sandbox="allow-scripts allow-same-origin allow-forms"
            title="Widget ${n.title}"
          ></iframe>
        </div>
        <div class="widget-info">
          <p><strong>Description:</strong> ${n.description||"No description"}</p>
          <p><strong>Category:</strong> ${n.category||"General"}</p>
          <p><strong>Tags:</strong> ${n.tags?.join(", ")||"No tags"}</p>
          <p><strong>Last Updated:</strong> ${new Date(n.updatedAt?.toDate()||n.updatedAt).toLocaleDateString()}</p>
          <div class="widget-stats">
            <span class="stat">👁️ ${n.stats?.views||0} views</span>
            <span class="stat">❤️ ${n.stats?.likes||0} likes</span>
            <span class="stat">📤 ${n.stats?.shares||0} shares</span>
          </div>
        </div>
      </div>
    `,this.setupWidgetActionHandlers(e)}showQuipIframe(e,o,n){e.innerHTML=`
      <div class="quip-container">
        <div class="quip-header">
          <h3 style="color: #00f0ff; font-family: JetBrains Mono;">${n.title||"Untitled Quip"}</h3>
          <div class="quip-badges">
            <span class="quip-type-badge" style="background: rgba(0,240,255,0.2); color: #00f0ff; padding: 4px 8px; border-radius: 12px; font-size: 0.8rem;">QUIP</span>
            ${n.webglEnabled?'<span class="webgl-badge" style="background: rgba(255,0,255,0.2); color: #ff00ff; padding: 4px 8px; border-radius: 12px; font-size: 0.8rem;">WebGL</span>':""}
          </div>
          <div class="quip-actions">
            <button class="btn btn-primary interact-quip-btn" data-quip-id="${n.id}">
              <span>🎮</span>
              Interact
            </button>
            <button class="btn btn-secondary edit-quip-btn" data-quip-id="${n.id}">
              <span>✏️</span>
              Edit
            </button>
            <button class="btn btn-secondary preview-quip-btn" data-quip-id="${n.id}">
              <span>👁️</span>
              Full View
            </button>
            <button class="btn btn-danger delete-quip-btn" data-quip-id="${n.id}">
              <span>🗑️</span>
              Delete
            </button>
          </div>
        </div>
        <div class="quip-frame-container">
          <iframe 
            src="${o}" 
            class="quip-iframe webgl-enabled"
            frameborder="0"
            loading="lazy"
            sandbox="allow-scripts allow-same-origin allow-forms allow-webgl allow-pointer-lock"
            style="width: 100%; height: 300px; border-radius: 12px; border: 2px solid #00f0ff; background: #0a0a0a;"
            title="Quip Preview - ${n.title||"Untitled Quip"}"
          ></iframe>
        </div>
        <div class="quip-info">
          <p style="color: #a0a0a0; margin: 8px 0;">${n.description||"No description available"}</p>
          <div class="quip-meta">
            <span class="quip-interactions" style="color: #00f0ff;">Interactions: ${n.interactionCount||0}</span>
            <span class="quip-category" style="color: #ff00ff;">Category: ${n.category||"general"}</span>
          </div>
        </div>
      </div>
    `;const s=e.querySelector(".quip-iframe");O&&typeof O.applyDashboardSettings=="function"&&O.applyDashboardSettings(s,{borderColor:"#00f0ff",borderWidth:"2px",borderRadius:"12px",shadow:"0 0 20px rgba(0, 240, 255, 0.3), inset 0 1px 0 rgba(255, 255, 255, 0.1)"}),this.setupQuipActionHandlers(e)}showEmptyQuipSlot(e,o){e.innerHTML=`
      <div class="empty-quip-slot" style="text-align: center; padding: 40px; border: 2px dashed #333; border-radius: 12px; background: rgba(0,240,255,0.05);">
        <div style="font-size: 3rem; margin-bottom: 16px; color: #00f0ff;">🎮</div>
        <h3 style="color: #00f0ff; margin-bottom: 8px; font-family: JetBrains Mono;">Empty Quip Slot ${o}</h3>
        <p style="color: #a0a0a0; margin-bottom: 16px;">Create an interactive WebGL quip to fill this slot</p>
        <button class="btn btn-primary create-quip-btn" data-slot="${o}" style="background: rgba(0,240,255,0.1); border: 1px solid #00f0ff; color: #00f0ff; padding: 8px 16px; border-radius: 6px;">
          <span>➕</span>
          Create Quip
        </button>
      </div>
    `,this.setupEmptyQuipHandlers(e)}showUploadInterface(e,o){e.innerHTML=`
      <div class="widget-upload-container">
        <h3>Widget Slot ${o}</h3>
        <p>Upload your widget files to get started</p>
        <div class="upload-area" data-slot="${o}">
          <input type="file" id="widgetFiles${o}" multiple accept=".html,.js,.css,.png,.jpg,.jpeg,.gif,.svg,.json,.mp3,.mp4,.wav,.ogg" style="display: none;">
          <div class="upload-placeholder">
            <span class="material-icons">cloud_upload</span>
            <p>Drop files here or click to upload</p>
            <p class="upload-hint">Supports: HTML, CSS, JS, Images, Audio, Video</p>
          </div>
        </div>
        <div class="upload-form" style="display: none;">
          <input type="text" placeholder="Widget Title" class="widget-title-input" data-slot="${o}">
          <textarea placeholder="Widget Description" class="widget-desc-input" data-slot="${o}" rows="3"></textarea>
          <input type="text" placeholder="Category (e.g., game, tool, art)" class="widget-category-input" data-slot="${o}">
          <input type="text" placeholder="Tags (comma separated)" class="widget-tags-input" data-slot="${o}">
          <button class="btn btn-primary upload-widget-btn" data-slot="${o}">
            <span class="material-icons">upload</span>
            Upload Widget
          </button>
        </div>
      </div>
    `,this.setupUploadHandlers(e,o)}setupUploadHandlers(e,o){const n=e.querySelector(".upload-area"),s=e.querySelector(`#widgetFiles${o}`),a=e.querySelector(".upload-form");s.addEventListener("change",l=>{l.target.files.length>0&&this.handleFileSelection(l.target.files,a)}),n.addEventListener("dragover",l=>{l.preventDefault(),n.classList.add("drag-over")}),n.addEventListener("dragleave",l=>{l.preventDefault(),n.classList.remove("drag-over")}),n.addEventListener("drop",l=>{l.preventDefault(),n.classList.remove("drag-over");const u=l.dataTransfer.files;u.length>0&&(s.files=u,this.handleFileSelection(u,a))}),n.addEventListener("click",()=>{s.click()}),e.querySelector(".upload-widget-btn").addEventListener("click",()=>{this.uploadWidget(o)})}handleFileSelection(e,o){o.style.display="block";const n=Array.from(e).map(s=>s.name).join(", ");o.querySelector(".upload-placeholder p").textContent=`Selected: ${n}`}async uploadWidget(e){if(this.log("Widget upload requested, delegating to WidgetUploadManager"),!window.widgetUploadManager){const{default:n}=await h(async()=>{const{default:s}=await import("./widget-upload-EdH-RL5r.js");return{default:s}},__vite__mapDeps([4,5,2]),import.meta.url);window.widgetUploadManager=n}const o=document.querySelector(`.upload-widget-btn[data-slot="${e}"]`);o?await window.widgetUploadManager.handleUploadButtonClick(o):this.error("Upload button not found for slot",{slotNumber:e})}setupWidgetActionHandlers(e){const o=e.querySelector(".edit-widget-btn");o&&o.addEventListener("click",a=>{const r=a.target.closest(".edit-widget-btn").dataset.widgetId;this.editWidget(r)});const n=e.querySelector(".preview-widget-btn");n&&n.addEventListener("click",a=>{const r=a.target.closest(".preview-widget-btn").dataset.widgetId;this.previewWidget(r)});const s=e.querySelector(".delete-widget-btn");s&&s.addEventListener("click",a=>{const r=a.target.closest(".delete-widget-btn").dataset.widgetId;this.deleteWidget(r)})}setupQuipActionHandlers(e){const o=e.querySelector(".interact-quip-btn");o&&o.addEventListener("click",r=>{const l=r.target.closest(".interact-quip-btn").dataset.quipId;this.interactWithQuip(l)});const n=e.querySelector(".edit-quip-btn");n&&n.addEventListener("click",r=>{const l=r.target.closest(".edit-quip-btn").dataset.quipId;this.editQuip(l)});const s=e.querySelector(".preview-quip-btn");s&&s.addEventListener("click",r=>{const l=r.target.closest(".preview-quip-btn").dataset.quipId;this.previewQuip(l)});const a=e.querySelector(".delete-quip-btn");a&&a.addEventListener("click",r=>{const l=r.target.closest(".delete-quip-btn").dataset.quipId;this.deleteQuip(l)})}setupEmptyQuipHandlers(e){const o=e.querySelector(".create-quip-btn");o&&o.addEventListener("click",n=>{const s=n.target.closest(".create-quip-btn").dataset.slot;this.createNewQuip(s)})}previewWidget(e){const o=this.widgetData[e];if(!o){this.showToast("Widget not found","error");return}const n=this.findHtmlFile(o.files);if(!n||!n.downloadURL){this.showToast("Widget HTML file not found","error");return}let s=document.getElementById("widgetPreviewModal");s||(s=document.createElement("div"),s.id="widgetPreviewModal",s.className="modal",s.innerHTML=`
        <div class="modal-content widget-preview-modal">
          <div class="modal-header">
            <h3>${o.title}</h3>
            <button class="close-modal">×</button>
          </div>
          <div class="modal-body">
            <iframe 
              src="${n.downloadURL}" 
              class="widget-preview-iframe"
              frameborder="0"
              sandbox="allow-scripts allow-same-origin allow-forms"
              title="Widget Preview"
            ></iframe>
          </div>
        </div>
      `,document.body.appendChild(s),s.querySelector(".close-modal").addEventListener("click",()=>{s.style.display="none"}),s.addEventListener("click",r=>{r.target===s&&(s.style.display="none")})),s.querySelector("h3").textContent=o.title,s.querySelector("iframe").src=n.downloadURL,s.style.display="block"}editWidget(e){const o=this.widgetData[e];if(!o){this.showToast("Widget not found","error");return}const n=document.querySelector(`[data-widget-slot="${o.slot}"]`);if(n){this.showUploadInterface(n,o.slot);const s=n.querySelector(".widget-title-input"),a=n.querySelector(".widget-desc-input"),r=n.querySelector(".widget-category-input"),l=n.querySelector(".widget-tags-input");s&&(s.value=o.title||""),a&&(a.value=o.description||""),r&&(r.value=o.category||""),l&&(l.value=o.tags?.join(", ")||"")}}async deleteWidget(e){const o=this.widgetData[e];if(!o){this.showToast("Widget not found","error");return}if(confirm(`Are you sure you want to delete "${o.title}"?`))try{await K(T(L,"widgets",e)),await Y(T(L,"users",this.currentUser.uid),{widgets:me(e)}),await this.loadUserWidgets(),this.setupWidgetSlots(),this.showToast(`Widget "${o.title}" deleted successfully`,"success"),this.log("Widget deleted successfully",{widgetId:e})}catch(n){this.error("Error deleting widget",n),this.showToast("Failed to delete widget: "+n.message,"error")}}setupProfileMenuIntegration(){this.updateProfileMenuWidgetCount(),this.addWidgetManagementToProfile()}updateProfileMenuWidgetCount(){const e=document.querySelector(".profile-menu");if(e){const o=e.querySelector(".widget-count");if(o)o.textContent=this.userWidgets.length;else{const n=document.createElement("div");n.className="widget-count",n.textContent=this.userWidgets.length,e.appendChild(n)}}}addWidgetManagementToProfile(){const e=document.querySelector(".profile-menu");if(e&&!e.querySelector(".widget-management")){const o=document.createElement("div");o.className="widget-management",o.innerHTML=`
        <h4>My Widgets (${this.userWidgets.length})</h4>
        <div class="widget-list">
          ${this.userWidgets.length===0?'<p>No widgets yet. <a href="#" class="upload-widget-link">Upload your first widget!</a></p>':this.userWidgets.map(n=>{const s=this.widgetData[n];return s?`
                <div class="widget-item" data-widget-id="${n}">
                  <div class="widget-info">
                    <h5>${s.title}</h5>
                    <p>${s.description||"No description"}</p>
                    <span class="widget-category">${s.category}</span>
                  </div>
                  <div class="widget-actions">
                    <button class="btn btn-sm preview-widget-btn" data-widget-id="${n}">Preview</button>
                    <button class="btn btn-sm edit-widget-btn" data-widget-id="${n}">Edit</button>
                    <button class="btn btn-sm btn-danger delete-widget-btn" data-widget-id="${n}">Delete</button>
                  </div>
                </div>
              `:""}).join("")}
        </div>
      `,e.appendChild(o),this.setupProfileMenuEventListeners(o)}}setupProfileMenuEventListeners(e){e.querySelectorAll(".preview-widget-btn").forEach(n=>{n.addEventListener("click",s=>{const a=s.target.dataset.widgetId;this.previewWidget(a)})}),e.querySelectorAll(".edit-widget-btn").forEach(n=>{n.addEventListener("click",s=>{const a=s.target.dataset.widgetId;this.editWidget(a)})}),e.querySelectorAll(".delete-widget-btn").forEach(n=>{n.addEventListener("click",s=>{const a=s.target.dataset.widgetId;this.deleteWidget(a)})});const o=e.querySelector(".upload-widget-link");o&&o.addEventListener("click",n=>{n.preventDefault();const s=document.querySelector("[data-widget-slot]");s&&s.scrollIntoView({behavior:"smooth"})})}async interactWithQuip(e){const o=this.quipData[e];if(!o){this.showToast("Quip not found","error");return}const n=document.querySelector(`[data-quip-id="${e}"] .quip-iframe`);n&&(n.focus(),n.style.borderColor="#ffff00",setTimeout(()=>{n.style.borderColor="#00f0ff"},2e3));try{await Y(T(L,"quips",e),{interactionCount:(o.interactionCount||0)+1,lastInteracted:pe()}),this.log("Quip interaction tracked",{quipId:e})}catch(s){this.error("Failed to track quip interaction",s)}}editQuip(e){if(!this.quipData[e]){this.showToast("Quip not found","error");return}const n=`pages/widget_studio.html?edit=${e}`;window.location.href=n}previewQuip(e){const o=this.quipData[e];if(!o){this.showToast("Quip not found","error");return}const n=this.findHtmlFile(o.files);if(!n||!n.downloadURL){this.showToast("Quip HTML file not found","error");return}let s=document.getElementById("quipPreviewModal");s||(s=document.createElement("div"),s.id="quipPreviewModal",s.className="modal",s.innerHTML=`
        <div class="modal-content" style="max-width: 90vw; max-height: 90vh;">
          <div class="modal-header">
            <h3>Quip Preview</h3>
            <button class="modal-close">&times;</button>
          </div>
          <div class="modal-body">
            <iframe 
              src="${n.downloadURL}" 
              style="width: 100%; height: 70vh; border: none; border-radius: 8px;"
              sandbox="allow-scripts allow-same-origin allow-forms allow-webgl allow-pointer-lock"
            ></iframe>
          </div>
        </div>
      `,document.body.appendChild(s));const a=s.querySelector("iframe");a.src=n.downloadURL,s.querySelector("h3").textContent=`Quip Preview - ${o.title||"Untitled Quip"}`,s.style.display="flex",s.querySelector(".modal-close").onclick=()=>{s.style.display="none"},s.onclick=r=>{r.target===s&&(s.style.display="none")}}async deleteQuip(e){const o=this.quipData[e];if(!o){this.showToast("Quip not found","error");return}if(confirm(`Are you sure you want to delete "${o.title||"Untitled Quip"}"?`))try{await K(T(L,"quips",e)),delete this.quipData[e],this.userQuips=this.userQuips.filter(n=>n!==e),this.showToast("Quip deleted successfully","success"),this.log("Quip deleted",{quipId:e}),this.setupQuipSlots()}catch(n){this.error("Failed to delete quip",n),this.showToast("Failed to delete quip","error")}}createNewQuip(e){const o=`pages/widget_studio.html?slot=${e}&type=quip`;window.location.href=o}showToast(e,o="info"){window.showToast?window.showToast(e,o):console.log(`[${o.toUpperCase()}] ${e}`)}}window.previewWidget=function(t){window.widgetDisplay&&window.widgetDisplay.previewWidget(t)};window.uploadWidget=function(t){window.widgetDisplay&&window.widgetDisplay.uploadWidget(t)};window.editWidget=function(t){window.widgetDisplay&&window.widgetDisplay.editWidget(t)};window.deleteWidget=function(t){window.widgetDisplay&&window.widgetDisplay.deleteWidget(t)};let A=null;te.onAuthStateChanged(t=>{t?A||(A=new Ye,A.init(),window.widgetDisplay=A):(A=null,window.widgetDisplay=null)});class se{constructor(){this.currentUser=null,this.following=new Set,this.followers=new Set,this.debugMode=!0}log(e,o=null){this.debugMode&&console.log(`[SOCIAL FEATURES] ${e}`,o||"")}error(e,o=null){console.error(`[SOCIAL FEATURES ERROR] ${e}`,o||"")}async init(){this.log("Initializing Social Features Manager"),this.setupAuthListener(),this.setupEventListeners(),this.log("Social Features Manager initialized")}async setupAuthListener(){try{this.log("Setting up auth state listener");const{auth:e,onAuthStateChanged:o}=await h(async()=>{const{auth:n,onAuthStateChanged:s}=await import("./firebase-core-BO8UvLyb.js");return{auth:n,onAuthStateChanged:s}},[],import.meta.url);this.log("Firebase imports successful",{auth:!!e,onAuthStateChanged:!!o}),o(e,async n=>{this.currentUser=n,n?await this.loadUserSocialData(n.uid):(this.following.clear(),this.followers.clear())})}catch(e){this.error("Failed to setup auth listener",e)}}async loadUserSocialData(e){try{const{db:o}=await h(async()=>{const{db:r}=await import("./firebase-core-BO8UvLyb.js");return{db:r}},[],import.meta.url),{doc:n,getDoc:s}=await h(async()=>{const{doc:r,getDoc:l}=await import("https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js");return{doc:r,getDoc:l}},[],import.meta.url),a=await s(n(o,"users",e));if(a.exists()){const r=a.data();this.following=new Set(r.following||[]),this.followers=new Set(r.followers||[]),this.log("User social data loaded",{following:this.following.size,followers:this.followers.size})}}catch(o){this.error("Failed to load user social data",o)}}async followUser(e){try{if(!this.currentUser)throw new Error("User must be logged in to follow others");const o=this.currentUser.uid;if(o===e)throw new Error("You cannot follow yourself");if(this.following.has(e))throw new Error("You are already following this user");const{db:n}=await h(async()=>{const{db:l}=await import("./firebase-core-BO8UvLyb.js");return{db:l}},[],import.meta.url),{doc:s,updateDoc:a,arrayUnion:r}=await h(async()=>{const{doc:l,updateDoc:u,arrayUnion:d}=await import("https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js");return{doc:l,updateDoc:u,arrayUnion:d}},[],import.meta.url);return await a(s(n,"users",o),{following:r(e)}),await a(s(n,"users",e),{followers:r(o)}),this.following.add(e),await this.createFollowNotification(e,o),this.log("User followed successfully",{targetUserId:e}),{success:!0}}catch(o){return this.error("Follow action failed",o),{success:!1,error:o.message}}}async unfollowUser(e){try{if(!this.currentUser)throw new Error("User must be logged in to unfollow others");const o=this.currentUser.uid;if(!this.following.has(e))throw new Error("You are not following this user");const{db:n}=await h(async()=>{const{db:l}=await import("./firebase-core-BO8UvLyb.js");return{db:l}},[],import.meta.url),{doc:s,updateDoc:a,arrayRemove:r}=await h(async()=>{const{doc:l,updateDoc:u,arrayRemove:d}=await import("https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js");return{doc:l,updateDoc:u,arrayRemove:d}},[],import.meta.url);return await a(s(n,"users",o),{following:r(e)}),await a(s(n,"users",e),{followers:r(o)}),this.following.delete(e),this.log("User unfollowed successfully",{targetUserId:e}),{success:!0}}catch(o){return this.error("Unfollow action failed",o),{success:!1,error:o.message}}}async likeWidget(e){try{if(!this.currentUser)throw new Error("User must be logged in to like widgets");const{db:o}=await h(async()=>{const{db:g}=await import("./firebase-core-BO8UvLyb.js");return{db:g}},[],import.meta.url),{doc:n,updateDoc:s,arrayUnion:a,getDoc:r}=await h(async()=>{const{doc:g,updateDoc:p,arrayUnion:c,getDoc:m}=await import("https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js");return{doc:g,updateDoc:p,arrayUnion:c,getDoc:m}},[],import.meta.url),l=await r(n(o,"widgets",e));if(!l.exists())throw new Error("Widget not found");const u=l.data(),d=this.currentUser.uid;if(u.likes&&u.likes.includes(d))throw new Error("You have already liked this widget");return await s(n(o,"widgets",e),{likes:a(d),"stats.likes":(u.stats?.likes||0)+1}),await this.createLikeNotification(u.userId,d,e,u.title),this.log("Widget liked successfully",{widgetId:e}),{success:!0}}catch(o){return this.error("Like action failed",o),{success:!1,error:o.message}}}async unlikeWidget(e){try{if(!this.currentUser)throw new Error("User must be logged in to unlike widgets");const{db:o}=await h(async()=>{const{db:g}=await import("./firebase-core-BO8UvLyb.js");return{db:g}},[],import.meta.url),{doc:n,updateDoc:s,arrayRemove:a,getDoc:r}=await h(async()=>{const{doc:g,updateDoc:p,arrayRemove:c,getDoc:m}=await import("https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js");return{doc:g,updateDoc:p,arrayRemove:c,getDoc:m}},[],import.meta.url),l=await r(n(o,"widgets",e));if(!l.exists())throw new Error("Widget not found");const u=l.data(),d=this.currentUser.uid;if(!u.likes||!u.likes.includes(d))throw new Error("You have not liked this widget");return await s(n(o,"widgets",e),{likes:a(d),"stats.likes":Math.max(0,(u.stats?.likes||1)-1)}),this.log("Widget unliked successfully",{widgetId:e}),{success:!0}}catch(o){return this.error("Unlike action failed",o),{success:!1,error:o.message}}}async shareWidget(e,o="general"){try{if(!this.currentUser)throw new Error("User must be logged in to share widgets");const{db:n}=await h(async()=>{const{db:g}=await import("./firebase-core-BO8UvLyb.js");return{db:g}},[],import.meta.url),{doc:s,getDoc:a,updateDoc:r,increment:l}=await h(async()=>{const{doc:g,getDoc:p,updateDoc:c,increment:m}=await import("https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js");return{doc:g,getDoc:p,updateDoc:c,increment:m}},[],import.meta.url),u=await a(s(n,"widgets",e));if(!u.exists())throw new Error("Widget not found");const d=u.data();return await r(s(n,"widgets",e),{"stats.shares":l(1)}),await this.createShareNotification(d.userId,this.currentUser.uid,e,d.title,o),await this.handlePlatformSharing(d,o),this.log("Widget shared successfully",{widgetId:e,platform:o}),{success:!0}}catch(n){return this.error("Share action failed",n),{success:!1,error:n.message}}}async handlePlatformSharing(e,o){const n=`${window.location.origin}/widget/${e.id}`,s=`Check out this amazing widget: ${e.title}`;switch(o){case"twitter":window.open(`https://twitter.com/intent/tweet?text=${encodeURIComponent(s)}&url=${encodeURIComponent(n)}`);break;case"facebook":window.open(`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(n)}`);break;case"linkedin":window.open(`https://www.linkedin.com/sharing/share-offsite/?url=${encodeURIComponent(n)}`);break;case"copy":await navigator.clipboard.writeText(`${s}
${n}`),this.showToast("Link copied to clipboard!","success");break;case"native":navigator.share?await navigator.share({title:e.title,text:e.description||s,url:n}):(await navigator.clipboard.writeText(`${s}
${n}`),this.showToast("Link copied to clipboard!","success"));break;default:await navigator.clipboard.writeText(`${s}
${n}`),this.showToast("Link copied to clipboard!","success")}}async discoverUsers(e=10,o=!0){try{const{db:n}=await h(async()=>{const{db:m}=await import("./firebase-core-BO8UvLyb.js");return{db:m}},[],import.meta.url),{collection:s,query:a,where:r,orderBy:l,limit:u,getDocs:d}=await h(async()=>{const{collection:m,query:f,where:b,orderBy:v,limit:w,getDocs:E}=await import("https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js");return{collection:m,query:f,where:b,orderBy:v,limit:w,getDocs:E}},[],import.meta.url);let g=a(s(n,"users"),l("createdAt","desc"),u(e));o&&this.currentUser&&(g=a(s(n,"users"),r("uid","!=",this.currentUser.uid),l("createdAt","desc"),u(e)));const p=await d(g),c=[];return p.forEach(m=>{const f=m.data();c.push({id:m.id,...f,isFollowing:this.following.has(m.id)})}),this.log("Users discovered",{count:c.length}),{success:!0,users:c}}catch(n){return this.error("Failed to discover users",n),{success:!1,error:n.message}}}async getUserFeed(e=20){try{if(!this.currentUser)throw new Error("User must be logged in to view feed");const{db:o}=await h(async()=>{const{db:p}=await import("./firebase-core-BO8UvLyb.js");return{db:p}},[],import.meta.url),{collection:n,query:s,where:a,orderBy:r,limit:l,getDocs:u}=await h(async()=>{const{collection:p,query:c,where:m,orderBy:f,limit:b,getDocs:v}=await import("https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js");return{collection:p,query:c,where:m,orderBy:f,limit:b,getDocs:v}},[],import.meta.url),d=Array.from(this.following),g=[];if(d.length>0){const p=s(n(o,"widgets"),a("userId","in",d),a("isPublic","==",!0),r("createdAt","desc"),l(e));(await u(p)).forEach(m=>{const f=m.data();g.push({type:"widget",id:m.id,data:f,timestamp:f.createdAt})})}return g.sort((p,c)=>c.timestamp?.toDate()-p.timestamp?.toDate()),this.log("User feed loaded",{count:g.length}),{success:!0,feed:g}}catch(o){return this.error("Failed to load user feed",o),{success:!1,error:o.message}}}async createFollowNotification(e,o){try{const{db:n}=await h(async()=>{const{db:c}=await import("./firebase-core-BO8UvLyb.js");return{db:c}},[],import.meta.url),{collection:s,addDoc:a,serverTimestamp:r}=await h(async()=>{const{collection:c,addDoc:m,serverTimestamp:f}=await import("https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js");return{collection:c,addDoc:m,serverTimestamp:f}},[],import.meta.url),{doc:l,getDoc:u}=await h(async()=>{const{doc:c,getDoc:m}=await import("https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js");return{doc:c,getDoc:m}},[],import.meta.url),d=await u(l(n,"users",o)),g=d.exists()?d.data().displayName:"Someone",p={userId:e,type:"follow",title:"New follower! 👥",message:`${g} started following you.`,icon:"👥",data:{followerId:o,action:"view_profile"},read:!1,timestamp:r()};await a(s(n,"notifications"),p),this.log("Follow notification created",{targetUserId:e,followerId:o})}catch(n){this.error("Failed to create follow notification",n)}}async createLikeNotification(e,o,n,s){try{const{db:a}=await h(async()=>{const{db:f}=await import("./firebase-core-BO8UvLyb.js");return{db:f}},[],import.meta.url),{collection:r,addDoc:l,serverTimestamp:u}=await h(async()=>{const{collection:f,addDoc:b,serverTimestamp:v}=await import("https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js");return{collection:f,addDoc:b,serverTimestamp:v}},[],import.meta.url),{doc:d,getDoc:g}=await h(async()=>{const{doc:f,getDoc:b}=await import("https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js");return{doc:f,getDoc:b}},[],import.meta.url),p=await g(d(a,"users",o)),c=p.exists()?p.data().displayName:"Someone",m={userId:e,type:"like",title:"New like! ❤️",message:`${c} liked your widget "${s}".`,icon:"❤️",data:{widgetId:n,likerId:o,action:"view_widget"},read:!1,timestamp:u()};await l(r(a,"notifications"),m),this.log("Like notification created",{widgetOwnerId:e,likerId:o,widgetId:n})}catch(a){this.error("Failed to create like notification",a)}}async createShareNotification(e,o,n,s,a){try{const{db:r}=await h(async()=>{const{db:w}=await import("./firebase-core-BO8UvLyb.js");return{db:w}},[],import.meta.url),{collection:l,addDoc:u,serverTimestamp:d}=await h(async()=>{const{collection:w,addDoc:E,serverTimestamp:k}=await import("https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js");return{collection:w,addDoc:E,serverTimestamp:k}},[],import.meta.url),{doc:g,getDoc:p}=await h(async()=>{const{doc:w,getDoc:E}=await import("https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js");return{doc:w,getDoc:E}},[],import.meta.url),c=await p(g(r,"users",o)),m=c.exists()?c.data().displayName:"Someone",b={twitter:"Twitter",facebook:"Facebook",linkedin:"LinkedIn",copy:"copied",native:"shared"}[a]||"shared",v={userId:e,type:"share",title:"Widget shared! 📤",message:`${m} ${b} your widget "${s}".`,icon:"📤",data:{widgetId:n,sharerId:o,platform:a,action:"view_widget"},read:!1,timestamp:d()};await u(l(r,"notifications"),v),this.log("Share notification created",{widgetOwnerId:e,sharerId:o,widgetId:n,platform:a})}catch(r){this.error("Failed to create share notification",r)}}setupEventListeners(){document.addEventListener("click",async e=>{if(e.target.matches(".follow-btn")){e.preventDefault();const o=e.target.dataset.userId,n=e.target.dataset.following==="true";n?await this.unfollowUser(o):await this.followUser(o),this.updateFollowButton(e.target,!n)}}),document.addEventListener("click",async e=>{if(e.target.matches(".like-btn")){e.preventDefault();const o=e.target.dataset.widgetId,n=e.target.dataset.liked==="true";n?await this.unlikeWidget(o):await this.likeWidget(o),this.updateLikeButton(e.target,!n)}}),document.addEventListener("click",async e=>{if(e.target.matches(".share-btn")){e.preventDefault();const o=e.target.dataset.widgetId,n=e.target.dataset.platform||"native";await this.shareWidget(o,n)}})}updateFollowButton(e,o){e.dataset.following=o.toString(),e.textContent=o?"Following":"Follow",e.className=o?"follow-btn following":"follow-btn"}updateLikeButton(e,o){e.dataset.liked=o.toString(),e.innerHTML=o?"❤️ Liked":"🤍 Like",e.className=o?"like-btn liked":"like-btn"}showToast(e,o="info"){const n=document.createElement("div");n.className=`toast ${o}`,n.innerHTML=`
      <span class="toast-message">${e}</span>
      <button class="toast-close">&times;</button>
    `,(document.getElementById("toast-container")||document.body).appendChild(n),setTimeout(()=>{n.parentNode&&n.remove()},5e3),n.querySelector(".toast-close").addEventListener("click",()=>{n.remove()})}}const ae=new se;window.socialFeatures=ae;document.addEventListener("DOMContentLoaded",()=>{ae.init()});const Je=Object.freeze(Object.defineProperty({__proto__:null,SocialFeaturesManager:se},Symbol.toStringTag,{value:"Module"}));console.log("[WORKFLOW MANAGER] Initializing workflow manager...");let _=[],re=[],le=[],de=[];function Xe(){console.log("[WORKFLOW MANAGER] Initializing workflow manager components..."),Ze(),et(),tt(),it(),at(),dt(),console.log("[WORKFLOW MANAGER] Workflow manager initialized successfully")}function Ze(){const t=document.querySelectorAll(".tab-button"),e=document.querySelectorAll(".tab-content");t.forEach(o=>{o.addEventListener("click",()=>{const n=o.getAttribute("data-tab");t.forEach(s=>s.classList.remove("active")),e.forEach(s=>s.classList.remove("active")),o.classList.add("active"),document.getElementById(`${n}-tab`).classList.add("active"),console.log(`[WORKFLOW MANAGER] Switched to tab: ${n}`)})})}function et(){const t=document.getElementById("createWorkflowBtn");t&&t.addEventListener("click",ht);const e=document.getElementById("scheduleWorkflowBtn");e&&e.addEventListener("click",vt);const o=document.getElementById("createWorkflowForm");o&&o.addEventListener("submit",bt);const n=document.getElementById("addStepBtn");n&&n.addEventListener("click",wt);const s=document.getElementById("cancelCreateWorkflow");s&&s.addEventListener("click",ue),document.querySelectorAll(".close-button").forEach(r=>{r.addEventListener("click",l=>{const u=l.target.closest(".modal");u&&(u.style.display="none")})})}async function tt(){console.log("[WORKFLOW MANAGER] Loading workflows...");try{const t=[{id:"full-code-review",name:"Full Code Review",description:"Comprehensive code analysis, security scan, auto-fix, and documentation",stepCount:5,status:"available"},{id:"security-check",name:"Security Check",description:"Quick security vulnerability scan",stepCount:2,status:"available"},{id:"documentation-only",name:"Documentation Generation",description:"Generate comprehensive documentation for code",stepCount:2,status:"available"}];_=t,ce(),console.log(`[WORKFLOW MANAGER] Loaded ${t.length} workflows`)}catch(t){console.error("[WORKFLOW MANAGER] Error loading workflows:",t)}}function ce(){const t=document.getElementById("workflowList");t&&(t.innerHTML="",_.forEach(e=>{const o=ot(e);t.appendChild(o)}))}function ot(t){const e=document.createElement("div");return e.className="workflow-card",e.innerHTML=`
    <div class="workflow-card-header">
      <h4 class="workflow-name">${t.name}</h4>
      <div class="workflow-status status-${t.status}">${t.status}</div>
    </div>
    <div class="workflow-card-body">
      <p class="workflow-description">${t.description}</p>
      <div class="workflow-meta">
        <span class="step-count">${t.stepCount} steps</span>
        <span class="workflow-id">ID: ${t.id}</span>
      </div>
    </div>
    <div class="workflow-card-actions">
      <button class="btn btn-primary btn-sm" onclick="executeWorkflow('${t.id}')">
        <span class="btn-icon">▶️</span>
        Execute
      </button>
      <button class="btn btn-secondary btn-sm" onclick="scheduleWorkflow('${t.id}')">
        <span class="btn-icon">⏰</span>
        Schedule
      </button>
      <button class="btn btn-outline btn-sm" onclick="viewWorkflowDetails('${t.id}')">
        <span class="btn-icon">👁️</span>
        Details
      </button>
    </div>
  `,e}async function it(){console.log("[WORKFLOW MANAGER] Loading templates...");const t=[{id:"code-quality",name:"Code Quality Check",description:"Comprehensive code quality analysis and improvement",stepCount:3,category:"Quality"},{id:"security-audit",name:"Security Audit",description:"Comprehensive security vulnerability assessment",stepCount:3,category:"Security"},{id:"documentation",name:"Documentation Generation",description:"Generate comprehensive project documentation",stepCount:2,category:"Documentation"},{id:"pre-deployment",name:"Pre-deployment Checklist",description:"Comprehensive checks before deployment",stepCount:4,category:"Deployment"}];re=t,nt(),console.log(`[WORKFLOW MANAGER] Loaded ${t.length} templates`)}function nt(){const t=document.getElementById("templateGrid");t&&(t.innerHTML="",re.forEach(e=>{const o=st(e);t.appendChild(o)}))}function st(t){const e=document.createElement("div");return e.className="template-card",e.innerHTML=`
    <div class="template-card-header">
      <h4 class="template-name">${t.name}</h4>
      <span class="template-category">${t.category}</span>
    </div>
    <div class="template-card-body">
      <p class="template-description">${t.description}</p>
      <div class="template-meta">
        <span class="step-count">${t.stepCount} steps</span>
      </div>
    </div>
    <div class="template-card-actions">
      <button class="btn btn-primary btn-sm" onclick="useTemplate('${t.id}')">
        <span class="btn-icon">📋</span>
        Use Template
      </button>
      <button class="btn btn-outline btn-sm" onclick="previewTemplate('${t.id}')">
        <span class="btn-icon">👁️</span>
        Preview
      </button>
    </div>
  `,e}async function at(){console.log("[WORKFLOW MANAGER] Loading scheduled workflows...");const t=[{id:"scheduled-1",workflowId:"security-check",workflowName:"Security Check",target:"main.js",schedule:"Daily at 9:00 AM",nextRun:"2024-01-15 09:00:00",status:"scheduled"},{id:"scheduled-2",workflowId:"full-code-review",workflowName:"Full Code Review",target:"pages/",schedule:"Weekly on Monday",nextRun:"2024-01-22 10:00:00",status:"scheduled"}];le=t,rt(),console.log(`[WORKFLOW MANAGER] Loaded ${t.length} scheduled workflows`)}function rt(){const t=document.getElementById("scheduledList");t&&(t.innerHTML="",le.forEach(e=>{const o=lt(e);t.appendChild(o)}))}function lt(t){const e=document.createElement("div");return e.className="scheduled-card",e.innerHTML=`
    <div class="scheduled-card-header">
      <h4 class="scheduled-workflow-name">${t.workflowName}</h4>
      <div class="scheduled-status status-${t.status}">${t.status}</div>
    </div>
    <div class="scheduled-card-body">
      <div class="scheduled-details">
        <div class="detail-item">
          <span class="detail-label">Target:</span>
          <span class="detail-value">${t.target}</span>
        </div>
        <div class="detail-item">
          <span class="detail-label">Schedule:</span>
          <span class="detail-value">${t.schedule}</span>
        </div>
        <div class="detail-item">
          <span class="detail-label">Next Run:</span>
          <span class="detail-value">${t.nextRun}</span>
        </div>
      </div>
    </div>
    <div class="scheduled-card-actions">
      <button class="btn btn-primary btn-sm" onclick="runScheduledNow('${t.id}')">
        <span class="btn-icon">▶️</span>
        Run Now
      </button>
      <button class="btn btn-secondary btn-sm" onclick="editSchedule('${t.id}')">
        <span class="btn-icon">✏️</span>
        Edit
      </button>
      <button class="btn btn-danger btn-sm" onclick="cancelSchedule('${t.id}')">
        <span class="btn-icon">❌</span>
        Cancel
      </button>
    </div>
  `,e}async function dt(){console.log("[WORKFLOW MANAGER] Loading workflow history...");const t=[{id:"exec-1",workflowId:"security-check",workflowName:"Security Check",target:"chatbot.js",status:"completed",startTime:"2024-01-14 14:30:00",endTime:"2024-01-14 14:32:15",duration:"2m 15s"},{id:"exec-2",workflowId:"full-code-review",workflowName:"Full Code Review",target:"main.js",status:"failed",startTime:"2024-01-14 13:45:00",endTime:"2024-01-14 13:47:30",duration:"2m 30s"},{id:"exec-3",workflowId:"documentation-only",workflowName:"Documentation Generation",target:"auto-fixer.js",status:"completed",startTime:"2024-01-14 12:15:00",endTime:"2024-01-14 12:18:45",duration:"3m 45s"}];de=t,ct(),console.log(`[WORKFLOW MANAGER] Loaded ${t.length} history entries`)}function ct(){const t=document.getElementById("historyList");t&&(t.innerHTML="",de.forEach(e=>{const o=ut(e);t.appendChild(o)}))}function ut(t){const e=document.createElement("div");return e.className="history-card",e.innerHTML=`
    <div class="history-card-header">
      <h4 class="history-workflow-name">${t.workflowName}</h4>
      <div class="history-status status-${t.status}">${t.status}</div>
    </div>
    <div class="history-card-body">
      <div class="history-details">
        <div class="detail-item">
          <span class="detail-label">Target:</span>
          <span class="detail-value">${t.target}</span>
        </div>
        <div class="detail-item">
          <span class="detail-label">Duration:</span>
          <span class="detail-value">${t.duration}</span>
        </div>
        <div class="detail-item">
          <span class="detail-label">Started:</span>
          <span class="detail-value">${t.startTime}</span>
        </div>
      </div>
    </div>
    <div class="history-card-actions">
      <button class="btn btn-outline btn-sm" onclick="viewExecutionDetails('${t.id}')">
        <span class="btn-icon">👁️</span>
        View Details
      </button>
      <button class="btn btn-secondary btn-sm" onclick="replayExecution('${t.id}')">
        <span class="btn-icon">🔄</span>
        Replay
      </button>
    </div>
  `,e}async function gt(t){console.log(`[WORKFLOW MANAGER] Executing workflow: ${t}`);const e=_.find(o=>o.id===t);if(!e){console.error(`[WORKFLOW MANAGER] Workflow not found: ${t}`);return}mt(e);try{await pt(t),console.log(`[WORKFLOW MANAGER] Workflow ${t} completed successfully`)}catch(o){console.error(`[WORKFLOW MANAGER] Workflow ${t} failed:`,o)}}function mt(t){const e=document.getElementById("workflowExecutionModal");e&&(document.getElementById("executingWorkflowName").textContent=t.name,document.getElementById("executingWorkflowDescription").textContent=t.description,document.getElementById("workflowProgress").style.width="0%",document.getElementById("progressText").textContent="0%",e.style.display="block")}async function pt(t){const e=[{name:"Security Scan",duration:2e3},{name:"Code Analysis",duration:3e3},{name:"Auto Fix",duration:1500},{name:"Documentation",duration:2500},{name:"Report Generation",duration:1e3}],o=e.length;let n=0;for(let s=0;s<e.length;s++){const a=e[s];ee(s,"running",a.name),await new Promise(l=>setTimeout(l,a.duration)),ee(s,"completed",a.name),n++;const r=Math.round(n/o*100);document.getElementById("workflowProgress").style.width=`${r}%`,document.getElementById("progressText").textContent=`${r}%`}ft()}function ee(t,e,o){const n=document.getElementById("workflowSteps");if(!n)return;let s=n.children[t];s||(s=document.createElement("div"),s.className="workflow-step",s.innerHTML=`
      <div class="step-icon"></div>
      <div class="step-content">
        <div class="step-name">${o}</div>
        <div class="step-status">${e}</div>
      </div>
    `,n.appendChild(s)),s.className=`workflow-step status-${e}`,s.querySelector(".step-status").textContent=e;const a=s.querySelector(".step-icon");a.textContent=e==="completed"?"✅":e==="running"?"⏳":"⏸️"}function ft(){const t=document.getElementById("workflowResults"),e=document.getElementById("resultsContent");!t||!e||(e.innerHTML=`
    <div class="result-summary">
      <h5>Execution Summary</h5>
      <div class="summary-stats">
        <div class="stat-item">
          <span class="stat-label">Status:</span>
          <span class="stat-value status-completed">Completed</span>
        </div>
        <div class="stat-item">
          <span class="stat-label">Duration:</span>
          <span class="stat-value">10.5 seconds</span>
        </div>
        <div class="stat-item">
          <span class="stat-label">Steps:</span>
          <span class="stat-value">5 completed</span>
        </div>
      </div>
    </div>
    <div class="result-details">
      <h5>Detailed Results</h5>
      <div class="result-item">
        <strong>Security Scan:</strong> No vulnerabilities found
      </div>
      <div class="result-item">
        <strong>Code Analysis:</strong> 3 issues identified and fixed
      </div>
      <div class="result-item">
        <strong>Auto Fix:</strong> 2 fixes applied successfully
      </div>
      <div class="result-item">
        <strong>Documentation:</strong> Generated comprehensive docs
      </div>
      <div class="result-item">
        <strong>Report:</strong> Summary report created
      </div>
    </div>
  `,t.style.display="block")}function ht(){const t=document.getElementById("createWorkflowModal");t&&(t.style.display="block")}function ue(){const t=document.getElementById("createWorkflowModal");t&&(t.style.display="none")}function wt(){const t=document.getElementById("stepsContainer");if(!t)return;const e=t.children.length,o=document.createElement("div");o.className="workflow-step-form",o.innerHTML=`
    <div class="step-form-header">
      <h5>Step ${e+1}</h5>
      <button type="button" class="btn btn-danger btn-sm" onclick="removeWorkflowStep(this)">
        <span class="btn-icon">❌</span>
        Remove
      </button>
    </div>
    <div class="step-form-body">
      <div class="form-group">
        <label>Agent</label>
        <select name="agent" required>
          <option value="">Select Agent</option>
          <option value="code-analyzer">Code Analyzer</option>
          <option value="security-scanner">Security Scanner</option>
          <option value="auto-fixer">Auto Fixer</option>
          <option value="documentation-generator">Documentation Generator</option>
          <option value="report-generator">Report Generator</option>
        </select>
      </div>
      <div class="form-group">
        <label>Target</label>
        <select name="target" required>
          <option value="">Select Target</option>
          <option value="file">File</option>
          <option value="project">Project</option>
          <option value="workflow">Workflow</option>
        </select>
      </div>
      <div class="form-group">
        <label>Dependencies (optional)</label>
        <input type="text" name="dependsOn" placeholder="Step IDs separated by commas">
      </div>
      <div class="form-group">
        <label>
          <input type="checkbox" name="required" checked>
          Required Step
        </label>
      </div>
    </div>
  `,t.appendChild(o)}function yt(t){const e=t.closest(".workflow-step-form");e&&e.remove()}function bt(t){t.preventDefault(),new FormData(t.target);const e=document.getElementById("workflowName").value,o=document.getElementById("workflowDescription").value,n=[];if(document.querySelectorAll(".workflow-step-form").forEach((r,l)=>{const u={id:`step-${l+1}`,agent:r.querySelector('[name="agent"]').value,target:r.querySelector('[name="target"]').value,dependsOn:r.querySelector('[name="dependsOn"]').value.split(",").map(d=>d.trim()).filter(d=>d),required:r.querySelector('[name="required"]').checked};u.agent&&u.target&&n.push(u)}),n.length===0){alert("Please add at least one step to the workflow");return}const a={id:`custom-${Date.now()}`,name:e,description:o,steps:n,stepCount:n.length,status:"available"};_.push(a),ce(),ue(),console.log(`[WORKFLOW MANAGER] Created custom workflow: ${a.id}`)}function vt(){const t=document.getElementById("scheduleWorkflowModal");t&&(t.style.display="block")}window.executeWorkflow=gt;window.scheduleWorkflow=t=>{console.log(`[WORKFLOW MANAGER] Scheduling workflow: ${t}`)};window.viewWorkflowDetails=t=>{console.log(`[WORKFLOW MANAGER] Viewing workflow details: ${t}`)};window.useTemplate=t=>{console.log(`[WORKFLOW MANAGER] Using template: ${t}`)};window.previewTemplate=t=>{console.log(`[WORKFLOW MANAGER] Previewing template: ${t}`)};window.runScheduledNow=t=>{console.log(`[WORKFLOW MANAGER] Running scheduled workflow now: ${t}`)};window.editSchedule=t=>{console.log(`[WORKFLOW MANAGER] Editing schedule: ${t}`)};window.cancelSchedule=t=>{console.log(`[WORKFLOW MANAGER] Canceling schedule: ${t}`)};window.viewExecutionDetails=t=>{console.log(`[WORKFLOW MANAGER] Viewing execution details: ${t}`)};window.replayExecution=t=>{console.log(`[WORKFLOW MANAGER] Replaying execution: ${t}`)};window.removeWorkflowStep=yt;document.addEventListener("DOMContentLoaded",()=>{console.log("[WORKFLOW MANAGER] DOM loaded, initializing workflow manager..."),Xe()});console.log("[WORKFLOW MANAGER] Workflow manager functionality loaded");
