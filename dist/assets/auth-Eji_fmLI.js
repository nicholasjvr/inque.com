const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./widget-upload-BclOXes8.js","./cloud-upload-B4hV8L3F.js","./firebase-core-BO8UvLyb.js"])))=>i.map(i=>d[i]);
import{_ as J}from"./preload-helper-DBRurSJI.js";import{auth as f,db as d,storage as x}from"./firebase-core-BO8UvLyb.js";import{signOut as O,GoogleAuthProvider as G,GithubAuthProvider as Q,sendPasswordResetEmail as Z,createUserWithEmailAndPassword as V,signInWithEmailAndPassword as Y,onAuthStateChanged as ee,sendEmailVerification as te,signInWithPopup as j}from"https://www.gstatic.com/firebasejs/11.10.0/firebase-auth.js";import{serverTimestamp as m,setDoc as k,doc as u,updateDoc as b,getDoc as P,arrayUnion as $,arrayRemove as H,addDoc as oe,collection as C,query as _,where as T,getDocs as ie,orderBy as se,limit as ae,onSnapshot as ne}from"https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js";import{ref as N,uploadBytes as R,getDownloadURL as re}from"https://www.gstatic.com/firebasejs/11.10.0/firebase-storage.js";import"https://www.gstatic.com/firebasejs/11.10.0/firebase-app.js";import"https://www.gstatic.com/firebasejs/11.10.0/firebase-analytics.js";class le{constructor(){this.currentUser=null,this.userProfile=null,this.isLoading=!1,this.authStateListeners=[],this.debugMode=!0,this.hasShownWelcomeThisSession=!1,this.authListenerSetUp=!1,this.domElements={},this.notificationUnsubscribe=null,document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>{this.initializeDOMElements()}):this.initializeDOMElements()}log(e,t=null){this.debugMode&&console.log(`[SOCIAL AUTH] ${e}`,t||"")}error(e,t=null){console.error(`[SOCIAL AUTH ERROR] ${e}`,t||"")}initializeDOMElements(){this.log("Initializing DOM element references"),this.domElements={authModal:document.getElementById("authModal"),authCloseBtn:document.querySelector(".auth-close-button"),loginForm:document.getElementById("loginForm"),signUpForm:document.getElementById("signUpForm"),showSignUp:document.getElementById("showSignUp"),showLogin:document.getElementById("showLogin"),authModalTitle:document.getElementById("authModalTitle"),googleLoginBtn:document.getElementById("googleLoginBtn"),githubLoginBtn:document.getElementById("githubLoginBtn"),profilePicContainer:document.querySelector(".profile-pic-container"),profileName:document.querySelector(".profile-name"),profileBio:document.querySelector(".profile-bio"),profileLvl:document.getElementById("profileLvl"),profileType:document.getElementById("profileType"),profileRole:document.getElementById("profileRole"),profileStatusIndicator:document.getElementById("profileStatusIndicator"),profileStatus:document.getElementById("profileStatus"),sidebarAvatar:document.querySelector(".sidebar-avatar"),sidebarUserName:document.querySelector(".sidebar-user-name"),sidebarUserEmail:document.querySelector(".sidebar-user-email"),sidebarUserStatus:document.querySelector(".sidebar-user-status"),sidebarStatusDot:document.querySelector(".status-dot"),sidebarLoginBtn:document.getElementById("sidebarLoginBtn"),sidebarUserActions:document.getElementById("sidebarUserActions"),sidebarEditProfileBtn:document.getElementById("sidebarEditProfileBtn"),sidebarLogoutBtn:document.getElementById("sidebarLogoutBtn"),sidebarStats:document.querySelector(".sidebar-stats"),sidebarLvl:document.getElementById("sidebarLvl"),sidebarType:document.getElementById("sidebarType"),sidebarRole:document.getElementById("sidebarRole"),notificationCount:document.getElementById("notificationCount"),notificationList:document.getElementById("notificationList"),markAllReadBtn:document.getElementById("markAllReadBtn")},this.log("DOM elements initialized",Object.keys(this.domElements))}async init(){this.log("Initializing Social Auth Manager"),this.authListenerSetUp?this.log("Auth state listener already set up, skipping"):(ee(f,async e=>{this.currentUser=e,this.log("Auth state changed",{userId:e?.uid}),e?await this.handleUserLogin(e):await this.handleUserLogout(),this.authStateListeners.forEach(t=>t(e)),this.dispatchAuthStateEvent(e)}),this.authListenerSetUp=!0,this.log("Auth state listener set up")),this.setupEventListeners(),this.log("Social Auth Manager initialized"),window.debugAuthState=()=>{console.log("[AUTH DEBUG] Current auth state:",{currentUser:this.currentUser?.uid,userProfile:this.userProfile,isLoading:this.isLoading,hasShownWelcome:this.hasShownWelcomeThisSession,authListenerSetUp:this.authListenerSetUp})}}dispatchAuthStateEvent(e,t=null){const o=e&&!this.hasShownWelcomeThisSession;e&&(this.hasShownWelcomeThisSession=!0);const i=new CustomEvent("auth-state-changed",{detail:{user:e,profile:t||this.userProfile,isNewLogin:o,timestamp:Date.now()}});window.dispatchEvent(i),this.log("Auth state change event dispatched",{userId:e?.uid,isNewLogin:o,hasProfile:!!t})}async registerUser(e){try{this.isLoading=!0,this.log("Starting user registration",{email:e.email});const o=(await V(f,e.email,e.password)).user;await te(o);const i={uid:o.uid,email:e.email,displayName:e.displayName||e.email.split("@")[0],bio:e.bio||"Welcome to inque! ðŸš€",photoURL:e.photoURL||this.getDefaultAvatar(),username:e.username||this.generateUsername(e.email),level:1,experience:0,type:"NEWB",role:"USER",followers:[],following:[],widgets:[],socialLinks:{twitter:e.twitter||"",instagram:e.instagram||"",github:e.github||"",website:e.website||""},preferences:{theme:"auto",notifications:!0,privacy:"public",language:"en"},stats:{widgetsCreated:0,followersCount:0,followingCount:0,totalViews:0,totalLikes:0},createdAt:m(),lastActive:m(),isVerified:!1,isPremium:!1};return await k(u(d,"users",o.uid),i),this.log("User profile created successfully"),await this.createNotification(o.uid,{type:"welcome",title:"Welcome to inque! ðŸŽ‰",message:"Your account has been created successfully. Start by uploading your first widget!",icon:"ðŸŽ‰",data:{action:"upload_widget"}}),await this.createDefaultWidgetSlots(o.uid),this.log("Registration completed successfully"),{success:!0,user:o,profile:i}}catch(t){return this.error("Registration failed",t),{success:!1,error:this.getUserFriendlyError(t)}}finally{this.isLoading=!1}}async loginUser(e){try{this.isLoading=!0,this.log("Starting user login",{email:e.email});const o=(await Y(f,e.email,e.password)).user;return await b(u(d,"users",o.uid),{lastActive:m()}),await this.createNotification(o.uid,{type:"login",title:"Welcome back! ðŸ‘‹",message:"You've successfully logged into your account.",icon:"ðŸ”",data:{action:"dashboard"}}),this.log("Login completed successfully"),{success:!0,user:o}}catch(t){return this.error("Login failed",t),{success:!1,error:this.getUserFriendlyError(t)}}finally{this.isLoading=!1}}async loginWithProvider(e){try{this.isLoading=!0,this.log("Starting social login",{provider:e});let t;switch(e){case"google":t=new G;break;case"github":t=new Q;break;default:throw new Error("Unsupported provider")}const i=(await j(f,t)).user;return(await P(u(d,"users",i.uid))).exists()?await b(u(d,"users",i.uid),{lastActive:m()}):await this.createSocialUserProfile(i,e),this.log("Social login completed successfully"),{success:!0,user:i}}catch(t){return this.error("Social login failed",t),{success:!1,error:this.getUserFriendlyError(t)}}finally{this.isLoading=!1}}async uploadWidget(e){if(this.log("Widget upload requested, delegating to WidgetUploadManager"),!window.widgetUploadManager){const{default:t}=await J(async()=>{const{default:o}=await import("./widget-upload-BclOXes8.js");return{default:o}},__vite__mapDeps([0,1,2]),import.meta.url);window.widgetUploadManager=t}return await window.widgetUploadManager.handleWidgetUpload(e)}async followUser(e){try{if(!this.currentUser)throw new Error("User must be logged in");const t=this.currentUser.uid;return await b(u(d,"users",t),{following:$(e)}),await b(u(d,"users",e),{followers:$(t)}),await this.createNotification(e,{type:"follow",title:"New follower! ðŸ‘¥",message:`${this.userProfile?.displayName||"Someone"} started following you.`,icon:"ðŸ‘¥",data:{followerId:t,action:"view_profile"}}),this.log("User followed successfully"),{success:!0}}catch(t){return this.error("Follow action failed",t),{success:!1,error:this.getUserFriendlyError(t)}}}async unfollowUser(e){try{if(!this.currentUser)throw new Error("User must be logged in");const t=this.currentUser.uid;return await b(u(d,"users",t),{following:H(e)}),await b(u(d,"users",e),{followers:H(t)}),this.log("User unfollowed successfully"),{success:!0}}catch(t){return this.error("Unfollow action failed",t),{success:!1,error:this.getUserFriendlyError(t)}}}generateUsername(e){const t=e.split("@")[0],o=Math.floor(Math.random()*1e3);return`${t}${o}`}generateWidgetId(){return`widget_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}getDefaultAvatar(){const e=["https://i.pinimg.com/originals/3c/69/1d/3c691d9047d7fb33383a8b417c8e9b67.jpg","https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?w=150&h=150&fit=crop&crop=face","https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=150&h=150&fit=crop&crop=face","https://images.unsplash.com/photo-1494790108755-2616b612b786?w=150&h=150&fit=crop&crop=face"];return e[Math.floor(Math.random()*e.length)]}getUserFriendlyError(e){return{"auth/user-not-found":"No account found with this email address.","auth/wrong-password":"Incorrect password. Please try again.","auth/email-already-in-use":"An account with this email already exists.","auth/weak-password":"Password is too weak. Please choose a stronger password.","auth/invalid-email":"Please enter a valid email address.","auth/too-many-requests":"Too many failed attempts. Please try again later.","auth/network-request-failed":"Network error. Please check your connection.","auth/popup-closed-by-user":"Login was cancelled.","auth/cancelled-popup-request":"Login was cancelled.","auth/popup-blocked":"Popup was blocked. Please allow popups for this site."}[e.code]||"An error occurred. Please try again."}async createNotification(e,t){try{const o={userId:e,type:t.type||"system",title:t.title,message:t.message,read:!1,timestamp:m(),data:t.data||{},icon:t.icon||"ðŸ””"};return await oe(C(d,"notifications"),o),this.log("Notification created",o),o}catch(o){throw this.error("Error creating notification",o),o}}async createDefaultWidgetSlots(e){try{const t=new Blob([`<html>
        <head><title>Widget Placeholder</title></head>
        <body style='display:flex;align-items:center;justify-content:center;height:100vh;background:#222;color:#fff;font-family:Arial,sans-serif;'>
          <div style='text-align:center;'>
            <h2>Widget Placeholder</h2>
            <p>This is a placeholder widget.</p>
            <p>Upload your files to replace this!</p>
            <img src='https://media.giphy.com/media/3oEjI6SIIHBdRxXI40/giphy.gif' alt='Placeholder' style='max-width:200px;border-radius:10px;'/>
          </div>
        </body>
      </html>`],{type:"text/html"});for(let o=1;o<=3;o++){const i=N(x,`users/${e}/app-widget-${o}/index.html`);await R(i,t),this.log(`Created widget slot ${o}`)}}catch(t){this.error("Error creating widget slots",t)}}async uploadWidgetFiles(e,t,o){const i=[];for(const s of e){const g=N(x,`users/${t}/widgets/${o}/${s.name}`);await R(g,s);const p=await re(g);i.push(p)}return i}async createSocialUserProfile(e,t){const o={uid:e.uid,email:e.email,displayName:e.displayName||e.email.split("@")[0],bio:"Welcome to inque! ðŸš€",photoURL:e.photoURL||this.getDefaultAvatar(),username:this.generateUsername(e.email),level:1,experience:0,type:"NEWB",role:"USER",followers:[],following:[],widgets:[],socialLinks:{},preferences:{theme:"auto",notifications:!0,privacy:"public",language:"en"},stats:{widgetsCreated:0,followersCount:0,followingCount:0,totalViews:0,totalLikes:0},dashboardSettings:{layout:"grid",theme:"neo-brutalist",customColors:{primary:"#00ffff",secondary:"#ff00ff",accent:"#ffff00",background:"#0a0a0a",text:"#ffffff"},widgetDefaults:{borderColor:"#00ffff",borderWidth:"3px",borderRadius:"0px",width:"100%",height:"300px",shadow:"0 0 20px rgba(0, 255, 255, 0.3)"},spacing:{widgetGap:"24px",sectionPadding:"40px",cardPadding:"24px"},animations:{enabled:!0,duration:"0.3s",easing:"ease-out"}},createdAt:m(),lastActive:m(),isVerified:!1,isPremium:!1,loginProvider:t};await k(u(d,"users",e.uid),o),await this.createDefaultWidgetSlots(e.uid)}async updateDashboardSettings(e,t){try{this.log("Updating dashboard settings",{userId:e,settings:t});const o=u(d,"users",e);return await b(o,{dashboardSettings:t,updatedAt:m()}),this.log("Dashboard settings updated successfully"),{success:!0}}catch(o){return this.error("Failed to update dashboard settings",o),{success:!1,error:o.message}}}async getDashboardSettings(e){try{this.log("Getting dashboard settings",{userId:e});const t=await P(u(d,"users",e));if(t.exists()){const i=t.data().dashboardSettings||this.getDefaultDashboardSettings();return this.log("Dashboard settings retrieved",i),{success:!0,settings:i}}else throw new Error("User profile not found")}catch(t){return this.error("Failed to get dashboard settings",t),{success:!1,error:t.message}}}getDefaultDashboardSettings(){return{layout:"grid",theme:"neo-brutalist",customColors:{primary:"#00ffff",secondary:"#ff00ff",accent:"#ffff00",background:"#0a0a0a",text:"#ffffff"},widgetDefaults:{borderColor:"#00ffff",borderWidth:"3px",borderRadius:"0px",width:"100%",height:"300px",shadow:"0 0 20px rgba(0, 255, 255, 0.3)"},spacing:{widgetGap:"24px",sectionPadding:"40px",cardPadding:"24px"},animations:{enabled:!0,duration:"0.3s",easing:"ease-out"}}}setupEventListeners(){}onAuthStateChanged(e){this.authStateListeners.push(e)}async handleUserLogin(e){this.log("Handling user login",{uid:e.uid});try{const t=await P(u(d,"users",e.uid));if(t.exists())this.userProfile=t.data(),this.log("User profile loaded",this.userProfile),this.updateUIForLoggedInUser(),this.setupNotificationListener(e.uid),this.dispatchAuthStateEvent(e,this.userProfile);else{this.log("User profile not found, creating default profile");const o={uid:e.uid,email:e.email,displayName:e.displayName||e.email?.split("@")[0],name:e.displayName||e.email?.split("@")[0],bio:"Welcome to inque! ðŸš€",photoURL:e.photoURL||this.getDefaultAvatar(),username:this.generateUsername(e.email),level:1,experience:0,type:"NEWB",role:"USER",followers:[],following:[],widgets:[],socialLinks:{},preferences:{theme:"auto",notifications:!0,privacy:"public",language:"en"},stats:{widgetsCreated:0,followersCount:0,followingCount:0,totalViews:0,totalLikes:0},createdAt:m(),lastActive:m(),isVerified:!1,isPremium:!1};await k(u(d,"users",e.uid),o),this.userProfile=o,this.updateUIForLoggedInUser(),this.setupNotificationListener(e.uid),this.dispatchAuthStateEvent(e,this.userProfile)}}catch(t){this.error("Error handling user login",t)}}async handleUserLogout(){this.log("Handling user logout"),this.userProfile=null,this.updateUIForLoggedOutUser(),this.notificationUnsubscribe&&this.notificationUnsubscribe()}updateUIForLoggedInUser(){this.log("Updating UI for logged in user"),this.dispatchAuthStateEvent(this.currentUser)}updateUIForLoggedOutUser(){this.log("Updating UI for logged out user"),this.dispatchAuthStateEvent(null)}updateProfileBanner(e,t=!1){this.log("Profile banner update delegated to ProfileHub")}updateSidebarUserInfo(e,t=!1,o=null){this.log("Sidebar user info update delegated to ProfileHub")}async markNotificationAsRead(e){try{const t=u(d,"notifications",e);await b(t,{read:!0}),this.log("Notification marked as read",{notificationId:e})}catch(t){this.error("Error marking notification as read",t)}}async markAllNotificationsAsRead(e){try{const t=_(C(d,"notifications"),T("userId","==",e),T("read","==",!1)),i=(await ie(t)).docs.map(s=>b(s.ref,{read:!0}));await Promise.all(i),this.log("All notifications marked as read")}catch(t){this.error("Error marking all notifications as read",t)}}setupNotificationListener(e){this.log("Setting up notification listener",{userId:e}),this.notificationUnsubscribe&&this.notificationUnsubscribe();const{notificationCount:t,notificationList:o,markAllReadBtn:i}=this.domElements,s=_(C(d,"notifications"),T("userId","==",e),se("timestamp","desc"),ae(20));this.notificationUnsubscribe=ne(s,g=>{o&&(o.innerHTML="");let p=0,v=!1;if(g.forEach(y=>{const S={id:y.id,...y.data()};v=!0,S.read||p++;const U=this.createNotificationElement(S);o&&o.appendChild(U)}),t&&(t.textContent=p,t.style.display=p>0?"inline-block":"none"),i&&(i.style.display=p>0?"inline-block":"none"),!v&&o){const y=document.createElement("div");y.className="notification-item empty-notification",y.innerHTML='<span class="notification-text">No new notifications</span>',o.appendChild(y)}},g=>{this.error("Error listening to notifications",g)})}createNotificationElement(e){const t=document.createElement("div");t.className=`notification-item ${e.type} ${e.read?"read":"unread"}`,t.dataset.notificationId=e.id;const o=e.timestamp?new Date(e.timestamp.toDate()).toLocaleString():"Just now";return t.innerHTML=`
      <div class="notification-content">
        <div class="notification-header">
          <span class="notification-icon">${e.icon}</span>
          <span class="notification-title">${e.title}</span>
          ${e.read?"":'<span class="unread-indicator"></span>'}
        </div>
        <div class="notification-message">${e.message}</div>
        <div class="notification-time">${o}</div>
      </div>
      <button class="notification-close" aria-label="Dismiss notification">&times;</button>
    `,t.addEventListener("click",s=>{s.target.classList.contains("notification-close")||(this.markNotificationAsRead(e.id),this.handleNotificationAction(e))}),t.querySelector(".notification-close").addEventListener("click",s=>{s.stopPropagation(),t.remove()}),t}handleNotificationAction(e){switch(this.log("Handling notification action",{type:e.type}),e.type){case"mention":e.data.postId&&this.log("Navigate to post:",e.data.postId);break;case"like":e.data.postId&&this.log("Navigate to liked post:",e.data.postId);break;case"follow":e.data.followerId&&this.log("Navigate to follower profile:",e.data.followerId);break;case"widget":e.data.widgetId&&this.log("Open widget:",e.data.widgetId);break;default:this.log("Notification clicked:",e)}}showToast(e,t="info",o=5e3){this.log("Showing toast",{message:e,type:t,duration:o});const i=document.getElementById("toast-container");if(!i){this.log("Toast container not found");return}const s=document.createElement("div");s.className=`toast ${t}`,s.innerHTML=`
      <span class="toast-message">${e}</span>
      <button class="toast-close">&times;</button>
    `,i.appendChild(s),setTimeout(()=>s.classList.add("show"),100);const g=setTimeout(()=>{s.classList.remove("show"),setTimeout(()=>{s.parentNode&&s.parentNode.removeChild(s)},300)},o);s.querySelector(".toast-close").addEventListener("click",()=>{clearTimeout(g),s.classList.remove("show"),setTimeout(()=>{s.parentNode&&s.parentNode.removeChild(s)},300)})}}const r=new le;window.socialAuth=r;document.addEventListener("DOMContentLoaded",()=>{r.init();const E=document.getElementById("authModal"),e=document.querySelector(".auth-close-button"),t=document.getElementById("loginForm"),o=document.getElementById("signUpForm"),i=document.getElementById("showSignUp"),s=document.getElementById("showLogin"),g=document.getElementById("authModalTitle"),p=document.getElementById("googleLoginBtn"),v=document.getElementById("githubLoginBtn");document.querySelector(".profile-pic-container"),document.querySelector(".profile-name"),document.querySelector(".profile-bio"),document.getElementById("profileLvl"),document.getElementById("profileType"),document.getElementById("profileRole"),document.getElementById("profileStatusIndicator"),document.getElementById("profileStatus");const y=document.getElementById("editProfileQuickBtn");document.getElementById("editProfileModal"),document.getElementById("editProfileForm"),document.getElementById("editPhoto"),document.querySelector(".edit-profile-close-button"),y&&y.addEventListener("click",()=>{console.log("[PROFILE EDIT] Edit profile quick button clicked"),window.openEditProfile?window.openEditProfile():r.showToast("Edit Profile not available","error")}),document.querySelector(".sidebar-avatar"),document.querySelector(".sidebar-user-name"),document.querySelector(".sidebar-user-email"),document.querySelector(".sidebar-user-status"),document.querySelector(".status-dot");const S=document.getElementById("sidebarLoginBtn");document.getElementById("sidebarUserActions");const U=document.getElementById("sidebarEditProfileBtn"),I=document.getElementById("sidebarLogoutBtn");document.querySelector(".sidebar-stats"),document.getElementById("sidebarLvl"),document.getElementById("sidebarType"),document.getElementById("sidebarRole"),document.getElementById("notificationCount"),document.getElementById("notificationList");const q=document.getElementById("markAllReadBtn"),z={name:"Welcome to inque!",bio:"This is a space to create, share, and display your interactive projects. Sign up to start building your personal widget dashboard.",lvl:"LVL â€¢ ?",type:"TYPE â€¢ ?",role:"ROLE â€¢ GUEST",photoURL:"https://i.pinimg.com/originals/3c/69/1d/3c691d9047d7fb33383a8b417c8e9b67.jpg"};i&&i.addEventListener("click",a=>{a.preventDefault(),console.log("Switching to sign up form"),t.style.display="none",o.style.display="block",w.style.display="none",g.textContent="Sign Up"}),s&&s.addEventListener("click",a=>{a.preventDefault(),console.log("Switching to login form"),o.style.display="none",t.style.display="block",w.style.display="none",g.textContent="Login"});const M=document.getElementById("showLoginFromForgot");M&&M.addEventListener("click",a=>{a.preventDefault(),console.log("Switching from forgot password to login form"),w.style.display="none",t.style.display="block",g.textContent="Login"}),S&&S.addEventListener("click",()=>{console.log("[SIDEBAR LOGIN] Login button clicked"),window.openAuthModal?window.openAuthModal("login"):(E.style.display="block",document.body.style.overflow="hidden")}),U&&U.addEventListener("click",()=>{console.log("[SIDEBAR EDIT PROFILE] Edit profile button clicked"),window.openEditProfile?window.openEditProfile():r.showToast("Edit Profile not available","error")}),e&&e.addEventListener("click",()=>{console.log("Closing auth modal"),E.style.display="none",document.body.style.overflow=""}),window.addEventListener("click",a=>{a.target===E&&(console.log("Closing auth modal via outside click"),E.style.display="none",document.body.style.overflow="")}),document.addEventListener("keydown",a=>{a.key==="Escape"&&E.style.display==="block"&&(console.log("Closing auth modal via escape key"),E.style.display="none",document.body.style.overflow="")}),I&&I.addEventListener("click",()=>{O(f).then(()=>{console.log("User signed out.")}).catch(a=>{console.error("Sign out error:",a)})});const D=async a=>{try{const c=await j(f,a);console.log("Logged in with provider:",c.user)}catch(c){alert(c.message),console.error("Provider login error:",c)}};p&&p.addEventListener("click",()=>{D(new G)}),v&&v.addEventListener("click",()=>{D(new Q)});const w=document.getElementById("forgotPasswordForm");w&&w.addEventListener("submit",async a=>{a.preventDefault();const c=document.getElementById("forgotPasswordEmail").value;try{const n=w.querySelector(".auth-submit-btn"),l=n.textContent;n.textContent="Sending...",n.disabled=!0,await Z(f,c),r.showToast("Password reset email sent! Check your inbox.","success"),w.style.display="none",t.style.display="block",g.textContent="Login"}catch(n){console.error("Password reset error:",n);let l="Failed to send reset email. Please try again.";n.code==="auth/user-not-found"&&(l="No account found with this email address."),r.showToast(l,"error")}finally{const n=w.querySelector(".auth-submit-btn");n.textContent=originalText,n.disabled=!1}}),o&&o.addEventListener("submit",async a=>{a.preventDefault();const c=document.getElementById("signUpEmail").value,n=document.getElementById("signUpPassword").value;try{const l=o.querySelector(".auth-submit-btn"),h=l.textContent;l.textContent="Creating Account...",l.disabled=!0,typeof grecaptcha<"u"&&grecaptcha.enterprise?grecaptcha.enterprise.ready(async()=>{const L=await grecaptcha.enterprise.execute("6Ldt0YYrAAAAAKyNgAPO8Te96_m5innDHsSkppQc",{action:"SIGNUP"});console.log("reCAPTCHA token (Sign Up):",L)}):console.log("reCAPTCHA not available, proceeding without verification (development mode)");const B=(await V(f,c,n)).user;console.log("User created:",B.uid);const K={name:c.split("@")[0],bio:"A new user ready to create amazing things.",lvl:"LVL â€¢ 1",type:"TYPE â€¢ NEWB",role:"ROLE â€¢ USER",photoURL:z.photoURL,email:c,createdAt:m(),lastLogin:m()};console.log("Creating user profile in Firestore..."),await k(u(d,"users",B.uid),K),console.log("User profile created in Firestore");try{console.log("Creating widget slots in Storage...");const L=new Blob([`<html>
              <head><title>Widget Placeholder</title></head>
              <body style='display:flex;align-items:center;justify-content:center;height:100vh;background:#222;color:#fff;font-family:Arial,sans-serif;'>
                <div style='text-align:center;'>
                  <h2>Widget Placeholder</h2>
                  <p>This is a placeholder widget.</p>
                  <p>Upload your files to replace this!</p>
                  <img src='https://media.giphy.com/media/3oEjI6SIIHBdRxXI40/giphy.gif' alt='Placeholder' style='max-width:200px;border-radius:10px;'/>
                </div>
              </body>
            </html>`],{type:"text/html"});for(let A=1;A<=3;A++){const X=N(x,`users/${B.uid}/app-widget-${A}/index.html`);await R(X,L),console.log(`Created widget slot ${A}`)}console.log("All widget slots created successfully")}catch(L){console.warn("Storage setup failed (this is okay for now):",L)}try{await r.createNotification(B.uid,{type:"system",title:"Welcome to inque! ðŸŽ‰",message:"Your account has been created successfully. Start by uploading your first widget!",icon:"ðŸŽ‰"})}catch(L){console.warn("Failed to create welcome notification:",L)}console.log("Signup completed successfully!");const F=document.getElementById("authModal");F&&(F.style.display="none",document.body.style.overflow=""),r.showToast("Account created successfully! Welcome to inque! ðŸŽ‰","success",5e3)}catch(l){console.error("Signup error:",l);let h="Signup failed. Please try again.";l.code==="auth/email-already-in-use"?h="This email is already registered. Please try logging in instead.":l.code==="auth/weak-password"?h="Password is too weak. Please choose a stronger password.":l.code==="auth/invalid-email"&&(h="Please enter a valid email address."),r.showToast(h,"error",5e3)}finally{const l=o.querySelector(".auth-submit-btn");l.textContent="Create Account",l.disabled=!1}}),t&&t.addEventListener("submit",a=>{a.preventDefault(),typeof grecaptcha<"u"&&grecaptcha.enterprise?grecaptcha.enterprise.ready(async()=>{const n=await grecaptcha.enterprise.execute("6Ldt0YYrAAAAAKyNgAPO8Te96_m5innDHsSkppQc",{action:"LOGIN"});console.log("reCAPTCHA token (Login):",n),c()}):(console.log("reCAPTCHA not available, proceeding without verification (development mode)"),c());function c(){const n=document.getElementById("loginEmail").value,l=document.getElementById("loginPassword").value;Y(f,n,l).then(h=>{console.log("Logged in:",h.user)}).catch(h=>{alert(h.message),console.error("Login error:",h)})}}),I&&I.addEventListener("click",()=>{O(f).then(()=>{console.log("User signed out.")}).catch(a=>{console.error("Sign out error:",a)})}),q&&q.addEventListener("click",()=>{f.currentUser?(r.markAllNotificationsAsRead(f.currentUser.uid),r.showToast("All notifications marked as read!","success")):r.showToast("Please log in to mark all notifications as read.","info")});const W=document.getElementById("forgotPasswordLink");W&&W.addEventListener("click",a=>{a.preventDefault(),console.log("Forgot password link clicked"),t.style.display="none",o.style.display="none",w.style.display="block",g.textContent="Reset Password"}),document.querySelectorAll(".quick-action-btn").forEach(a=>{a.addEventListener("click",()=>{const c=a.getAttribute("data-action");console.log("Quick action clicked:",c);const n=()=>{if(window.sidebarHandler)window.sidebarHandler.closeSidebar();else{const l=document.querySelector(".sidebar-nav"),h=document.querySelector(".sidebar-overlay");l&&h&&(l.classList.remove("open"),h.classList.remove("show"),document.body.style.overflow="")}};switch(c){case"newWidget":r.showToast("Opening Widget Studio...","info"),n(),window.openWidgetStudio?(window.openWidgetStudio(),console.log("[QUICK ACTION] Widget Studio modal opened successfully")):r.showToast("Widget Studio not available","error");break;case"shareProfile":n(),navigator.share?navigator.share({title:"Check out my profile!",url:window.location.href}):(navigator.clipboard.writeText(window.location.href),r.showToast("Profile URL copied to clipboard!","success"));break;case"settings":n(),r.showToast("Settings panel opening...","info");break;case"testNotifications":n(),f.currentUser?r.showToast("Test notifications feature coming soon!","info"):r.showToast("Please log in to test notifications.","info");break;case"openChatbot":n(),r.showToast("Opening AI Assistant...","info"),typeof openChatbot=="function"?(openChatbot(),console.log("[QUICK ACTION] AI Assistant opened successfully")):(r.showToast("AI Assistant not available","error"),console.error("[QUICK ACTION] openChatbot function not found"));break;default:r.showToast(`Action "${c}" not implemented yet.`,"warning")}})})});
