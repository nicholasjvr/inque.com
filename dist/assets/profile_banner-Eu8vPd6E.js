console.log("[PROFILE HUB] Initializing modular ProfileHub system...");class l{constructor(){console.log("[PROFILE HUB] Creating ProfileHubManager..."),this.state={user:{isAuthenticated:!1,profile:null,preferences:this.getDefaultPreferences()},ui:{hubState:"minimized",chatbotState:"closed",customizationState:"closed",position:"top-right",theme:"neo-brutalist",scale:1},navigation:{currentPage:this.getCurrentPage(),history:[],bookmarks:[]},chatbot:{messages:[],isTyping:!1,commands:this.getQuickCommands()},notifications:{unreadCount:0,items:[]}},this.listeners=new Map,this.dom={},this.modules={auth:null,chatbot:null,customization:null,navigation:null},this.init()}async init(){console.log("[PROFILE HUB] Initializing ProfileHub system...");try{document.readyState==="loading"&&await new Promise(t=>{document.addEventListener("DOMContentLoaded",t)}),this.initializeDOMReferences(),await this.initializeModules(),this.setupEventListeners(),this.applySavedPreferences(),this.updateUI(),this.setupAuthListener(),console.log("[PROFILE HUB] ProfileHub initialization complete")}catch(t){console.error("[PROFILE HUB] Initialization failed:",t)}}initializeDOMReferences(){console.log("[PROFILE HUB] Initializing DOM references..."),this.dom={hub:document.getElementById("profileHub"),hubCore:document.querySelector(".hub-core"),expandedContent:document.getElementById("hubExpandedContent"),overlay:document.getElementById("profileHubOverlay"),userAvatar:document.getElementById("hubUserAvatar"),userName:document.getElementById("hubUserName"),userStatus:document.getElementById("hubUserStatus"),userLevel:document.getElementById("hubUserLevel"),statusIndicator:document.getElementById("hubStatusIndicator"),chatbotToggle:document.getElementById("hubChatbotToggle"),customizeToggle:document.getElementById("hubCustomizeToggle"),authToggle:document.getElementById("hubAuthToggle"),hubToggle:document.getElementById("hubToggleBtn"),chatbotContainer:document.getElementById("hubChatbotContainer"),chatbotSlider:document.getElementById("chatbotSlider"),chatMessages:document.getElementById("hubChatMessages"),chatInput:document.getElementById("hubChatInput"),sendChatBtn:document.getElementById("hubSendChatBtn"),chatCommands:document.getElementById("hubChatCommands"),customizationPanel:document.getElementById("hubCustomizationPanel"),userStats:document.getElementById("hubUserStats"),notificationBadge:document.getElementById("hubNotificationBadge")};const e=["hub","hubCore","expandedContent"].filter(i=>!this.dom[i]);if(e.length>0)throw new Error(`Missing required DOM elements: ${e.join(", ")}`);console.log("[PROFILE HUB] DOM references initialized successfully - Enhanced sliding modal system ready")}async initializeModules(){console.log("[PROFILE HUB] Initializing modules..."),this.modules.auth=new m(this),this.modules.chatbot=new g(this),this.modules.customization=new p(this),this.modules.navigation=new b(this),console.log("[PROFILE HUB] All modules initialized")}setupEventListeners(){console.log("[PROFILE HUB] Setting up event listeners..."),this.addEventListener(this.dom.hubToggle,"click",()=>{this.toggleHub()}),this.addEventListener(this.dom.chatbotToggle,"click",()=>{this.toggleChatbot()}),this.addEventListener(this.dom.customizeToggle,"click",()=>{console.log("[PROFILE HUB] Gear quicklink clicked ‚Üí navigating to Explore"),window.location.href="pages/explore.html"}),this.addEventListener(this.dom.authToggle,"click",()=>{this.modules.auth.handleAuthToggle()}),this.addEventListener(this.dom.userAvatar,"click",()=>{this.handleUserAvatarClick()}),this.addEventListener(this.dom.overlay,"click",()=>{this.closeAllPanels()}),this.addEventListener(document,"keydown",t=>{this.handleKeyboardShortcuts(t)}),this.setupNavigationListeners(),this.setupQuickActionListeners(),this.addEventListener(window,"resize",()=>{this.handleResize()}),console.log("[PROFILE HUB] Event listeners set up successfully")}setupNavigationListeners(){const t=this.dom.expandedContent?.querySelectorAll(".nav-link");t&&t.forEach(e=>{this.addEventListener(e,"click",i=>{this.handleNavigation(i,e)})})}setupQuickActionListeners(){const t=this.dom.expandedContent?.querySelectorAll(".quick-action-btn");t&&t.forEach(e=>{this.addEventListener(e,"click",()=>{const i=e.dataset.action;this.handleQuickAction(i)})})}handleNavigation(t,e){const i=e.getAttribute("href"),s=i.startsWith("http");console.log(`[PROFILE HUB] Navigation requested: ${i}`),s||(t.preventDefault(),this.state.navigation.history.push({url:i,timestamp:Date.now(),title:e.textContent.trim()}),e.style.transform="scale(0.95)",setTimeout(()=>{e.style.transform=""},150),setTimeout(()=>{window.location.href=i},200)),setTimeout(()=>{this.setState({ui:{hubState:"minimized"}})},100)}handleQuickAction(t){switch(console.log(`[PROFILE HUB] Quick action: ${t}`),t){case"newWidget":this.modules.navigation.openWidgetStudio();break;case"shareProfile":this.modules.navigation.shareProfile();break;case"notifications":this.modules.navigation.openNotifications();break;case"settings":this.toggleCustomization();break;default:console.warn(`[PROFILE HUB] Unknown action: ${t}`)}}handleKeyboardShortcuts(t){(t.ctrlKey||t.metaKey)&&t.shiftKey&&t.key==="H"&&(t.preventDefault(),this.toggleHub()),(t.ctrlKey||t.metaKey)&&t.shiftKey&&t.key==="C"&&(t.preventDefault(),this.toggleChatbot()),t.key==="Escape"&&this.closeAllPanels()}handleResize(){this.adjustHubPosition()}handleUserAvatarClick(){this.state.user.isAuthenticated?this.toggleHub():this.modules.auth.openAuthModal()}toggleHub(){const e=this.state.ui.hubState==="expanded"?"minimized":"expanded";console.log(`[PROFILE HUB] Toggling hub: ${this.state.ui.hubState} -> ${e}`),this.setState({ui:{hubState:e,customizationState:"closed"}})}toggleChatbot(){const t=this.state.ui.hubState==="chatbot-active",e=t?"minimized":"chatbot-active";console.log(`[PROFILE HUB] Toggling chatbot: ${this.state.ui.hubState} -> ${e}`),console.log("[PROFILE HUB] Enhanced chatbot sliding animation triggered - smooth slide from right"),this.setState({ui:{hubState:e,customizationState:"closed"}}),t||this.modules.chatbot.initialize()}toggleCustomization(){const t=this.state.ui.customizationState==="open",e=t?"closed":"open";console.log(`[PROFILE HUB] Toggling customization: ${this.state.ui.customizationState} -> ${e}`),console.log("[PROFILE HUB] Enhanced sliding modal animation triggered - smooth slide from right"),console.log("[PROFILE HUB] Orb remains visible and accessible in top-left corner"),this.setState({ui:{customizationState:e,hubState:t?"minimized":"expanded"}}),this.toggleCustomizationBackdrop(e==="open"),console.log("[PROFILE HUB] Customization panel state updated successfully")}toggleCustomizationBackdrop(t){let e=document.getElementById("hub-customization-panel-backdrop");e||(e=document.createElement("div"),e.id="hub-customization-panel-backdrop",e.className="hub-customization-panel-backdrop",e.addEventListener("click",()=>{this.toggleCustomization()}),document.body.appendChild(e),console.log("[PROFILE HUB] Created customization panel backdrop")),t?(e.classList.add("active"),console.log("[PROFILE HUB] Enhanced backdrop overlay activated with sliding animation")):(e.classList.remove("active"),console.log("[PROFILE HUB] Enhanced backdrop overlay deactivated"))}closeAllPanels(){console.log("[PROFILE HUB] Closing all panels"),this.setState({ui:{hubState:"minimized",customizationState:"closed"}})}updateUI(){if(!this.dom.hub)return;const{ui:t,user:e,notifications:i}=this.state;if(this.dom.hub.setAttribute("data-state",t.hubState),this.dom.hub.setAttribute("data-theme",t.theme),this.dom.hub.setAttribute("data-position",t.position),this.dom.hub.style.setProperty("--hub-scale",t.scale),this.dom.overlay&&this.dom.overlay.classList.toggle("active",t.hubState==="expanded"||t.hubState==="chatbot-active"||t.customizationState==="open"),this.updateUserInfo(),this.updateNotificationBadge(),this.dom.customizationPanel){const s=t.customizationState==="open",a=this.dom.customizationPanel.classList.contains("active");this.dom.customizationPanel.classList.remove("slide-in","slide-out"),s&&!a?(this.dom.customizationPanel.classList.add("active","slide-in"),console.log("[PROFILE HUB] Customization panel sliding in with enhanced animation")):!s&&a?(this.dom.customizationPanel.classList.add("slide-out"),setTimeout(()=>{this.dom.customizationPanel.classList.remove("active","slide-out")},400),console.log("[PROFILE HUB] Customization panel sliding out with enhanced animation")):s&&this.dom.customizationPanel.classList.add("active")}if(this.dom.chatbotContainer){const s=t.hubState==="chatbot-active",a=this.dom.chatbotContainer.classList.contains("active");this.dom.chatbotContainer.classList.remove("slide-in","slide-out"),s&&!a?(this.dom.chatbotContainer.classList.add("active","slide-in"),console.log("[PROFILE HUB] Chatbot container sliding in with enhanced animation")):!s&&a?(this.dom.chatbotContainer.classList.add("slide-out"),setTimeout(()=>{this.dom.chatbotContainer.classList.remove("active","slide-out")},400),console.log("[PROFILE HUB] Chatbot container sliding out with enhanced animation")):s&&this.dom.chatbotContainer.classList.add("active")}console.log("[PROFILE HUB] UI updated with enhanced sliding modal animations")}updateUserInfo(){const{user:t}=this.state;this.dom.userName&&(this.dom.userName.textContent=t.isAuthenticated?t.profile?.displayName||t.profile?.name||"User":"Guest"),this.dom.userStatus&&(this.dom.userStatus.textContent=t.isAuthenticated?"Online ‚Ä¢ Authenticated":"Click to customize"),this.dom.userLevel&&(this.dom.userLevel.textContent=t.isAuthenticated?`LVL ‚Ä¢ ${t.profile?.level||1}`:"LVL ‚Ä¢ ?"),this.dom.statusIndicator&&(this.dom.statusIndicator.className=`avatar-status-indicator ${t.isAuthenticated?"online":"offline"}`),this.dom.authToggle&&(this.dom.authToggle.classList.toggle("logged-in",t.isAuthenticated),this.dom.authToggle.querySelector(".btn-icon").textContent=t.isAuthenticated?"üë§":"üîê"),this.dom.userStats&&(this.dom.userStats.style.display=t.isAuthenticated?"block":"none"),console.log("[PROFILE HUB] User info updated")}updateNotificationBadge(){const{notifications:t}=this.state;this.dom.notificationBadge&&(this.dom.notificationBadge.textContent=t.unreadCount,this.dom.notificationBadge.style.display=t.unreadCount>0?"flex":"none")}updateUserStats(t){console.log("[PROFILE HUB] Updating user stats",t);const e=document.getElementById("hubWidgetCount"),i=document.getElementById("hubFollowerCount"),s=document.getElementById("hubViewCount");e&&(e.textContent=t.widgetsCreated||0),i&&(i.textContent=t.followersCount||0),s&&(s.textContent=t.totalViews||0),console.log("[PROFILE HUB] User stats updated successfully")}setupAuthListener(){window.addEventListener("auth-state-changed",t=>{const{user:e,profile:i}=t.detail;this.handleAuthStateChange(e,i)})}handleAuthStateChange(t,e=null){console.log("[PROFILE HUB] Auth state changed:",t?"logged in":"logged out",e?"with profile data":"without profile data"),this.setState({user:{isAuthenticated:!!t,profile:e||(t?this.extractUserProfile(t):null)}}),e&&e.stats&&this.updateUserStats(e.stats)}extractUserProfile(t){return{uid:t.uid,email:t.email,displayName:t.displayName,photoURL:t.photoURL,name:t.displayName||t.email?.split("@")[0],level:1}}setState(t,e=!0){this.state=this.deepMerge(this.state,t),this.updateUI(),t.ui?.position&&this.handlePositionChange(t.ui.position),e&&t.user?.preferences&&this.savePreferences(),this.emit("state-changed",{state:this.state,changes:t}),console.log("[PROFILE HUB] State updated:",t)}deepMerge(t,e){const i={...t};for(const s in e)e[s]&&typeof e[s]=="object"&&!Array.isArray(e[s])?i[s]=this.deepMerge(i[s]||{},e[s]):i[s]=e[s];return i}addEventListener(t,e,i){if(!t)return;t.addEventListener(e,i);const s=`${e}-${Date.now()}-${Math.random()}`;return this.listeners.set(s,{element:t,event:e,handler:i}),s}removeEventListener(t){const e=this.listeners.get(t);e&&(e.element.removeEventListener(e.event,e.handler),this.listeners.delete(t))}emit(t,e){const i=new CustomEvent(`profilehub-${t}`,{detail:e});window.dispatchEvent(i)}getCurrentPage(){return window.location.pathname.split("/").pop()||"index.html"}getDefaultPreferences(){return{theme:"neo-brutalist",position:"top-right",scale:1,autoMinimize:!0,chatbotEnabled:!0,keyboardShortcuts:!0,animations:!0}}getQuickCommands(){return[{command:"/navigate projects",label:"üîó Projects",action:"navigate",target:"pages/my-projects.html"},{command:"/help customize",label:"‚öôÔ∏è Customize",action:"customize",target:null},{command:"/stats",label:"üìä Stats",action:"stats",target:null},{command:"/help",label:"‚ùì Help",action:"help",target:null}]}savePreferences(){try{localStorage.setItem("profilehub-preferences",JSON.stringify(this.state.user.preferences)),console.log("[PROFILE HUB] Preferences saved")}catch(t){console.warn("[PROFILE HUB] Failed to save preferences:",t)}}applySavedPreferences(){try{const t=localStorage.getItem("profilehub-preferences");if(t){const e=JSON.parse(t);this.setState({user:{preferences:e},ui:{theme:e.theme||"neo-brutalist",position:e.position||"top-right",scale:e.scale||1}},!1),console.log("[PROFILE HUB] Preferences applied")}}catch(t){console.warn("[PROFILE HUB] Failed to load preferences:",t)}}adjustHubPosition(){const t=this.dom.hub.getBoundingClientRect();(t.right>window.innerWidth||t.bottom>window.innerHeight)&&console.log("[PROFILE HUB] Adjusting position for viewport")}handlePositionChange(t){console.log("[PROFILE HUB] Handling position change to:",t),this.updateModalPositions(t),this.emit("position-changed",{position:t,previousPosition:this.state.ui.position}),this.repositionOpenModals(t)}updateModalPosition(t,e){t&&(Object.keys(e).forEach(i=>{t.style[i]=e[i]}),t.className=t.className.replace(/position-\w+/g,""),t.classList.add(`position-${this.state.ui.position}`))}repositionOpenModals(t){const{ui:e}=this.state;e.hubState==="expanded"&&this.dom.expandedContent&&this.updateModalPositions(t),e.hubState==="chatbot-active"&&this.dom.chatbotContainer&&this.updateModalPositions(t),e.customizationState==="open"&&this.dom.customizationPanel&&this.updateModalPositions(t)}destroy(){console.log("[PROFILE HUB] Destroying ProfileHub..."),this.listeners.forEach((t,e)=>{this.removeEventListener(e)}),Object.values(this.modules).forEach(t=>{t&&typeof t.destroy=="function"&&t.destroy()}),console.log("[PROFILE HUB] ProfileHub destroyed")}}class m{constructor(t){this.hub=t,console.log("[AUTH MODULE] Initialized")}handleAuthToggle(){this.hub.state.user.isAuthenticated?this.openProfileMenu():this.openAuthModal()}openAuthModal(){if(console.log("[AUTH MODULE] Opening auth modal..."),window.openAuthModal)window.openAuthModal("login");else{const t=document.getElementById("authModal");t&&(t.style.display="block",document.body.style.overflow="hidden")}this.hub.setState({ui:{hubState:"minimized"}})}openProfileMenu(){console.log("[AUTH MODULE] Opening profile menu..."),this.hub.toggleHub()}}class g{constructor(t){this.hub=t,this.initialized=!1,console.log("[CHATBOT MODULE] Initialized")}initialize(){this.initialized||(console.log("[CHATBOT MODULE] Setting up chatbot integration..."),this.setupChatbotListeners(),this.loadChatHistory(),this.setupQuickCommands(),this.initialized=!0,console.log("[CHATBOT MODULE] Chatbot integration ready"))}setupChatbotListeners(){const{dom:t}=this.hub;this.hub.addEventListener(t.sendChatBtn,"click",()=>{this.sendMessage()}),this.hub.addEventListener(t.chatInput,"keypress",a=>{a.key==="Enter"&&!a.shiftKey&&(a.preventDefault(),this.sendMessage())});const e=t.chatCommands?.querySelectorAll(".command-chip");e&&e.forEach(a=>{this.hub.addEventListener(a,"click",()=>{const d=a.dataset.command;this.executeCommand(d)})});const i=t.chatbotSlider?.querySelector("#chatbotClose"),s=t.chatbotSlider?.querySelector("#chatbotMinimize");i&&this.hub.addEventListener(i,"click",()=>{this.hub.setState({ui:{hubState:"minimized"}})}),s&&this.hub.addEventListener(s,"click",()=>{this.hub.setState({ui:{hubState:"expanded"}})})}async sendMessage(){const{dom:t}=this.hub,e=t.chatInput?.value.trim();if(e){if(console.log("[CHATBOT MODULE] Sending message:",e),t.chatInput.value="",this.addMessage(e,"user"),e.startsWith("/")){this.executeCommand(e);return}this.showTypingIndicator();try{const i=await this.getAIResponse(e);this.hideTypingIndicator(),this.addMessage(i,"ai")}catch(i){console.error("[CHATBOT MODULE] Error getting AI response:",i),this.hideTypingIndicator(),this.addMessage("Sorry, I encountered an error. Please try again.","ai")}}}addMessage(t,e){const{dom:i}=this.hub;if(!i.chatMessages)return;const s=document.createElement("div");s.className=`message ${e}-message`,s.innerHTML=`
      <div class="message-avatar">${e==="user"?"üë§":"ü§ñ"}</div>
      <div class="message-content">
        <p>${t}</p>
      </div>
    `,i.chatMessages.appendChild(s),i.chatMessages.scrollTop=i.chatMessages.scrollHeight,this.hub.setState({chatbot:{messages:[...this.hub.state.chatbot.messages,{content:t,sender:e,timestamp:Date.now()}]}}),console.log(`[CHATBOT MODULE] Added ${e} message`)}showTypingIndicator(){const{dom:t}=this.hub;if(!t.chatMessages)return;const e=document.createElement("div");e.className="message ai-message typing",e.id="hubTypingIndicator",e.innerHTML=`
      <div class="message-avatar">ü§ñ</div>
      <div class="message-content">
        <p>Thinking...</p>
      </div>
    `,t.chatMessages.appendChild(e),t.chatMessages.scrollTop=t.chatMessages.scrollHeight,this.hub.setState({chatbot:{isTyping:!0}})}hideTypingIndicator(){const t=document.getElementById("hubTypingIndicator");t&&t.remove(),this.hub.setState({chatbot:{isTyping:!1}})}async getAIResponse(t){try{const e=this.getContextualResponse(t);return e||(window.getAIResponse?await window.getAIResponse(t):this.getFallbackResponse(t))}catch(e){return console.error("[CHATBOT MODULE] AI response error:",e),"I'm here to help you navigate and customize your ProfileHub experience. What would you like to know?"}}getContextualResponse(t){const e=t.toLowerCase();return e.includes("navigate")||e.includes("go to")?"I can help you navigate! Use commands like '/navigate projects' to go to your projects, or click the navigation links in your expanded hub.":e.includes("customize")||e.includes("theme")?"To customize your ProfileHub, click the gear icon or use '/help customize'. You can change themes, colors, position, and more!":e.includes("stats")||e.includes("profile")?"Your profile stats show your widgets, followers, and views. Use '/stats' to see detailed information about your account.":null}getFallbackResponse(t){const e=["I'm your integrated AI assistant! I can help you navigate, customize your hub, and answer questions about the platform.","Try using commands like '/navigate projects' or '/help customize' for quick actions!","I can help you understand ProfileHub features. What would you like to explore?","Your ProfileHub is fully customizable! Ask me about themes, positioning, or navigation."];return e[Math.floor(Math.random()*e.length)]}executeCommand(t){console.log("[CHATBOT MODULE] Executing command:",t);const e=t.split(" "),i=e[0].substring(1),s=e.slice(1).join(" ");switch(i){case"navigate":this.executeNavigateCommand(s);break;case"help":this.executeHelpCommand(s);break;case"stats":this.executeStatsCommand();break;case"customize":this.executeCustomizeCommand();break;default:this.addMessage(`Unknown command: ${t}. Try '/help' for available commands.`,"ai")}}executeNavigateCommand(t){const e={projects:"pages/my-projects.html",studio:"pages/widget_studio.html",explore:"pages/explore.html",community:"pages/users.html"};e[t]?(this.addMessage(`Navigating to ${t}...`,"ai"),setTimeout(()=>{window.location.href=e[t]},1e3)):this.addMessage(`Available navigation targets: ${Object.keys(e).join(", ")}`,"ai")}executeHelpCommand(t){t==="customize"?(this.addMessage("To customize your ProfileHub: Click the gear icon, choose themes, adjust colors and position. Your changes are saved automatically!","ai"),this.hub.toggleCustomization()):this.addMessage(`Available commands:
      ‚Ä¢ /navigate [projects|studio|explore|community]
      ‚Ä¢ /help [customize]
      ‚Ä¢ /stats
      ‚Ä¢ /customize`,"ai")}executeStatsCommand(){const{user:t}=this.hub.state;t.isAuthenticated?this.addMessage(`Your Stats:
      ‚Ä¢ Level: ${t.profile?.level||1}
      ‚Ä¢ Widgets: ${t.profile?.stats?.widgetsCreated||0}
      ‚Ä¢ Followers: ${t.profile?.stats?.followersCount||0}
      ‚Ä¢ Views: ${t.profile?.stats?.totalViews||0}`,"ai"):this.addMessage("Please log in to view your stats!","ai")}executeCustomizeCommand(){this.addMessage("Opening customization panel...","ai"),this.hub.toggleCustomization()}setupQuickCommands(){}loadChatHistory(){try{const t=localStorage.getItem("profilehub-chat-history");if(t){const e=JSON.parse(t);this.hub.setState({chatbot:{messages:e}},!1),e.forEach(i=>{this.addMessage(i.content,i.sender)})}}catch(t){console.warn("[CHATBOT MODULE] Failed to load chat history:",t)}}}class p{constructor(t){this.hub=t,this.setupCustomizationControls(),console.log("[CUSTOMIZATION MODULE] Initialized")}setupCustomizationControls(){const t=document.getElementById("hubCustomizationPanel");if(!t)return;t.querySelectorAll(".theme-option").forEach(c=>{this.hub.addEventListener(c,"click",()=>{this.setTheme(c.dataset.theme)})});const i=t.querySelector("#hubPrimaryColor");i&&this.hub.addEventListener(i,"change",c=>{this.setPrimaryColor(c.target.value)});const s=t.querySelector("#hubSize");s&&this.hub.addEventListener(s,"input",c=>{this.setSize(parseFloat(c.target.value))});const a=t.querySelector("#saveCustomization"),d=t.querySelector("#resetCustomization");a&&this.hub.addEventListener(a,"click",()=>{this.saveCustomization()}),d&&this.hub.addEventListener(d,"click",()=>{this.resetCustomization()})}setTheme(t){console.log("[CUSTOMIZATION MODULE] Setting theme:",t),this.hub.setState({ui:{theme:t},user:{preferences:{theme:t}}}),document.querySelectorAll(".theme-option").forEach(e=>{e.classList.toggle("active",e.dataset.theme===t)})}setPrimaryColor(t){console.log("[CUSTOMIZATION MODULE] Setting primary color:",t),this.hub.dom.hub.style.setProperty("--hub-primary",t),this.hub.setState({user:{preferences:{primaryColor:t}}})}setSize(t){console.log("[CUSTOMIZATION MODULE] Setting size:",t),this.hub.setState({ui:{scale:t},user:{preferences:{scale:t}}})}saveCustomization(){this.hub.savePreferences(),this.showCustomizationToast("Customization saved!","success")}resetCustomization(){const t=this.hub.getDefaultPreferences();this.hub.setState({ui:{theme:t.theme,position:t.position,scale:t.scale},user:{preferences:t}}),this.updateCustomizationUI(),this.showCustomizationToast("Customization reset to defaults","info")}updateCustomizationUI(){const{ui:t}=this.hub.state;document.querySelectorAll(".theme-option").forEach(i=>{i.classList.toggle("active",i.dataset.theme===t.theme)}),document.getElementById("hubPrimaryColor");const e=document.getElementById("hubSize");e&&(e.value=t.scale)}showCustomizationToast(t,e){window.socialAuth&&window.socialAuth.showToast?window.socialAuth.showToast(t,e):console.log(`[CUSTOMIZATION MODULE] ${t}`)}}class b{constructor(t){this.hub=t,console.log("[NAVIGATION MODULE] Initialized")}openWidgetStudio(){console.log("[NAVIGATION MODULE] Opening Widget Studio..."),window.openWidgetStudio?window.openWidgetStudio():window.location.href="pages/widget_studio.html",this.hub.setState({ui:{hubState:"minimized"}})}shareProfile(){console.log("[NAVIGATION MODULE] Sharing profile...");const t=window.location.href;navigator.share?navigator.share({title:"Check out my profile!",url:t}):navigator.clipboard&&(navigator.clipboard.writeText(t),this.showNavigationToast("Profile URL copied to clipboard!","success"))}openNotifications(){console.log("[NAVIGATION MODULE] Opening notifications..."),window.openNotificationsPanel?window.openNotificationsPanel():this.showNavigationToast("Notifications panel coming soon!","info")}showNavigationToast(t,e){window.socialAuth&&window.socialAuth.showToast&&window.socialAuth.showToast(t,e)}}async function f(){try{console.log("[PROFILE HUB] Loading ProfileHub HTML content..."),await new Promise(s=>setTimeout(s,100));const o=["pages/page_modals/profile_banner.html","./pages/page_modals/profile_banner.html","/pages/page_modals/profile_banner.html"];let t=null,e=null;for(const s of o)try{console.log(`[PROFILE HUB] Trying to load from: ${s}`);const a=await fetch(s);if(a.ok){t=await a.text(),console.log(`[PROFILE HUB] Successfully loaded HTML from: ${s}`);break}else e=new Error(`Failed to load ProfileHub HTML from ${s}: ${a.status}`)}catch(a){e=a,console.warn(`[PROFILE HUB] Failed to load from ${s}:`,a.message)}if(!t)throw e||new Error("Failed to load ProfileHub HTML from any path");const i=document.getElementById("profileHubContainer");i?(i.innerHTML=t,console.log("[PROFILE HUB] ProfileHub HTML content loaded successfully"),initializeProfileHub()):(console.warn("[PROFILE HUB] ProfileHub container not found"),u())}catch(o){console.error("[PROFILE HUB] Error loading ProfileHub HTML:",o),r()}}function u(){const o=document.createElement("div");o.id="profileHubContainer",o.style.position="fixed",o.style.top="20px",o.style.right="20px",o.style.zIndex="1000",document.body.appendChild(o),console.log("[PROFILE HUB] Created ProfileHub container")}function r(){console.log("[PROFILE HUB] Creating fallback ProfileHub structure...");const o=document.getElementById("profileHubContainer");o&&(o.innerHTML=`
    <div id="profileHub" class="profile-hub" data-state="minimized">
      <div class="hub-core">
        <div class="hub-user-section">
          <div class="user-avatar-container">
            <div id="hubUserAvatar" class="hub-user-avatar">
              <span class="avatar-emoji">üë§</span>
              <div class="avatar-status-indicator" id="hubStatusIndicator"></div>
            </div>
          </div>
          <div class="hub-user-info">
            <div id="hubUserName" class="hub-user-name">Guest</div>
            <div id="hubUserStatus" class="hub-user-status">Click to customize</div>
            <div id="hubUserLevel" class="hub-user-level">LVL ‚Ä¢ ?</div>
          </div>
        </div>
        <div class="hub-controls">
          <button id="hubChatbotToggle" class="hub-control-btn" title="AI Assistant">
            <span class="btn-icon">ü§ñ</span>
            <span class="btn-pulse" id="chatbotPulse"></span>
          </button>
          <button id="hubCustomizeToggle" class="hub-control-btn" title="Explore">
            <span class="btn-icon">‚öôÔ∏è</span>
          </button>
          <button id="hubAuthToggle" class="hub-control-btn hub-auth-btn" title="Login / Profile">
            <span class="btn-icon">üîê</span>
          </button>
        </div>
        <button id="hubToggleBtn" class="hub-toggle-btn" title="Expand Hub">
          <span class="toggle-icon">‚´∑</span>
        </button>
      </div>
      <div class="hub-expanded-content" id="hubExpandedContent">
        <div class="hub-navigation">
          <h3 class="nav-section-title">Navigate</h3>
          <div class="nav-links-grid">
            <a href="pages/my-projects.html" class="nav-link" data-color="primary">
              <span class="nav-icon">üìä</span>
              <span class="nav-label">Projects</span>
            </a>
            <a href="pages/widget_studio.html" class="nav-link" data-color="secondary">
              <span class="nav-icon">üé®</span>
              <span class="nav-label">Studio</span>
            </a>
            <a href="pages/explore.html" class="nav-link" data-color="accent">
              <span class="nav-icon">üîç</span>
              <span class="nav-label">Explore</span>
            </a>
            <a href="pages/users.html" class="nav-link" data-color="success">
              <span class="nav-icon">üë•</span>
              <span class="nav-label">Community</span>
            </a>
          </div>
        </div>
        <div class="hub-quick-actions">
          <h3 class="nav-section-title">Quick Actions</h3>
          <div class="quick-actions-grid">
            <button class="quick-action-btn" data-action="newWidget">
              <span class="action-icon">‚ûï</span>
              <span class="action-label">New Widget</span>
            </button>
            <button class="quick-action-btn" data-action="shareProfile">
              <span class="action-icon">üîó</span>
              <span class="action-label">Share</span>
            </button>
            <button class="quick-action-btn" data-action="notifications">
              <span class="action-icon">üîî</span>
              <span class="action-label">Notifications</span>
              <span class="notification-badge" id="hubNotificationBadge">0</span>
            </button>
            <button class="quick-action-btn" data-action="settings">
              <span class="action-icon">‚öôÔ∏è</span>
              <span class="action-label">Settings</span>
            </button>
          </div>
        </div>
        <div class="hub-user-stats" id="hubUserStats" style="display: none;">
          <h3 class="nav-section-title">Stats</h3>
          <div class="stats-grid">
            <div class="stat-item">
              <span class="stat-value" id="hubWidgetCount">0</span>
              <span class="stat-label">Widgets</span>
            </div>
            <div class="stat-item">
              <span class="stat-value" id="hubFollowerCount">0</span>
              <span class="stat-label">Followers</span>
            </div>
            <div class="stat-item">
              <span class="stat-value" id="hubViewCount">0</span>
              <span class="stat-label">Views</span>
            </div>
          </div>
        </div>
      </div>
      <div class="hub-chatbot-container" id="hubChatbotContainer">
        <div class="chatbot-slider" id="chatbotSlider">
          <div class="chatbot-header">
            <div class="chatbot-title">
              <span class="chatbot-icon">ü§ñ</span>
              <span>AI Assistant</span>
            </div>
            <div class="chatbot-controls">
              <button id="chatbotMinimize" class="chatbot-control-btn" title="Minimize">‚àí</button>
              <button id="chatbotClose" class="chatbot-control-btn" title="Close">√ó</button>
            </div>
          </div>
          <div class="chatbot-content">
            <div class="chat-messages" id="hubChatMessages">
              <div class="message ai-message">
                <div class="message-avatar">ü§ñ</div>
                <div class="message-content">
                  <p>Hi! I'm your AI assistant integrated into your ProfileHub. How can I help you navigate or customize your experience?</p>
                </div>
              </div>
            </div>
            <div class="chat-input-container">
              <input type="text" id="hubChatInput" class="chat-input" placeholder="Ask me anything..." maxlength="500">
              <button id="hubSendChatBtn" class="send-chat-btn">
                <span class="btn-icon">üì§</span>
              </button>
            </div>
            <div class="chat-quick-commands" id="hubChatCommands">
              <button class="command-chip" data-command="/navigate projects">üîó Projects</button>
              <button class="command-chip" data-command="/help customize">‚öôÔ∏è Customize</button>
              <button class="command-chip" data-command="/stats">üìä Stats</button>
              <button class="command-chip" data-command="/help">‚ùì Help</button>
            </div>
          </div>
        </div>
      </div>
      <div class="hub-customization-panel" id="hubCustomizationPanel">
        <div class="customization-content">
          <h3>Customize Your Hub</h3>
          <div class="customization-section">
            <label class="section-label">Theme</label>
            <div class="theme-selector">
              <button class="theme-option active" data-theme="neo-brutalist">Neo</button>
              <button class="theme-option" data-theme="minimal">Minimal</button>
              <button class="theme-option" data-theme="cyberpunk">Cyber</button>
              <button class="theme-option" data-theme="custom">Custom</button>
            </div>
          </div>
          <div class="customization-section">
            <label class="section-label">Primary Color</label>
            <input type="color" id="hubPrimaryColor" class="color-picker" value="#00f0ff">
          </div>
          <div class="customization-section">
            <label class="section-label">Hub Size</label>
            <input type="range" id="hubSize" class="size-slider" min="0.8" max="1.5" step="0.1" value="1">
          </div>
          <div class="customization-actions">
            <button id="saveCustomization" class="save-btn">Save Changes</button>
            <button id="resetCustomization" class="reset-btn">Reset</button>
          </div>
        </div>
      </div>
    </div>
    <div id="profileHubOverlay" class="profile-hub-overlay"></div>
  `,console.log("[PROFILE HUB] Fallback ProfileHub structure created"))}let n=null;async function h(){console.log("[PROFILE HUB] Starting ProfileHub system initialization...");try{let o=document.getElementById("profileHubContainer");return o||(console.log("[PROFILE HUB] Creating ProfileHub container..."),u(),o=document.getElementById("profileHubContainer")),await f(),await new Promise(t=>setTimeout(t,200)),n=new l,window.profileHubManager=n,console.log("[PROFILE HUB] ProfileHub system ready!"),!0}catch(o){console.error("[PROFILE HUB] Failed to initialize ProfileHub:",o),console.log("[PROFILE HUB] Attempting fallback initialization...");try{return r(),await new Promise(t=>setTimeout(t,100)),n=new l,window.profileHubManager=n,console.log("[PROFILE HUB] Fallback initialization successful!"),!0}catch(t){return console.error("[PROFILE HUB] Fallback initialization also failed:",t),!1}}}document.addEventListener("DOMContentLoaded",async()=>{console.log("[PROFILE HUB] DOM ready, initializing ProfileHub..."),await h()});window.toggleProfileHub=()=>n?.toggleHub();window.toggleProfileChatbot=()=>n?.toggleChatbot();window.openProfileCustomization=()=>n?.toggleCustomization();window.resetProfileBannerPosition=(o="top-right")=>{console.log("[PROFILE HUB DEBUG] Resetting position to:",o),n?(n.setState({ui:{position:o},user:{preferences:{position:o}}}),n.updateUI(),console.log("[PROFILE HUB DEBUG] Position reset complete")):console.warn("[PROFILE HUB DEBUG] ProfileHub manager not available")};window.forceShowProfileHub=()=>{if(console.log("[PROFILE HUB DEBUG] Forcing ProfileHub to show"),!document.getElementById("profileHubContainer")){console.error("[PROFILE HUB DEBUG] ProfileHub container not found!");return}const t=document.getElementById("profileHub");if(!t){console.error("[PROFILE HUB DEBUG] ProfileHub element not found! Creating fallback..."),r(),n||(console.log("[PROFILE HUB DEBUG] Creating ProfileHub manager..."),n=new l,window.profileHubManager=n);return}if(t.style.display="block",t.style.opacity="1",t.style.visibility="visible",t.style.zIndex="1000",t.style.position="fixed",t.style.top="20px",t.style.right="20px",console.log("[PROFILE HUB DEBUG] ProfileHub forced to show"),!n){console.log("[PROFILE HUB DEBUG] Initializing ProfileHub manager...");try{n=new l,window.profileHubManager=n,console.log("[PROFILE HUB DEBUG] ProfileHub manager initialized")}catch(e){console.error("[PROFILE HUB DEBUG] Failed to initialize ProfileHub manager:",e)}}};window.checkProfileHubStatus=()=>{console.log("[PROFILE HUB DEBUG] Checking ProfileHub status...");const o={container:!!document.getElementById("profileHubContainer"),profileHub:!!document.getElementById("profileHub"),manager:!!n,managerState:n?.state||null,cssLoaded:!!document.querySelector('link[href*="profile_banner.css"]'),scriptLoaded:!!window.ProfileHubEvents};return console.log("[PROFILE HUB DEBUG] Status:",o),o};window.ProfileHubEvents={onPositionChange:o=>{const t=e=>{o(e.detail)};return window.addEventListener("profilehub-position-changed",t),()=>{window.removeEventListener("profilehub-position-changed",t)}},onStateChange:o=>{const t=e=>{o(e.detail)};return window.addEventListener("profilehub-state-changed",t),()=>{window.removeEventListener("profilehub-state-changed",t)}},getCurrentPosition:()=>n?.state?.ui?.position||"top-right",getCurrentState:()=>n?.state?.ui?.hubState||"minimized",isModalOpen:o=>{if(!n)return!1;const{ui:t}=n.state;switch(o){case"expanded":return t.hubState==="expanded";case"chatbot":return t.hubState==="chatbot-active";case"customization":return t.customizationState==="open";default:return!1}}};window.openChatbot=()=>n?.toggleChatbot();window.openWorkflowManager=()=>{const o=document.getElementById("workflowManagerModal");o&&(o.style.display="block",document.body.style.overflow="hidden")};window.initProfileHub=()=>{console.log("[PROFILE HUB] Manual initialization triggered");try{n?console.log("[PROFILE HUB] ProfileHub already initialized"):(r(),n=new l,window.profileHubManager=n,console.log("[PROFILE HUB] Manual initialization successful"))}catch(o){console.error("[PROFILE HUB] Manual initialization failed:",o)}};window.openAuthModal=(o="login")=>{const t=document.getElementById("authModal");if(t){t.style.display="block",document.body.style.overflow="hidden";const e=document.getElementById("loginForm"),i=document.getElementById("signUpForm"),s=document.getElementById("forgotPasswordForm"),a=document.getElementById("authModalTitle");o==="signup"?(e.style.display="none",i.style.display="block",s.style.display="none",a.textContent="Sign Up"):o==="forgot"?(e.style.display="none",i.style.display="none",s.style.display="block",a.textContent="Reset Password"):(e.style.display="block",i.style.display="none",s.style.display="none",a.textContent="Login")}};console.log("[PROFILE HUB] ProfileHub module loaded successfully");setTimeout(()=>{if(!n){console.log("[PROFILE HUB] Timeout-based initialization triggered");try{const o=document.getElementById("profileHubContainer");o&&!o.querySelector("#profileHub")&&(console.log("[PROFILE HUB] Creating ProfileHub via timeout fallback"),r(),n=new l,window.profileHubManager=n,console.log("[PROFILE HUB] Timeout-based initialization successful"))}catch(o){console.error("[PROFILE HUB] Timeout-based initialization failed:",o)}}},2e3);window.repositionOrbToTopLeft=()=>{console.log("[PROFILE HUB DEBUG] Repositioning orb to top-left"),document.querySelector(".floating-orb-container")?(document.documentElement.style.setProperty("--orb-left","20px"),document.documentElement.style.setProperty("--orb-top","20px"),window.innerWidth<=768&&(document.documentElement.style.setProperty("--orb-left","15px"),document.documentElement.style.setProperty("--orb-top","15px")),console.log("[PROFILE HUB DEBUG] Orb repositioned to top-left successfully")):console.warn("[PROFILE HUB DEBUG] Orb container not found")};window.restoreProfileHub=()=>{console.log("[PROFILE HUB EMERGENCY] Restoring ProfileHub..."),r(),n||(n=new l,window.profileHubManager=n,console.log("[PROFILE HUB EMERGENCY] Manager created"));const o=document.getElementById("profileHub");o?(o.style.display="block",o.style.opacity="1",o.style.visibility="visible",o.style.position="fixed",o.style.top="20px",o.style.right="20px",o.style.zIndex="1000",console.log("[PROFILE HUB EMERGENCY] ProfileHub restored and visible!")):console.error("[PROFILE HUB EMERGENCY] Failed to restore ProfileHub")};window.testSlidingModal=()=>{console.log("[PROFILE HUB DEBUG] Testing sliding modal animation");const o=document.getElementById("hubCustomizationPanel");o?(o.classList.toggle("active"),console.log("[PROFILE HUB DEBUG] Sliding modal animation toggled")):console.warn("[PROFILE HUB DEBUG] Customization panel not found")};window.diagnoseProfileIssues=()=>{console.log("[PROFILE HUB DEBUG] Diagnosing profile connection issues...");const o={timestamp:new Date().toISOString(),profileHubContainer:!!document.getElementById("profileHubContainer"),profileHub:!!document.getElementById("profileHub"),profileHubManager:!!window.profileHubManager,authUser:!!window.socialAuth?.currentUser,firebaseAuth:!!window.auth?.currentUser,widgetDisplay:!!window.widgetDisplay,firestoreRules:"Check Firebase Console for updated rules",networkStatus:navigator.onLine?"online":"offline"};return console.log("[PROFILE HUB DEBUG] Diagnosis results:",o),o.profileHubContainer||console.error("[PROFILE HUB DEBUG] Missing profileHubContainer - this is critical!"),o.profileHub||console.error("[PROFILE HUB DEBUG] Missing profileHub element - HTML may not have loaded"),o.profileHubManager||console.error("[PROFILE HUB DEBUG] ProfileHub manager not initialized"),!o.authUser&&!o.firebaseAuth&&console.warn("[PROFILE HUB DEBUG] No authenticated user found"),o};window.reinitializeProfileHub=async()=>{if(console.log("[PROFILE HUB DEBUG] Force reinitializing ProfileHub..."),window.profileHubManager)try{window.profileHubManager.destroy()}catch(t){console.warn("[PROFILE HUB DEBUG] Error destroying existing manager:",t)}const o=document.getElementById("profileHubContainer");o&&(o.innerHTML=""),await h(),console.log("[PROFILE HUB DEBUG] Reinitialization complete")};
